<!DOCTYPE html>
<html>
<head>	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/zenburn.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js-bootstrap-css/1.2.1/typeaheadjs.min.css">
	<link rel="stylesheet" type="text/css" data-href="common.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/3.1.1/bootstrap3-typeahead.min.js"></script>
	<script data-src="common.js"></script>

	<script>
        (function () {
            var cachekey;
            try {
                cachekey = window.parent.CACHEKEY;
            }
            catch (e) {
                cachekey = 'nocache';
            }
            $('link[data-href]').attr('href', function () {
                return this.dataset.href + '?' + cachekey;
            });
            $('script[data-src]').attr('src', function () {
                return this.dataset.src + '?' + cachekey;
            });

            $(document).on('click', 'a[href]:not([target="_blank"]):not(.cachekey)', function () {
                this.classList.add('cachekey');
                this.href = this.href.replace('.html', '.html?' + cachekey);
            });
        })();
	</script>
    </head>
<body>
<a id="anchor" href="./" style="display: none"></a>
<h1 class="ellipsis">
	<span class="pull-left">
	Structure
	<small class="ellipsis-text">(ryunosuke\Functions\Package\Utility)</small>
	</span>
	<span class="pull-right">
		<small class="frame-switch">
		<a target="_parent">frame</a> | <a target="_parent">noframe</a>
		</small>
	</span>
</h1>
<div class="main-wrapper">
	<div class="attribute">
		<span class="label label-danger"></span>
		<span class="label label-warning"></span>
		<span class="label label-info"></span>
		<span class="label label-info"></span>
		<span class="label label-deprecated"></span>
        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L5-L1027" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                    	</div>

	<h2>class <span class="category-name">ryunosuke\Functions\Package\Utility</span></h2>

	<div class="description"><p>汎用的なユーティリティ</p>
</div>

	<h3>Construction</h3>
                
	<h3>Hierarchy</h3>
	<div class="hierarchy"></div>

	<h3>Constants</h3>
    
	<h3>Properties</h3>
    
	<h3>Methods</h3>
    		<ul>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L10-L211" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::date_interval()" tabindex="-1" class="structure-title ">
                        date_interval						<small>($sec, $format = null, $limit_type = &#039;y&#039;)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>秒を世紀・年・月・日・時間・分・秒・ミリ秒の各要素に分解する</p>
<p>例えば <code>60 * 60 * 24 * 900 + 12345.678</code> （約900日12345秒）は・・・</p>
<ul>
<li>2 年（約900日なので）</li>
<li>5 ヶ月（約(900 - 365 * 2 = 170)日なので）</li>
<li>18 日（約(170 - 30.416 * 5 = 18)日なので）</li>
<li>3 時間（約12345秒なので）</li>
<li>25 分（約(12345 - 3600 * 3 = 1545)秒なので）</li>
<li>45 秒（約(1545 - 60 * 25 = 45)秒なので）</li>
<li>678 ミリ秒（.678 部分そのまま）</li>
</ul>
<p>となる（年はうるう年未考慮で365日、月は30.41666666日で換算）。</p>
<p>$format を与えると DateInterval::format して文字列で返す。与えないと DateInterval をそのまま返す。<br />
$format はクロージャを与えることができる。クロージャを与えた場合、各要素を引数としてコールバックされる。<br />
$format は配列で与えることができる。配列で与えた場合、 0 になる要素は省かれる。<br />
セパレータを与えたり、pre/suffix を与えたりできるが、難解なので省略する。</p>
<p>$limit_type で換算のリミットを指定できる。例えば 'y' を指定すると「2年5ヶ月」となるが、 'm' を指定すると「29ヶ月」となる。<br />
数値を与えるとその範囲でオートスケールする。例えば 3 を指定すると値が大きいとき <code>ymd</code> の表示になり、年が 0 になると <code>mdh</code> の表示に切り替わるようになる。</p>
<p>Example:</p>
<pre><code class="language-php">// 書式文字列指定（%vはミリ秒）
assertSame(date_interval(60 * 60 * 24 * 900 + 12345.678, '%Y/%M/%D %H:%I:%S.%v'), '02/05/18 03:25:45.678');

// 書式にクロージャを与えるとコールバックされる（引数はスケールの小さい方から）
assertSame(date_interval(60 * 60 * 24 * 900 + 12345.678, function(){return implode(',', func_get_args());}), '678,45,25,3,18,5,2,0');

// リミットを指定（month までしか計算しないので year は 0 になり month は 29になる）
assertSame(date_interval(60 * 60 * 24 * 900 + 12345.678, '%Y/%M/%D %H:%I:%S.%v', 'm'), '00/29/18 03:25:45.678');

// 書式に配列を与えてリミットに数値を与えるとその範囲でオートスケールする
$format = [
    'y' =&gt; '%y年',
    'm' =&gt; '%mヶ月',
    'd' =&gt; '%d日',
    ' ',
    'h' =&gt; '%h時間',
    'i' =&gt; '%i分',
    's' =&gt; '%s秒',
];
// 数が大きいので年・月・日の3要素のみ
assertSame(date_interval(60 * 60 * 24 * 900 + 12345, $format, 3), '2年5ヶ月18日');
// 数がそこそこだと日・時間・分の3要素に切り替わる
assertSame(date_interval(60 * 60 * 24 * 20 + 12345, $format, 3), '20日 3時間25分');
// どんなに数が小さくても3要素以下にはならない
assertSame(date_interval(1234, $format, 3), '0時間20分34秒');

// 書式指定なし（DateInterval を返す）
assertInstanceOf(\DateInterval::class, date_interval(123.456));
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">int<span class="type-separator"></span><wbr>float</td>
				<td class="rest">$sec</td>
				<td class="desc"><p>タイムスタンプ</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>array</td>
				<td class="rest">$format = null</td>
				<td class="desc"><p>時刻フォーマット</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>int</td>
				<td class="rest">$limit_type = &#039;y&#039;</td>
				<td class="desc"><p>どこまで換算するか（[c|y|m|d|h|i|s]）</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">string<span class="type-separator"></span><wbr><a href="http://php.net/manual/ja/class.dateinterval.php" class="fqsen" target="_blank">\DateInterval</a></td>
			<td class="desc"><p>時間差文字列 or DateInterval オブジェクト</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L213-L236" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    							<span class="display-none" data-fqsen="ryunosuke\Test\Package\UtilityTest::test_get_uploaded_files()">			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/tests/Test/Package/UtilityTest.php#L102-L287" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            </span>
                        					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::get_uploaded_files()" tabindex="-1" class="structure-title ">
                        get_uploaded_files						<small>($files = null)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>$_FILES の構造を組み替えて $_POST などと同じにする</p>
<p>$_FILES の配列構造はバグとしか思えないのでそれを是正する関数。<br />
第1引数 $files は指定可能だが、大抵は $_FILES であり、指定するのはテスト用。</p>
<p>サンプルを書くと長くなるので例は<tag_source data-fqsen='ryunosuke\Test\Package\UtilityTest::test_get_uploaded_files()' data-description='テストファイル'>テストファイル</tag_source>を参照。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$files = null</td>
				<td class="desc"><p>$_FILES の同じ構造の配列。省略時は $_FILES</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>$_FILES を $_POST などと同じ構造にした配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L238-L257" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::cachedir()" tabindex="-1" class="structure-title ">
                        cachedir						<small>($dirname = null)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>本ライブラリで使用するキャッシュディレクトリを設定する</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>null</td>
				<td class="rest">$dirname = null</td>
				<td class="desc"><p>キャッシュディレクトリ。省略時は返すのみ</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">string</td>
			<td class="desc"><p>設定前のキャッシュディレクトリ</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L259-L393" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::cache()" tabindex="-1" class="structure-title ">
                        cache						<small>($key, $provider, $namespace = null)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>シンプルにキャッシュする</p>
<p>この関数は get/set/delete を兼ねる。<br />
キャッシュがある場合はそれを返し、ない場合は $provider を呼び出してその結果をキャッシュしつつそれを返す。</p>
<p>$provider に null を与えるとキャッシュの削除となる。</p>
<p>Example:</p>
<pre><code class="language-php">$provider = function(){return rand();};
// 乱数を返す処理だが、キャッシュされるので同じ値になる
$rand1 = cache('rand', $provider);
$rand2 = cache('rand', $provider);
assertSame($rand1, $rand2);
// $provider に null を与えると削除される
cache('rand', null);
$rand3 = cache('rand', $provider);
assertNotSame($rand1, $rand3);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$key</td>
				<td class="desc"><p>キャッシュのキー</p>
</td>
			</tr>
        			<tr>
				<td class="type">callable</td>
				<td class="rest">$provider</td>
				<td class="desc"><p>キャッシュがない場合にコールされる callable</p>
</td>
			</tr>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$namespace = null</td>
				<td class="desc"><p>名前空間</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">mixed</td>
			<td class="desc"><p>キャッシュ</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L395-L487" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::process()" tabindex="-1" class="structure-title ">
                        process						<small>($command, $args = [], $stdin = &#039;&#039;, &amp;$stdout = &#039;&#039;, &amp;$stderr = &#039;&#039;, $cwd = null, $env = null)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>proc_open ～ proc_close の一連の処理を行う</p>
<p>標準入出力は受け渡しできるが、決め打ち実装なのでいわゆる対話型なプロセスは起動できない。</p>
<p>Example:</p>
<pre><code class="language-php">// サンプル実行用ファイルを用意
$phpfile = sys_get_temp_dir() . '/rf-sample.php';
file_put_contents($phpfile, "&lt;?php
    fwrite(STDOUT, fgets(STDIN));
    fwrite(STDERR, 'err');
    exit((int) ini_get('max_file_uploads'));
");
// 引数と標準入出力エラーを使った単純な例
$rc = process(PHP_BINARY, [
    '-d' =&gt; 'max_file_uploads=123',
    $phpfile,
], 'out', $stdout, $stderr);
assertSame($rc, 123); // -d で与えた max_file_uploads で exit してるので 123
assertSame($stdout, 'out'); // 標準出力に標準入力を書き込んでいるので "out" が格納される
assertSame($stderr, 'err'); // 標準エラーに書き込んでいるので "err" が格納される
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$command</td>
				<td class="desc"><p>実行コマンド。escapeshellcmd される</p>
</td>
			</tr>
        			<tr>
				<td class="type">array<span class="type-separator"></span><wbr>string</td>
				<td class="rest">$args = []</td>
				<td class="desc"><p>コマンドライン引数。文字列はそのまま結合される。配列は escapeshellarg された上でキーと結合される</p>
</td>
			</tr>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$stdin = &#039;&#039;</td>
				<td class="desc"><p>標準入力</p>
</td>
			</tr>
        			<tr>
				<td class="type">string</td>
				<td class="rest">&amp;$stdout = &#039;&#039;</td>
				<td class="desc"><p>標準出力（参照渡しで格納される）</p>
</td>
			</tr>
        			<tr>
				<td class="type">string</td>
				<td class="rest">&amp;$stderr = &#039;&#039;</td>
				<td class="desc"><p>標準エラー（参照渡しで格納される）</p>
</td>
			</tr>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$cwd = null</td>
				<td class="desc"><p>作業ディレクトリ</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$env = null</td>
				<td class="desc"><p>環境変数</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">int</td>
			<td class="desc"><p>リターンコード</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L489-L662" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::arguments()" tabindex="-1" class="structure-title ">
                        arguments						<small>($rule, $argv = null)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>コマンドライン引数をパースして引数とオプションを返す</p>
<p>少しリッチな <tag_link data-kind='uri' data-type='http://php.net/manual/function.getopt.php' data-description='getopt'>getopt</tag_link> として使える（shell 由来のオプション構文(a:b::)はどうも馴染みにくい）。<br />
ただし「値が必須なオプション」はサポートしない。<br />
もっとも、オプションとして空文字が来ることはほぼ無いのでデフォルト値を空文字にすることで対応可能。</p>
<p>$rule に従って <code>--noval filename --opt optval</code> のような文字列・配列をパースする。<br />
$rule 配列の仕様は下記。</p>
<ul>
<li>キーは「オプション名」を指定する。ただし・・・<ul>
<li>数値キーは「引数」を意味する</li>
<li>スペースの後に「ショート名」を与えられる</li>
</ul>
</li>
<li>値は「デフォルト値」を指定する。ただし・・・<ul>
<li><code>[]</code> は「複数値オプション」を意味する（配列にしない限り同オプションの多重指定は許されない）</li>
<li><code>null</code> は「値なしオプション」を意味する（スイッチングオプション）</li>
</ul>
</li>
<li>空文字キーは解釈自体のオプションを与える<ul>
<li>今のところ throw のみの実装。配列ではなく bool を与えられる</li>
</ul>
</li>
</ul>
<p>上記の仕様でパースして「引数は数値連番、オプションはオプション名をキーとした配列」を返す。<br />
なお、いわゆる「引数」はどこに来ても良い（前オプション、後オプションの区別がない）。</p>
<p>$argv には配列や文字列が与えられるが、ほとんどテスト用に近く、普通は未指定で $argv を使うはず。</p>
<p>Example:</p>
<pre><code class="language-php">// いくつか織り交ぜたスタンダードな例
$rule = [
    'opt'       =&gt; 'def',    // 基本的には「デフォルト値」を表す
    'longopt l' =&gt; '',       // スペース区切りで「ショート名」を意味する
    1           =&gt; 'defarg', // 数値キーは「引数」を意味する
];
assertSame(arguments($rule, '--opt optval arg1 -l longval'), [
    'opt'     =&gt; 'optval',  // optval と指定している
    'longopt' =&gt; 'longval', // ショート名指定でも本来の名前で返ってくる
    'arg1',   // いわゆるコマンドライン引数（optval は opt に飲まれるので含まれない）
    'defarg', // いわゆるコマンドライン引数（与えられていないが、ルールの 1 =&gt; 'defarg' が活きている）
]);

// 「値なしオプション」と「複数値オプション」の例
$rule = [
    'noval1 l'  =&gt; null, // null は「値なしオプション」を意味する（指定されていれば true されていなければ false を返す）
    'noval2 m'  =&gt; null, // 同上
    'noval3 n'  =&gt; null, // 同上
    'opts o' =&gt; [],      // 配列を与えると「複数値オプション」を表す
];
assertSame(arguments($rule, '--opts o1 -ln arg1 -o o2 arg2 --opts o3'), [
    'noval1' =&gt; true,  // -ln で同時指定されているので true
    'noval2' =&gt; false, // -ln で同時指定されてないので false
    'noval3' =&gt; true,  // -ln の同時指定されているので true
    'opts'   =&gt; ['o1', 'o2', 'o3'], // ロング、ショート混在でも OK
    'arg1', // 一見 -ln のオプション値に見えるが、 noval は値なしなので引数として得られる
    'arg2', // 前オプション、後オプションの区別はないのでどこに居ようと引数として得られる
]);

// 空文字で解釈自体のオプションを与える
$rule = [
    ''  =&gt; false, // 定義されていないオプションが来ても例外を投げずに引数として処理する
];
assertSame(arguments($rule, '--long A -short B'), [
    '--long', // 明らかにオプション指定に見えるが、 long というオプションは定義されていないので引数として解釈される
    'A',      // 同上。long のオプション値に見えるが、ただの引数
    '-short', // 同上。short というオプションは定義されていない
    'B',      // 同上。short のオプション値に見えるが、ただの引数
]);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$rule</td>
				<td class="desc"><p>オプションルール</p>
</td>
			</tr>
        			<tr>
				<td class="type">array<span class="type-separator"></span><wbr>string<span class="type-separator"></span><wbr>null</td>
				<td class="rest">$argv = null</td>
				<td class="desc"><p>パースするコマンドライン引数。未指定時は $argv が使用される</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>コマンドライン引数＋オプション</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L664-L764" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::stacktrace()" tabindex="-1" class="structure-title ">
                        stacktrace						<small>($traces = null, $option = [
    &#039;format&#039; =&gt; &#039;%s:%s %s&#039;,
    &#039;limit&#039;  =&gt; 16,
])</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>スタックトレースを文字列で返す</p>
<p><code>(new \Exception())-&gt;getTraceAsString()</code> と実質的な役割は同じ。<br />
ただし、 getTraceAsString は引数が Array になったりクラス名しか取れなかったり微妙に使い勝手が悪いのでもうちょっと情報量を増やしたもの。</p>
<p>第1引数 $traces はトレース的配列を受け取る（<code>(new \Exception())-&gt;getTrace()</code> とか）。<br />
未指定時は debug_backtrace() で採取する。</p>
<p>第2引数 $option は文字列化する際の設定を指定するが、あまり指定することはないはず。<br />
今のところ limit と format のみであり、かつこれらは比較的指定頻度が高いので配列オプションではなく直に渡すことが可能になっている。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$traces = null</td>
				<td class="desc"><p>debug_backtrace 的な配列</p>
</td>
			</tr>
        			<tr>
				<td class="type">int<span class="type-separator"></span><wbr>string<span class="type-separator"></span><wbr>array</td>
				<td class="rest">$option = [
    &#039;format&#039; =&gt; &#039;%s:%s %s&#039;,
    &#039;limit&#039;  =&gt; 16,
]</td>
				<td class="desc"><p>オプション</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">string</td>
			<td class="desc"><p>トレース文字列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L766-L823" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::backtrace()" tabindex="-1" class="structure-title ">
                        backtrace						<small>($flags = DEBUG_BACKTRACE_PROVIDE_OBJECT, $options = [])</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>特定条件までのバックトレースを取得する</p>
<p>第2引数 $options を満たすトレース以降を返す。<br />
$options は ['$trace の key' =&gt; "条件"] を渡す。<br />
条件は文字列かクロージャで、文字列の場合は緩い一致、クロージャの場合は true を返した場合にそれ以降を返す。</p>
<p>Example:</p>
<pre><code class="language-php">function f001 () {return backtrace(0, ['function' =&gt; __NAMESPACE__ . '\\f002', 'limit' =&gt; 2]);}
function f002 () {return f001();}
function f003 () {return f002();}
$traces = f003();
// limit 指定してるので2個
assertCount(2, $traces);
// 「function が f002 以降」を返す
assertArraySubset([
    'function' =&gt; __NAMESPACE__ . '\\f002'
], $traces[0]);
assertArraySubset([
    'function' =&gt; __NAMESPACE__ . '\\f003'
], $traces[1]);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">int</td>
				<td class="rest">$flags = DEBUG_BACKTRACE_PROVIDE_OBJECT</td>
				<td class="desc"><p>debug_backtrace の引数</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$options = []</td>
				<td class="desc"><p>フィルタ条件</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>バックトレース</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L825-L884" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::error()" tabindex="-1" class="structure-title ">
                        error						<small>($message, $destination = null)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>エラー出力する</p>
<p>第1引数 $message はそれらしく文字列化されて出力される。基本的にはあらゆる型を与えて良い。</p>
<p>第2引数 $destination で出力対象を指定する。省略すると error_log 設定に従う。<br />
文字列を与えるとファイル名とみなし、ファイルに追記される。<br />
ファイルを開くが、<strong>ファイルは閉じない</strong>。閉じ処理は php の終了処理に身を任せる。<br />
したがって閉じる必要がある場合はファイルポインタを渡す必要がある。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>mixed</td>
				<td class="rest">$message</td>
				<td class="desc"><p>出力メッセージ</p>
</td>
			</tr>
        			<tr>
				<td class="type">resource<span class="type-separator"></span><wbr>string<span class="type-separator"></span><wbr>mixed</td>
				<td class="rest">$destination = null</td>
				<td class="desc"><p>出力先</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">int</td>
			<td class="desc"><p>書き込んだバイト数</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L886-L913" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::timer()" tabindex="-1" class="structure-title ">
                        timer						<small>($callable, $count = 1)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>処理時間を計測する</p>
<p>第1引数 $callable を $count 回回してその処理時間を返す。</p>
<p>Example:</p>
<pre><code class="language-php">// 0.01 秒を 10 回回すので 0.1 秒は超える
assertGreaterThan(0.1, timer(function(){usleep(10 * 1000);}, 10));
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">callable</td>
				<td class="rest">$callable</td>
				<td class="desc"><p>処理クロージャ</p>
</td>
			</tr>
        			<tr>
				<td class="type">int</td>
				<td class="rest">$count = 1</td>
				<td class="desc"><p>ループ回数</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">float</td>
			<td class="desc"><p>処理時間</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L915-L1026" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::benchmark()" tabindex="-1" class="structure-title ">
                        benchmark						<small>($suite, $args = [], $millisec = 1000, $output = true)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>簡易ベンチマークを取る</p>
<p>「指定ミリ秒内で何回コールできるか？」でベンチする。</p>
<p>$suite は ['表示名' =&gt; $callable] 形式の配列。<br />
表示名が与えられていない場合、それらしい名前で表示する。</p>
<p>Example:</p>
<pre><code class="language-php">// intval と int キャストはどちらが早いか調べる
benchmark([
    'intval',
    'intcast' =&gt; function($v){return (int)$v;},
], ['12345'], 10);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array<span class="type-separator"></span><wbr>callable</td>
				<td class="rest">$suite</td>
				<td class="desc"><p>ベンチ対象処理</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$args = []</td>
				<td class="desc"><p>各ケースに与えられる引数</p>
</td>
			</tr>
        			<tr>
				<td class="type">int</td>
				<td class="rest">$millisec = 1000</td>
				<td class="desc"><p>呼び出しミリ秒</p>
</td>
			</tr>
        			<tr>
				<td class="type">bool</td>
				<td class="rest">$output = true</td>
				<td class="desc"><p>true だと標準出力に出力される</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>ベンチ結果の配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            		</ul>
    
	<div class="attribute">
		<span class="label label-default"></span>
		<span class="label label-default"></span>
	</div>
	<div class="clearfix"></div>
</div>
</body>
</html>
