<!DOCTYPE html>
<html>
<head>	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/foundation.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js-bootstrap-css/1.2.1/typeaheadjs.min.css">
	<link rel="stylesheet" type="text/css" data-href="common.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/3.1.1/bootstrap3-typeahead.min.js"></script>
	<script data-src="common.js"></script>

	<script>
        (function () {
            var cachekey;
            try {
                cachekey = window.parent.CACHEKEY;
            }
            catch (e) {
                cachekey = 'nocache';
            }
            $('link[data-href]').attr('href', function () {
                return this.dataset.href + '?' + cachekey;
            });
            $('script[data-src]').attr('src', function () {
                return this.dataset.src + '?' + cachekey;
            });

            $(document).on('click', 'a[href]:not([target="_blank"]):not(.cachekey)', function () {
                this.classList.add('cachekey');
                this.href = this.href.replace('.html', '.html?' + cachekey);
            });
        })();
	</script>
    </head>
<body class="typespace">
<a id="anchor" href="./" style="display: none"></a>
<h1 class="ellipsis fixed">
	<span class="pull-left">
	Structure
	<small class="ellipsis-text">(ryunosuke\Functions\Package\Utility)</small>
	</span>
	<span class="pull-right">
		<small class="frame-switch">
		<a target="_parent">frame</a> | <a target="_parent">noframe</a>
		</small>
	</span>
</h1>
<div class="main-wrapper">
	<div class="attribute">
		<span class="label label-danger"></span>
		<span class="label label-warning"></span>
		<span class="label label-info"></span>
		<span class="label label-info"></span>
		<span class="label label-deprecated"></span>
        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L5-L1957" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                    	</div>

	<h2>class <span class="category-name">ryunosuke\Functions\Package\Utility</span></h2>

	<div class="description"><p>汎用的なユーティリティ</p>
</div>

	<h3>Construction</h3>
                
	<h3>Hierarchy</h3>
	<div class="hierarchy"></div>

	<h3>Constants</h3>
    
	<h3>Properties</h3>
    
	<h3>Methods</h3>
    		<ul>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L10-L31" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::ini_sets()" tabindex="-1" class="structure-title ">
                        ini_sets                        	<small>($values) : callable</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>複数の php.ini の設定をまとめて設定する</p>
<p>返り値として「もとに戻すためのクロージャ」を返すので、復元するためにはそのクロージャを呼ぶだけで良い。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$values</td>
				<td class="desc"><p>ini のエントリ名と値の配列</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">callable</td>
			<td class="desc"><p>ini を元に戻すクロージャ</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L33-L56" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    							<span class="display-none" data-fqsen="ryunosuke\Test\Package\UtilityTest::test_get_uploaded_files()">			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/tests/Test/Package/UtilityTest.php#L29-L214" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            </span>
                        					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::get_uploaded_files()" tabindex="-1" class="structure-title ">
                        get_uploaded_files                        	<small>($files = null) : array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>$_FILES の構造を組み替えて $_POST などと同じにする</p>
<p>$_FILES の配列構造はバグとしか思えないのでそれを是正する関数。<br />
第1引数 $files は指定可能だが、大抵は $_FILES であり、指定するのはテスト用。</p>
<p>サンプルを書くと長くなるので例は<tag_source data-fqsen='ryunosuke\Test\Package\UtilityTest::test_get_uploaded_files()' data-description='テストファイル'>テストファイル</tag_source>を参照。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">?array</td>
				<td class="rest">$files = null</td>
				<td class="desc"><p>$_FILES の同じ構造の配列。省略時は $_FILES</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>$_FILES を $_POST などと同じ構造にした配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L58-L126" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::number_serial()" tabindex="-1" class="structure-title ">
                        number_serial                        	<small>($numbers, $step = 1, $separator = null, $doSort = true) : array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>連続した数値の配列を縮めて返す</p>
<p>例えば <code>[1, 2, 4, 6, 7, 9]</code> が <code>['1~2', 4, '6~7', 9]</code> になる。<br />
結合法則は指定可能（上記は "~" を指定したもの）。<br />
null を与えると配列の配列で返すことも可能。</p>
<p>Example:</p>
<pre><code class="language-php">// 単純に文字列指定
that(number_serial([1, 2, 4, 6, 7, 9], 1, '~'))-&gt;is(['1~2', 4, '6~7', 9]);
// null を与えると from, to の配列で返す
that(number_serial([1, 2, 4, 6, 7, 9], 1, null))-&gt;is([[1, 2], [4, 4], [6, 7], [9, 9]]);
// $step は負数・小数・逆順も対応している（正負でよしなにソートされる）
that(number_serial([-9, 0.2, 0.5, -0.3, 0.1, 0, -0.2, 9], -0.1, '~'))-&gt;is([9, 0.5, '0.2~0', '-0.2~-0.3', -9]);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">iterable<span class="type-separator"></span><wbr>array</td>
				<td class="rest">$numbers</td>
				<td class="desc"><p>数値配列</p>
</td>
			</tr>
        			<tr>
				<td class="type">int<span class="type-separator"></span><wbr>float</td>
				<td class="rest">$step = 1</td>
				<td class="desc"><p>連続とみなすステップ。負数を指定すれば逆順指定にも使える</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>null<span class="type-separator"></span><wbr><a href="http://php.net/manual/ja/class.closure.php" class="fqsen" target="_blank">\Closure</a></td>
				<td class="rest">$separator = null</td>
				<td class="desc"><p>連続列を結合する文字列（string: 文字結合、null: 配列、Closure: 2引数が渡ってくる）</p>
</td>
			</tr>
        			<tr>
				<td class="type">bool</td>
				<td class="rest">$doSort = true</td>
				<td class="desc"><p>ソートをするか否か。事前にソート済みであることが明らかであれば false の方が良い</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>連続値をまとめた配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L128-L267" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::cacheobject()" tabindex="-1" class="structure-title ">
                        cacheobject                        	<small>($directory) : <a href="Psr-SimpleCache-CacheInterface$typespace.html#Psr\SimpleCache\CacheInterface" class="fqsen "><small>Psr\SimpleCache\</small><wbr>CacheInterface</a></small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>psr-16 を実装したキャッシュオブジェクトを返す</p>
<p>このオブジェクトはあくまで「他のパッケージに依存したくない」場合のデフォルト実装としての使用を想定している。</p>
<ul>
<li>キャッシュはファイルシステムに保存される</li>
<li>キャッシュキーの . はディレクトリ区切りとして使用される</li>
<li>TTL を指定しなかったときのデフォルト値は約100年（実質無期限だろう）</li>
<li>clear するとディレクトリ自体を吹き飛ばすのでそのディレクトリはキャッシュ以外の用途に使用してはならない</li>
</ul>
<p>psr-16 は依存に含めていないので別途 composer require psr/simple-cache が必要。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$directory</td>
				<td class="desc"><p>キャッシュ保存ディレクトリ</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="Psr-SimpleCache-CacheInterface$typespace.html#Psr\SimpleCache\CacheInterface" class="fqsen "><small>Psr\SimpleCache\</small><wbr>CacheInterface</a></td>
			<td class="desc"><p>psr-16 実装オブジェクト</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L269-L293" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::cachedir()" tabindex="-1" class="structure-title ">
                        cachedir                        	<small>($dirname = null) : string</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>本ライブラリで使用するキャッシュディレクトリを設定する</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>null</td>
				<td class="rest">$dirname = null</td>
				<td class="desc"><p>キャッシュディレクトリ。省略時は返すのみ</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">string</td>
			<td class="desc"><p>設定前のキャッシュディレクトリ</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L295-L432" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::cache()" tabindex="-1" class="structure-title ">
                        cache                        	<small>($key, $provider, $namespace = null) : mixed</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>シンプルにキャッシュする</p>
<p>この関数は get/set/delete を兼ねる。<br />
キャッシュがある場合はそれを返し、ない場合は $provider を呼び出してその結果をキャッシュしつつそれを返す。</p>
<p>$provider に null を与えるとキャッシュの削除となる。</p>
<p>Example:</p>
<pre><code class="language-php">$provider = function(){return rand();};
// 乱数を返す処理だが、キャッシュされるので同じ値になる
$rand1 = cache('rand', $provider);
$rand2 = cache('rand', $provider);
that($rand1)-&gt;isSame($rand2);
// $provider に null を与えると削除される
cache('rand', null);
$rand3 = cache('rand', $provider);
that($rand1)-&gt;isNotSame($rand3);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$key</td>
				<td class="desc"><p>キャッシュのキー</p>
</td>
			</tr>
        			<tr>
				<td class="type">callable</td>
				<td class="rest">$provider</td>
				<td class="desc"><p>キャッシュがない場合にコールされる callable</p>
</td>
			</tr>
        			<tr>
				<td class="type">?string</td>
				<td class="rest">$namespace = null</td>
				<td class="desc"><p>名前空間</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">mixed</td>
			<td class="desc"><p>キャッシュ</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L434-L595" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::parse_namespace()" tabindex="-1" class="structure-title ">
                        parse_namespace                        	<small>($filename) : array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>php ファイルをパースして名前空間配列を返す</p>
<p>ファイル内で use/use const/use function していたり、シンボルを定義していたりする箇所を検出して名前空間単位で返す。</p>
<p>Example:</p>
<pre><code class="language-php">// このような php ファイルをパースすると・・・
file_set_contents(sys_get_temp_dir() . '/namespace.php', '
&lt;?php
namespace NS1;
use ArrayObject as AO;
use function strlen as SL;
function InnerFunc(){}
class InnerClass{}

namespace NS2;
use RuntimeException as RE;
use const COUNT_RECURSIVE as CR;
class InnerClass{}
const InnerConst = 123;
');
// このような名前空間配列が得られる
that(parse_namespace(sys_get_temp_dir() . '/namespace.php'))-&gt;isSame([
    'NS1' =&gt; [
        'const'    =&gt; [],
        'function' =&gt; [
            'SL'        =&gt; 'strlen',
            'InnerFunc' =&gt; 'NS1\\InnerFunc',
        ],
        'alias'    =&gt; [
            'AO'         =&gt; 'ArrayObject',
            'InnerClass' =&gt; 'NS1\\InnerClass',
        ],
    ],
    'NS2' =&gt; [
        'const'    =&gt; [
            'CR'         =&gt; 'COUNT_RECURSIVE',
            'InnerConst' =&gt; 'NS2\\InnerConst',
        ],
        'function' =&gt; [],
        'alias'    =&gt; [
            'RE'         =&gt; 'RuntimeException',
            'InnerClass' =&gt; 'NS2\\InnerClass',
        ],
    ],
]);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$filename</td>
				<td class="desc"><p>ファイル名</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>名前空間配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L597-L660" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::resolve_symbol()" tabindex="-1" class="structure-title ">
                        resolve_symbol                        	<small>($shortname, $nsfiles, $targets = [&quot;const&quot;, &quot;function&quot;, &quot;alias&quot;]) : string<span class="type-separator"></span><wbr>null</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>エイリアス名を完全修飾名に解決する</p>
<p>例えばあるファイルのある名前空間で <code>use Hoge\Fuga\Piyo;</code> してるときの <code>Piyo</code> を <code>Hoge\Fuga\Piyo</code> に解決する。</p>
<p>Example:</p>
<pre><code class="language-php">// このような php ファイルがあるとして・・・
file_set_contents(sys_get_temp_dir() . '/symbol.php', '
&lt;?php
namespace vendor\NS;

use ArrayObject as AO;
use function strlen as SL;

function InnerFunc(){}
class InnerClass{}
');
// 下記のように解決される
that(resolve_symbol('AO', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('ArrayObject');
that(resolve_symbol('SL', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('strlen');
that(resolve_symbol('InnerFunc', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('vendor\\NS\\InnerFunc');
that(resolve_symbol('InnerClass', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('vendor\\NS\\InnerClass');
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$shortname</td>
				<td class="desc"><p>エイリアス名</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>array</td>
				<td class="rest">$nsfiles</td>
				<td class="desc"><p>ファイル名 or [ファイル名 =&gt; 名前空間名]</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$targets = [&quot;const&quot;, &quot;function&quot;, &quot;alias&quot;]</td>
				<td class="desc"><p>エイリアスタイプ（'const', 'function', 'alias' のいずれか）</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">string<span class="type-separator"></span><wbr>null</td>
			<td class="desc"><p>完全修飾名。解決できなかった場合は null</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L662-L845" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::parse_annotation()" tabindex="-1" class="structure-title ">
                        parse_annotation                        	<small>($annotation, $schema = [], $nsfiles = []) : array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>アノテーションっぽい文字列をそれっぽくパースして返す</p>
<p>$annotation にはリフレクションオブジェクトも渡せる。<br />
その場合、getDocComment や getFilename, getNamespaceName などを用いてある程度よしなに名前解決する。<br />
もっとも、@Class(args) 形式を使わないのであれば特に意味はない。</p>
<p>$schame で「どのように取得するか？」のスキーマ定義が渡せる。<br />
ただし、現実装では「そのまま文字列で返すか？」の bool 値とクロージャしか渡すことはできない。</p>
<p>アノテーションの仕様は下記（すべて $schema が false であるとする）。</p>
<ul>
<li>@から行末まで（1行に複数のアノテーションは含められない）<ul>
<li>ただし行末が <code>({[</code> のいずれかであれば次の <code>]})</code> までブロックを記載する機会が与えられる</li>
<li>ブロックを見つけたときは本来値となるべき値がキーに、ブロックが値となり、結果は必ず配列化される</li>
</ul>
</li>
<li>同じアノテーションを複数見つけたときは配列化される</li>
<li><code>@hogera</code>: 値なしは null を返す</li>
<li><code>@hogera v1 "v2 v3"</code>: ["v1", "v2 v3"] という配列として返す</li>
<li><code>@hogera {key: 123}</code>: ["key" =&gt; 123] という（連想）配列として返す</li>
<li><code>@hogera [123, 456]</code>: [123, 456] という連番配列として返す</li>
<li><code>@hogera ("2019/12/23")</code>: hogera で解決できるクラス名で new して返す（$filename 引数の指定が必要）</li>
<li>下3つの形式はアノテーション区切りのスペースはあってもなくても良い</li>
</ul>
<p>$schema が true だと上記のような変換は一切行わず、素朴な文字列で返す。<br />
あくまで簡易実装であり、本格的に何かをしたいなら専用のパッケージを導入したほうが良い。</p>
<p>Example:</p>
<pre><code class="language-php">$annotations = parse_annotation('
冒頭の - に意味はない
- @noval
- @single this is value
- @closure this is value
- @array this is value
- @hash {key: 123}
- @list [1, 2, 3]
- @ArrayObject([1, 2, 3])
- @block message {
      this is message1
      this is message2
  }
- @same this is same value1
- @same this is same value2
- @same this is same value3
', [
    'single'  =&gt; true,
    'closure' =&gt; function ($value) { return explode(' ', strtoupper($value)); },
]);
that($annotations)-&gt;is([
    'noval'       =&gt; null,                        // 値なしは null になる
    'single'      =&gt; 'this is value',             // $schema 指定してるので文字列になる
    'closure'     =&gt; ['THIS', 'IS', 'VALUE'],     // $schema 指定してそれがクロージャだとコールバックされる
    'array'       =&gt; ['this', 'is', 'value'],     // $schema 指定していないので配列になる
    'hash'        =&gt; ['key' =&gt; '123'],            // 連想配列になる
    'list'        =&gt; [1, 2, 3],                   // 連番配列になる
    'ArrayObject' =&gt; new \ArrayObject([1, 2, 3]), // new されてインスタンスになる
    "block"       =&gt; [                            // ブロックはブロック外をキーとした連想配列になる（複数指定でキーは指定できるイメージ）
        "message" =&gt; ["this is message1\n      this is message2"],
    ],
    'same'        =&gt; [                            // 複数あるのでそれぞれの配列になる
        ['this', 'is', 'same', 'value1'],
        ['this', 'is', 'same', 'value2'],
        ['this', 'is', 'same', 'value3'],
    ],
]);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr><a href="http://php.net/manual/ja/class.reflector.php" class="fqsen" target="_blank">\Reflector</a></td>
				<td class="rest">$annotation</td>
				<td class="desc"><p>アノテーション文字列</p>
</td>
			</tr>
        			<tr>
				<td class="type">array<span class="type-separator"></span><wbr>mixed</td>
				<td class="rest">$schema = []</td>
				<td class="desc"><p>スキーマ定義</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>array</td>
				<td class="rest">$nsfiles = []</td>
				<td class="desc"><p>ファイル名 or [ファイル名 =&gt; 名前空間名]</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>アノテーション配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L847-L875" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::is_ansi()" tabindex="-1" class="structure-title ">
                        is_ansi                        	<small>($stream) : bool</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>リソースが ansi color に対応しているか返す</p>
<p>パイプしたりリダイレクトしていると false を返す。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">resource</td>
				<td class="rest">$stream</td>
				<td class="desc"><p>調べるリソース</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">bool</td>
			<td class="desc"><p>ansi color に対応しているなら true</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            	<table class="table">
		<caption>See</caption>
		<tbody>
        			<tr>
				<td class="type">
                    						<a href="https://github.com/symfony/console/blob/v4.2.8/Output/StreamOutput.php#L98" target="_blank">https://github.com/symfony/console/blob/v4.2.8/Output/StreamOutput.php#L98</a>
                    				</td>
				<td class="desc"></td>
			</tr>
        		</tbody>
	</table>
    					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L877-L940" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::ansi_colorize()" tabindex="-1" class="structure-title ">
                        ansi_colorize                        	<small>($string, $color) : string</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>文字列に ANSI Color エスケープシーケンスを埋め込む</p>
<ul>
<li>"blue" のような小文字色名は文字色</li>
<li>"BLUE" のような大文字色名は背景色</li>
<li>"bold" のようなスタイル名は装飾</li>
</ul>
<p>となる。その区切り文字は現在のところ厳密に定めていない（<code>fore+back|bold</code> のような形式で定めることも考えたけどメリットがない）。<br />
つまり、アルファベット以外で分割するので、</p>
<ul>
<li><code>blue|WHITE@bold</code>: 文字青・背景白・太字</li>
<li><code>blue WHITE bold underscore</code>: 文字青・背景白・太字・下線</li>
<li><code>italic|bold,blue+WHITE  </code>: 文字青・背景白・太字・斜体</li>
</ul>
<p>という動作になる（記号で区切られていれば形式はどうでも良いということ）。<br />
ただ、この指定方法は変更が入る可能性が高いのでスペースあたりで区切っておくのがもっとも無難。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$string</td>
				<td class="desc"><p>対象文字列</p>
</td>
			</tr>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$color</td>
				<td class="desc"><p>色とスタイル文字列</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">string</td>
			<td class="desc"><p>エスケープシーケンス付きの文字列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L942-L1063" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::process()" tabindex="-1" class="structure-title ">
                        process                        	<small>($command, $args = [], $stdin = &quot;&quot;, &amp;$stdout = &quot;&quot;, &amp;$stderr = &quot;&quot;, $cwd = null, $env = null) : int</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>proc_open ～ proc_close の一連の処理を行う</p>
<p>標準入出力は文字列で受け渡しできるが、決め打ち実装なのでいわゆる対話型なプロセスは起動できない。<br />
また、標準入出力はリソース型を渡すこともできる。</p>
<p>Example:</p>
<pre><code class="language-php">// サンプル実行用ファイルを用意
$phpfile = sys_get_temp_dir() . '/rf-sample.php';
file_put_contents($phpfile, "&lt;?php
    fwrite(STDOUT, fgets(STDIN));
    fwrite(STDERR, 'err');
    exit((int) ini_get('max_file_uploads'));
");
// 引数と標準入出力エラーを使った単純な例
$rc = process(PHP_BINARY, [
    '-d' =&gt; 'max_file_uploads=123',
    $phpfile,
], 'out', $stdout, $stderr);
that($rc)-&gt;isSame(123); // -d で与えた max_file_uploads で exit してるので 123
that($stdout)-&gt;isSame('out'); // 標準出力に標準入力を書き込んでいるので "out" が格納される
that($stderr)-&gt;isSame('err'); // 標準エラーに書き込んでいるので "err" が格納される
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$command</td>
				<td class="desc"><p>実行コマンド。php7.4 未満では escapeshellcmd される</p>
</td>
			</tr>
        			<tr>
				<td class="type">array<span class="type-separator"></span><wbr>string</td>
				<td class="rest">$args = []</td>
				<td class="desc"><p>コマンドライン引数。php7.4 未満では文字列はそのまま結合され、配列は escapeshellarg された上でキーと結合される</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>resource</td>
				<td class="rest">$stdin = &quot;&quot;</td>
				<td class="desc"><p>標準入力（string を渡すと単純に読み取れられる。resource を渡すと fread される）</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>resource</td>
				<td class="rest">&amp;$stdout = &quot;&quot;</td>
				<td class="desc"><p>標準出力（string を渡すと参照渡しで格納される。resource を渡すと fwrite される）</p>
</td>
			</tr>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>resource</td>
				<td class="rest">&amp;$stderr = &quot;&quot;</td>
				<td class="desc"><p>標準エラー（string を渡すと参照渡しで格納される。resource を渡すと fwrite される）</p>
</td>
			</tr>
        			<tr>
				<td class="type">?string</td>
				<td class="rest">$cwd = null</td>
				<td class="desc"><p>作業ディレクトリ</p>
</td>
			</tr>
        			<tr>
				<td class="type">?array</td>
				<td class="rest">$env = null</td>
				<td class="desc"><p>環境変数</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">int</td>
			<td class="desc"><p>リターンコード</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1065-L1238" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::arguments()" tabindex="-1" class="structure-title ">
                        arguments                        	<small>($rule, $argv = null) : array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>コマンドライン引数をパースして引数とオプションを返す</p>
<p>少しリッチな <tag_link data-kind='uri' data-type='http://php.net/manual/function.getopt.php' data-description='getopt'>getopt</tag_link> として使える（shell 由来のオプション構文(a:b::)はどうも馴染みにくい）。<br />
ただし「値が必須なオプション」はサポートしない。<br />
もっとも、オプションとして空文字が来ることはほぼ無いのでデフォルト値を空文字にすることで対応可能。</p>
<p>$rule に従って <code>--noval filename --opt optval</code> のような文字列・配列をパースする。<br />
$rule 配列の仕様は下記。</p>
<ul>
<li>キーは「オプション名」を指定する。ただし・・・<ul>
<li>数値キーは「引数」を意味する</li>
<li>スペースの後に「ショート名」を与えられる</li>
</ul>
</li>
<li>値は「デフォルト値」を指定する。ただし・・・<ul>
<li><code>[]</code> は「複数値オプション」を意味する（配列にしない限り同オプションの多重指定は許されない）</li>
<li><code>null</code> は「値なしオプション」を意味する（スイッチングオプション）</li>
</ul>
</li>
<li>空文字キーは解釈自体のオプションを与える<ul>
<li>今のところ throw のみの実装。配列ではなく bool を与えられる</li>
</ul>
</li>
</ul>
<p>上記の仕様でパースして「引数は数値連番、オプションはオプション名をキーとした配列」を返す。<br />
なお、いわゆる「引数」はどこに来ても良い（前オプション、後オプションの区別がない）。</p>
<p>$argv には配列や文字列が与えられるが、ほとんどテスト用に近く、普通は未指定で $argv を使うはず。</p>
<p>Example:</p>
<pre><code class="language-php">// いくつか織り交ぜたスタンダードな例
$rule = [
    'opt'       =&gt; 'def',    // 基本的には「デフォルト値」を表す
    'longopt l' =&gt; '',       // スペース区切りで「ショート名」を意味する
    1           =&gt; 'defarg', // 数値キーは「引数」を意味する
];
that(arguments($rule, '--opt optval arg1 -l longval'))-&gt;isSame([
    'opt'     =&gt; 'optval',  // optval と指定している
    'longopt' =&gt; 'longval', // ショート名指定でも本来の名前で返ってくる
    'arg1',   // いわゆるコマンドライン引数（optval は opt に飲まれるので含まれない）
    'defarg', // いわゆるコマンドライン引数（与えられていないが、ルールの 1 =&gt; 'defarg' が活きている）
]);

// 「値なしオプション」と「複数値オプション」の例
$rule = [
    'noval1 l'  =&gt; null, // null は「値なしオプション」を意味する（指定されていれば true されていなければ false を返す）
    'noval2 m'  =&gt; null, // 同上
    'noval3 n'  =&gt; null, // 同上
    'opts o' =&gt; [],      // 配列を与えると「複数値オプション」を表す
];
that(arguments($rule, '--opts o1 -ln arg1 -o o2 arg2 --opts o3'))-&gt;isSame([
    'noval1' =&gt; true,  // -ln で同時指定されているので true
    'noval2' =&gt; false, // -ln で同時指定されてないので false
    'noval3' =&gt; true,  // -ln の同時指定されているので true
    'opts'   =&gt; ['o1', 'o2', 'o3'], // ロング、ショート混在でも OK
    'arg1', // 一見 -ln のオプション値に見えるが、 noval は値なしなので引数として得られる
    'arg2', // 前オプション、後オプションの区別はないのでどこに居ようと引数として得られる
]);

// 空文字で解釈自体のオプションを与える
$rule = [
    ''  =&gt; false, // 定義されていないオプションが来ても例外を投げずに引数として処理する
];
that(arguments($rule, '--long A -short B'))-&gt;isSame([
    '--long', // 明らかにオプション指定に見えるが、 long というオプションは定義されていないので引数として解釈される
    'A',      // 同上。long のオプション値に見えるが、ただの引数
    '-short', // 同上。short というオプションは定義されていない
    'B',      // 同上。short のオプション値に見えるが、ただの引数
]);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$rule</td>
				<td class="desc"><p>オプションルール</p>
</td>
			</tr>
        			<tr>
				<td class="type">array<span class="type-separator"></span><wbr>string<span class="type-separator"></span><wbr>null</td>
				<td class="rest">$argv = null</td>
				<td class="desc"><p>パースするコマンドライン引数。未指定時は $argv が使用される</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>コマンドライン引数＋オプション</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1240-L1379" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::stacktrace()" tabindex="-1" class="structure-title ">
                        stacktrace                        	<small>($traces = null, $option = []) : string<span class="type-separator"></span><wbr>array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>スタックトレースを文字列で返す</p>
<p><code>(new \Exception())-&gt;getTraceAsString()</code> と実質的な役割は同じ。<br />
ただし、 getTraceAsString は引数が Array になったりクラス名しか取れなかったり微妙に使い勝手が悪いのでもうちょっと情報量を増やしたもの。</p>
<p>第1引数 $traces はトレース的配列を受け取る（<code>(new \Exception())-&gt;getTrace()</code> とか）。<br />
未指定時は debug_backtrace() で採取する。</p>
<p>第2引数 $option は文字列化する際の設定を指定する。<br />
情報量が増える分、機密も含まれる可能性があるため、 mask オプションで塗りつぶすキーや引数名を指定できる（クロージャの引数までは手出ししないため留意）。<br />
limit と format は比較的指定頻度が高いかつ互換性維持のため配列オプションではなく直に渡すことが可能になっている。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">?array</td>
				<td class="rest">$traces = null</td>
				<td class="desc"><p>debug_backtrace 的な配列</p>
</td>
			</tr>
        			<tr>
				<td class="type">int<span class="type-separator"></span><wbr>string<span class="type-separator"></span><wbr>array</td>
				<td class="rest">$option = []</td>
				<td class="desc"><p>オプション</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">string<span class="type-separator"></span><wbr>array</td>
			<td class="desc"><p>トレース文字列（delimiter オプションに null を渡すと配列で返す）</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1381-L1438" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::backtrace()" tabindex="-1" class="structure-title ">
                        backtrace                        	<small>($flags = DEBUG_BACKTRACE_PROVIDE_OBJECT, $options = []) : array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>特定条件までのバックトレースを取得する</p>
<p>第2引数 $options を満たすトレース以降を返す。<br />
$options は ['$trace の key' =&gt; "条件"] を渡す。<br />
条件は文字列かクロージャで、文字列の場合は緩い一致、クロージャの場合は true を返した場合にそれ以降を返す。</p>
<p>Example:</p>
<pre><code class="language-php">function f001 () {return backtrace(0, ['function' =&gt; __NAMESPACE__ . '\\f002', 'limit' =&gt; 2]);}
function f002 () {return f001();}
function f003 () {return f002();}
$traces = f003();
// limit 指定してるので2個
that($traces)-&gt;count(2);
// 「function が f002 以降」を返す
that($traces[0])-&gt;arraySubset([
    'function' =&gt; __NAMESPACE__ . '\\f002'
]);
that($traces[1])-&gt;arraySubset([
    'function' =&gt; __NAMESPACE__ . '\\f003'
]);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">int</td>
				<td class="rest">$flags = DEBUG_BACKTRACE_PROVIDE_OBJECT</td>
				<td class="desc"><p>debug_backtrace の引数</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$options = []</td>
				<td class="desc"><p>フィルタ条件</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>バックトレース</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1440-L1705" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::profiler()" tabindex="-1" class="structure-title ">
                        profiler                        	<small>($options = []) : <a href="http://php.net/manual/ja/class.traversable.php" class="fqsen" target="_blank">\Traversable</a><span class="type-separator"></span><wbr>callable</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>外部ツールに頼らない pure php なプロファイラを返す</p>
<p>file プロトコル上書きと ticks と debug_backtrace によるかなり無理のある実装なので動かない環境・コードは多い。<br />
その分お手軽だが下記の注意点がある。</p>
<ul>
<li>file プロトコルを上書きするので、既に読み込み済みのファイルは計上されない</li>
<li>tick されないステートメントは計上されない<ul>
<li>1行メソッドなどでありがち</li>
</ul>
</li>
<li>A-&gt;B-&gt;C という呼び出しで C が 3秒、B が 2秒、A が1秒かかった場合、 A は 6 秒、B は 5秒、C は 3 秒といて計上される<ul>
<li>つまり、配下の呼び出しも重複して計上される</li>
</ul>
</li>
</ul>
<p>この関数を呼んだ時点で計測は始まる。<br />
返り値としてイテレータを返すので、foreach で回せばコールスタック・回数・時間などが取得できる。<br />
配列で欲しい場合は直に呼べば良い。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$options = []</td>
				<td class="desc"><p>オプション配列</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="http://php.net/manual/ja/class.traversable.php" class="fqsen" target="_blank">\Traversable</a><span class="type-separator"></span><wbr>callable</td>
			<td class="desc"><p>プロファイライテレータ</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1707-L1766" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::error()" tabindex="-1" class="structure-title ">
                        error                        	<small>($message, $destination = null) : int</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>エラー出力する</p>
<p>第1引数 $message はそれらしく文字列化されて出力される。基本的にはあらゆる型を与えて良い。</p>
<p>第2引数 $destination で出力対象を指定する。省略すると error_log 設定に従う。<br />
文字列を与えるとファイル名とみなし、ファイルに追記される。<br />
ファイルを開くが、<strong>ファイルは閉じない</strong>。閉じ処理は php の終了処理に身を任せる。<br />
したがって閉じる必要がある場合はファイルポインタを渡す必要がある。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string<span class="type-separator"></span><wbr>mixed</td>
				<td class="rest">$message</td>
				<td class="desc"><p>出力メッセージ</p>
</td>
			</tr>
        			<tr>
				<td class="type">resource<span class="type-separator"></span><wbr>string<span class="type-separator"></span><wbr>mixed</td>
				<td class="rest">$destination = null</td>
				<td class="desc"><p>出力先</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">int</td>
			<td class="desc"><p>書き込んだバイト数</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1768-L1805" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::add_error_handler()" tabindex="-1" class="structure-title ">
                        add_error_handler                        	<small>($handler, $error_types = 32767) : callable<span class="type-separator"></span><wbr>null</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>エラーハンドラを追加する</p>
<p>追加したエラーハンドラが false を返すと標準のエラーハンドラではなく、直近の設定されていたエラーハンドラに移譲される。<br />
（直近にエラーハンドラが設定されていなかったら標準ハンドラになる）。</p>
<p>「局所的にエラーハンドラを変更したいけど特定の状況は設定済みハンドラへ流したい」という状況はまれによくあるはず。</p>
<p>Example:</p>
<pre><code class="language-php">// @ 付きなら元々のハンドラに移譲、@ なしなら何らかのハンドリングを行う例
add_error_handler(function () {
    if (error_reporting() === 0) {
        // この false はマニュアルにある「この関数が FALSE を返した場合は、通常のエラーハンドラが処理を引き継ぎます」ではなく、
        // 「さっきまで設定されていたエラーハンドラが処理を引き継ぎます」という意味になる
        return false;
    }
    // do something
});
// false の扱いが異なるだけでその他の挙動はすべて set_error_handler と同じなので restore_error_handler で戻せる
restore_error_handler();
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">callable</td>
				<td class="rest">$handler</td>
				<td class="desc"><p>エラーハンドラ</p>
</td>
			</tr>
        			<tr>
				<td class="type">int</td>
				<td class="rest">$error_types = 32767</td>
				<td class="desc"><p>エラータイプ</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">callable<span class="type-separator"></span><wbr>null</td>
			<td class="desc"><p>直近に設定されていたエラーハンドラ（未設定の場合は null）</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1807-L1834" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::timer()" tabindex="-1" class="structure-title ">
                        timer                        	<small>($callable, $count = 1) : float</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>処理時間を計測する</p>
<p>第1引数 $callable を $count 回回してその処理時間を返す。</p>
<p>Example:</p>
<pre><code class="language-php">// 0.01 秒を 10 回回すので 0.1 秒は超える
that(timer(function(){usleep(10 * 1000);}, 10))-&gt;greaterThan(0.1);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">callable</td>
				<td class="rest">$callable</td>
				<td class="desc"><p>処理クロージャ</p>
</td>
			</tr>
        			<tr>
				<td class="type">int</td>
				<td class="rest">$count = 1</td>
				<td class="desc"><p>ループ回数</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">float</td>
			<td class="desc"><p>処理時間</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/Utility.php#L1836-L1956" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\Functions\Package\Utility::benchmark()" tabindex="-1" class="structure-title ">
                        benchmark                        	<small>($suite, $args = [], $millisec = 1000, $output = true) : array</small>
						</h4>
					<div class="inner-item">
						<div class="description"><p>簡易ベンチマークを取る</p>
<p>「指定ミリ秒内で何回コールできるか？」でベンチする。</p>
<p>$suite は ['表示名' =&gt; $callable] 形式の配列。<br />
表示名が与えられていない場合、それらしい名前で表示する。</p>
<p>Example:</p>
<pre><code class="language-php">// intval と int キャストはどちらが早いか調べる
benchmark([
    'intval',
    'intcast' =&gt; function($v){return (int)$v;},
], ['12345'], 10);
</code></pre>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">array<span class="type-separator"></span><wbr>callable</td>
				<td class="rest">$suite</td>
				<td class="desc"><p>ベンチ対象処理</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$args = []</td>
				<td class="desc"><p>各ケースに与えられる引数</p>
</td>
			</tr>
        			<tr>
				<td class="type">int</td>
				<td class="rest">$millisec = 1000</td>
				<td class="desc"><p>呼び出しミリ秒</p>
</td>
			</tr>
        			<tr>
				<td class="type">bool</td>
				<td class="rest">$output = true</td>
				<td class="desc"><p>true だと標準出力に出力される</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">array</td>
			<td class="desc"><p>ベンチ結果の配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            		</ul>
    
	<div class="attribute">
		<span class="label label-default"></span>
		<span class="label label-default"></span>
	</div>
	<div class="clearfix"></div>
</div>
</body>
</html>
