<html lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ryunosuke-Functions-Package.html</title>

    <link id="sphinx_rtd_theme" href="https://cdn.jsdelivr.net/npm/sphinx_rtd_theme@0.4.2/css/theme.css" rel="stylesheet">
    <link id="highlight_style" data-cdn-url="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/styles/" href="" rel="stylesheet">
            <link href="style.css" rel="stylesheet">
        
    <script defer src="https://cdn.jsdelivr.net/gh/arima-ryunosuke/js-kQuery/dist/kQuery-full.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid@9.1.7/dist/mermaid.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@viz-js/viz@3.12.0/lib/viz-standalone.min.js"></script>
            <script defer src="script.js"></script>
        </head>

<body class="wy-body-for-nav downloaded ">
<div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                <a href="" class="icon icon-home"> ryunosuke-Functions-Package.html</a>
                <div class="version">
                    最終更新日 2025/04/13 19:07:36                </div>
                <div role="search">
                    <form id="rtd-search-form" class="wy-form hidden-download" method="get">
                        <input type="text" name="query" placeholder="ディレクトリ内検索" value="">
                    </form>
                </div>
            </div>
            <div class="wy-menu wy-menu-vertical markdown-toc">
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
            </div>
        </div>
    </nav>
    <div data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <nav class="wy-nav-top" aria-label="Mobile navigation menu">
            <i data-toggle="wy-nav-top" class="fa fa-bars" data-toggle-target="[data-toggle=&quot;wy-nav-shift&quot;]" data-toggle-class="shift"></i>
            <a href=""> ryunosuke-Functions-Package.html</a>
        </nav>
        <div class="wy-nav-content">
            <div class="rst-content">
                <header class="hidden-single">
                    <ul class="wy-breadcrumbs">
                        <li class="top-breadcrumb"><a href="/" class="icon icon-home"></a> »</li>
                                                    <li><a href="index.html">.md/</a> »</li>
                                                <li>ryunosuke-Functions-Package.html</li>
                        <li class="wy-breadcrumbs-aside hidden-download">
                            <a href="?raw=true" class="fa fa-file-text"> マークダウン</a>
                            <a href="?dl=html" class="fa fa-download" download> ダウンロード（html）</a>
                            <a href="?dl=zip" class="fa fa-download" download> ダウンロード（zip）</a>
                            <a id="button-export" href="javascript:void(0)" class="fa fa-arrow-circle-down"> エクスポート</a>
                        </li>
                    </ul>
                    <hr>
                </header>
                <div class="markdown-head">
                    <script>
                        var METADATA = [];
                    </script>
                                    </div>
                <main class="markdown-body">
                    <article><style>.rst-content .right.sidebar {
    margin: -3.2em 4px 4px 0px;
}
.toc-h span:nth-of-type(n + 3) {
    font-size: 80%;
    color: #aaaaaa;
}
.toc-h span:nth-of-type(3):before {
    content: " - ";
}
.section-header small {
    display: none;
}
a[href^="http://"],
a[href^="https://"] {
    font-style: italic;
    text-decoration: underline;
}
a[href^="#--"] {
    color: #404040;
    cursor: not-allowed;
    text-decoration: underline dotted;
}
table.no-border code {
    font-size: 1em;
    padding: 0;
    background-color: transparent;
    border: none;
    white-space: nowrap;
}
.rst-content h1:has([data-attribute]),
.rst-content h2:has([data-attribute]),
.rst-content h3:has([data-attribute]),
.rst-content h4:has([data-attribute]),
.rst-content h5:has([data-attribute]),
.rst-content h6:has([data-attribute]),
.rst-content td:has([data-attribute]),
.rst-content tr:has([data-attribute]) td {
    padding-top: 1.5em;
}
[data-attribute] {
    position: absolute;
}
[data-attribute]:after {
    content: attr(data-attribute);
    position: absolute;
    top: -3em;
    white-space: nowrap;
    font-size: 80%;
    color: #8a8a8a;
}
span.summary:not(:first-child) {
    display: block;
    margin-top: 0.5em;
}
div.description {
    margin-bottom: 24px;
}
div.description h1,
div.description h2,
div.description h3,
div.description h4,
div.description h5,
div.description h6 {
    background: transparent;
}
</style>
<script>window.addEventListener('hashchange', function (e) {
    const url = new URL(e.newURL);
    const target = document.querySelector('#' + CSS.escape(decodeURIComponent(url.hash.substring(1))));
    const section = target?.closest('.section');
    const details = Array.from(section?.children ?? []).find(e => e.tagName === 'DETAILS');
    if (details) {
        details.open = true;
    }
});
</script>
<section id="_94d1e73ebec2f76c41dd9c6f75312a156171496b-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package" class="anchor"></a>[N] ryunosuke\Functions\Package\ <small><span class="summary"></span></small></h2>
</section><section id="_7c304dbaa95aed7c0d80b6c64b2598691a1e9e1f-1" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package--constants" class="anchor"></a>[G] constants</h3>
</section><section id="_19451524bba635d5017fca7545de32920592360f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-IS_OWNSELF" class="anchor"></a>[C] IS_OWNSELF <small><span class="summary">自分自身を表す定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L5-L5" target="_blank">constants.php#5~5</a></p>
</div>
<details>
<summary class="">自分自身を表す定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int IS_OWNSELF = 2</div></pre>
</details>
</section><section id="_7346116dcad11a6af1278e7b6d17964118b4123c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-IS_PUBLIC" class="anchor"></a>[C] IS_PUBLIC <small><span class="summary">public を表す定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L8-L8" target="_blank">constants.php#8~8</a></p>
</div>
<details>
<summary class="">public を表す定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int IS_PUBLIC = 4</div></pre>
</details>
</section><section id="_23b079b0fd9b81bfa31f505559015bea4c46df77-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-IS_PROTECTED" class="anchor"></a>[C] IS_PROTECTED <small><span class="summary">protected を表す定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L11-L11" target="_blank">constants.php#11~11</a></p>
</div>
<details>
<summary class="">protected を表す定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int IS_PROTECTED = 8</div></pre>
</details>
</section><section id="_b30dd03cbf5c464ce791f300c9d52eeb4c67a847-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-IS_PRIVATE" class="anchor"></a>[C] IS_PRIVATE <small><span class="summary">private を表す定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L14-L14" target="_blank">constants.php#14~14</a></p>
</div>
<details>
<summary class="">private を表す定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int IS_PRIVATE = 16</div></pre>
</details>
</section><section id="_1c99485b7ed87c61d93e216c4a99dae72fd0bff2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-EN_MONTH_SHORT" class="anchor"></a>[C] EN_MONTH_SHORT <small><span class="summary">月名（省略）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L17-L30" target="_blank">constants.php#17~30</a></p>
</div>
<details>
<summary class="">月名（省略）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const array EN_MONTH_SHORT = [
    1  =&gt; "jan",
    2  =&gt; "feb",
    3  =&gt; "mar",
    4  =&gt; "apr",
    5  =&gt; "may",
    6  =&gt; "jun",
    7  =&gt; "jul",
    8  =&gt; "aug",
    9  =&gt; "sep",
    10 =&gt; "oct",
    11 =&gt; "nov",
    12 =&gt; "dec",
]</div></pre>
</details>
</section><section id="_fcfcb50882940a9c710015158c3113bfa4888eae-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-EN_MONTH_LONG" class="anchor"></a>[C] EN_MONTH_LONG <small><span class="summary">月名（フル）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L33-L46" target="_blank">constants.php#33~46</a></p>
</div>
<details>
<summary class="">月名（フル）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const array EN_MONTH_LONG = [
    1  =&gt; "january",
    2  =&gt; "february",
    3  =&gt; "march",
    4  =&gt; "april",
    5  =&gt; "may",
    6  =&gt; "june",
    7  =&gt; "july",
    8  =&gt; "august",
    9  =&gt; "september",
    10 =&gt; "october",
    11 =&gt; "november",
    12 =&gt; "december",
]</div></pre>
</details>
</section><section id="_eb3eb56451d89ad2a9a580d9f56ad8a85ec18749-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JP_ERA" class="anchor"></a>[C] JP_ERA <small><span class="summary">和暦</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L49-L75" target="_blank">constants.php#49~75</a></p>
</div>
<details>
<summary class="">和暦</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const array JP_ERA = [
    [
        "name"  =&gt; "令和",
        "abbr"  =&gt; "R",
        "since" =&gt; 1556636400,
    ],
    [
        "name"  =&gt; "平成",
        "abbr"  =&gt; "H",
        "since" =&gt; 600188400,
    ],
    [
        "name"  =&gt; "昭和",
        "abbr"  =&gt; "S",
        "since" =&gt; -1357635600,
    ],
    [
        "name"  =&gt; "大正",
        "abbr"  =&gt; "T",
        "since" =&gt; -1812186000,
    ],
    [
        "name"  =&gt; "明治",
        "abbr"  =&gt; "M",
        "since" =&gt; -3216790800,
    ],
]</div></pre>
</details>
</section><section id="_20dd4308371dad5cad16be0d000c60ad79f7af36-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-GENERAL_MIMETYPE" class="anchor"></a>[C] GENERAL_MIMETYPE <small><span class="summary">一般的な mimetype</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L78-L211" target="_blank">constants.php#78~211</a></p>
</div>
<details>
<summary class="">一般的な mimetype</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const array GENERAL_MIMETYPE = [
    "csv"   =&gt; "text/csv",
    "dcm"   =&gt; "application/dicom",
    "dvc"   =&gt; "application/dvcs",
    "finf"  =&gt; "application/fastinfoset",
    "stk"   =&gt; "application/hyperstudio",
    "ipfix" =&gt; "application/ipfix",
    "json"  =&gt; "application/json",
    "mrc"   =&gt; "application/marc",
    "nb"    =&gt; "application/mathematica",
    "ma"    =&gt; "application/mathematica",
    "mb"    =&gt; "application/mathematica",
    "mbox"  =&gt; "application/mbox",
    "m21"   =&gt; "application/mp21",
    "mp21"  =&gt; "application/mp21",
    "xls"   =&gt; "application/vnd.ms-excel",
    "doc"   =&gt; "application/vnd.ms-word",
    "mxf"   =&gt; "application/mxf",
    "oda"   =&gt; "application/oda",
    "ogx"   =&gt; "application/ogg",
    "pdf"   =&gt; "application/pdf",
    "p10"   =&gt; "application/pkcs10",
    "ai"    =&gt; "application/postscript",
    "eps"   =&gt; "application/postscript",
    "ps"    =&gt; "application/postscript",
    "rtf"   =&gt; "application/rtf",
    "sdp"   =&gt; "application/sdp",
    "siv"   =&gt; "application/sieve",
    "sieve" =&gt; "application/sieve",
    "smil"  =&gt; "application/smil",
    "smi"   =&gt; "application/smil",
    "sml"   =&gt; "application/smil",
    "gram"  =&gt; "application/srgs",
    "xml"   =&gt; "text/xml",
    "zip"   =&gt; "application/x-zip-compressed",
    "xlsx"  =&gt; "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
    "docx"  =&gt; "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    726     =&gt; "audio/32kadpcm",
    "amr"   =&gt; "audio/AMR",
    "at3"   =&gt; "audio/ATRAC3",
    "aa3"   =&gt; "audio/ATRAC3",
    "omg"   =&gt; "audio/ATRAC3",
    "evc"   =&gt; "audio/EVRC",
    "evb"   =&gt; "audio/EVRCB",
    "evw"   =&gt; "audio/EVRCWB",
    "l16"   =&gt; "audio/L16",
    "smv"   =&gt; "audio/SMV",
    "ac3"   =&gt; "audio/ac3",
    "au"    =&gt; "audio/basic",
    "snd"   =&gt; "audio/basic",
    "dls"   =&gt; "audio/dls",
    "lbc"   =&gt; "audio/iLBC",
    "mid"   =&gt; "audio/midi",
    "midi"  =&gt; "audio/midi",
    "kar"   =&gt; "audio/midi",
    "mpga"  =&gt; "audio/mpeg",
    "mp1"   =&gt; "audio/mpeg",
    "mp2"   =&gt; "audio/mpeg",
    "mp3"   =&gt; "audio/mpeg",
    "oga"   =&gt; "audio/ogg",
    "ogg"   =&gt; "audio/ogg",
    "spx"   =&gt; "audio/ogg",
    "qcp"   =&gt; "audio/qcelp",
    "bmp"   =&gt; "image/bmp",
    "fits"  =&gt; "image/fits",
    "fit"   =&gt; "image/fits",
    "fts"   =&gt; "image/fits",
    "gif"   =&gt; "image/gif",
    "ief"   =&gt; "image/ief",
    "jp2"   =&gt; "image/jp2",
    "jpg2"  =&gt; "image/jp2",
    "jpeg"  =&gt; "image/jpeg",
    "jpg"   =&gt; "image/jpeg",
    "jpe"   =&gt; "image/jpeg",
    "jfif"  =&gt; "image/jpeg",
    "jpm"   =&gt; "image/jpm",
    "jpgm"  =&gt; "image/jpm",
    "jpx"   =&gt; "image/jpx",
    "jpf"   =&gt; "image/jpx",
    "svg"   =&gt; "image/svg+xml",
    "png"   =&gt; "image/png",
    "t38"   =&gt; "image/t38",
    "tiff"  =&gt; "image/tiff",
    "tif"   =&gt; "image/tiff",
    "u8msg" =&gt; "message/global",
    "eml"   =&gt; "message/rfc822",
    "mail"  =&gt; "message/rfc822",
    "art"   =&gt; "message/rfc822",
    "igs"   =&gt; "model/iges",
    "iges"  =&gt; "model/iges",
    "msh"   =&gt; "model/mesh",
    "mesh"  =&gt; "model/mesh",
    "silo"  =&gt; "model/mesh",
    "wrl"   =&gt; "model/vrml",
    "vrml"  =&gt; "model/vrml",
    "ics"   =&gt; "text/calendar",
    "ifb"   =&gt; "text/calendar",
    "css"   =&gt; "text/css",
    "soa"   =&gt; "text/dns",
    "zone"  =&gt; "text/dns",
    "html"  =&gt; "text/html",
    "htm"   =&gt; "text/html",
    "js"    =&gt; "text/javascript",
    "asc"   =&gt; "text/plain",
    "txt"   =&gt; "text/plain",
    "text"  =&gt; "text/plain",
    "pm"    =&gt; "text/plain",
    "el"    =&gt; "text/plain",
    "c"     =&gt; "text/plain",
    "h"     =&gt; "text/plain",
    "cc"    =&gt; "text/plain",
    "hh"    =&gt; "text/plain",
    "cxx"   =&gt; "text/plain",
    "hxx"   =&gt; "text/plain",
    "f90"   =&gt; "text/plain",
    "rtx"   =&gt; "text/richtext",
    "sgml"  =&gt; "text/sgml",
    "sgm"   =&gt; "text/sgml",
    "3gp"   =&gt; "video/3gpp",
    "3gpp"  =&gt; "video/3gpp",
    "3g2"   =&gt; "video/3gpp2",
    "3gpp2" =&gt; "video/3gpp2",
    "mj2"   =&gt; "video/mj2",
    "mjp2"  =&gt; "video/mj2",
    "mp4"   =&gt; "video/mp4",
    "mpg4"  =&gt; "video/mp4",
    "mpeg"  =&gt; "video/mpeg",
    "mpg"   =&gt; "video/mpeg",
    "mpe"   =&gt; "video/mpeg",
    "ogv"   =&gt; "video/ogg",
    "qt"    =&gt; "video/quicktime",
    "mov"   =&gt; "video/quicktime",
    "webm"  =&gt; "video/webm",
]</div></pre>
</details>
</section><section id="_64580873e8889621eff7112e658316cd0840ca9d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-GLOB_RECURSIVE" class="anchor"></a>[C] GLOB_RECURSIVE <small><span class="summary">glob 系関数で ** を有効にするか</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L214-L214" target="_blank">constants.php#214~214</a></p>
</div>
<details>
<summary class="">glob 系関数で ** を有効にするか</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int GLOB_RECURSIVE = 65536</div></pre>
</details>
</section><section id="_727be05a386b75491f41f920463cb543388ec933-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_MAX_DEPTH" class="anchor"></a>[C] JSON_MAX_DEPTH <small><span class="summary">json_*** 関数で $depth 引数を表す定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L217-L217" target="_blank">constants.php#217~217</a></p>
</div>
<details>
<summary class="">json_*** 関数で $depth 引数を表す定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_MAX_DEPTH = -1</div></pre>
</details>
</section><section id="_0dcc47a42374c946be663fdfd6896e284a5be25e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_INDENT" class="anchor"></a>[C] JSON_INDENT <small><span class="summary">json_*** 関数でインデント数・文字を指定する定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L220-L220" target="_blank">constants.php#220~220</a></p>
</div>
<details>
<summary class="">json_*** 関数でインデント数・文字を指定する定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_INDENT = -71</div></pre>
</details>
</section><section id="_2d90c3fa588ebdc55ab2fef0cbc4ac58b69e3bfa-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_CLOSURE" class="anchor"></a>[C] JSON_CLOSURE <small><span class="summary">json_*** 関数でクロージャをサポートするかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L223-L223" target="_blank">constants.php#223~223</a></p>
</div>
<details>
<summary class="">json_*** 関数でクロージャをサポートするかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_CLOSURE = -72</div></pre>
</details>
</section><section id="_8581356a55beb3f138f0294ccc8e8a655f0ba5c7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_NEST_LEVEL" class="anchor"></a>[C] JSON_NEST_LEVEL <small><span class="summary">json_*** 関数で初期ネストレベルを指定する定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L226-L226" target="_blank">constants.php#226~226</a></p>
</div>
<details>
<summary class="">json_*** 関数で初期ネストレベルを指定する定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_NEST_LEVEL = -73</div></pre>
</details>
</section><section id="_8538dad7e05fa933bcec2c81de72f14938c5c1dd-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_INLINE_LEVEL" class="anchor"></a>[C] JSON_INLINE_LEVEL <small><span class="summary">json_*** 関数で一定以上の階層をインライン化するかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L229-L229" target="_blank">constants.php#229~229</a></p>
</div>
<details>
<summary class="">json_*** 関数で一定以上の階層をインライン化するかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_INLINE_LEVEL = -74</div></pre>
</details>
</section><section id="_fe9e9d52d7486f546c79f789de3403aaee4391fa-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_INLINE_SCALARLIST" class="anchor"></a>[C] JSON_INLINE_SCALARLIST <small><span class="summary">json_*** 関数でスカラーのみのリストをインライン化するかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L232-L232" target="_blank">constants.php#232~232</a></p>
</div>
<details>
<summary class="">json_*** 関数でスカラーのみのリストをインライン化するかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_INLINE_SCALARLIST = -75</div></pre>
</details>
</section><section id="_34d1bfc2618f8abb0c91df38e53f3e99a5faf257-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_ES5" class="anchor"></a>[C] JSON_ES5 <small><span class="summary">json_*** 関数で json5 を取り扱うかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L235-L235" target="_blank">constants.php#235~235</a></p>
</div>
<details>
<summary class="">json_*** 関数で json5 を取り扱うかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_ES5 = -100</div></pre>
</details>
</section><section id="_e8dee232c062b5d61e75b98c2facedc1aa05ebf4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_INT_AS_STRING" class="anchor"></a>[C] JSON_INT_AS_STRING <small><span class="summary">json_*** 関数で整数を常に文字列で返すかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L238-L238" target="_blank">constants.php#238~238</a></p>
</div>
<details>
<summary class="">json_*** 関数で整数を常に文字列で返すかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_INT_AS_STRING = -101</div></pre>
</details>
</section><section id="_87bfd3dda41450003580c779fbbbeba3a6a8cb86-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_FLOAT_AS_STRING" class="anchor"></a>[C] JSON_FLOAT_AS_STRING <small><span class="summary">json_*** 関数で小数を常に文字列で返すかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L241-L241" target="_blank">constants.php#241~241</a></p>
</div>
<details>
<summary class="">json_*** 関数で小数を常に文字列で返すかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_FLOAT_AS_STRING = -102</div></pre>
</details>
</section><section id="_78f594e9afaf5a15092c5b2a2424cd8ba30e70cf-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_TRAILING_COMMA" class="anchor"></a>[C] JSON_TRAILING_COMMA <small><span class="summary">json_*** 関数で強制ケツカンマを振るかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L244-L244" target="_blank">constants.php#244~244</a></p>
</div>
<details>
<summary class="">json_*** 関数で強制ケツカンマを振るかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_TRAILING_COMMA = -103</div></pre>
</details>
</section><section id="_e2c0d60485c4c1adfbd670355931a1829d187ac1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_COMMENT_PREFIX" class="anchor"></a>[C] JSON_COMMENT_PREFIX <small><span class="summary">json_*** 関数でコメントを判定するプレフィックス定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L247-L247" target="_blank">constants.php#247~247</a></p>
</div>
<details>
<summary class="">json_*** 関数でコメントを判定するプレフィックス定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_COMMENT_PREFIX = -104</div></pre>
</details>
</section><section id="_cfa8c1b00620ed4b21f07a1b3b340b5cb9584821-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_TEMPLATE_LITERAL" class="anchor"></a>[C] JSON_TEMPLATE_LITERAL <small><span class="summary">json_*** 関数でテンプレートリテラルを有効にするかの定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L250-L250" target="_blank">constants.php#250~250</a></p>
</div>
<details>
<summary class="">json_*** 関数でテンプレートリテラルを有効にするかの定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_TEMPLATE_LITERAL = -105</div></pre>
</details>
</section><section id="_c486f480644220a496d8386baa089f9993232952-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_BARE_AS_STRING" class="anchor"></a>[C] JSON_BARE_AS_STRING <small><span class="summary">json_*** 関数で bare string を文字列として扱うか</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L253-L253" target="_blank">constants.php#253~253</a></p>
</div>
<details>
<summary class="">json_*** 関数で bare string を文字列として扱うか</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_BARE_AS_STRING = -106</div></pre>
</details>
</section><section id="_9c0df3b6e57b77cb336af2d3c0b3fb2f2965ee82-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_OBJECT_HANDLER" class="anchor"></a>[C] JSON_OBJECT_HANDLER <small><span class="summary">json_*** 関数で特定クラスの独自変換の定数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L256-L256" target="_blank">constants.php#256~256</a></p>
</div>
<details>
<summary class="">json_*** 関数で特定クラスの独自変換の定数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_OBJECT_HANDLER = -107</div></pre>
</details>
</section><section id="_f84c338ba52228500369b3c4233304cf3918d9a9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-JSON_ESCAPE_SINGLE_QUOTE" class="anchor"></a>[C] JSON_ESCAPE_SINGLE_QUOTE <small><span class="summary">json_*** 関数で ' でエスケープシーケンスを扱うか</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L259-L259" target="_blank">constants.php#259~259</a></p>
</div>
<details>
<summary class="">json_*** 関数で ' でエスケープシーケンスを扱うか</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int JSON_ESCAPE_SINGLE_QUOTE = -108</div></pre>
</details>
</section><section id="_0a5d2680b74400716fe523fcb92a484f50cae04d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-SI_UNITS" class="anchor"></a>[C] SI_UNITS <small><span class="summary"></span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L261-L279" target="_blank">constants.php#261~279</a></p>
</div>
<details>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const array SI_UNITS = [
    -8 =&gt; ["y"],
    -7 =&gt; ["z"],
    -6 =&gt; ["a"],
    -5 =&gt; ["f"],
    -4 =&gt; ["p"],
    -3 =&gt; ["n"],
    -2 =&gt; ["u", "μ", "µ"],
    -1 =&gt; ["m"],
    0  =&gt; [],
    1  =&gt; ["k", "K"],
    2  =&gt; ["M"],
    3  =&gt; ["G"],
    4  =&gt; ["T"],
    5  =&gt; ["P"],
    6  =&gt; ["E"],
    7  =&gt; ["Z"],
    8  =&gt; ["Y"],
]</div></pre>
</details>
</section><section id="_ff8aa627745ed08d7b53d80599133ccf0b03b79e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-SORT_STRICT" class="anchor"></a>[C] SORT_STRICT <small><span class="summary">SORT_XXX 定数の厳密版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/constants.php#L282-L282" target="_blank">constants.php#282~282</a></p>
</div>
<details>
<summary class="">SORT_XXX 定数の厳密版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">const int SORT_STRICT = 256</div></pre>
</details>
</section><section id="_becece83489b1680f7abcc61d30b5e4e18880580-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-array" class="anchor"></a>[N] ryunosuke\Functions\Package\array\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-1" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-array--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_5d7aae330fa4b7346e8ef25bddd739f719283bc3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_add()" class="anchor"></a>[F] array_add <small><span class="summary">配列の+演算子の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_add.php#L7-L30" target="_blank">array_add.php#7~30</a></p>
</div>
<details>
<summary class="">配列の+演算子の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_add(array ...$variadic): array</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// ただの加算の関数版なので同じキーは上書きされない
that(array_add(['a', 'b', 'c'], ['X']))-&gt;isSame(['a', 'b', 'c']);
// 異なるキーは生える
that(array_add(['a', 'b', 'c'], ['x' =&gt; 'X']))-&gt;isSame(['a', 'b', 'c', 'x' =&gt; 'X']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">足す配列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">足された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_464184c10ba85c37e2c36216774b9750d5e1fd24-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_aggregate()" class="anchor"></a>[F] array_aggregate <small><span class="summary">配列をコールバックの返り値で集計する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_aggregate.php#L10-L143" target="_blank">array_aggregate.php#10~143</a></p>
</div>
<details>
<summary class="">配列をコールバックの返り値で集計する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_aggregate(
    iterable $array,
    callable|callable[] $columns,
    string|array|null $key = null
): array</div></pre>
<div class="description">
<p>$columns で集計列を指定する。<span class="implicit-br">
</span>単一の callable を渡すと結果も単一になる。<span class="implicit-br">
</span>複数の callable 連想配列を渡すと [キー =&gt; 集系列] の連想配列になる。<span class="implicit-br">
</span>いずれにせよ引数としてそのグループの配列が渡ってくるので返り値がその列の値になる。<span class="implicit-br">
</span>第2引数には「今までの結果が詰まった配列」が渡ってくる（count, avg, sum など何度もでてくる集計で便利）。</p>
<p>$key で集約列を指定する。<span class="implicit-br">
</span>指定しなければ引数の配列そのままで集計される。<span class="implicit-br">
</span>複数要素の配列を与えるとその数分潜って集計される。<span class="implicit-br">
</span>クロージャを与えると返り値がキーになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 単純な配列の集計
that(array_aggregate([1, 2, 3], [
    'min' =&gt; fn($elems) =&gt; min($elems),
    'max' =&gt; fn($elems) =&gt; max($elems),
    'avg' =&gt; fn($elems) =&gt; array_sum($elems) / count($elems),
]))-&gt;isSame([
    'min' =&gt; 1, // 最小値
    'max' =&gt; 3, // 最大値
    'avg' =&gt; 2, // 平均値
]);

$row1 = ['user_id' =&gt; 'hoge', 'group' =&gt; 'A', 'score' =&gt; 4];
$row2 = ['user_id' =&gt; 'fuga', 'group' =&gt; 'B', 'score' =&gt; 6];
$row3 = ['user_id' =&gt; 'fuga', 'group' =&gt; 'A', 'score' =&gt; 5];
$row4 = ['user_id' =&gt; 'hoge', 'group' =&gt; 'A', 'score' =&gt; 8];

// user_id, group ごとの score を集計して階層配列で返す（第2引数 $current を利用している）
that(array_aggregate([$row1, $row2, $row3, $row4], [
    'scores' =&gt; fn($rows) =&gt; array_column($rows, 'score'),
    'score'  =&gt; fn($rows, $current) =&gt; array_sum($current['scores']),
], ['user_id', 'group']))-&gt;isSame([
    'hoge' =&gt; [
        'A' =&gt; [
            'scores' =&gt; [4, 8],
            'score'  =&gt; 12,
        ],
    ],
    'fuga' =&gt; [
        'B' =&gt; [
            'scores' =&gt; [6],
            'score'  =&gt; 6,
        ],
        'A' =&gt; [
            'scores' =&gt; [5],
            'score'  =&gt; 5,
        ],
    ],
]);

// user_id ごとの score を集計して単一列で返す（キーのクロージャも利用している）
that(array_aggregate([$row1, $row2, $row3, $row4],
    fn($rows) =&gt; array_sum(array_column($rows, 'score')),
    fn($row) =&gt; strtoupper($row['user_id'])))-&gt;isSame([
    'HOGE' =&gt; 12,
    'FUGA' =&gt; 11,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable|​callable[]</td>
<td>​<code>$columns</code></td>
<td>​<span class="summary">集計関数</span></td>
</tr>
<tr>
<td>​string|​array|​null</td>
<td>​<code>$key = null</code></td>
<td>​<span class="summary">集約列。クロージャを与えると返り値がキーになる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">集約配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d91be0219237f303c915256017f16f2f866b83ad-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_all()" class="anchor"></a>[F] array_all <small><span class="summary">全要素が true になるなら true を返す（1つでも false なら false を返す）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><span class="badge alert" data-badge-title="">deprecated </span><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_all.php#L8-L20" target="_blank">array_all.php#8~20</a></p>
</div>
<details>
<summary class="">全要素が true になるなら true を返す（1つでも false なら false を返す）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_all(
    $array,
    $callback = null,
    $default = true
)</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​</td>
<td>​<code>$array</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$callback = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$default = true</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--array_and%28%29">array_and()</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_350417b3e03de94f60a64d6f03a79b3c72e17fe2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_and()" class="anchor"></a>[F] array_and <small><span class="summary">全要素が true になるなら true を返す（1つでも false なら false を返す）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_and.php#L9-L43" target="_blank">array_and.php#9~43</a></p>
</div>
<details>
<summary class="">全要素が true になるなら true を返す（1つでも false なら false を返す）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_and(
    iterable $array,
    ?callable $callback = null,
    bool|mixed $default = true
): bool</div></pre>
<div class="description">
<p>$callback が要求するならキーも渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_and([true, true]))-&gt;isTrue();
that(array_and([true, false]))-&gt;isFalse();
that(array_and([false, false]))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$callback = null</code></td>
<td>​<span class="summary">評価クロージャ。 null なら値そのもので評価</span></td>
</tr>
<tr>
<td>​bool|​mixed</td>
<td>​<code>$default = true</code></td>
<td>​<span class="summary">空配列の場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">全要素が true なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c4d1aed05c30398e5403ef72c1636f4038ffcc16-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_any()" class="anchor"></a>[F] array_any <small><span class="summary">全要素が false になるなら false を返す（1つでも true なら true を返す）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><span class="badge alert" data-badge-title="">deprecated </span><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_any.php#L8-L20" target="_blank">array_any.php#8~20</a></p>
</div>
<details>
<summary class="">全要素が false になるなら false を返す（1つでも true なら true を返す）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_any(
    $array,
    $callback = null,
    $default = false
)</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​</td>
<td>​<code>$array</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$callback = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$default = false</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--array_or%28%29">array_or()</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e4591c76aecf0e44bf5e506dcdfafae7fe5ada0b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_append()" class="anchor"></a>[F] array_append <small><span class="summary">配列の末尾に要素を追加する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_append.php#L7-L38" target="_blank">array_append.php#7~38</a></p>
</div>
<details>
<summary class="">配列の末尾に要素を追加する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_append(
    array $array,
    $value,
    $key = null
): array</div></pre>
<div class="description">
<p>array_push のキーが指定できる参照渡しでない版と言える。<span class="implicit-br">
</span>キー指定でかつそのキーが存在するとき、値を変えつつ末尾に移動する動作となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// キー未指定は言語機構を利用して末尾に追加される
that(array_append([1, 2, 3], 99))-&gt;is([1, 2, 3, 99]);
// キーを指定すればそのキーで生える
that(array_append([1, 2, 3], 99, 'newkey'))-&gt;is([1, 2, 3, 'newkey' =&gt; 99]);
// 存在する場合は値が変わって末尾に移動する
that(array_append([1, 2, 3], 99, 1))-&gt;is([0 =&gt; 1, 2 =&gt; 3, 1 =&gt; 99]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$value</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$key = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">要素が追加された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_93487eaa0cd8a21467947adaf3e4c62179204600-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_assort()" class="anchor"></a>[F] array_assort <small><span class="summary">配列をコールバックに従って分類する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_assort.php#L8-L56" target="_blank">array_assort.php#8~56</a></p>
</div>
<details>
<summary class="">配列をコールバックに従って分類する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_assort(
    iterable $array,
    callable[] $rules
): array</div></pre>
<div class="description">
<p>コールバックは配列で複数与える。そのキーが結果配列のキーになるが、一切マッチしなくてもキー自体は作られる。<span class="implicit-br">
</span>複数のコールバックにマッチしたらその分代入されるし、どれにもマッチしなければ代入されない。<span class="implicit-br">
</span>つまり5個の配列を分類したからと言って、全要素数が5個になるとは限らない（多い場合も少ない場合もある）。</p>
<p>$rule が要求するならキーも渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// lt2(2より小さい)で分類
$lt2 = fn($v) =&gt; $v &lt; 2;
that(array_assort([1, 2, 3], [
    'lt2' =&gt; $lt2,
]))-&gt;isSame([
    'lt2' =&gt; [1],
]);
// lt3(3より小さい)、ctd(ctype_digit)で分類（両方に属する要素が存在する）
$lt3 = fn($v) =&gt; $v &lt; 3;
that(array_assort(['1', '2', '3'], [
    'lt3' =&gt; $lt3,
    'ctd' =&gt; 'ctype_digit',
]))-&gt;isSame([
    'lt3' =&gt; ['1', '2'],
    'ctd' =&gt; ['1', '2', '3'],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable[]</td>
<td>​<code>$rules</code></td>
<td>​<span class="summary">分類ルール。[key =&gt; callable] 形式</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">分類された新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0adee5bf9f9ea2f7c769d4ade422e6cba0c914dc-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_columns()" class="anchor"></a>[F] array_columns <small><span class="summary">全要素に対して array_column する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_columns.php#L7-L44" target="_blank">array_columns.php#7~44</a></p>
</div>
<details>
<summary class="">全要素に対して array_column する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_columns(
    array $array,
    string|array|null $column_keys = null,
    mixed $index_key = null
): array</div></pre>
<div class="description">
<p>行列が逆転するイメージ。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$row1 = ['id' =&gt; 1, 'name' =&gt; 'A'];
$row2 = ['id' =&gt; 2, 'name' =&gt; 'B'];
$rows = [$row1, $row2];
that(array_columns($rows))-&gt;isSame(['id' =&gt; [1, 2], 'name' =&gt; ['A', 'B']]);
that(array_columns($rows, 'id'))-&gt;isSame(['id' =&gt; [1, 2]]);
that(array_columns($rows, 'name', 'id'))-&gt;isSame(['name' =&gt; [1 =&gt; 'A', 2 =&gt; 'B']]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​array|​null</td>
<td>​<code>$column_keys = null</code></td>
<td>​<span class="summary">引っ張ってくるキー名</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$index_key = null</code></td>
<td>​<span class="summary">新しい配列のキーとなるキー名</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2de4eac2d907e44e0c6187198294231c9387efb9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_convert()" class="anchor"></a>[F] array_convert <small><span class="summary">配列の各要素に再帰的にコールバックを適用して変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_convert.php#L7-L132" target="_blank">array_convert.php#7~132</a></p>
</div>
<details>
<summary class="">配列の各要素に再帰的にコールバックを適用して変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_convert(
    array $array,
    callable $callback,
    bool $apply_array = false
): array</div></pre>
<div class="description">
<p>$callback は下記の仕様。</p>
<p>引数は (キー, 値, 今まで処理したキー配列) で渡ってくる。<span class="implicit-br">
</span>返り値は新しいキーを返す。</p>
<ul class=" simple">
<li>文字列や数値を返すとそれがキーとして使われる</li>
<li>null を返すと元のキーがそのまま使われる</li>
<li>true を返すと数値連番が振られる</li>
<li>false を返すとその要素は無かったことになる</li>
<li>配列を返すとその配列で完全に置換される</li>
</ul>
<p>$apply_array=false で要素が配列の場合は再帰され、コールバックが適用されない（array_walk_recursive と同じ仕様）。</p>
<p>$apply_array=true だと配列かは問わず全ての要素にコールバックが適用される。<span class="implicit-br">
</span>配列も渡ってきてしまうのでコールバック内部で is_array 判定が必要になる場合がある。</p>
<p>「map も filter も可能でキー変更可能かつ再帰的」というとてもマッチョな関数。<span class="implicit-br">
</span>複雑だが実質的には「キーも設定できる array_walk_recursive」のように振る舞う（そしてそのような使い方を想定している）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
   'k1' =&gt; 'v1',
   'k2' =&gt; [
       'k21' =&gt; 'v21',
       'k22' =&gt; [
           'k221' =&gt; 'v221',
           'k222' =&gt; 'v222',
       ],
       'k23' =&gt; 'v23',
   ],
];
// 全要素に 'prefix-' を付与する。キーには '_' をつける。ただし 'k21' はそのままとする。さらに 'k22' はまるごと伏せる。 'k23' は数値キーになる
$callback = function ($k, &amp;$v) {
    if ($k === 'k21') return null;
    if ($k === 'k22') return false;
    if ($k === 'k23') return true;
    if (!is_array($v)) $v = "prefix-$v";
    return "_$k";
};
that(array_convert($array, $callback, true))-&gt;isSame([
    '_k1' =&gt; 'prefix-v1',
    '_k2' =&gt; [
        'k21' =&gt; 'v21',
        0     =&gt; 'v23',
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">適用するコールバック</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$apply_array = false</code></td>
<td>​<span class="summary">配列要素にもコールバックを適用するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">変換された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4eb96807ef47c008ab1f2f099e17cc4496e532cb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_count()" class="anchor"></a>[F] array_count <small><span class="summary">配列をコールバックに従ってカウントする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_count.php#L8-L91" target="_blank">array_count.php#8~91</a></p>
</div>
<details>
<summary class="">配列をコールバックに従ってカウントする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_count(
    iterable $array,
    callable $callback,
    bool $recursive = false
): int|array</div></pre>
<div class="description">
<p>コールバックが true 相当を返した要素をカウントして返す。<span class="implicit-br">
</span>普通に使う分には <code>count(array_filter($array, $callback))</code> とほとんど同じだが、下記の点が微妙に異なる。</p>
<ul class=" simple">
<li>$callback が要求するならキーも渡ってくる</li>
<li>$callback には配列が渡せる。配列を渡した場合は件数を配列で返す（Example 参照）</li>
</ul>
<p>$recursive に true を渡すと再帰的に動作する。<span class="implicit-br">
</span>末端・配列を問わずに呼び出されるので場合によっては is_array などの判定が必要になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['hoge', 'fuga', 'piyo'];
// 'o' を含むものの数（2個）
that(array_count($array, fn($s) =&gt; strpos($s, 'o') !== false))-&gt;isSame(2);
// 'a' と 'o' を含むものをそれぞれ（1個と2個）
that(array_count($array, [
    'a' =&gt; fn($s) =&gt; strpos($s, 'a') !== false,
    'o' =&gt; fn($s) =&gt; strpos($s, 'o') !== false,
]))-&gt;isSame([
    'a' =&gt; 1,
    'o' =&gt; 2,
]);

// 再帰版
$array = [
    ['1', '2', '3'],
    ['a', 'b', 'c'],
    ['X', 'Y', 'Z'],
    [[[['a', 'M', 'Z']]]],
];
that(array_count($array, [
    'lower' =&gt; fn($v) =&gt; !is_array($v) &amp;&amp; ctype_lower($v),
    'upper' =&gt; fn($v) =&gt; !is_array($v) &amp;&amp; ctype_upper($v),
    'array' =&gt; fn($v) =&gt; is_array($v),
], true))-&gt;is([
    'lower' =&gt; 4, // 小文字の数
    'upper' =&gt; 5, // 大文字の数
    'array' =&gt; 7, // 配列の数
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">カウントルール。配列も渡せる</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$recursive = false</code></td>
<td>​<span class="summary">再帰フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​array</td>
<td>​<span class="summary">条件一致した件数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e5a4f59f1c517ea2f92d2dcf55067898bdfbff80-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_cross()" class="anchor"></a>[F] array_cross <small><span class="summary">配列の直積を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_cross.php#L7-L52" target="_blank">array_cross.php#7~52</a></p>
</div>
<details>
<summary class="">配列の直積を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_cross(array ...$arrays): array</div></pre>
<div class="description">
<p>文字キーは保存されるが数値キーは再割り振りされる。<span class="implicit-br">
</span>ただし、文字キーが重複すると例外を投げる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 普通の直積
that(array_cross(
    [1, 2],
    [3, 4]
))-&gt;isSame([[1, 3], [1, 4], [2, 3], [2, 4]]);
// キーが維持される
that(array_cross(
    ['a' =&gt; 1, 2],
    ['b' =&gt; 3, 4]
))-&gt;isSame([['a' =&gt; 1, 'b' =&gt; 3], ['a' =&gt; 1, 4], [2, 'b' =&gt; 3], [2, 4]]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>...$arrays</code></td>
<td>​<span class="summary">対象配列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">各配列値の直積</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d1b014de90fd3cff720e8956398c203e58a58cdb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_depth()" class="anchor"></a>[F] array_depth <small><span class="summary">配列の次元数を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_depth.php#L7-L52" target="_blank">array_depth.php#7~52</a></p>
</div>
<details>
<summary class="">配列の次元数を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_depth(
    array $array,
    int|null $max_depth = null
): int</div></pre>
<div class="description">
<p>フラット配列は 1 と定義する。<span class="implicit-br">
</span>つまり、配列を与える限りは 0 以下を返すことはない。</p>
<p>第2引数 $max_depth を与えるとその階層になった時点で走査を打ち切る。<span class="implicit-br">
</span>「1階層のみか？」などを調べるときは指定したほうが高速に動作する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_depth([]))-&gt;isSame(1);
that(array_depth(['hoge']))-&gt;isSame(1);
that(array_depth([['nest1' =&gt; ['nest2']]]))-&gt;isSame(3);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$max_depth = null</code></td>
<td>​<span class="summary">最大階層数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">次元数。素のフラット配列は 1</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5c8f138ebd60ec4606d792b8ade08b9f6fcb5533-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_difference()" class="anchor"></a>[F] array_difference <small><span class="summary">配列の差分を取り配列で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_difference.php#L8-L113" target="_blank">array_difference.php#8~113</a></p>
</div>
<details>
<summary class="">配列の差分を取り配列で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_difference(
    iterable $array1,
    iterable $array2,
    string $delimiter = "."
): array</div></pre>
<div class="description">
<p>返り値の配列は構造化されたデータではない。<span class="implicit-br">
</span>主に文字列化して出力することを想定している。</p>
<p>ユースケースとしては「スキーマデータ」「各環境の設定ファイル」などの差分。</p>
<ul class=" simple">
<li>'+' はキーが追加されたことを表す</li>
<li>'-' はキーが削除されたことを表す</li>
<li>両方が含まれている場合、値の変更を表す</li>
</ul>
<p>数値キーはキーの比較は行われない。値の差分のみ返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// common は 中身に差分がある。 1 に key1 はあるが、 2 にはない。2 に key2 はあるが、 1 にはない。
that(array_difference([
    'common' =&gt; [
        'sub' =&gt; [
            'x' =&gt; 'val',
        ]
    ],
    'key1'   =&gt; 'hoge',
    'array'  =&gt; ['a', 'b', 'c'],
], [
    'common' =&gt; [
        'sub' =&gt; [
            'x' =&gt; 'VAL',
        ]
    ],
    'key2'   =&gt; 'fuga',
    'array'  =&gt; ['c', 'd', 'e'],
]))-&gt;isSame([
    'common.sub.x' =&gt; ['-' =&gt; 'val', '+' =&gt; 'VAL'],
    'key1'         =&gt; ['-' =&gt; 'hoge'],
    'array'        =&gt; ['-' =&gt; ['a', 'b'], '+' =&gt; ['d', 'e']],
    'key2'         =&gt; ['+' =&gt; 'fuga'],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array1</code></td>
<td>​<span class="summary">対象配列1</span></td>
</tr>
<tr>
<td>​iterable</td>
<td>​<code>$array2</code></td>
<td>​<span class="summary">対象配列2</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$delimiter = "."</code></td>
<td>​<span class="summary">差分配列のキー区切り文字</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">差分を表す配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_87852371a657da13603d0709c371ac43c8e806a9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_distinct()" class="anchor"></a>[F] array_distinct <small><span class="summary">比較関数が渡せる array_unique</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_distinct.php#L11-L107" target="_blank">array_distinct.php#11~107</a></p>
</div>
<details>
<summary class="">比較関数が渡せる array_unique</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_distinct(
    iterable $array,
    callable|int|string|null $comparator = null
): array</div></pre>
<div class="description">
<p>array_unique は微妙に癖があるのでシンプルに使いやすくしたもの。</p>
<ul class=" simple">
<li>SORT_STRING|SORT_FLAG_CASE のような指定が使える（大文字小文字を無視した重複除去）<ul class=" simple">
<li>厳密に言えば array_unique も指定すれば動く（が、ドキュメントに記載がない）</li>
</ul>
</li>
<li>配列を渡すと下記の動作になる<ul class=" simple">
<li>数値キーは配列アクセス</li>
<li>文字キーはメソッドコール（値は引数）</li>
</ul>
</li>
<li>もちろん（$a, $b を受け取る）クロージャも渡せる</li>
<li>引数1つのクロージャを渡すとシュワルツ的動作になる（Example 参照）</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルな重複除去
that(array_distinct([1, 2, 3, '3']))-&gt;isSame([1, 2, 3]);
// 大文字小文字を無視した重複除去
that(array_distinct(['a', 'b', 'A', 'B'], SORT_STRING|SORT_FLAG_CASE))-&gt;isSame(['a', 'b']);

$v1 = new \ArrayObject(['id' =&gt; '1', 'group' =&gt; 'aaa']);
$v2 = new \ArrayObject(['id' =&gt; '2', 'group' =&gt; 'bbb', 'dummy' =&gt; 123]);
$v3 = new \ArrayObject(['id' =&gt; '3', 'group' =&gt; 'aaa', 'dummy' =&gt; 456]);
$v4 = new \ArrayObject(['id' =&gt; '4', 'group' =&gt; 'bbb', 'dummy' =&gt; 789]);
// クロージャを指定して重複除去
that(array_distinct([$v1, $v2, $v3, $v4], fn($a, $b) =&gt; $a['group'] &lt;=&gt; $b['group']))-&gt;isSame([$v1, $v2]);
// 単純な配列アクセスなら文字列や配列でよい（上記と同じ結果になる）
that(array_distinct([$v1, $v2, $v3, $v4], 'group'))-&gt;isSame([$v1, $v2]);
// 文字キーの配列はメソッドコールになる（ArrayObject::count で重複検出）
that(array_distinct([$v1, $v2, $v3, $v4], ['count' =&gt; []]))-&gt;isSame([$v1, $v2]);
// 上記2つは混在できる（group キー + count メソッドで重複検出。端的に言えば "aaa+2", "bbb+3", "aaa+3", "bbb+3" で除去）
that(array_distinct([$v1, $v2, $v3, $v4], ['group', 'count' =&gt; []]))-&gt;isSame([$v1, $v2, 2 =&gt; $v3]);
// 引数1つのクロージャ
that(array_distinct([$v1, $v2, $v3, $v4], fn($ao) =&gt; $ao['group']))-&gt;isSame([$v1, $v2]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable|​int|​string|​null</td>
<td>​<code>$comparator = null</code></td>
<td>​<span class="summary">比較関数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">重複が除去された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6602dbd255ee89db3eb145855a93d23e4e96a4da-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_dive()" class="anchor"></a>[F] array_dive <small><span class="summary">パス形式で配列値を取得</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_dive.php#L9-L50" target="_blank">array_dive.php#9~50</a></p>
</div>
<details>
<summary class="">パス形式で配列値を取得</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_dive(
    array|\ArrayAccess $array,
    string|array $path,
    mixed $default = null,
    string $delimiter = "."
): mixed</div></pre>
<div class="description">
<p>存在しない場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    'a' =&gt; [
        'b' =&gt; [
            'c' =&gt; 'vvv'
        ]
    ]
];
that(array_dive($array, 'a.b.c'))-&gt;isSame('vvv');
that(array_dive($array, 'a.b.x', 9))-&gt;isSame(9);
// 配列を与えても良い。その場合 $delimiter 引数は意味をなさない
that(array_dive($array, ['a', 'b', 'c']))-&gt;isSame('vvv');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​<a href="https://php.net/manual/class.arrayaccess.php" target="_blank">ArrayAccess</a></td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$path</code></td>
<td>​<span class="summary">パス文字列。配列も与えられる</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$delimiter = "."</code></td>
<td>​<span class="summary">パスの区切り文字。大抵は '.' か '/'</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">パスが示す配列の値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_96d3ea515ff1d0c30ca40f0e3d5532b10b427bfb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_each()" class="anchor"></a>[F] array_each <small><span class="summary">array_reduce の参照版（のようなもの）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_each.php#L8-L87" target="_blank">array_each.php#8~87</a></p>
</div>
<details>
<summary class="">array_reduce の参照版（のようなもの）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_each(
    iterable $array,
    callable $callback,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>配列をループで回し、その途中経過、値、キー、連番をコールバック引数で渡して最終的な結果を返り値として返す。<span class="implicit-br">
</span>array_reduce と少し似てるが、下記の点が異なる。</p>
<ul class=" simple">
<li>いわゆる $carry は返り値で表すのではなく、参照引数で表す</li>
<li>値だけでなくキー、連番も渡ってくる</li>
<li>巨大配列の場合でも速度劣化が少ない（array_reduce に巨大配列を渡すと実用にならないレベルで遅くなる）</li>
</ul>
<p>$callback の引数は <code>($value, $key, $n)</code> （$n はキーとは関係がない 0 ～ 要素数-1 の通し連番）。</p>
<p>返り値ではなく参照引数なので return する必要はない（ワンライナーが書きやすくなる）。<span class="implicit-br">
</span>返り値が空くのでループ制御に用いる。<span class="implicit-br">
</span>今のところ $callback が false を返すとそこで break するのみ。</p>
<p>第3引数を省略した場合、<strong>クロージャの第1引数のデフォルト値が使われる</strong>。<span class="implicit-br">
</span>これは特筆すべき動作で、不格好な第3引数を完全に省略することができる（サンプルコードを参照）。<span class="implicit-br">
</span>ただし「php の文法違反（今のところエラーにはならないし、全てにデフォルト値をつければ一応回避可能）」「リフレクションを使う（ほんの少し遅くなる）」などの弊害が有るので推奨はしない。<span class="implicit-br">
</span>（ただ、「意図していることをコードで表す」といった観点ではこの記法の方が正しいとも思う）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 全要素を文字列的に足し合わせる
that(array_each([1, 2, 3, 4, 5], function (&amp;$carry, $v) {$carry .= $v;}, ''))-&gt;isSame('12345');
// 値をキーにして要素を2乗値にする
that(array_each([1, 2, 3, 4, 5], function (&amp;$carry, $v) {$carry[$v] = $v * $v;}, []))-&gt;isSame([
    1 =&gt; 1,
    2 =&gt; 4,
    3 =&gt; 9,
    4 =&gt; 16,
    5 =&gt; 25,
]);
// 上記と同じ。ただし、3 で break する
that(array_each([1, 2, 3, 4, 5], function (&amp;$carry, $v, $k){
    if ($k === 3) return false;
    $carry[$v] = $v * $v;
}, []))-&gt;isSame([
    1 =&gt; 1,
    2 =&gt; 4,
    3 =&gt; 9,
]);

// 下記は完全に同じ（第3引数の代わりにデフォルト引数を使っている）
that(array_each([1, 2, 3], function (&amp;$carry = [], $v = null) {
        $carry[$v] = $v * $v;
    }))-&gt;isSame(array_each([1, 2, 3], function (&amp;$carry, $v) {
        $carry[$v] = $v * $v;
    }, [])
    // 個人的に↑のようなぶら下がり引数があまり好きではない（クロージャを最後の引数にしたい）
);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価クロージャ。(&amp;$carry, $key, $value) を受ける</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">ループの最初や空の場合に適用される値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">each した結果</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_90c304e5794abc070d090ee9070b38e3a39e391d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_explode()" class="anchor"></a>[F] array_explode <small><span class="summary">配列を指定条件で分割する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_explode.php#L8-L82" target="_blank">array_explode.php#8~82</a></p>
</div>
<details>
<summary class="">配列を指定条件で分割する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_explode(
    iterable $array,
    mixed $condition,
    int $limit = PHP_INT_MAX
): array</div></pre>
<div class="description">
<p>文字列の explode を更に一階層掘り下げたイメージ。<span class="implicit-br">
</span>$condition で指定された要素は結果配列に含まれない。</p>
<p>$condition にはクロージャが指定できる。クロージャの場合は true 相当を返した場合に分割要素とみなされる。<span class="implicit-br">
</span>引数は (値, キー)の順番。</p>
<p>$limit に負数を与えると「その絶対値-1までを結合したものと残り」を返す。<span class="implicit-br">
</span>端的に言えば「正数を与えると後詰めでその個数で返す」「負数を与えると前詰めでその（絶対値）個数で返す」という動作になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// null 要素で分割
that(array_explode(['a', null, 'b', 'c'], null))-&gt;isSame([['a'], [2 =&gt; 'b', 3 =&gt; 'c']]);
// クロージャで分割（大文字で分割）
that(array_explode(['a', 'B', 'c', 'D', 'e'], fn($v) =&gt; ctype_upper($v)))-&gt;isSame([['a'], [2 =&gt; 'c'], [4 =&gt; 'e']]);
// 負数指定
that(array_explode(['a', null, 'b', null, 'c'], null, -2))-&gt;isSame([[0 =&gt; 'a', 1 =&gt; null, 2 =&gt; 'b'], [4 =&gt; 'c']]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$condition</code></td>
<td>​<span class="summary">分割条件</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$limit = PHP_INT_MAX</code></td>
<td>​<span class="summary">最大分割数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">分割された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_45b644756ae68e1fbe254d1db3a26c9a5cc7bdb5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_extend()" class="anchor"></a>[F] array_extend <small><span class="summary">独自拡張した array_replace_recursive</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_extend.php#L8-L133" target="_blank">array_extend.php#8~133</a></p>
</div>
<details>
<summary class="">独自拡張した array_replace_recursive</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_extend(
    array|bool $default = [],
    iterable|\Closure ...$arrays
): array</div></pre>
<div class="description">
<p>下記の点で array_replace_recursive と異なる。</p>
<ul class=" simple">
<li>元配列のキーのみでフィルタされる</li>
<li>対象配列にクロージャを渡すと現在の状態を引数にしてコールバックされる</li>
<li>値に Generator や Generator 関数を渡すと最後にまとめて値化される<ul class=" simple">
<li>つまり、上書きされた値は実質的にコールされない</li>
</ul>
</li>
<li>recursive かどうかは 最初の引数で分岐する（jQuery の extend と同じ）</li>
<li>recursive の場合、元配列の値が配列の場合のみ対象となる。配列でない場合は単純に上書きされる<ul class=" simple">
<li>次の値が非配列の場合、末尾に追加される</li>
<li>次の値がクロージャの場合、元の値を引数にしてコールバックされる</li>
<li>次の値が配列の場合<ul class=" simple">
<li>元配列が数値配列なら完全にマージされる</li>
<li>元配列が連想配列なら再帰される</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>この仕様上、Generator を値とする配列を対象にすることはできないが、そのような状況は稀だろう。<span class="implicit-br">
</span>その代わり、使われるかどうか分からない状態でもとりあえず Generator にしておけば無駄な処理を省くことができる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"># $deep ではない単純呼び出し
that(array_extend([
    'overwrite' =&gt; 'hoge',            // 後段で指定されているので上書きされる
    'through'   =&gt; 'fuga',            // 後段で指定されていないので生き残る
    'array'     =&gt; ['a', 'b', 'c'],   // $deep ではないし後段で指定されているので完全に上書きされる
    'yield1'    =&gt; fn() =&gt; yield 123, // 後段で指定されているのでコールすらされない
    'yield2'    =&gt; fn() =&gt; yield 456, // 後段で指定されていないのでコールされる
], [
    'ignore'    =&gt; null,              // 元配列に存在しないのでスルーされる
    'overwrite' =&gt; 'HOGE',
    'array'     =&gt; ['x', 'y', 'z'],
    'yield1'    =&gt; fn() =&gt; yield 234,
]))-&gt;is([
    'overwrite' =&gt; 'HOGE',
    'through'   =&gt; 'fuga',
    'array'     =&gt; ['x', 'y', 'z'],
    'yield1'    =&gt; 234,
    'yield2'    =&gt; 456,
]);
# $deep の場合のマージ呼び出し
that(array_extend(true, [
    'array'    =&gt; ['hoge'],            // 後段がスカラーなので末尾に追加される
    'callback' =&gt; ['fuga'],            // 後段がクロージャなのでコールバックされる
    'list'     =&gt; ['a', 'b', 'c'],     // 数値配列なのでマージされる
    'hash'     =&gt; ['a' =&gt; null],       // 連想配列なので再帰される
    'yield'    =&gt; [fn() =&gt; yield 123], // generator は解決される
], [
    'array'    =&gt; 'HOGE',
    'callback' =&gt; fn($v) =&gt; $v + [1 =&gt; 'FUGA'],
    'list'     =&gt; ['x', 'y', 'z'],
    'hash'     =&gt; ['a' =&gt; ['x' =&gt; ['y' =&gt; ['z' =&gt; 'xyz']]]],
    'yield'    =&gt; [fn() =&gt; yield 456],
]))-&gt;is([
    'array'    =&gt; ['hoge', 'HOGE'],
    'callback' =&gt; ['fuga', 'FUGA'],
    'list'     =&gt; ['a', 'b', 'c', 'x', 'y', 'z'],
    'hash'     =&gt; ['a' =&gt; ['x' =&gt; ['y' =&gt; ['z' =&gt; 'xyz']]]],
    'yield'    =&gt; [123, 456],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​bool</td>
<td>​<code>$default = []</code></td>
<td>​<span class="summary">基準となる配列</span></td>
</tr>
<tr>
<td>​iterable|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>...$arrays</code></td>
<td>​<span class="summary">マージする配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f0b0f7093752b63de91f9aea91d55cf98082184b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_fill_callback()" class="anchor"></a>[F] array_fill_callback <small><span class="summary">array_fill_keys のコールバック版のようなもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_fill_callback.php#L9-L42" target="_blank">array_fill_callback.php#9~42</a></p>
</div>
<details>
<summary class="">array_fill_keys のコールバック版のようなもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_fill_callback(
    iterable $keys,
    callable $callback
): array</div></pre>
<div class="description">
<p>指定したキー配列をそれらのマップしたもので配列を生成する。<span class="implicit-br">
</span><code>array_combine($keys, array_map($callback, $keys))</code> とほぼ等価。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$abc = ['a', 'b', 'c'];
// [a, b, c] から [a =&gt; A, b =&gt; B, c =&gt; C] を作る
that(array_fill_callback($abc, 'strtoupper'))-&gt;isSame([
    'a' =&gt; 'A',
    'b' =&gt; 'B',
    'c' =&gt; 'C',
]);
// [a, b, c] からその sha1 配列を作って大文字化する
that(array_fill_callback($abc, fn($v) =&gt; strtoupper(sha1($v))))-&gt;isSame([
    'a' =&gt; '86F7E437FAA5A7FCE15D1DDCB9EAEAEA377667B8',
    'b' =&gt; 'E9D71F5EE7C92D6DC9E92FFDAD17B8BD49418F98',
    'c' =&gt; '84A516841BA77A5B4648DE2CD0DFCB30EA46DBB4',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$keys</code></td>
<td>​<span class="summary">キーとなる配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">要素のコールバック（引数でキーが渡ってくる）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_afcadfbf336b72eff2c421aee55d90d33bcdc4af-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_fill_gap()" class="anchor"></a>[F] array_fill_gap <small><span class="summary">配列の隙間を埋める</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_fill_gap.php#L7-L100" target="_blank">array_fill_gap.php#7~100</a></p>
</div>
<details>
<summary class="">配列の隙間を埋める</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_fill_gap(
    array $array,
    mixed ...$values
): array</div></pre>
<div class="description">
<p>「隙間」とは数値キーの隙間のこと。文字キーには関与しない。<span class="implicit-br">
</span>連番の抜けている箇所に $values の値を順次詰めていく動作となる。</p>
<p>値が足りなくてもエラーにはならない。つまり、この関数を通したとしても隙間が無くなるわけではない。<span class="implicit-br">
</span>また、隙間を埋めても値が余る場合（隙間より与えられた値が多い場合）は末尾に全て追加される。</p>
<p>負数キーは考慮しない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// ところどころキーが抜け落ちている配列の・・・
$array = [
    1 =&gt; 'b',
    2 =&gt; 'c',
    5 =&gt; 'f',
    7 =&gt; 'h',
];
// 抜けているところを可変引数で順次埋める（'i', 'j' は隙間というより末尾追加）
that(array_fill_gap($array, 'a', 'd', 'e', 'g', 'i', 'j'))-&gt;isSame([
    0 =&gt; 'a',
    1 =&gt; 'b',
    2 =&gt; 'c',
    3 =&gt; 'd',
    4 =&gt; 'e',
    5 =&gt; 'f',
    6 =&gt; 'g',
    7 =&gt; 'h',
    8 =&gt; 'i',
    9 =&gt; 'j',
]);

// 文字キーには関与しないし、値は足りなくても良い
$array = [
    1   =&gt; 'b',
    'x' =&gt; 'noize',
    4   =&gt; 'e',
    'y' =&gt; 'noize',
    7   =&gt; 'h',
    'z' =&gt; 'noize',
];
// 文字キーはそのまま保持され、値が足りないので 6 キーはない
that(array_fill_gap($array, 'a', 'c', 'd', 'f'))-&gt;isSame([
    0   =&gt; 'a',
    1   =&gt; 'b',
    'x' =&gt; 'noize',
    2   =&gt; 'c',
    3   =&gt; 'd',
    4   =&gt; 'e',
    'y' =&gt; 'noize',
    5   =&gt; 'f',
    7   =&gt; 'h',
    'z' =&gt; 'noize',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$values</code></td>
<td>​<span class="summary">詰める値（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">隙間が詰められた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e8cf28f8d619b0fd7305f30e96f3d0e17f3f1880-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_filter_map()" class="anchor"></a>[F] array_filter_map <small><span class="summary">array_filter + array_map する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_filter_map.php#L11-L49" target="_blank">array_filter_map.php#11~49</a></p>
</div>
<details>
<summary class="">array_filter + array_map する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_filter_map(
    iterable $array,
    callable $callback
): iterable</div></pre>
<div class="description">
<p>コールバックを適用して、結果が !false 要素のみ取り出す。<span class="implicit-br">
</span>コールバックの第1引数を参照にして書き換えると結果にも反映される。</p>
<p>$callback が要求するならキーも渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_filter_map([' a ', ' b ', ''], fn(&amp;$v) =&gt; strlen($v) ? $v = trim($v) : false))-&gt;isSame(['a', 'b']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価クロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<span class="summary">$callback が !false を返し map された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3559cd3cc1fa669ec9195dce78a0afda03dcf9f9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_filter_recursive()" class="anchor"></a>[F] array_filter_recursive <small><span class="summary">再帰的に array_filter する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_filter_recursive.php#L10-L105" target="_blank">array_filter_recursive.php#10~105</a></p>
</div>
<details>
<summary class="">再帰的に array_filter する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_filter_recursive(
    iterable|T $array,
    callable $callback,
    bool $unset_empty = true
): iterable</div></pre>
<div class="description">
<p>要素が配列だった場合に再帰する点とコールバックの引数以外は array_filter とほとんど変わらない。<span class="implicit-br">
</span>$callback が要求するならキーも渡ってくる。</p>
<p>$unset_empty:true だと再帰で伏せられた結果が空になった場合、そのキーも伏せられる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    'a'  =&gt; 'A', // 生き残る
    'e'  =&gt; '',  // 生き残らない
    'a1' =&gt; [    // A がいるため $unset_empty は無関係に a1 自体も生き残る
        'A', // 生き残る
        '',  // 生き残らない
    ],
    'a2' =&gt; [    // 生き残りが居ないため $unset_empty:true だと a2 自体も生き残らない
        '',  // 生き残らない
        '',  // 生き残らない
    ],
    'b1' =&gt; [    // a1 のネスト版
        'a' =&gt; [
            'a' =&gt; 'A',
            'e' =&gt; '',
        ],
    ],
    'b2' =&gt; [    // a2 のネスト版
        'a' =&gt; [
            'a' =&gt; '',
            'e' =&gt; '',
        ],
    ],
];
// 親を伏せない版
that(array_filter_recursive($array, fn($v) =&gt; strlen($v), false))-&gt;isSame([
    "a"  =&gt; "A",
    "a1" =&gt; ["A"],
    "a2" =&gt; [],
    "b1" =&gt; [
        "a" =&gt; [
            "a" =&gt; "A",
        ],
    ],
    "b2" =&gt; [
        "a" =&gt; [],
    ],
]);
// 親を伏せる版
that(array_filter_recursive($array, fn($v) =&gt; strlen($v), true))-&gt;isSame([
    "a"  =&gt; "A",
    "a1" =&gt; ["A"],
    "b1" =&gt; [
        "a" =&gt; [
            "a" =&gt; "A",
        ],
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable|​<a href="#--T">T</a></td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価クロージャ（値, キー, 親キー配列）</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$unset_empty = true</code></td>
<td>​<span class="summary">再帰の際に空になった要素も伏せるか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<span class="summary">フィルタされた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d44f9b2651e4dc2e42a98c36288788fef562f61e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_filters()" class="anchor"></a>[F] array_filters <small><span class="summary">複数コールバックを指定できる array_filter</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_filters.php#L11-L85" target="_blank">array_filters.php#11~85</a></p>
</div>
<details>
<summary class="">複数コールバックを指定できる array_filter</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_filters(
    iterable $array,
    callable ...$callbacks
): array</div></pre>
<div class="description">
<p>指定したコールバックで複数回回してフィルタする。<span class="implicit-br">
</span><code>array_filter($array, $f, $g)</code> は <code>array_filter(array_filter($array, $f), $g)</code> とほぼ等しい。<span class="implicit-br">
</span>コールバックが要求するならキーも渡ってくる。<span class="implicit-br">
</span>さらに文字列関数で "..." から始まっているなら可変引数としてコールする。</p>
<p>少し変わった仕様として、コールバックに [$method =&gt; $args] を付けるとそれはメソッド呼び出しになる。<span class="implicit-br">
</span>つまり各要素 $v に対して <code>$v-&gt;$method(...$args)</code> がフィルタ結果になる。<span class="implicit-br">
</span>さらに引数が不要なら <code>@method</code> とするだけで良い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 非 null かつ小文字かつ16進数
that(array_filters(['abc', 'XYZ', null, 'ABC', 'ff', '3e7'],
    fn($v) =&gt; $v !== null,
    fn($v) =&gt; ctype_lower("$v"),
    fn($v) =&gt; ctype_xdigit("$v"),
))-&gt;isSame([0 =&gt; 'abc', 4 =&gt; 'ff']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>...$callbacks</code></td>
<td>​<span class="summary">評価クロージャ配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">評価クロージャでフィルタした新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_319a1f5aa7035a51915e7d5b4ccbff08a609752f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_find()" class="anchor"></a>[F] array_find <small><span class="summary">array_search のクロージャ版のようなもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><span class="badge alert" data-badge-title="">deprecated </span><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_find.php#L8-L20" target="_blank">array_find.php#8~20</a></p>
</div>
<details>
<summary class="">array_search のクロージャ版のようなもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_find(
    $array,
    $callback,
    $is_key = true
)</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​</td>
<td>​<code>$array</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$is_key = true</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--array_find_first%28%29">array_find_first()</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9ac748bee76f3ad96d6074179ba1492eb55818c7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_find_first()" class="anchor"></a>[F] array_find_first <small><span class="summary">array_search のクロージャ版のようなもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_find_first.php#L8-L49" target="_blank">array_find_first.php#8~49</a></p>
</div>
<details>
<summary class="">array_search のクロージャ版のようなもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_find_first(
    iterable $array,
    callable $callback,
    bool $is_key = true
): mixed</div></pre>
<div class="description">
<p>コールバックの返り値が true 相当のものを返す。<span class="implicit-br">
</span>$is_key に true を与えるとそのキーを返す（デフォルトの動作）。<span class="implicit-br">
</span>$is_key に false を与えるとコールバックの結果を返す。</p>
<p>この関数は論理値 FALSE を返す可能性がありますが、FALSE として評価される値を返す可能性もあります。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 最初に見つかったキーを返す
that(array_find_first(['a', '8', '9'], 'ctype_digit'))-&gt;isSame(1);
that(array_find_first(['a', 'b', 'b'], fn($v) =&gt; $v === 'b'))-&gt;isSame(1);
// 最初に見つかったコールバック結果を返す（最初の数字の2乗を返す）
$ifnumeric2power = fn($v) =&gt; ctype_digit($v) ? $v * $v : false;
that(array_find_first(['a', '8', '9'], $ifnumeric2power, false))-&gt;isSame(64);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価コールバック</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$is_key = true</code></td>
<td>​<span class="summary">キーを返すか否か</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">コールバックが true を返した最初のキー。存在しなかったら null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_54effe04df40ac6236e489b81736a346cba24ee2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_find_last()" class="anchor"></a>[F] array_find_last <small><span class="summary">array_find の後ろから探す版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_find_last.php#L9-L54" target="_blank">array_find_last.php#9~54</a></p>
</div>
<details>
<summary class="">array_find の後ろから探す版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_find_last(
    iterable $array,
    callable $callback,
    bool $is_key = true
): mixed</div></pre>
<div class="description">
<p>コールバックの返り値が true 相当のものを返す。<span class="implicit-br">
</span>$is_key に true を与えるとそのキーを返す（デフォルトの動作）。<span class="implicit-br">
</span>$is_key に false を与えるとコールバックの結果を返す。</p>
<p>この関数は論理値 FALSE を返す可能性がありますが、FALSE として評価される値を返す可能性もあります。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 最後に見つかったキーを返す
that(array_find_last(['a', '8', '9'], 'ctype_digit'))-&gt;isSame(2);
that(array_find_last(['a', 'b', 'b'], fn($v) =&gt; $v === 'b'))-&gt;isSame(2);
// 最後に見つかったコールバック結果を返す（最初の数字の2乗を返す）
$ifnumeric2power = fn($v) =&gt; ctype_digit($v) ? $v * $v : false;
that(array_find_last(['a', '8', '9'], $ifnumeric2power, false))-&gt;isSame(81);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価コールバック</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$is_key = true</code></td>
<td>​<span class="summary">キーを返すか否か</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">コールバックが true を返した最初のキー。存在しなかったら false</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2ff1f13b9c106b6c22ecb83cf2b383761328697b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_find_recursive()" class="anchor"></a>[F] array_find_recursive <small><span class="summary">array_find の再帰版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_find_recursive.php#L8-L68" target="_blank">array_find_recursive.php#8~68</a></p>
</div>
<details>
<summary class="">array_find の再帰版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_find_recursive(
    iterable $array,
    callable $callback,
    bool $is_key = true
): mixed</div></pre>
<div class="description">
<p>コールバックの返り値が true 相当のものを返す。<span class="implicit-br">
</span>$is_key に true を与えるとそのキー配列を返す（デフォルトの動作）。<span class="implicit-br">
</span>$is_key に false を与えるとコールバックの結果を返す。</p>
<p>この関数は論理値 FALSE を返す可能性がありますが、FALSE として評価される値を返す可能性もあります。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 最初に見つかったキーを配列で返す
that(array_find_recursive([
    'a' =&gt; [
        'b' =&gt; [
            'c' =&gt; [1, 2, 3],
        ],
    ],
], fn($v) =&gt; $v === 2))-&gt;isSame(['a', 'b', 'c', 1]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価コールバック</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$is_key = true</code></td>
<td>​<span class="summary">キーを返すか否か</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">コールバックが true を返した最初のキー。存在しなかったら false</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4c539d0a575f3fff062e6c1726ad44d3b3bd6534-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_flatten()" class="anchor"></a>[F] array_flatten <small><span class="summary">多階層配列をフラットに展開する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_flatten.php#L7-L81" target="_blank">array_flatten.php#7~81</a></p>
</div>
<details>
<summary class="">多階層配列をフラットに展開する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_flatten(
    iterable $array,
    string|\Closure|null $delimiter = null
): array</div></pre>
<div class="description">
<p>巷にあふれている実装と違って、 ["$pkey.$ckey" =&gt; $value] 形式の配列でも返せる。<span class="implicit-br">
</span>$delimiter で区切り文字を指定した場合にそのようになる。<span class="implicit-br">
</span>$delimiter = null の場合に本当の配列で返す（巷の実装と同じ）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
   'k1' =&gt; 'v1',
   'k2' =&gt; [
       'k21' =&gt; 'v21',
       'k22' =&gt; [
           'k221' =&gt; 'v221',
           'k222' =&gt; 'v222',
           'k223' =&gt; [1, 2, 3],
       ],
   ],
];
// 区切り文字指定なし
that(array_flatten($array))-&gt;isSame([
   0 =&gt; 'v1',
   1 =&gt; 'v21',
   2 =&gt; 'v221',
   3 =&gt; 'v222',
   4 =&gt; 1,
   5 =&gt; 2,
   6 =&gt; 3,
]);
// 区切り文字指定
that(array_flatten($array, '.'))-&gt;isSame([
   'k1'            =&gt; 'v1',
   'k2.k21'        =&gt; 'v21',
   'k2.k22.k221'   =&gt; 'v221',
   'k2.k22.k222'   =&gt; 'v222',
   'k2.k22.k223.0' =&gt; 1,
   'k2.k22.k223.1' =&gt; 2,
   'k2.k22.k223.2' =&gt; 3,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a>|​null</td>
<td>​<code>$delimiter = null</code></td>
<td>​<span class="summary">キーの区切り文字。 null を与えると連番になる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">フラット化された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0d6474603e46bd75aed093155127d9e7e95b2161-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_get()" class="anchor"></a>[F] array_get <small><span class="summary">デフォルト値付きの配列値取得</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_get.php#L8-L86" target="_blank">array_get.php#8~86</a></p>
</div>
<details>
<summary class="">デフォルト値付きの配列値取得</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_get(
    array|\ArrayAccess $array,
    string|int|array|\Closure $key,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>存在しない場合は $default を返す。</p>
<p>$key に配列を与えるとそれらの値の配列を返す（lookup 的な動作）。<span class="implicit-br">
</span>その場合、$default が活きるのは「全て無かった場合」となる。</p>
<p>さらに $key が配列の場合に限り、 $default を省略すると空配列として動作する。</p>
<p>同様に、$key にクロージャを与えると、その返り値が true 相当のものを返す。<span class="implicit-br">
</span>その際、 $default が配列なら一致するものを配列で返し、配列でないなら単値で返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 単純取得
that(array_get(['a', 'b', 'c'], 1))-&gt;isSame('b');
// 単純デフォルト
that(array_get(['a', 'b', 'c'], 9, 999))-&gt;isSame(999);
// 配列取得
that(array_get(['a', 'b', 'c'], [0, 2]))-&gt;isSame([0 =&gt; 'a', 2 =&gt; 'c']);
// 配列部分取得
that(array_get(['a', 'b', 'c'], [0, 9]))-&gt;isSame([0 =&gt; 'a']);
// 配列デフォルト（null ではなく [] を返す）
that(array_get(['a', 'b', 'c'], [9]))-&gt;isSame([]);
// クロージャ指定＆単値（コールバックが true を返す最初の要素）
that(array_get(['a', 'b', 'c'], fn($v) =&gt; in_array($v, ['b', 'c'])))-&gt;isSame('b');
// クロージャ指定＆配列（コールバックが true を返すもの）
that(array_get(['a', 'b', 'c'], fn($v) =&gt; in_array($v, ['b', 'c']), []))-&gt;isSame([1 =&gt; 'b', 2 =&gt; 'c']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​<a href="https://php.net/manual/class.arrayaccess.php" target="_blank">ArrayAccess</a></td>
<td>​<code>$array</code></td>
<td>​<span class="summary">配列</span></td>
</tr>
<tr>
<td>​string|​int|​array|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$key</code></td>
<td>​<span class="summary">取得したいキー。配列を与えると全て返す。クロージャの場合は true 相当を返す</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">指定したキーの値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9f0e2c2a79598236e6b1579d1e23cef7ca246008-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_grep_key()" class="anchor"></a>[F] array_grep_key <small><span class="summary">キーを正規表現でフィルタする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_grep_key.php#L7-L30" target="_blank">array_grep_key.php#7~30</a></p>
</div>
<details>
<summary class="">キーを正規表現でフィルタする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_grep_key(
    iterable $array,
    string $regex,
    bool $not = false
): array</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_grep_key(['a' =&gt; 'A', 'aa' =&gt; 'AA', 'b' =&gt; 'B'], '#^a#'))-&gt;isSame(['a' =&gt; 'A', 'aa' =&gt; 'AA']);
that(array_grep_key(['a' =&gt; 'A', 'aa' =&gt; 'AA', 'b' =&gt; 'B'], '#^a#', true))-&gt;isSame(['b' =&gt; 'B']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$regex</code></td>
<td>​<span class="summary">正規表現</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$not = false</code></td>
<td>​<span class="summary">true にすると「マッチしない」でフィルタする</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">正規表現でフィルタされた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_72a8ec370259f029462b5e79ee6ec11b2832e8bc-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_group()" class="anchor"></a>[F] array_group <small><span class="summary">配列をコールバックの返り値でグループ化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_group.php#L9-L75" target="_blank">array_group.php#9~75</a></p>
</div>
<details>
<summary class="">配列をコールバックの返り値でグループ化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_group(
    iterable $array,
    ?callable|string|array $callback = null,
    bool $preserve_keys = false
): array</div></pre>
<div class="description">
<p>コールバックを省略すると値そのもので評価する。<span class="implicit-br">
</span>コールバックに配列・文字列を与えるとキーでグループ化する。<span class="implicit-br">
</span>コールバックが配列を返すと入れ子としてグループ化する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_group([1, 1, 1]))-&gt;isSame([
    1 =&gt; [1, 1, 1],
]);
that(array_group([1, 2, 3], fn($v) =&gt; $v % 2))-&gt;isSame([
    1 =&gt; [1, 3],
    0 =&gt; [2],
]);
// group -&gt; id で入れ子グループにする
$row1 = ['id' =&gt; 1, 'group' =&gt; 'hoge'];
$row2 = ['id' =&gt; 2, 'group' =&gt; 'fuga'];
$row3 = ['id' =&gt; 3, 'group' =&gt; 'hoge'];
that(array_group([$row1, $row2, $row3], fn($row) =&gt; [$row['group'], $row['id']]))-&gt;isSame([
    'hoge' =&gt; [
        1 =&gt; $row1,
        3 =&gt; $row3,
    ],
    'fuga' =&gt; [
        2 =&gt; $row2,
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​?callable|​string|​array</td>
<td>​<code>$callback = null</code></td>
<td>​<span class="summary">評価クロージャ。 null なら値そのもので評価</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$preserve_keys = false</code></td>
<td>​<span class="summary">キーを保存するか。 false の場合数値キーは振り直される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">グルーピングされた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_89b214d6f543d224042de67211417446213f12d7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_implode()" class="anchor"></a>[F] array_implode <small><span class="summary">配列の各要素の間に要素を差し込む</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_implode.php#L7-L48" target="_blank">array_implode.php#7~48</a></p>
</div>
<details>
<summary class="">配列の各要素の間に要素を差し込む</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_implode(
    iterable|string $array,
    string $glue
): array</div></pre>
<div class="description">
<p>歴史的な理由はないが、引数をどちらの順番でも受けつけることが可能。<span class="implicit-br">
</span>ただし、$glue を先に渡すパターンの場合は配列指定が可変引数渡しになる。</p>
<p>文字キーは保存されるが数値キーは再割り振りされる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// (配列, 要素) の呼び出し
that(array_implode(['a', 'b', 'c'], 'X'))-&gt;isSame(['a', 'X', 'b', 'X', 'c']);
// (要素, ...配列) の呼び出し
that(array_implode('X', 'a', 'b', 'c'))-&gt;isSame(['a', 'X', 'b', 'X', 'c']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable|​string</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$glue</code></td>
<td>​<span class="summary">差し込む要素</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">差し込まれた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4dacc9a6ccb1bc40914a749f0423e2d9ec35f9ad-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_insert()" class="anchor"></a>[F] array_insert <small><span class="summary">配列・連想配列を問わず任意の位置に値を挿入する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_insert.php#L7-L39" target="_blank">array_insert.php#7~39</a></p>
</div>
<details>
<summary class="">配列・連想配列を問わず任意の位置に値を挿入する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_insert(
    array $array,
    mixed $value,
    int|null $position = null
): array</div></pre>
<div class="description">
<p>$position を省略すると最後に挿入される（≒ array_push）。<span class="implicit-br">
</span>$position に負数を与えると後ろから数えられる。<span class="implicit-br">
</span>$value には配列も与えられるが、その場合数値キーは振り直される</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_insert([1, 2, 3], 'x'))-&gt;isSame([1, 2, 3, 'x']);
that(array_insert([1, 2, 3], 'x', 1))-&gt;isSame([1, 'x', 2, 3]);
that(array_insert([1, 2, 3], 'x', -1))-&gt;isSame([1, 2, 'x', 3]);
that(array_insert([1, 2, 3], ['a' =&gt; 'A', 'b' =&gt; 'B'], 1))-&gt;isSame([1, 'a' =&gt; 'A', 'b' =&gt; 'B', 2, 3]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">挿入値</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$position = null</code></td>
<td>​<span class="summary">挿入位置</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">挿入された新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1cca5d1af555cdf24c2b4dee445b57f63be57486-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_join()" class="anchor"></a>[F] array_join <small><span class="summary">配列の SQL 的な JOIN を行う</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_join.php#L8-L124" target="_blank">array_join.php#8~124</a></p>
</div>
<details>
<summary class="">配列の SQL 的な JOIN を行う</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_join(
    array|iterable&amp;\ArrayAccess $from,
    array|iterable&amp;\ArrayAccess $join,
    array|callable $on,
    bool $outer = false
): array</div></pre>
<div class="description">
<p>$from に対して $on を満たす $join の行を結合する。<span class="implicit-br">
</span>$from,$join は共にいわゆる「配列の配列」でなければならない。</p>
<p>$on は各レコードが渡ってくるので、true を返せば結合、false を返せば結合されない。<span class="implicit-br">
</span>$on には配列も渡すことができ、配列を渡した場合は USING 的な動作になる。</p>
<ul class=" simple">
<li>キーが駆動表のカラム名、値が結合表のカラム名を表す</li>
<li>キーの値同士を json で判定する（厳密に言えば値を json キーにした一時配列で逆引きされる）</li>
<li>複数指定時は AND になる<span class="implicit-br">
</span>上記の前提・制約が許容できるなら配列指定の方が高速に動作する。</li>
</ul>
<p>join 後のキーは各キーを "+" で連結したものになるが、このキーは暫定的なもの。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// t_article と t_comment の JOIN（のイメージ）
$articles = [
    2 =&gt; ['article_id' =&gt; 2, 'article_name' =&gt; 'hoge'],
    4 =&gt; ['article_id' =&gt; 4, 'article_name' =&gt; 'fuga'],
    5 =&gt; ['article_id' =&gt; 5, 'article_name' =&gt; 'piyo'],
];
$comments = [
    4 =&gt; ['comment_id' =&gt; 4, 'article_id' =&gt; 2, 'comment' =&gt; 'foo'],
    6 =&gt; ['comment_id' =&gt; 6, 'article_id' =&gt; 4, 'comment' =&gt; 'bar'],
    7 =&gt; ['comment_id' =&gt; 7, 'article_id' =&gt; 4, 'comment' =&gt; 'baz'],
    9 =&gt; ['comment_id' =&gt; 9, 'article_id' =&gt; 9, 'comment' =&gt; 'dmy'],
];
// INNER っぽい動き
that(array_join($articles, $comments, fn($article, $comment) =&gt; $article['article_id'] === $comment['article_id'], false))-&gt;isSame([
    '2+4' =&gt; ['article_id' =&gt; 2, 'article_name' =&gt; 'hoge', 'comment_id' =&gt; 4, 'comment' =&gt; 'foo'],
    '4+6' =&gt; ['article_id' =&gt; 4, 'article_name' =&gt; 'fuga', 'comment_id' =&gt; 6, 'comment' =&gt; 'bar'],
    '4+7' =&gt; ['article_id' =&gt; 4, 'article_name' =&gt; 'fuga', 'comment_id' =&gt; 7, 'comment' =&gt; 'baz'],
]);
// LEFT っぽい動き
that(array_join($articles, $comments, fn($article, $comment) =&gt; $article['article_id'] === $comment['article_id'], true))-&gt;isSame([
    '2+4'    =&gt; ['article_id' =&gt; 2, 'article_name' =&gt; 'hoge', 'comment_id' =&gt; 4, 'comment' =&gt; 'foo'],
    '4+6'    =&gt; ['article_id' =&gt; 4, 'article_name' =&gt; 'fuga', 'comment_id' =&gt; 6, 'comment' =&gt; 'bar'],
    '4+7'    =&gt; ['article_id' =&gt; 4, 'article_name' =&gt; 'fuga', 'comment_id' =&gt; 7, 'comment' =&gt; 'baz'],
    '5+null' =&gt; ['article_id' =&gt; 5, 'article_name' =&gt; 'piyo', 'comment_id' =&gt; null, 'comment' =&gt; null],
]);
// ↑のような単純比較クロージャなら配列でも指定できる（そしてこの方がはるかに速い）
that(array_join($articles, $comments, ['article_id' =&gt; 'article_id'], false))-&gt;isSame([
    '2+4' =&gt; ['article_id' =&gt; 2, 'article_name' =&gt; 'hoge', 'comment_id' =&gt; 4, 'comment' =&gt; 'foo'],
    '4+6' =&gt; ['article_id' =&gt; 4, 'article_name' =&gt; 'fuga', 'comment_id' =&gt; 6, 'comment' =&gt; 'bar'],
    '4+7' =&gt; ['article_id' =&gt; 4, 'article_name' =&gt; 'fuga', 'comment_id' =&gt; 7, 'comment' =&gt; 'baz'],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​<a href="#--iterable%26-ArrayAccess">ArrayAccess</a></td>
<td>​<code>$from</code></td>
<td>​<span class="summary">駆動表</span></td>
</tr>
<tr>
<td>​array|​<a href="#--iterable%26-ArrayAccess">ArrayAccess</a></td>
<td>​<code>$join</code></td>
<td>​<span class="summary">結合表</span></td>
</tr>
<tr>
<td>​array|​callable</td>
<td>​<code>$on</code></td>
<td>​<span class="summary">結合条件。原則として callable で、ある程度の前提制約が置けるときのみ配列を指定する</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$outer = false</code></td>
<td>​<span class="summary">true だと OUTER, false だと INNER 的挙動になる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">JOIN された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_26f025764a918f7396f61a4f82523913a0c87d10-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_keys_exist()" class="anchor"></a>[F] array_keys_exist <small><span class="summary">array_key_exists の複数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_keys_exist.php#L8-L63" target="_blank">array_keys_exist.php#8~63</a></p>
</div>
<details>
<summary class="">array_key_exists の複数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_keys_exist(
    array|string $keys,
    array|\ArrayAccess $array
): bool</div></pre>
<div class="description">
<p>指定キーが全て存在するなら true を返す。<span class="implicit-br">
</span>配列ではなく単一文字列を与えても動作する（array_key_exists と全く同じ動作になる）。</p>
<p>$keys に空を与えると例外を投げる。<span class="implicit-br">
</span>$keys に配列を与えるとキーで潜ってチェックする（Example 参照）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// すべて含むので true
that(array_keys_exist(['a', 'b', 'c'], ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C']))-&gt;isTrue();
// N は含まないので false
that(array_keys_exist(['a', 'b', 'N'], ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C']))-&gt;isFalse();
// 配列を与えると潜る（日本語で言えば「a というキーと、x というキーとその中に x1, x2 というキーがあるか？」）
that(array_keys_exist(['a', 'x' =&gt; ['x1', 'x2']], ['a' =&gt; 'A', 'x' =&gt; ['x1' =&gt; 'X1', 'x2' =&gt; 'X2']]))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​string</td>
<td>​<code>$keys</code></td>
<td>​<span class="summary">調べるキー</span></td>
</tr>
<tr>
<td>​array|​<a href="https://php.net/manual/class.arrayaccess.php" target="_blank">ArrayAccess</a></td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">指定キーが全て存在するなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3e2884d431dd6eaf3b5c25b1be191a7cefb7f63e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_kvmap()" class="anchor"></a>[F] array_kvmap <small><span class="summary">配列の各キー・値にコールバックを適用する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_kvmap.php#L7-L105" target="_blank">array_kvmap.php#7~105</a></p>
</div>
<details>
<summary class="">配列の各キー・値にコールバックを適用する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_kvmap(
    iterable $array,
    callable $callback
): array</div></pre>
<div class="description">
<p>$callback は (キー, 値, $callback) が渡ってくるので 「その位置に配置したい配列」を返せばそこに置換される。<span class="implicit-br">
</span>つまり、空配列を返せばそのキー・値は消えることになるし、複数の配列を返せば要素が増えることになる。<span class="implicit-br">
</span>ただし、数値キーは新しく採番される。<span class="implicit-br">
</span>null を返すと特別扱いで、そのキー・値をそのまま維持する。<span class="implicit-br">
</span>iterable を返す必要があるが、もし iterable でない場合は配列キャストされる。</p>
<p>「map も filter も可能でキー変更可能」というとてもマッチョな関数。<span class="implicit-br">
</span>実質的には「数値キーが再採番される再帰的でない array_convert」のように振る舞う。<span class="implicit-br">
</span>ただし、再帰処理はないので自前で管理する必要がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
   'a' =&gt; 'A',
   'b' =&gt; 'B',
   'c' =&gt; 'C',
   'd' =&gt; 'D',
];
// キーに '_' 、値に 'prefix-' を付与。'b' は一切何もしない。'c' は値のみ。'd' はそれ自体伏せる
that(array_kvmap($array, function ($k, $v) {
    if ($k === 'b') return null;
    if ($k === 'd') return [];
    if ($k !== 'c') $k = "_$k";
    return [$k =&gt; "prefix-$v"];
}))-&gt;isSame([
    '_a' =&gt; 'prefix-A',
    'b'  =&gt; 'B',
    'c'  =&gt; 'prefix-C',
]);

// 複数返せばその分増える（要素の水増し）
that(array_kvmap($array, fn($k, $v) =&gt; [
    "{$k}1" =&gt; "{$v}1",
    "{$k}2" =&gt; "{$v}2",
]))-&gt;isSame([
   'a1' =&gt; 'A1',
   'a2' =&gt; 'A2',
   'b1' =&gt; 'B1',
   'b2' =&gt; 'B2',
   'c1' =&gt; 'C1',
   'c2' =&gt; 'C2',
   'd1' =&gt; 'D1',
   'd2' =&gt; 'D2',
]);

// $callback には $callback 自体も渡ってくるので再帰も比較的楽に書ける
that(array_kvmap([
    'x' =&gt; [
        'X',
        'y' =&gt; [
            'Y',
            'z' =&gt; ['Z'],
        ],
    ],
], function ($k, $v, $callback) {
    // 配列だったら再帰する
    return ["_$k" =&gt; is_array($v) ? array_kvmap($v, $callback) : "prefix-$v"];
}))-&gt;isSame([
    "_x" =&gt; [
        "_0" =&gt; "prefix-X",
        "_y" =&gt; [
            "_0" =&gt; "prefix-Y",
            "_z" =&gt; [
                "_0" =&gt; "prefix-Z",
            ],
        ],
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">適用するコールバック</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">変換された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7726492a6b7392906c3ab2e50679e21100689efb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_limit()" class="anchor"></a>[F] array_limit <small><span class="summary">limit を主体とした array_slice</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_limit.php#L9-L93" target="_blank">array_limit.php#9~93</a></p>
</div>
<details>
<summary class="">limit を主体とした array_slice</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_limit(
    iterable $array,
    int $limit,
    ?int $offset = null,
    ?bool $preserve_keys = null
): array</div></pre>
<div class="description">
<p>「配列の上から/下からN件取りたい」というユースケースがそれなりに多いが、毎回迷う上に1文で書けないので関数化した。</p>
<p>$limit が負数の場合は戻って読む。<span class="implicit-br">
</span>$offset 省略時は $limit の符号で自動で先頭か末尾になる。<span class="implicit-br">
</span>$offset を指定することは少なく、端的に言えば「$limit が整数なら先頭から、負数なら末尾から $limit 件返す」と考えてもよい。<span class="implicit-br">
</span>配列を無限数直線にマッピングし、位置範囲指定で切り取るイメージ。<span class="implicit-br">
</span>文章で書くと複雑なので Example を参照。</p>
<p>また、「array_slice しても結果が変わらないケース」でコールせずに結果を返すようにしてある。<span class="implicit-br">
</span>（結果が変わらなくても無駄に呼ばれて速度低下があるため）。<span class="implicit-br">
</span>例えば <code>array_slice($array, 0, 0)</code> は必ず空配列を返すし <code>array_slice($array, 0, null)</code> は必ず元の配列を返すはず。<span class="implicit-br">
</span>にも関わらず array_slice は愚直に切り取り処理をしているようで、その分岐の有る無しで速度がだいぶ違う。</p>
<p>$preserve_keys は array_slice と同じだが、 null を渡すと「通常配列時に true, 連想配列時に false」が動的に決まるようになる。<span class="implicit-br">
</span>ユースケースとしてはそのような使い方が多いはず。<span class="implicit-br">
</span>あくまで null 指定の場合のみなのでこの動作が嫌なら明示的に bool を渡せばよい。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a', 'b', 'c', 'd', 'e'];

that(array_limit($array, 3))-&gt;isSame(['a', 'b', 'c']);     // シンプルに先頭から3件
that(array_limit($array, -3))-&gt;isSame(['c', 'd', 'e']);    // シンプルに末尾から3件

that(array_limit($array, 3, 1))-&gt;isSame(['b', 'c', 'd']);  // 1番目（'b'）から正順に3件
that(array_limit($array, -3, 1))-&gt;isSame(['a', 'b']);      // 1番目（'b'）から逆順に3件（足りないので結果は2件）

that(array_limit($array, 3, 3))-&gt;isSame(['d', 'e']);       // 3番目（'d'）から正順に3件（足りないので結果は2件）
that(array_limit($array, -3, 3))-&gt;isSame(['b', 'c', 'd']); // 3番目（'d'）から逆順に3件

that(array_limit($array, 3, -2))-&gt;isSame(['a']);           // -2番目（範囲外）から正順に3件（'a'だけがギリギリ範囲に入る）
that(array_limit($array, -3, 6))-&gt;isSame(['e']);           // 6番目（範囲外）から逆順に3件（'e'だけがギリギリ範囲に入る）

that(array_limit($array, 3, -100))-&gt;isSame([]);            // -100番目（範囲外）から正順に3件（完全に範囲外なので空）
that(array_limit($array, -3, 100))-&gt;isSame([]);            // 100番目（範囲外）から逆順に3件（完全に範囲外なので空）</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$limit</code></td>
<td>​<span class="summary">切り詰めるサイズ</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$offset = null</code></td>
<td>​<span class="summary">開始位置</span></td>
</tr>
<tr>
<td>​?bool</td>
<td>​<code>$preserve_keys = null</code></td>
<td>​<span class="summary">キーの保存フラグ（null にすると連想配列の時のみ保存される）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">slice した配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ce2ce58a292063d8850618ab54781b15beb4ddc2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_lookup()" class="anchor"></a>[F] array_lookup <small><span class="summary">キー保存可能な array_column</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_lookup.php#L10-L71" target="_blank">array_lookup.php#10~71</a></p>
</div>
<details>
<summary class="">キー保存可能な array_column</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_lookup(
    iterable $array,
    array|string|null $column_key = null,
    string|\Closure|null $index_key = null
): array</div></pre>
<div class="description">
<p>array_column は キーを保存することが出来ないが、この関数は引数を2つだけ与えるとキーはそのままで array_column 相当の配列を返す。<span class="implicit-br">
</span>逆に第3引数にクロージャを与えるとその結果をキーにすることが出来る。</p>
<p>$column_key に配列を与えるとそれだけの配列を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    11 =&gt; ['id' =&gt; 1, 'name' =&gt; 'name1', 'status' =&gt; true],
    12 =&gt; ['id' =&gt; 2, 'name' =&gt; 'name2', 'status' =&gt; false],
    13 =&gt; ['id' =&gt; 3, 'name' =&gt; 'name3', 'status' =&gt; true],
];
// 第3引数を渡せば array_column と全く同じ
that(array_lookup($array, 'name', 'id'))-&gt;isSame(array_column($array, 'name', 'id'));
that(array_lookup($array, 'name', null))-&gt;isSame(array_column($array, 'name', null));
// 省略すればキーが保存される
that(array_lookup($array, 'name'))-&gt;isSame([
    11 =&gt; 'name1',
    12 =&gt; 'name2',
    13 =&gt; 'name3',
]);
// クロージャを指定すればキーが生成される
that(array_lookup($array, 'name', fn($v, $k) =&gt; $k * 2))-&gt;isSame([
    22 =&gt; 'name1',
    24 =&gt; 'name2',
    26 =&gt; 'name3',
]);
// $column_key に配列を与えるとそれだけの配列を返す
that(array_lookup($array, ['id', 'status']))-&gt;isSame([
    11 =&gt; ['id' =&gt; 1, 'status' =&gt; true],
    12 =&gt; ['id' =&gt; 2, 'status' =&gt; false],
    13 =&gt; ['id' =&gt; 3, 'status' =&gt; true],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​array|​string|​null</td>
<td>​<code>$column_key = null</code></td>
<td>​<span class="summary">値となるキー</span></td>
</tr>
<tr>
<td>​string|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a>|​null</td>
<td>​<code>$index_key = null</code></td>
<td>​<span class="summary">キーとなるキー</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2a3dd3ef5c7210165195450214bf91702db48bce-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_map_filter()" class="anchor"></a>[F] array_map_filter <small><span class="summary">array_map + array_filter する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_map_filter.php#L11-L51" target="_blank">array_map_filter.php#11~51</a></p>
</div>
<details>
<summary class="">array_map + array_filter する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_map_filter(
    iterable $array,
    callable $callback,
    bool $strict = false
): iterable</div></pre>
<div class="description">
<p>コールバックを適用して、結果が true 相当の要素のみ取り出す。<span class="implicit-br">
</span>$strict に true を与えると「null でない」要素のみ返される。</p>
<p>$callback が要求するならキーも渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_map_filter([' a ', ' b ', ''], 'trim'))-&gt;isSame(['a', 'b']);
that(array_map_filter([' a ', ' b ', ''], 'trim', true))-&gt;isSame(['a', 'b', '']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価クロージャ</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$strict = false</code></td>
<td>​<span class="summary">厳密比較フラグ。 true だと null のみが偽とみなされる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<span class="summary">$callback が真を返した新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fa3eb70d35aca88f8874793ec63a67994c668317-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_map_key()" class="anchor"></a>[F] array_map_key <small><span class="summary">キーをマップして変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_map_key.php#L8-L37" target="_blank">array_map_key.php#8~37</a></p>
</div>
<details>
<summary class="">キーをマップして変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_map_key(
    iterable $array,
    callable $callback
): array</div></pre>
<div class="description">
<p>$callback が null を返すとその要素は取り除かれる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_map_key(['a' =&gt; 'A', 'b' =&gt; 'B'], 'strtoupper'))-&gt;isSame(['A' =&gt; 'A', 'B' =&gt; 'B']);
that(array_map_key(['a' =&gt; 'A', 'b' =&gt; 'B'], function () { }))-&gt;isSame([]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価クロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">キーが変換された新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b7bea0d0feb7979bd2bbdc7538e03d3a349a8568-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_map_recursive()" class="anchor"></a>[F] array_map_recursive <small><span class="summary">array_map の再帰版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_map_recursive.php#L8-L96" target="_blank">array_map_recursive.php#8~96</a></p>
</div>
<details>
<summary class="">array_map の再帰版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_map_recursive(
    iterable $array,
    callable $callback,
    bool $iterable = true,
    bool $apply_array = false
): array</div></pre>
<div class="description">
<p>下記の点で少し array_map とは挙動が異なる。</p>
<ul class=" simple">
<li>配列だけでなく iterable も対象になる（引数で指定可能。デフォルト true）<ul class=" simple">
<li>つまりオブジェクト構造は維持されず、結果はすべて配列になる</li>
</ul>
</li>
<li>値だけでなくキーも渡ってくる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// デフォルトでは array_walk 等と同様に葉のみが渡ってくる（iterable も対象になる）
that(array_map_recursive([
    'k' =&gt; 'v',
    'c' =&gt; new \ArrayObject([
        'k1' =&gt; 'v1',
        'k2' =&gt; 'v2',
    ]),
], 'strtoupper'))-&gt;isSame([
    'k' =&gt; 'V',
    'c' =&gt; [
        'k1' =&gt; 'V1',
        'k2' =&gt; 'V2',
    ],
]);

// ただし、その挙動は引数で変更可能
that(array_map_recursive([
    'k' =&gt; 'v',
    'c' =&gt; new \ArrayObject([
        'k1' =&gt; 'v1',
        'k2' =&gt; 'v2',
    ]),
], 'gettype', false))-&gt;isSame([
    'k' =&gt; 'string',
    'c' =&gt; 'object',
]);

// さらに、自身にも適用できる（呼び出しは子が先で、本当の意味で「すべての要素」で呼び出される）
that(array_map_recursive([
    'k' =&gt; 'v',
    'c' =&gt; [
        'k1' =&gt; 'v1',
        'k2' =&gt; 'v2',
    ],
], function ($v) {
    // 配列は stdclass 化、それ以外は大文字化
    return is_array($v) ? (object) $v : strtoupper($v);
}, true, true))-&gt;is((object) [
    'k' =&gt; 'V',
    'c' =&gt; (object) [
        'k1' =&gt; 'V1',
        'k2' =&gt; 'V2',
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">評価クロージャ</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$iterable = true</code></td>
<td>​<span class="summary">is_iterable で判定するか</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$apply_array = false</code></td>
<td>​<span class="summary">配列要素にもコールバックを適用するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">map された新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b0eb055cca26c62dd3a72b7494de42d2ce7838e0-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_maps()" class="anchor"></a>[F] array_maps <small><span class="summary">複数コールバックを指定できる array_map</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_maps.php#L11-L84" target="_blank">array_maps.php#11~84</a></p>
</div>
<details>
<summary class="">複数コールバックを指定できる array_map</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_maps(
    iterable $array,
    callable ...$callbacks
): iterable</div></pre>
<div class="description">
<p>指定したコールバックで複数回回してマップする。<span class="implicit-br">
</span><code>array_maps($array, $f, $g)</code> は <code>array_map($g, array_map($f, $array))</code> とほぼ等しい。<span class="implicit-br">
</span>ただし、引数は順番が違う（可変引数のため）し、コールバックが要求するならキーも渡ってくる。<span class="implicit-br">
</span>さらに文字列関数で "..." から始まっているなら可変引数としてコールする。</p>
<p>少し変わった仕様として、コールバックに [$method =&gt; $args] を付けるとそれはメソッド呼び出しになる。<span class="implicit-br">
</span>つまり各要素 $v に対して <code>$v-&gt;$method(...$args)</code> がマップ結果になる。<span class="implicit-br">
</span>さらに引数が不要なら <code>@method</code> とするだけで良い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 値を3乗したあと16進表記にして大文字化する
that(array_maps([1, 2, 3, 4, 5], fn($v) =&gt; pow($v, 3), 'dechex', 'strtoupper'))-&gt;isSame(['1', '8', '1B', '40', '7D']);
// キーも渡ってくる
that(array_maps(['a' =&gt; 'A', 'b' =&gt; 'B'], fn($v, $k) =&gt; "$k:$v"))-&gt;isSame(['a' =&gt; 'a:A', 'b' =&gt; 'b:B']);
// ... で可変引数コール
that(array_maps([[1, 3], [1, 5, 2]], '...range'))-&gt;isSame([[1, 2, 3], [1, 3, 5]]);
// メソッドコールもできる（引数不要なら `@method` でも同じ）
that(array_maps([new \Exception('a'), new \Exception('b')], ['getMessage' =&gt; []]))-&gt;isSame(['a', 'b']);
that(array_maps([new \Exception('a'), new \Exception('b')], '@getMessage'))-&gt;isSame(['a', 'b']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>...$callbacks</code></td>
<td>​<span class="summary">評価クロージャ配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<span class="summary">評価クロージャを通した新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_06269dad1cde79d092d1836ac07c304143db346a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_merge2()" class="anchor"></a>[F] array_merge2 <small><span class="summary">配列をマージして通常配列＋αで返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_merge2.php#L7-L65" target="_blank">array_merge2.php#7~65</a></p>
</div>
<details>
<summary class="">配列をマージして通常配列＋αで返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_merge2(array ...$arrays): array</div></pre>
<div class="description">
<p>キー・値が維持される点で array_merge とは異なる（振り直しをせず数値配列で返す）。<span class="implicit-br">
</span>きちんと0からの連番で構成される点で配列の加算とは異なる。<span class="implicit-br">
</span>要するに「できるだけキーが自然数（の並び）になるように」マージする。</p>
<p>歯抜けはそのまま維持され、文字キーは後ろに追加される（負数キーも同様）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// キーが入り乱れているがよく見ると通し番号が振られている配列をマージ
that(array_merge2([4 =&gt; 4, 1 =&gt; 1], [0 =&gt; 0], [5 =&gt; 5, 2 =&gt; 2, 3 =&gt; 3]))-&gt;isSame([0, 1, 2, 3, 4, 5]);
// 歯抜けの配列をマージ
that(array_merge2([4 =&gt; 4, 1 =&gt; 1], [0 =&gt; 0], [5 =&gt; 5, 3 =&gt; 3]))-&gt;isSame([0, 1, 3 =&gt; 3, 4 =&gt; 4, 5 =&gt; 5]);
// 負数や文字キーは後ろに追いやられる
that(array_merge2(['a' =&gt; 'A', 1 =&gt; 1], [0 =&gt; 0], [-1 =&gt; 'X', 2 =&gt; 2, 3 =&gt; 3]))-&gt;isSame([0, 1, 2, 3, -1 =&gt; 'X', 'a' =&gt; 'A']);
// 同じキーは後ろ優先
that(array_merge2([0, 'a' =&gt; 'A0'], [1, 'a' =&gt; 'A1'], [2, 'a' =&gt; 'A2']))-&gt;isSame([2, 'a' =&gt; 'A2']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>...$arrays</code></td>
<td>​<span class="summary">マージする配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">マージされた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9981d2b6fd83d877fcc418c6e4b5d41e9d66ed95-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_mix()" class="anchor"></a>[F] array_mix <small><span class="summary">配列を交互に追加する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_mix.php#L7-L61" target="_blank">array_mix.php#7~61</a></p>
</div>
<details>
<summary class="">配列を交互に追加する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_mix(array ...$variadic): array</div></pre>
<div class="description">
<p>引数の配列を横断的に追加して返す。<span class="implicit-br">
</span>数値キーは振り直される。文字キーはそのまま追加される（同じキーは後方上書き）。</p>
<p>配列の長さが異なる場合、短い方に対しては何もしない。そのまま追加される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 奇数配列と偶数配列をミックスして自然数配列を生成
that(array_mix([1, 3, 5], [2, 4, 6]))-&gt;isSame([1, 2, 3, 4, 5, 6]);
// 長さが異なる場合はそのまま追加される（短い方の足りない分は無視される）
that(array_mix([1], [2, 3, 4]))-&gt;isSame([1, 2, 3, 4]);
that(array_mix([1, 3, 4], [2]))-&gt;isSame([1, 2, 3, 4]);
// 可変引数なので3配列以上も可
that(array_mix([1], [2, 4], [3, 5, 6]))-&gt;isSame([1, 2, 3, 4, 5, 6]);
that(array_mix([1, 4, 6], [2, 5], [3]))-&gt;isSame([1, 2, 3, 4, 5, 6]);
// 文字キーは維持される
that(array_mix(['a' =&gt; 'A', 1, 3], ['b' =&gt; 'B', 2]))-&gt;isSame(['a' =&gt; 'A', 'b' =&gt; 'B', 1, 2, 3]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象配列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">引数配列が交互に追加された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8e39f0c66d1df9c6495be4bd04acf598e7dc346b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_nest()" class="anchor"></a>[F] array_nest <small><span class="summary">シンプルな [キー =&gt; 値] な配列から階層配列を生成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_nest.php#L7-L83" target="_blank">array_nest.php#7~83</a></p>
</div>
<details>
<summary class="">シンプルな [キー =&gt; 値] な配列から階層配列を生成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_nest(
    iterable $array,
    string $delimiter = "."
): array</div></pre>
<div class="description">
<p>定義的に array_flatten の逆関数のような扱いになる。<span class="implicit-br">
</span>$delimiter で階層を表現する。</p>
<p>同名とみなされるキーは上書きされるか例外が飛ぶ。具体的には Example を参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 単純な階層展開
$array = [
   'k1'            =&gt; 'v1',
   'k2.k21'        =&gt; 'v21',
   'k2.k22.k221'   =&gt; 'v221',
   'k2.k22.k222'   =&gt; 'v222',
   'k2.k22.k223.0' =&gt; 1,
   'k2.k22.k223.1' =&gt; 2,
   'k2.k22.k223.2' =&gt; 3,
];
that(array_nest($array))-&gt;isSame([
   'k1' =&gt; 'v1',
   'k2' =&gt; [
       'k21' =&gt; 'v21',
       'k22' =&gt; [
           'k221' =&gt; 'v221',
           'k222' =&gt; 'v222',
           'k223' =&gt; [1, 2, 3],
       ],
   ],
]);
// 同名になるようなキーは上書きされる
$array = [
   'k1.k2' =&gt; 'v1', // この時点で 'k1' は配列になるが・・・
   'k1'    =&gt; 'v2', // この時点で 'k1' は文字列として上書きされる
];
that(array_nest($array))-&gt;isSame([
   'k1' =&gt; 'v2',
]);
// 上書きすら出来ない場合は例外が飛ぶ
$array = [
   'k1'    =&gt; 'v1', // この時点で 'k1' は文字列になるが・・・
   'k1.k2' =&gt; 'v2', // この時点で 'k1' にインデックスアクセスすることになるので例外が飛ぶ
];
try {
    array_nest($array);
}
catch (\Exception $e) {
    that($e)-&gt;isInstanceOf(\InvalidArgumentException::class);
}</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$delimiter = "."</code></td>
<td>​<span class="summary">キーの区切り文字</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">階層化された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_033b93dc3f0be52e039b7bea047d7e3ccbd6f724-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_of()" class="anchor"></a>[F] array_of <small><span class="summary">配列を与えると指定キーの値を返すクロージャを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_of.php#L8-L33" target="_blank">array_of.php#8~33</a></p>
</div>
<details>
<summary class="">配列を与えると指定キーの値を返すクロージャを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_of(
    string|int|array $key,
    mixed $default = null
): \Closure</div></pre>
<div class="description">
<p>存在しない場合は $default を返す。</p>
<p>$key に配列を与えるとそれらの値の配列を返す（lookup 的な動作）。<span class="implicit-br">
</span>その場合、$default が活きるのは「全て無かった場合」となる。<span class="implicit-br">
</span>さらに $key が配列の場合に限り、 $default を省略すると空配列として動作する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$fuga_of_array = array_of('fuga');
that($fuga_of_array(['hoge' =&gt; 'HOGE', 'fuga' =&gt; 'FUGA']))-&gt;isSame('FUGA');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int|​array</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">取得したいキー</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">デフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<span class="summary">$key の値を返すクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a81a992b26764c68839f7908c217558019fe7144-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_or()" class="anchor"></a>[F] array_or <small><span class="summary">全要素が false になるなら false を返す（1つでも true なら true を返す）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_or.php#L9-L43" target="_blank">array_or.php#9~43</a></p>
</div>
<details>
<summary class="">全要素が false になるなら false を返す（1つでも true なら true を返す）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_or(
    iterable $array,
    ?callable $callback = null,
    bool|mixed $default = false
): bool</div></pre>
<div class="description">
<p>$callback が要求するならキーも渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_or([true, true]))-&gt;isTrue();
that(array_or([true, false]))-&gt;isTrue();
that(array_or([false, false]))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$callback = null</code></td>
<td>​<span class="summary">評価クロージャ。 null なら値そのもので評価</span></td>
</tr>
<tr>
<td>​bool|​mixed</td>
<td>​<code>$default = false</code></td>
<td>​<span class="summary">空配列の場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">全要素が false なら false</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c99300c31b093914a992318eb93fa3985fd1931f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_order()" class="anchor"></a>[F] array_order <small><span class="summary">配列を $orders に従って並べ替える</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_order.php#L9-L152" target="_blank">array_order.php#9~152</a></p>
</div>
<details>
<summary class="">配列を $orders に従って並べ替える</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_order(
    array $array,
    mixed $orders,
    bool $preserve_keys = false
): array</div></pre>
<div class="description">
<p>データベースからフェッチしたような連想配列の配列を想定しているが、スカラー配列(['key' =&gt; 'value'])にも対応している。<span class="implicit-br">
</span>その場合 $orders に配列ではなく直値を渡せば良い。</p>
<p>$orders には下記のような配列を渡す。<span class="implicit-br">
</span>キーに空文字を渡すとそれは「キー自体」を意味する。</p>
<pre data-label=""><div class="code language-php php">$orders = [
    'col1' =&gt; true,                              // true: 昇順, false: 降順。照合は型に依存
    'col2' =&gt; SORT_NATURAL,                      // SORT_NATURAL, SORT_REGULAR などで照合。正数で昇順、負数で降順
    'col3' =&gt; ['sort', 'this', 'order'],         // 指定した配列順で昇順
    'col4' =&gt; fn($v) =&gt; $v,                      // 引数1個: クロージャを通した値で昇順。照合は返り値の型に依存
    // 'col4' =&gt; fn($v, $o = SORT_DESC) =&gt; $v,   // ↑の亜種（第2引数のデフォルト値がオーダーを表す）
    'col5' =&gt; fn($av, $bv) =&gt; $av - $bv,         // 引数2個: クロージャで比較して値昇順（いわゆる比較関数を渡す）
    'col6' =&gt; fn($ak, $bk, $array) =&gt; $ak - $bk, // 引数3個: クロージャで比較してキー昇順（いわゆる比較関数を渡す）
];</div></pre>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$v1 = ['id' =&gt; '1', 'no' =&gt; 'a03', 'name' =&gt; 'yyy'];
$v2 = ['id' =&gt; '2', 'no' =&gt; 'a4',  'name' =&gt; 'yyy'];
$v3 = ['id' =&gt; '3', 'no' =&gt; 'a12', 'name' =&gt; 'xxx'];
// name 昇順, no 自然降順
that(array_order([$v1, $v2, $v3], ['name' =&gt; true, 'no' =&gt; -SORT_NATURAL]))-&gt;isSame([$v3, $v2, $v1]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$orders</code></td>
<td>​<span class="summary">ソート順</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$preserve_keys = false</code></td>
<td>​<span class="summary">キーを保存するか。 false の場合数値キーは振り直される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">並び替えられた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_71f55253034700ace999e10c1ec1964e7048e259-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_pickup()" class="anchor"></a>[F] array_pickup <small><span class="summary">キーを指定してそれだけの配列にする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_pickup.php#L9-L58" target="_blank">array_pickup.php#9~58</a></p>
</div>
<details>
<summary class="">キーを指定してそれだけの配列にする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_pickup(
    iterable|object $array,
    array $keys
): array</div></pre>
<div class="description">
<p><code>array_intersect_key($array, array_flip($keys))</code> とほぼ同義。<span class="implicit-br">
</span>違いは Traversable を渡せることと、結果配列の順番が $keys に従うこと。</p>
<p>$keys に連想配列を渡すとキーを読み替えて動作する（Example を参照）。<span class="implicit-br">
</span>さらにその時クロージャを渡すと($key, $value)でコールされた結果が新しいキーになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
// a と c を取り出す
that(array_pickup($array, ['a', 'c']))-&gt;isSame(['a' =&gt; 'A', 'c' =&gt; 'C']);
// 順番は $keys 基準になる
that(array_pickup($array, ['c', 'a']))-&gt;isSame(['c' =&gt; 'C', 'a' =&gt; 'A']);
// 連想配列を渡すと読み替えて返す
that(array_pickup($array, ['c' =&gt; 'cX', 'a' =&gt; 'aX']))-&gt;isSame(['cX' =&gt; 'C', 'aX' =&gt; 'A']);
// コールバックを渡せる
that(array_pickup($array, ['c' =&gt; fn($k, $v) =&gt; "$k-$v"]))-&gt;isSame(['c-C' =&gt; 'C']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable|​object</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$keys</code></td>
<td>​<span class="summary">取り出すキー</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4748aeea2b50749fba2596e9504a801d254984e9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_pos()" class="anchor"></a>[F] array_pos <small><span class="summary">配列・連想配列を問わず「N番目(0ベース)」の要素を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_pos.php#L7-L49" target="_blank">array_pos.php#7~49</a></p>
</div>
<details>
<summary class="">配列・連想配列を問わず「N番目(0ベース)」の要素を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_pos(
    array $array,
    int $position,
    bool $return_key = false
): mixed</div></pre>
<div class="description">
<p>負数を与えると逆から N 番目となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_pos([1, 2, 3], 1))-&gt;isSame(2);
that(array_pos([1, 2, 3], -1))-&gt;isSame(3);
that(array_pos(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], 1))-&gt;isSame('B');
that(array_pos(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], 1, true))-&gt;isSame('b');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$position</code></td>
<td>​<span class="summary">取得する位置</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$return_key = false</code></td>
<td>​<span class="summary">true にすると値ではなくキーを返す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">指定位置の値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fcfd1793e036d0929b528b52650f4c3c7e3a9839-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_pos_key()" class="anchor"></a>[F] array_pos_key <small><span class="summary">配列の指定キーの位置を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_pos_key.php#L7-L59" target="_blank">array_pos_key.php#7~59</a></p>
</div>
<details>
<summary class="">配列の指定キーの位置を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_pos_key(
    array $array,
    string|int|array $key,
    mixed $default = null
): int|int[]</div></pre>
<div class="description">
<p>$key に配列を与えるとその全ての位置を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_pos_key(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], 'c'))-&gt;isSame(2);
that(array_pos_key(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], 'x', -1))-&gt;isSame(-1);
 that(array_pos_key(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], ['a', 'c']))-&gt;isSame(['a' =&gt; 0, 'c' =&gt; 2]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​int|​array</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">取得したい位置のキー</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">見つからなかったときのデフォルト値。指定しないと例外。$key が配列の場合は見つからなかったキー全てに代入される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​int[]</td>
<td>​<span class="summary">指定キーの位置</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e751681a81bc178b91b8058d6e70dfc5599bcc1b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_prepend()" class="anchor"></a>[F] array_prepend <small><span class="summary">配列の先頭に要素を追加する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_prepend.php#L7-L38" target="_blank">array_prepend.php#7~38</a></p>
</div>
<details>
<summary class="">配列の先頭に要素を追加する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_prepend(
    array $array,
    $value,
    $key = null
): array</div></pre>
<div class="description">
<p>array_unshift のキーが指定できる参照渡しでない版と言える。<span class="implicit-br">
</span>配列の数値キーは振り直される。<span class="implicit-br">
</span>キー指定でかつそのキーが存在するとき、値を変えつつ先頭に移動する動作となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// キー未指定は0で挿入される
that(array_prepend([1, 2, 3], 99))-&gt;is([99, 1, 2, 3]);
// キーを指定すればそのキーで生える
that(array_prepend([1, 2, 3], 99, 'newkey'))-&gt;is(['newkey' =&gt; 99, 1, 2, 3]);
// 存在する場合は値が変わって先頭に移動する
that(array_prepend([1, 2, 3], 99, 1))-&gt;is([1 =&gt; 99, 0 =&gt; 1, 2 =&gt; 3]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$value</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$key = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">要素が追加された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ea1e8ee5459e0b17613e5981b3c7b6a4cf1a977d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_random()" class="anchor"></a>[F] array_random <small><span class="summary">array_rand の要素版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_random.php#L7-L68" target="_blank">array_random.php#7~68</a></p>
</div>
<details>
<summary class="">array_rand の要素版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_random(
    array $array,
    ?int $count = null,
    $preserve_keys = false
): mixed</div></pre>
<div class="description">
<p>とはいえ多少の差異がある。</p>
<ul class=" simple">
<li>第2引数に null を与えると単一の値として返す</li>
<li>第2引数に数値を与えると配列で返す（たとえ1でも配列で返す）</li>
<li>第2引数に 0 を与えてもエラーにはならない（空配列を返す）</li>
<li>第2引数に負数を与えるとその個数に満たなくても例外にならない</li>
<li>第3引数に true を与えるとキーを維持して返す</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">mt_srand(4); // テストがコケるので種固定
// 配列からランダムに値1件取得（単一で返す）
that(array_random(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C']))-&gt;isSame('B');
// 配列からランダムに値2件取得（配列で返す）
that(array_random(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], 2))-&gt;isSame(['B', 'C']);
// 配列からランダムに値2件取得（キーを維持）
that(array_random(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], 2, true))-&gt;isSame(['a' =&gt; 'A', 'c' =&gt; 'C']);
// 配列からランダムに値N件取得（負数指定。配列数を超えた指定は例外になるので負数にする必要がある）
that(array_random(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'], -999, true))-&gt;isSame(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$count = null</code></td>
<td>​<span class="summary">取り出す個数</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$preserve_keys = false</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">ランダムな要素</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_02196906f86dc0ddec52cb21f328c50c08b8f302-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_range()" class="anchor"></a>[F] array_range <small><span class="summary">range を少し改良したもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_range.php#L11-L244" target="_blank">array_range.php#11~244</a></p>
</div>
<details>
<summary class="">range を少し改良したもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_range(
    int|float|string|\DateTimeInterface $start,
    int|float|string|\DateTimeInterface $end,
    int|float|string|null|\DateInterval $step = null,
    $options = []
): array</div></pre>
<div class="description">
<ul class=" simple">
<li>文字列に対応</li>
<li>日時に対応</li>
<li>$start, $end から $step の自動算出</li>
<li>$start &lt; $end で $step &lt; 0 の場合、空配列を返す</li>
<li>$start &gt; $end で $step &gt; 0 の場合、空配列を返す</li>
</ul>
<p>逆に言うと $start, $end の大小を意識しないと正しい値は返らないことになる。<span class="implicit-br">
</span>標準 range の下記の挙動が個人的に違和感があるので実装した。</p>
<ul class=" simple">
<li>range(1, 3, -1); // [1, 2, 3]</li>
<li>range(3, 1, +1); // [3, 2, 1]</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 文字列（具体的にはデクリメント）
that(array_range('a', 'c', +1))-&gt;isSame(['a', 'b', 'c']);
that(array_range('c', 'a', -1))-&gt;isSame(['c', 'b', 'a']);

// 日時
that(array_range('2014/12/24 12:34:56', '2014/12/26 12:34:56', 'P1D', ['format' =&gt; 'Y/m/d H:i:s']))-&gt;isSame([
    '2014/12/24 12:34:56',
    '2014/12/25 12:34:56',
    '2014/12/26 12:34:56',
]);
that(array_range('2014/12/26 12:34:56', '2014/12/24 12:34:56', 'P-1D', ['format' =&gt; 'Y/m/d H:i:s']))-&gt;isSame([
    '2014/12/26 12:34:56',
    '2014/12/25 12:34:56',
    '2014/12/24 12:34:56',
]);

// step は省略可能（+/-1 になる）
that(array_range(1, 3))-&gt;isSame([1, 2, 3]);
that(array_range(3, 1))-&gt;isSame([3, 2, 1]);
that(array_range('a', 'c'))-&gt;isSame(['a', 'b', 'c']);
that(array_range('c', 'a'))-&gt;isSame(['c', 'b', 'a']);

// 範囲外は空配列を返す
that(array_range(1, 3, -1))-&gt;isSame([]);
that(array_range(3, 1, +1))-&gt;isSame([]);
that(array_range('a', 'c', -1))-&gt;isSame([]);
that(array_range('c', 'a', +1))-&gt;isSame([]);
that(array_range('2014/12/24', '2014/12/27', 'P-1D'))-&gt;isSame([]);
that(array_range('2014/12/27', '2014/12/24', 'P1D'))-&gt;isSame([]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float|​string|​<a href="https://php.net/manual/class.datetimeinterface.php" target="_blank">DateTimeInterface</a></td>
<td>​<code>$start</code></td>
<td>​<span class="summary">最初の値</span></td>
</tr>
<tr>
<td>​int|​float|​string|​<a href="https://php.net/manual/class.datetimeinterface.php" target="_blank">DateTimeInterface</a></td>
<td>​<code>$end</code></td>
<td>​<span class="summary">最後の値</span></td>
</tr>
<tr>
<td>​int|​float|​string|​null|​<a href="https://php.net/manual/class.dateinterval.php" target="_blank">DateInterval</a></td>
<td>​<code>$step = null</code></td>
<td>​<span class="summary">増分</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">$start ~ $end の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_51425b79f0fda68ddbbeb74942f24d6986ac8200-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_rank()" class="anchor"></a>[F] array_rank <small><span class="summary">配列をランク付けしてその順番でN件返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_rank.php#L8-L71" target="_blank">array_rank.php#8~71</a></p>
</div>
<details>
<summary class="">配列をランク付けしてその順番でN件返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_rank(
    iterable $array,
    int $length,
    ?callable $rankfunction = null
): array</div></pre>
<div class="description">
<p>同ランクはすべて返す。<span class="implicit-br">
</span>つまり $length=10 でも10件以上を返すこともある。</p>
<p>$length が負数の場合、降順ソートして後ろから取り出す。<span class="implicit-br">
</span>端的に言えば</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>正数</dt>
<dd>下位N件</dd>
</div>
<div class="dtdd-container">
<dt>負数</dt>
<dd>上位N件</dd>
</div>
</dl>
<p>という動作になる。</p>
<p>ソートの型は最初の要素で決まる。<span class="implicit-br">
</span>文字列なら SORT_STRING で、違うなら SORT_NUMERIC</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$length</code></td>
<td>​<span class="summary">取り出す件数</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$rankfunction = null</code></td>
<td>​<span class="summary">ランク付けクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">上位N件の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_939412df72be1ed239a0d27148088782f4056ac4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_rekey()" class="anchor"></a>[F] array_rekey <small><span class="summary">キーをマップ配列・callable で置換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_rekey.php#L8-L63" target="_blank">array_rekey.php#8~63</a></p>
</div>
<details>
<summary class="">キーをマップ配列・callable で置換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_rekey(
    iterable $array,
    array|callable $keymap
): array</div></pre>
<div class="description">
<p>変換先・返り値が null だとその要素は取り除かれる。<span class="implicit-br">
</span>callable 指定時の引数は <code>(キー, 値, 連番インデックス, 対象配列そのもの)</code> が渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
// a は x に c は z に置換される
that(array_rekey($array, ['a' =&gt; 'x', 'c' =&gt; 'z']))-&gt;isSame(['x' =&gt; 'A', 'b' =&gt; 'B', 'z' =&gt; 'C']);
// b は削除され c は z に置換される
that(array_rekey($array, ['b' =&gt; null, 'c' =&gt; 'z']))-&gt;isSame(['a' =&gt; 'A', 'z' =&gt; 'C']);
// キーの交換にも使える（a ⇔ c）
that(array_rekey($array, ['a' =&gt; 'c', 'c' =&gt; 'a']))-&gt;isSame(['c' =&gt; 'A', 'b' =&gt; 'B', 'a' =&gt; 'C']);
// callable
that(array_rekey($array, 'strtoupper'))-&gt;isSame(['A' =&gt; 'A', 'B' =&gt; 'B', 'C' =&gt; 'C']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​array|​callable</td>
<td>​<code>$keymap</code></td>
<td>​<span class="summary">マップ配列かキーを返すクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">キーが置換された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_aafa3f67f69ec031c07ec655cd665e59fdbe6ced-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_remove()" class="anchor"></a>[F] array_remove <small><span class="summary">キーを指定してそれらを除いた配列にする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_remove.php#L8-L35" target="_blank">array_remove.php#8~35</a></p>
</div>
<details>
<summary class="">キーを指定してそれらを除いた配列にする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_remove(
    array|\Traversable $array,
    array|int|string $keys
): array</div></pre>
<div class="description">
<p><code>array_diff_key($array, array_flip($keys))</code> とほぼ同義。<span class="implicit-br">
</span>違いは Traversable を渡せること。</p>
<p>array_pickup の逆とも言える。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
// a と c を伏せる（b を残す）
that(array_remove($array, ['a', 'c']))-&gt;isSame(['b' =&gt; 'B']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​<a href="https://php.net/manual/class.traversable.php" target="_blank">Traversable</a></td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​array|​int|​string</td>
<td>​<code>$keys</code></td>
<td>​<span class="summary">伏せるキー</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_41973cf5ad9cdb6d8fbfbd0479e9dbe4aa405a24-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_revise()" class="anchor"></a>[F] array_revise <small><span class="summary">配列要素の追加・変更・削除を行う</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_revise.php#L8-L64" target="_blank">array_revise.php#8~64</a></p>
</div>
<details>
<summary class="">配列要素の追加・変更・削除を行う</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_revise(
    iterable $array,
    array ...$maps
): array</div></pre>
<div class="description">
<p>$map の当該キー要素が・・・</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>クロージャの場合</dt>
<dd>キーの有無に関わらずコールされる</dd>
</div>
<div class="dtdd-container">
<dt>null の場合</dt>
<dd>キーが削除される</dd>
</div>
<div class="dtdd-container">
<dt>それ以外の場合</dt>
<dd>キーが追加される（存在しない場合のみ）</dd>
</div>
</dl>
<p>という処理を行う。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_revise([
    'id'      =&gt; 123,
    'name'    =&gt; 'hoge',
    'age'     =&gt; 18,
    'delete'  =&gt; '',
], [
    'name'    =&gt; 'ignored',            // 存在するのでスルーされる
    'append'  =&gt; 'newkey',             // 存在しないので追加される
    'age'     =&gt; fn($age) =&gt; $age + 1, // クロージャは現在の値を引数にしてコールされる
    'delete'  =&gt; null,                 // null は削除される
    'null'    =&gt; fn() =&gt; null,         // 削除の目印として null を使っているので null を追加したい場合はクロージャで包む必要がある
]))-&gt;isSame([
    'id'      =&gt; 123,
    'name'    =&gt; 'hoge',
    'age'     =&gt; 19,
    'append'  =&gt; 'newkey',
    'null'    =&gt; null,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>...$maps</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">変更された新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_dbab233a47823a458ac4554e9cb1f55897904a9e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_schema()" class="anchor"></a>[F] array_schema <small><span class="summary">配列のスキーマを定義して配列を正規化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_schema.php#L12-L238" target="_blank">array_schema.php#12~238</a></p>
</div>
<details>
<summary class="">配列のスキーマを定義して配列を正規化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_schema(
    array $schema,
    mixed ...$arrays
): array</div></pre>
<div class="description">
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>type</dt>
<dd>値の型を指定する<dl class="docutils field-list">
<div class="dtdd-container">
<dt>is_XXX の XXX 部分</dt>
<dd>左記で検証</dd>
</div>
<div class="dtdd-container">
<dt>number</dt>
<dd>is_int or is_float で検証</dd>
</div>
<div class="dtdd-container">
<dt>class 名</dt>
<dd>instanceof で検証</dd>
</div>
<div class="dtdd-container">
<dt>list</dt>
<dd>値がマージされて通常配列になる<ul class=" simple">
<li>list@string のようにすると配列の中身の型を指定できる</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>hash</dt>
<dd>連想配列になる</dd>
</div>
<div class="dtdd-container">
<dt>string|int</dt>
<dd>string or int</dd>
</div>
<div class="dtdd-container">
<dt>['string', 'int']</dt>
<dd>上と同じ</dd>
</div>
</dl>
</dd>
</div>
<div class="dtdd-container">
<dt>closure</dt>
<dd>指定クロージャで検証・フィルタ<dl class="docutils field-list">
<div class="dtdd-container">
<dt>all</dt>
<dd>値を引数に取り、返り値が新しい値となる</dd>
</div>
</dl>
</dd>
</div>
<div class="dtdd-container">
<dt>unique</dt>
<dd>重複を除去する<dl class="docutils field-list">
<div class="dtdd-container">
<dt>list</dt>
<dd>重複除去（パラメータがソートアルゴリズムになる）</dd>
</div>
</dl>
</dd>
</div>
<div class="dtdd-container">
<dt>enum</dt>
<dd>値が指定値のいずれかであるか検証する<dl class="docutils field-list">
<div class="dtdd-container">
<dt>all</dt>
<dd>in_array で検証する</dd>
</div>
</dl>
</dd>
</div>
<div class="dtdd-container">
<dt>min</dt>
<dd>値が指定値以上であるか検証する<dl class="docutils field-list">
<div class="dtdd-container">
<dt>string</dt>
<dd>strlen で検証</dd>
</div>
<div class="dtdd-container">
<dt>list</dt>
<dd>count で検証</dd>
</div>
<div class="dtdd-container">
<dt>all</dt>
<dd>その値で検証</dd>
</div>
</dl>
</dd>
</div>
<div class="dtdd-container">
<dt>max</dt>
<dd>値が指定値以下であるか検証する<ul class=" simple">
<li>min の逆</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>match</dt>
<dd>値が正規表現にマッチするか検証する<dl class="docutils field-list">
<div class="dtdd-container">
<dt>all</dt>
<dd>preg_match で検証する</dd>
</div>
</dl>
</dd>
</div>
<div class="dtdd-container">
<dt>unmatch</dt>
<dd>値が正規表現にマッチしないか検証する<ul class=" simple">
<li>match の逆</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>include</dt>
<dd>値が指定値を含むか検証する<dl class="docutils field-list">
<div class="dtdd-container">
<dt>string</dt>
<dd>strpos で検証</dd>
</div>
<div class="dtdd-container">
<dt>list</dt>
<dd>in_array で検証</dd>
</div>
</dl>
</dd>
</div>
<div class="dtdd-container">
<dt>exclude</dt>
<dd>値が指定値を含まないか検証する<ul class=" simple">
<li>include の逆</li>
</ul>
</dd>
</div>
</dl>
<p>検証・フィルタは原則として型を見ない（指定されていればすべて実行される）。<span class="implicit-br">
</span>のでおかしな型におかしな検証・フィルタを与えると型エラーが出ることがある。</p>
<p>検証は途中経過を問わない。<span class="implicit-br">
</span>後ろの配列で上書きされた値や unique で減った配列などは以下に違反していても valid と判断される。</p>
<p>素直に json schema を使えという内なる声が聞こえなくもない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$schema</code></td>
<td>​<span class="summary">スキーマ配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$arrays</code></td>
<td>​<span class="summary">検証する配列（可変引数。マージされる）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">正規化された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9e756dfdc5a0b945ee05e3546db87878df7789fc-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_select()" class="anchor"></a>[F] array_select <small><span class="summary">指定キーの要素で抽出する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_select.php#L11-L116" target="_blank">array_select.php#11~116</a></p>
</div>
<details>
<summary class="">指定キーの要素で抽出する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_select(
    iterable $array,
    string|iterable|\Closure $columns,
    int|string|null $index = null
): array</div></pre>
<div class="description">
<p>$columns に単純な値を渡すとそのキーの値を選択する。<span class="implicit-br">
</span>キー付きで値を渡すと読み替えて選択する。<span class="implicit-br">
</span>キー付きでクロージャを渡すと <code>(キーの値, 行自体, 現在行のキー)</code> を引数としてコールバックして選択する。<span class="implicit-br">
</span>単一のクロージャを渡すと <code>(行自体, 現在行のキー)</code> を引数としてコールバックして選択する（array_map とほぼ同じ）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    11 =&gt; ['id' =&gt; 1, 'name' =&gt; 'name1'],
    12 =&gt; ['id' =&gt; 2, 'name' =&gt; 'name2'],
    13 =&gt; ['id' =&gt; 3, 'name' =&gt; 'name3'],
];

that(array_select($array, [
    'id',              // id を単純取得
    'alias' =&gt; 'name', // name を alias として取得
]))-&gt;isSame([
    11 =&gt; ['id' =&gt; 1, 'alias' =&gt; 'name1'],
    12 =&gt; ['id' =&gt; 2, 'alias' =&gt; 'name2'],
    13 =&gt; ['id' =&gt; 3, 'alias' =&gt; 'name3'],
]);

that(array_select($array, [
    // id の 10 倍を取得
    'id'     =&gt; fn($id) =&gt; $id * 10,
    // id と name の結合を取得
    'idname' =&gt; fn($null, $row, $index) =&gt; $row['id'] . $row['name'],
]))-&gt;isSame([
    11 =&gt; ['id' =&gt; 10, 'idname' =&gt; '1name1'],
    12 =&gt; ['id' =&gt; 20, 'idname' =&gt; '2name2'],
    13 =&gt; ['id' =&gt; 30, 'idname' =&gt; '3name3'],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​iterable|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$columns</code></td>
<td>​<span class="summary">抽出項目</span></td>
</tr>
<tr>
<td>​int|​string|​null</td>
<td>​<code>$index = null</code></td>
<td>​<span class="summary">キーとなるキー</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_236fc35ca5139e1d97e63c69aef787fc1d2c5e9f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_set()" class="anchor"></a>[F] array_set <small><span class="summary">キー指定の配列値設定</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_set.php#L7-L73" target="_blank">array_set.php#7~73</a></p>
</div>
<details>
<summary class="">キー指定の配列値設定</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_set(
    array &amp;$array,
    mixed $value,
    array|string|int|null $key = null,
    callable|null $condition = null
): string|int|null</div></pre>
<div class="description">
<p>第3引数を省略すると（null を与えると）言語機構を使用して配列の最後に設定する（$array[] = $value）。<span class="implicit-br">
</span>第3引数に配列を指定すると潜って設定する。</p>
<p>第4引数で追加する条件クロージャを指定できる。<span class="implicit-br">
</span>クロージャには <code>(追加する要素, 追加するキー, 追加される元配列)</code> が渡ってくる。<span class="implicit-br">
</span>このクロージャが false 相当を返した時は追加されないようになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a' =&gt; 'A', 'B'];
// 第3引数省略（最後に連番キーで設定）
that(array_set($array, 'Z'))-&gt;isSame(1);
that($array)-&gt;isSame(['a' =&gt; 'A', 'B', 'Z']);
// 第3引数でキーを指定
that(array_set($array, 'Z', 'z'))-&gt;isSame('z');
that($array)-&gt;isSame(['a' =&gt; 'A', 'B', 'Z', 'z' =&gt; 'Z']);
that(array_set($array, 'Z', 'z'))-&gt;isSame('z');
// 第3引数で配列を指定
that(array_set($array, 'Z', ['x', 'y', 'z']))-&gt;isSame('z');
that($array)-&gt;isSame(['a' =&gt; 'A', 'B', 'Z', 'z' =&gt; 'Z', 'x' =&gt; ['y' =&gt; ['z' =&gt; 'Z']]]);
// 第4引数で条件を指定（キーが存在するなら追加しない）
that(array_set($array, 'Z', 'z', fn($v, $k, $array) =&gt; !isset($array[$k])))-&gt;isSame(null);
// 第4引数で条件を指定（値が存在するなら追加しない）
that(array_set($array, 'Z', null, fn($v, $k, $array) =&gt; !in_array($v, $array)))-&gt;isSame(null);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>&amp;$array</code></td>
<td>​<span class="summary">配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">設定する値</span></td>
</tr>
<tr>
<td>​array|​string|​int|​null</td>
<td>​<code>$key = null</code></td>
<td>​<span class="summary">設定するキー</span></td>
</tr>
<tr>
<td>​callable|​null</td>
<td>​<code>$condition = null</code></td>
<td>​<span class="summary">追加する条件</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int|​null</td>
<td>​<span class="summary">設定したキー</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ffc0c276e7b7d86f68550c2dcbac30e5f2c860c6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_shrink_key()" class="anchor"></a>[F] array_shrink_key <small><span class="summary">値の優先順位を逆にした array_intersect_key</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_shrink_key.php#L8-L38" target="_blank">array_shrink_key.php#8~38</a></p>
</div>
<details>
<summary class="">値の優先順位を逆にした array_intersect_key</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_shrink_key(iterable|array|object ...$variadic): array</div></pre>
<div class="description">
<p>array_intersect_key は「左優先で共通項を取る」という動作だが、この関数は「右優先で共通項を取る」という動作になる。<span class="implicit-br">
</span>「配列の並び順はそのままで値だけ変えたい/削ぎ落としたい」という状況はまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array1 = ['a' =&gt; 'A1', 'b' =&gt; 'B1', 'c' =&gt; 'C1'];
$array2 = ['c' =&gt; 'C2', 'b' =&gt; 'B2', 'a' =&gt; 'A2'];
$array3 = ['c' =&gt; 'C3', 'dummy' =&gt; 'DUMMY'];
// 全共通項である 'c' キーのみが生き残り、その値は最後の 'C3' になる
that(array_shrink_key($array1, $array2, $array3))-&gt;isSame(['c' =&gt; 'C3']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable|​array|​object</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">共通項を取る配列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_14ef575f791e883917093aec5cc0c0d2faa5bcf7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_shuffle()" class="anchor"></a>[F] array_shuffle <small><span class="summary">shuffle のキーが保存される＋参照渡しではない版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_shuffle.php#L7-L30" target="_blank">array_shuffle.php#7~30</a></p>
</div>
<details>
<summary class="">shuffle のキーが保存される＋参照渡しではない版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_shuffle(array $array): array</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_shuffle(['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C']))-&gt;is(['b' =&gt; 'B', 'a' =&gt; 'A', 'c' =&gt; 'C']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">shuffle された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4bafe8f9802d1bd086deee12211992d31696dca5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_sprintf()" class="anchor"></a>[F] array_sprintf <small><span class="summary">キーと値で sprintf する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_sprintf.php#L8-L65" target="_blank">array_sprintf.php#8~65</a></p>
</div>
<details>
<summary class="">キーと値で sprintf する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_sprintf(
    iterable $array,
    string|callable|null $format = null,
    ?string $glue = null
): array|string</div></pre>
<div class="description">
<p>配列の各要素を文字列化して返すイメージ。<span class="implicit-br">
</span>$glue を与えるとさらに implode して返す（返り値が文字列になる）。</p>
<p>$format は書式文字列（$v, $k）。<span class="implicit-br">
</span>callable を与えると sprintf ではなくコールバック処理になる（$v, $k）。<span class="implicit-br">
</span>省略（null）するとキーを format 文字列、値を引数として <strong>vsprintf</strong> する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['key1' =&gt; 'val1', 'key2' =&gt; 'val2'];
// key, value を利用した sprintf
that(array_sprintf($array, '%2$s=%1$s'))-&gt;isSame(['key1=val1', 'key2=val2']);
// 第3引数を与えるとさらに implode される
that(array_sprintf($array, '%2$s=%1$s', ' '))-&gt;isSame('key1=val1 key2=val2');
// クロージャを与えるとコールバック動作になる
$closure = fn($v, $k) =&gt; "$k=" . strtoupper($v);
that(array_sprintf($array, $closure, ' '))-&gt;isSame('key1=VAL1 key2=VAL2');
// 省略すると vsprintf になる
that(array_sprintf([
    'str:%s,int:%d' =&gt; ['sss', '3.14'],
    'single:%s'     =&gt; 'str',
], null, '|'))-&gt;isSame('str:sss,int:3|single:str');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​callable|​null</td>
<td>​<code>$format = null</code></td>
<td>​<span class="summary">書式文字列あるいはクロージャ</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$glue = null</code></td>
<td>​<span class="summary">結合文字列。未指定時は implode しない</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​string</td>
<td>​<span class="summary">sprintf された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_acac54a31faac249cfbc7b8487ea2a55d1be8b8b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_strpad()" class="anchor"></a>[F] array_strpad <small><span class="summary">配列のキー・要素に文字列を付加する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_strpad.php#L7-L55" target="_blank">array_strpad.php#7~55</a></p>
</div>
<details>
<summary class="">配列のキー・要素に文字列を付加する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_strpad(
    iterable $array,
    string|array $key_prefix,
    string|array $val_prefix = ""
): array</div></pre>
<div class="description">
<p>$key_prefix, $val_prefix でそれぞれ「キーに付与する文字列」「値に付与する文字列」が指定できる。<span class="implicit-br">
</span>配列を与えると [サフィックス, プレフィックス] という意味になる。<span class="implicit-br">
</span>デフォルト（ただの文字列）はプレフィックス（値だけに付与したいなら array_map で十分なので）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['key1' =&gt; 'val1', 'key2' =&gt; 'val2'];
// キーにプレフィックス付与
that(array_strpad($array, 'prefix-'))-&gt;isSame(['prefix-key1' =&gt; 'val1', 'prefix-key2' =&gt; 'val2']);
// 値にサフィックス付与
that(array_strpad($array, '', ['-suffix']))-&gt;isSame(['key1' =&gt; 'val1-suffix', 'key2' =&gt; 'val2-suffix']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$key_prefix</code></td>
<td>​<span class="summary">キー側の付加文字列</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$val_prefix = ""</code></td>
<td>​<span class="summary">値側の付加文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">文字列付与された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5b6f54326ae733793ee5da013de77e8db70450b2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_uncolumns()" class="anchor"></a>[F] array_uncolumns <small><span class="summary">array_columns のほぼ逆で [キー =&gt; [要素]] 配列から連想配列の配列を生成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_uncolumns.php#L8-L52" target="_blank">array_uncolumns.php#8~52</a></p>
</div>
<details>
<summary class="">array_columns のほぼ逆で [キー =&gt; [要素]] 配列から連想配列の配列を生成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_uncolumns(
    array $array,
    ?array $template = null
): array</div></pre>
<div class="description">
<p>$template を指定すると「それに含まれる配列かつ値がデフォルト」になる（要するに $default みたいなもの）。<span class="implicit-br">
</span>キーがバラバラな配列を指定する場合は指定したほうが良い。が、null を指定すると最初の要素が使われるので大抵の場合は null で良い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(array_uncolumns([
    'id'   =&gt; [1, 2],
    'name' =&gt; ['A', 'B'],
]))-&gt;isSame([
    ['id' =&gt; 1, 'name' =&gt; 'A'],
    ['id' =&gt; 2, 'name' =&gt; 'B'],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$template = null</code></td>
<td>​<span class="summary">抽出要素とそのデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_77bb1d7fa9ab56ad912c497a5c6ac0145739bf0f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_unset()" class="anchor"></a>[F] array_unset <small><span class="summary">伏せると同時にその値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_unset.php#L8-L94" target="_blank">array_unset.php#8~94</a></p>
</div>
<details>
<summary class="">伏せると同時にその値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_unset(
    array|\ArrayAccess &amp;$array,
    string|int|array|callable $key,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>$key に配列を与えると全て伏せて配列で返す。<span class="implicit-br">
</span>その場合、$default が活きるのは「全て無かった場合」となる。</p>
<p>さらに $key が配列の場合に限り、 $default を省略すると空配列として動作する。</p>
<p>配列を与えた場合の返り値は与えた配列の順番・キーが活きる。<span class="implicit-br">
</span>これを利用すると list の展開の利便性が上がったり、連想配列で返すことができる。</p>
<p>同様に、$key にクロージャを与えると、その返り値が true 相当のものを伏せて配列で返す。<span class="implicit-br">
</span>callable ではなくクロージャのみ対応する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a' =&gt; 'A', 'b' =&gt; 'B'];
// ない場合は $default を返す
that(array_unset($array, 'x', 'X'))-&gt;isSame('X');
// 指定したキーを返す。そのキーは伏せられている
that(array_unset($array, 'a'))-&gt;isSame('A');
that($array)-&gt;isSame(['b' =&gt; 'B']);

$array = ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
// 配列を与えるとそれらを返す。そのキーは全て伏せられている
that(array_unset($array, ['a', 'b', 'x']))-&gt;isSame(['A', 'B']);
that($array)-&gt;isSame(['c' =&gt; 'C']);

$array = ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
// 配列のキーは返されるキーを表す。順番も維持される
that(array_unset($array, ['x2' =&gt; 'b', 'x1' =&gt; 'a']))-&gt;isSame(['x2' =&gt; 'B', 'x1' =&gt; 'A']);

$array = ['hoge' =&gt; 'HOGE', 'fuga' =&gt; 'FUGA', 'piyo' =&gt; 'PIYO'];
// 値に "G" を含むものを返す。その要素は伏せられている
that(array_unset($array, fn($v) =&gt; strpos($v, 'G') !== false))-&gt;isSame(['hoge' =&gt; 'HOGE', 'fuga' =&gt; 'FUGA']);
that($array)-&gt;isSame(['piyo' =&gt; 'PIYO']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​<a href="https://php.net/manual/class.arrayaccess.php" target="_blank">ArrayAccess</a></td>
<td>​<code>&amp;$array</code></td>
<td>​<span class="summary">配列</span></td>
</tr>
<tr>
<td>​string|​int|​array|​callable</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">伏せたいキー。配列を与えると全て伏せる。クロージャの場合は true 相当を伏せる</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">指定したキーの値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ef302a500e1e76a4697464ae479a0847142139cc-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_walk_recursive2()" class="anchor"></a>[F] array_walk_recursive2 <small><span class="summary">array_walk_recursive の改善版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_walk_recursive2.php#L8-L51" target="_blank">array_walk_recursive2.php#8~51</a></p>
</div>
<details>
<summary class="">array_walk_recursive の改善版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_walk_recursive2(
    array $array,
    callable $callback
): array</div></pre>
<div class="description">
<p>違いは下記。</p>
<ul class=" simple">
<li>第3引数はなし<ul class=" simple">
<li>クロージャの use で十分だしそちらの方が優れている</li>
</ul>
</li>
<li>コールバックは ($value, $key, $array, $keys) が渡ってくる<ul class=" simple">
<li>$value, $array はリファレンスにすることで書き換え可能</li>
</ul>
</li>
<li>返り値で返す<ul class=" simple">
<li>元の array_walk_recursive の返り値はほとんど意味がない</li>
<li>返り値が空いてるなら変に参照を使わず返り値の方がシンプル</li>
</ul>
</li>
</ul>
<p>array_walk_recursive で「この要素は伏せたいのに…」「このノードだけ触りたいのに…」ということはままあるが、</p>
<ul class=" simple">
<li>$array が渡ってくるので unset したり他のキーを生やしたりすることが可能</li>
<li>$keys が渡ってくるのでツリー構造の特定のノードだけ触ることが可能<span class="implicit-br">
</span>になっている。</li>
</ul>
<p>「map も filter も可能」という少しマッチョな関数。<span class="implicit-br">
</span>実質的には「再帰的な array_kvmap」のように振る舞う。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">コールバック</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">walk 後の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_730c32126d5c8156225283c00feb74a4e836249e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_where()" class="anchor"></a>[F] array_where <small><span class="summary">指定キーの要素で array_filter する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_where.php#L9-L131" target="_blank">array_where.php#9~131</a></p>
</div>
<details>
<summary class="">指定キーの要素で array_filter する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_where(
    iterable $array,
    string|array|null $column = null,
    ?callable $callback = null
): array</div></pre>
<div class="description">
<p>array_column があるなら array_where があってもいいはず。</p>
<p>$column はコールバックに渡ってくる配列のキー名を渡す。null を与えると行全体が渡ってくる。<span class="implicit-br">
</span>$callback は絞り込み条件を渡す。null を与えると true 相当の値でフィルタする。<span class="implicit-br">
</span>つまり $column も $callback も省略した場合、実質的に array_filter と同じ動作になる。</p>
<p>$column は配列を受け入れる。配列を渡した場合その値の共通項がコールバックに渡る。<span class="implicit-br">
</span>連想配列の場合は「キーのカラム == 値」で filter する（それぞれで AND。厳密かどうかは $callback で指定。説明が難しいので Example を参照）。</p>
<p>$callback が要求するならキーも渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    0 =&gt; ['id' =&gt; 1, 'name' =&gt; 'hoge', 'flag' =&gt; false],
    1 =&gt; ['id' =&gt; 2, 'name' =&gt; 'fuga', 'flag' =&gt; true],
    2 =&gt; ['id' =&gt; 3, 'name' =&gt; 'piyo', 'flag' =&gt; false],
];
// 'flag' が true 相当のものだけ返す
that(array_where($array, 'flag'))-&gt;isSame([
    1 =&gt; ['id' =&gt; 2, 'name' =&gt; 'fuga', 'flag' =&gt; true],
]);
// 'name' に 'h' を含むものだけ返す
$contain_h = fn($name) =&gt; strpos($name, 'h') !== false;
that(array_where($array, 'name', $contain_h))-&gt;isSame([
    0 =&gt; ['id' =&gt; 1, 'name' =&gt; 'hoge', 'flag' =&gt; false],
]);
// $callback が引数2つならキーも渡ってくる（キーが 2 のものだけ返す）
$equal_2 = fn($row, $key) =&gt; $key === 2;
that(array_where($array, null, $equal_2))-&gt;isSame([
    2 =&gt; ['id' =&gt; 3, 'name' =&gt; 'piyo', 'flag' =&gt; false],
]);
// $column に配列を渡すと共通項が渡ってくる
$idname_is_2fuga = fn($idname) =&gt; ($idname['id'] . $idname['name']) === '2fuga';
that(array_where($array, ['id', 'name'], $idname_is_2fuga))-&gt;isSame([
    1 =&gt; ['id' =&gt; 2, 'name' =&gt; 'fuga', 'flag' =&gt; true],
]);
// $column に連想配列を渡すと「キーのカラム == 値」で filter する（要するに「name が piyo かつ flag が false」で filter）
that(array_where($array, ['name' =&gt; 'piyo', 'flag' =&gt; false]))-&gt;isSame([
    2 =&gt; ['id' =&gt; 3, 'name' =&gt; 'piyo', 'flag' =&gt; false],
]);
// 上記において値に配列を渡すと in_array で判定される
that(array_where($array, ['id' =&gt; [2, 3]]))-&gt;isSame([
    1 =&gt; ['id' =&gt; 2, 'name' =&gt; 'fuga', 'flag' =&gt; true],
    2 =&gt; ['id' =&gt; 3, 'name' =&gt; 'piyo', 'flag' =&gt; false],
]);
// $column の連想配列の値にはコールバックが渡せる（それぞれで AND）
that(array_where($array, [
    'id'   =&gt; fn($id) =&gt; $id &gt;= 3,                       // id が 3 以上
    'name' =&gt; fn($name) =&gt; strpos($name, 'o') !== false, // name に o を含む
]))-&gt;isSame([
    2 =&gt; ['id' =&gt; 3, 'name' =&gt; 'piyo', 'flag' =&gt; false],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​array|​null</td>
<td>​<code>$column = null</code></td>
<td>​<span class="summary">キー名</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$callback = null</code></td>
<td>​<span class="summary">評価クロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">$where が真を返した新しい配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_cbae9e9df3f65cf2db421e10e679bf11732b4679-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-array_zip()" class="anchor"></a>[F] array_zip <small><span class="summary">配列の各要素値で順番に配列を作る</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/array_zip.php#L9-L83" target="_blank">array_zip.php#9~83</a></p>
</div>
<details>
<summary class="">配列の各要素値で順番に配列を作る</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function array_zip(array ...$arrays): array</div></pre>
<div class="description">
<p><code>array_map(null, ...$arrays)</code> とほぼ同義。ただし</p>
<ul class=" simple">
<li>文字キーは保存される（数値キーは再割り振りされる）</li>
<li>一つだけ配列を与えても構造は壊れない（array_map(null) は壊れる）</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 普通の zip
that(array_zip(
    [1, 2, 3],
    ['hoge', 'fuga', 'piyo']
))-&gt;is([[1, 'hoge'], [2, 'fuga'], [3, 'piyo']]);
// キーが維持される
that(array_zip(
    ['a' =&gt; 1, 2, 3],
    ['hoge', 'b' =&gt; 'fuga', 'piyo']
))-&gt;is([['a' =&gt; 1, 'hoge'], [2, 'b' =&gt; 'fuga'], [3, 'piyo']]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>...$arrays</code></td>
<td>​<span class="summary">対象配列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">各要素値の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9dec4555af545363c4c82cbe8389ebb186280ee1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-arrayize()" class="anchor"></a>[F] arrayize <small><span class="summary">引数の配列を生成する。</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/arrayize.php#L8-L50" target="_blank">arrayize.php#8~50</a></p>
</div>
<details>
<summary class="">引数の配列を生成する。</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function arrayize(mixed ...$variadic): array</div></pre>
<div class="description">
<p>配列以外を渡すと配列化されて追加される。<span class="implicit-br">
</span>配列を渡してもそのままだが、連番配列の場合はマージ、連想配列の場合は結合となる。<span class="implicit-br">
</span>iterable や Traversable は考慮せずあくまで「配列」としてチェックする。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 値は配列化される
that(arrayize(1, 2, 3))-&gt;isSame([1, 2, 3]);
// 配列はそのまま
that(arrayize([1], [2], [3]))-&gt;isSame([1, 2, 3]);
// 連想配列、連番配列の挙動
that(arrayize([1, 2, 3], [4, 5, 6], ['a' =&gt; 'A1'], ['a' =&gt; 'A2']))-&gt;isSame([1, 2, 3, 4, 5, 6, 'a' =&gt; 'A1']);
// stdClass は foreach 可能だがあくまで配列としてチェックする
$object = new \stdClass();
that(arrayize($object, false, [1, 2, 3]))-&gt;isSame([$object, false, 1, 2, 3]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">生成する要素（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">引数を配列化したもの</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3d4517a8b81a4eca84b1ef2a3cc0b63654166fe7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-arrays()" class="anchor"></a>[F] arrays <small><span class="summary">配列をシーケンシャルに走査するジェネレータを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/arrays.php#L7-L38" target="_blank">arrays.php#7~38</a></p>
</div>
<details>
<summary class="">配列をシーケンシャルに走査するジェネレータを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function arrays(iterable $array): \Generator</div></pre>
<div class="description">
<p>「シーケンシャルに」とは要するに数値連番が得られるように走査するということ。<span class="implicit-br">
</span>0ベースの連番を作ってインクリメントしながら foreach するのと全く変わらない。</p>
<p>キーは連番、値は [$key, $value] で返す。<span class="implicit-br">
</span>つまり、 Example のように foreach の list 構文を使えば「連番、キー、値」でループを回すことが可能になる。<span class="implicit-br">
</span>「foreach で回したいんだけど連番も欲しい」という状況はまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
$nkv = [];
foreach (arrays($array) as $n =&gt; [$k, $v]) {
    $nkv[] = "$n,$k,$v";
}
that($nkv)-&gt;isSame(['0,a,A', '1,b,B', '2,c,C']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.generator.php" target="_blank">Generator</a></td>
<td>​<span class="summary">[$seq =&gt; [$key, $value]] を返すジェネレータ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e17fe1e674306a8fcf5f065781001f328567094c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-first_key()" class="anchor"></a>[F] first_key <small><span class="summary">配列の最初のキーを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/first_key.php#L9-L34" target="_blank">first_key.php#9~34</a></p>
</div>
<details>
<summary class="">配列の最初のキーを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function first_key(
    iterable $array,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>空の場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(first_key(['a', 'b', 'c']))-&gt;isSame(0);
that(first_key([], 999))-&gt;isSame(999);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">最初のキー</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e4511917ae298d05c458697c3ddbbad81e145bb1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-first_keyvalue()" class="anchor"></a>[F] first_keyvalue <small><span class="summary">配列の最初のキー/値ペアをタプルで返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/first_keyvalue.php#L7-L30" target="_blank">first_keyvalue.php#7~30</a></p>
</div>
<details>
<summary class="">配列の最初のキー/値ペアをタプルで返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function first_keyvalue(
    iterable|object $array,
    mixed $default = null
): array</div></pre>
<div class="description">
<p>空の場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(first_keyvalue(['a', 'b', 'c']))-&gt;isSame([0, 'a']);
that(first_keyvalue([], 999))-&gt;isSame(999);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable|​object</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">[最初のキー, 最初の値]</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_41d824cf911747ed0651277664718c8b013b91ec-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-first_value()" class="anchor"></a>[F] first_value <small><span class="summary">配列の最初の値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/first_value.php#L9-L34" target="_blank">first_value.php#9~34</a></p>
</div>
<details>
<summary class="">配列の最初の値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function first_value(
    iterable $array,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>空の場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(first_value(['a', 'b', 'c']))-&gt;isSame('a');
that(first_value([], 999))-&gt;isSame(999);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">最初の値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ff5a6875158cd10d9c647dfeec38b5f7a55d87c9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-groupsort()" class="anchor"></a>[F] groupsort <small><span class="summary">配列を部分的にソートする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/groupsort.php#L8-L90" target="_blank">groupsort.php#8~90</a></p>
</div>
<details>
<summary class="">配列を部分的にソートする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function groupsort(
    iterable $array,
    callable $grouper,
    callable $comparator
): array</div></pre>
<div class="description">
<p>$grouper でグルーピングされた部分配列を $comparator でソートし、元の位置に埋め込む。<span class="implicit-br">
</span>元の配列の並び順は可能な限り維持される。</p>
<p>$grouper はグループを決定づける何かを返す。<span class="implicit-br">
</span>一意であれば何でも良いが、内部的に配列のキーに格納されるため、文字列であることが望ましい。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 下記のような配列を元の順番を保ちつつ各々の group で部分的にソートする
$array = [
    ['id' =&gt; 1, 'group' =&gt; 'A', 'name' =&gt; 'q'],
    ['id' =&gt; 2, 'group' =&gt; 'A', 'name' =&gt; 'a'],
    ['id' =&gt; 3, 'group' =&gt; 'A', 'name' =&gt; 'z'],
    ['id' =&gt; 4, 'group' =&gt; null, 'name' =&gt; 'noise'],
    ['id' =&gt; 5, 'group' =&gt; 'B', 'name' =&gt; 'w'],
    ['id' =&gt; 6, 'group' =&gt; 'B', 'name' =&gt; 's'],
    ['id' =&gt; 7, 'group' =&gt; 'B', 'name' =&gt; 'x'],
    ['id' =&gt; 8, 'group' =&gt; 'C', 'name' =&gt; 'e'],
    ['id' =&gt; 9, 'group' =&gt; 'C', 'name' =&gt; 'd'],
    ['id' =&gt; 10, 'group' =&gt; null, 'name' =&gt; 'noise'],
    ['id' =&gt; 11, 'group' =&gt; 'C', 'name' =&gt; 'c'],
];
that(groupsort($array, fn($v, $k) =&gt; $v['group'], fn($a, $b) =&gt; $a['name'] &lt;=&gt; $b['name']))-&gt;is([
    1  =&gt; ["id" =&gt; 2, "group" =&gt; "A", "name" =&gt; "a"],
    0  =&gt; ["id" =&gt; 1, "group" =&gt; "A", "name" =&gt; "q"],
    2  =&gt; ["id" =&gt; 3, "group" =&gt; "A", "name" =&gt; "z"],
    3  =&gt; ["id" =&gt; 4, "group" =&gt; null, "name" =&gt; "noise"],
    5  =&gt; ["id" =&gt; 6, "group" =&gt; "B", "name" =&gt; "s"],
    4  =&gt; ["id" =&gt; 5, "group" =&gt; "B", "name" =&gt; "w"],
    6  =&gt; ["id" =&gt; 7, "group" =&gt; "B", "name" =&gt; "x"],
    10 =&gt; ["id" =&gt; 11, "group" =&gt; "C", "name" =&gt; "c"],
    8  =&gt; ["id" =&gt; 9, "group" =&gt; "C", "name" =&gt; "d"],
    7  =&gt; ["id" =&gt; 8, "group" =&gt; "C", "name" =&gt; "e"],
    9  =&gt; ["id" =&gt; 10, "group" =&gt; null, "name" =&gt; "noise"],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$grouper</code></td>
<td>​<span class="summary">グループ導出関数</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$comparator</code></td>
<td>​<span class="summary">部分配列の比較関数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">部分ソートされた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_783890a097a0043c859d4a165d8b99ea8c9f686a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-in_array_and()" class="anchor"></a>[F] in_array_and <small><span class="summary">in_array の複数版（AND）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/in_array_and.php#L8-L43" target="_blank">in_array_and.php#8~43</a></p>
</div>
<details>
<summary class="">in_array の複数版（AND）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function in_array_and(
    array|mixed $needle,
    array $haystack,
    bool $strict = false
): bool</div></pre>
<div class="description">
<p>配列 $haystack が $needle の「すべてを含む」ときに true を返す。</p>
<p>$needle が非配列の場合は配列化される。<span class="implicit-br">
</span>$needle が空の場合は常に false を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(in_array_and([1], [1, 2, 3]))-&gt;isTrue();
that(in_array_and([9], [1, 2, 3]))-&gt;isFalse();
that(in_array_and([1, 9], [1, 2, 3]))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​mixed</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$strict = false</code></td>
<td>​<span class="summary">厳密フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">$needle のすべてが含まれているなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8e5213b33724109134294f2eaa33cf5bfef4033d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-in_array_or()" class="anchor"></a>[F] in_array_or <small><span class="summary">in_array の複数版（OR）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/in_array_or.php#L8-L43" target="_blank">in_array_or.php#8~43</a></p>
</div>
<details>
<summary class="">in_array の複数版（OR）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function in_array_or(
    array|mixed $needle,
    array $haystack,
    bool $strict = false
): bool</div></pre>
<div class="description">
<p>配列 $haystack が $needle の「どれかを含む」ときに true を返す。</p>
<p>$needle が非配列の場合は配列化される。<span class="implicit-br">
</span>$needle が空の場合は常に false を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(in_array_or([1], [1, 2, 3]))-&gt;isTrue();
that(in_array_or([9], [1, 2, 3]))-&gt;isFalse();
that(in_array_or([1, 9], [1, 2, 3]))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​mixed</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$strict = false</code></td>
<td>​<span class="summary">厳密フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">$needle のどれかが含まれているなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f7b361d0c2125f3d366d9f1eee72a6a6a767193c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_hasharray()" class="anchor"></a>[F] is_hasharray <small><span class="summary">配列が連想配列か調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/is_hasharray.php#L7-L37" target="_blank">is_hasharray.php#7~37</a></p>
</div>
<details>
<summary class="">配列が連想配列か調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_hasharray(array $array): bool</div></pre>
<div class="description">
<p>空の配列は普通の配列とみなす。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(is_hasharray([]))-&gt;isFalse();
that(is_hasharray([1, 2, 3]))-&gt;isFalse();
that(is_hasharray(['x' =&gt; 'X']))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">連想配列なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7bab6da02867a584dcb454fd7bafb1a2b5f4d1db-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_indexarray()" class="anchor"></a>[F] is_indexarray <small><span class="summary">配列が数値配列か調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/is_indexarray.php#L7-L37" target="_blank">is_indexarray.php#7~37</a></p>
</div>
<details>
<summary class="">配列が数値配列か調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_indexarray(array $array): bool</div></pre>
<div class="description">
<p>空の配列も数値配列とみなす。<span class="implicit-br">
</span>さらにいわゆる「連番配列」ではなく「キーが数値のみか？」で判定する。</p>
<p>つまり、 is_hasharray とは排他的ではない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(is_indexarray([]))-&gt;isTrue();
that(is_indexarray([1, 2, 3]))-&gt;isTrue();
that(is_indexarray(['x' =&gt; 'X']))-&gt;isFalse();
// 抜け番があっても true になる（これは is_hasharray も true になる）
that(is_indexarray([1 =&gt; 1, 2 =&gt; 2, 3 =&gt; 3]))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">調べる配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">数値配列なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_405ca486b61223fddd5e71e416e17c2177da5643-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-kvsort()" class="anchor"></a>[F] kvsort <small><span class="summary">比較関数にキーも渡ってくる安定ソート</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/kvsort.php#L10-L136" target="_blank">kvsort.php#10~136</a></p>
</div>
<details>
<summary class="">比較関数にキーも渡ってくる安定ソート</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function kvsort(
    T $array,
    callable|int|null $comparator = null,
    callable|callable[] $schwartzians = []
): T</div></pre>
<div class="description">
<p>比較関数は ($valueA, $valueB, $keyA, $keyB) という引数を取る。<span class="implicit-br">
</span>「値で比較して同値だったらキーも見たい」という状況はまれによくあるはず。<span class="implicit-br">
</span>さらに安定ソートであり、同値だとしても元の並び順は維持される。</p>
<p>$schwartzians を指定した場合は呼び出しが ($schwartzianA, $schwartzianB, $valueA, $valueB, $keyA, $keyB) になる。<span class="implicit-br">
</span>$schwartzianX は単一値の場合はその結果、配列の場合はキー構造が維持されて渡ってくる。<span class="implicit-br">
</span>このあたりは表現しにくいので Example を参照。</p>
<p>$comparator は省略できる。省略した場合、型に基づいてよしなにソートする。<span class="implicit-br">
</span>（が、比較のたびに型チェックが入るので指定したほうが高速に動く）。</p>
<p>ただし、標準のソート関数とは異なり、参照渡しではなくソートして返り値で返す。<span class="implicit-br">
</span>また、いわゆる asort であり、キー・値は常に維持される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    'a'  =&gt; 3,
    'b'  =&gt; 1,
    'c'  =&gt; 2,
    'x1' =&gt; 9,
    'x2' =&gt; 9,
    'x3' =&gt; 9,
];
// 普通のソート
that(kvsort($array))-&gt;isSame([
    'b'  =&gt; 1,
    'c'  =&gt; 2,
    'a'  =&gt; 3,
    'x1' =&gt; 9,
    'x2' =&gt; 9,
    'x3' =&gt; 9,
]);
// キーを使用したソート
that(kvsort($array, fn($av, $bv, $ak, $bk) =&gt; strcmp($bk, $ak)))-&gt;isSame([
    'x3' =&gt; 9,
    'x2' =&gt; 9,
    'x1' =&gt; 9,
    'c'  =&gt; 2,
    'b'  =&gt; 1,
    'a'  =&gt; 3,
]);
// シュワルツ変換を使用したソート（引数説明のために全て列挙している）
that(kvsort($array, fn($hashA, $hashB, $av, $bv, $ak, $bk) =&gt; ($hashA['md5'] &lt;=&gt; $hashB['md5']) ?: ($hashA['sha1'] &lt;=&gt; $hashB['sha1']), [
    'md5'  =&gt; fn($v) =&gt; md5($v),
    'sha1' =&gt; fn($v) =&gt; sha1($v),
]))-&gt;isSame([
    'x1' =&gt; 9,
    'x2' =&gt; 9,
    'x3' =&gt; 9,
    'b'  =&gt; 1,
    'c'  =&gt; 2,
    'a'  =&gt; 3,
]);
// シュワルツ変換の場合 $comparator は省略可能（昇順）で、配列ではなく単一値を渡せばその結果値が渡ってくる（これは要するに md5 での昇順ソート）
that(kvsort($array, null, fn($v) =&gt; md5($v)))-&gt;isSame([
    'x1' =&gt; 9,
    'x2' =&gt; 9,
    'x3' =&gt; 9,
    'b'  =&gt; 1,
    'c'  =&gt; 2,
    'a'  =&gt; 3,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--T">T</a></td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​callable|​int|​null</td>
<td>​<code>$comparator = null</code></td>
<td>​<span class="summary">比較関数。SORT_XXX も使える</span></td>
</tr>
<tr>
<td>​callable|​callable[]</td>
<td>​<code>$schwartzians = []</code></td>
<td>​<span class="summary">シュワルツ変換に使用する仮想列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--T">T</a></td>
<td>​<span class="summary">ソートされた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e71c2fee61091335d84130e86516246d0ed25678-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-last_key()" class="anchor"></a>[F] last_key <small><span class="summary">配列の最後のキーを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/last_key.php#L9-L34" target="_blank">last_key.php#9~34</a></p>
</div>
<details>
<summary class="">配列の最後のキーを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function last_key(
    iterable $array,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>空の場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(last_key(['a', 'b', 'c']))-&gt;isSame(2);
that(last_key([], 999))-&gt;isSame(999);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">最後のキー</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ddca7931bb9d4dc2d5a378ed8df16afe02890af0-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-last_keyvalue()" class="anchor"></a>[F] last_keyvalue <small><span class="summary">配列の最後のキー/値ペアをタプルで返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/last_keyvalue.php#L8-L44" target="_blank">last_keyvalue.php#8~44</a></p>
</div>
<details>
<summary class="">配列の最後のキー/値ペアをタプルで返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function last_keyvalue(
    iterable|object $array,
    mixed $default = null
): array</div></pre>
<div class="description">
<p>空の場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(last_keyvalue(['a', 'b', 'c']))-&gt;isSame([2, 'c']);
that(last_keyvalue([], 999))-&gt;isSame(999);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable|​object</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">[最後のキー, 最後の値]</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e736a64291096b1dbb12b7731ff6820cae729082-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-last_value()" class="anchor"></a>[F] last_value <small><span class="summary">配列の最後の値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/last_value.php#L9-L34" target="_blank">last_value.php#9~34</a></p>
</div>
<details>
<summary class="">配列の最後の値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function last_value(
    iterable $array,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>空の場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(last_value(['a', 'b', 'c']))-&gt;isSame('c');
that(last_value([], 999))-&gt;isSame(999);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">最後の値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_422368de0e809fa9f91b833985f03e86088ee07a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-next_key()" class="anchor"></a>[F] next_key <small><span class="summary">配列の指定キーの次のキーを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/next_key.php#L7-L59" target="_blank">next_key.php#7~59</a></p>
</div>
<details>
<summary class="">配列の指定キーの次のキーを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function next_key(
    array $array,
    string|int|null $key = null
): string|int|bool|null</div></pre>
<div class="description">
<p>$key が最後のキーだった場合は null を返す。<span class="implicit-br">
</span>$key が存在しない場合は false を返す。<span class="implicit-br">
</span>$key が未指定だと「次に生成されるキー」（$array[]='hoge' で生成されるキー）を返す。</p>
<p>$array[] = 'hoge' で作成されるキーには完全準拠しない（標準は unset すると結構乱れる）。公式マニュアルを参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [9 =&gt; 9, 'a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
// 'b' キーの次は 'c'
that(next_key($array, 'b'))-&gt;isSame('c');
// 'c' キーの次は無いので null
that(next_key($array, 'c'))-&gt;isSame(null);
// 'x' キーはそもそも存在しないので false
that(next_key($array, 'x'))-&gt;isSame(false);
// 次に生成されるキーは 10
that(next_key($array, null))-&gt;isSame(10);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​int|​null</td>
<td>​<code>$key = null</code></td>
<td>​<span class="summary">調べるキー</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int|​bool|​null</td>
<td>​<span class="summary">$key の次のキー</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8ffc8e17a403807604a06a3eddf72d3f303688fb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-prev_key()" class="anchor"></a>[F] prev_key <small><span class="summary">配列の指定キーの前のキーを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/array/prev_key.php#L7-L41" target="_blank">prev_key.php#7~41</a></p>
</div>
<details>
<summary class="">配列の指定キーの前のキーを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function prev_key(
    array $array,
    string|int $key
): string|int|bool|null</div></pre>
<div class="description">
<p>$key が最初のキーだった場合は null を返す。<span class="implicit-br">
</span>$key が存在しない場合は false を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C'];
// 'b' キーの前は 'a'
that(prev_key($array, 'b'))-&gt;isSame('a');
// 'a' キーの前は無いので null
that(prev_key($array, 'a'))-&gt;isSame(null);
// 'x' キーはそもそも存在しないので false
that(prev_key($array, 'x'))-&gt;isSame(false);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​string|​int</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">調べるキー</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int|​bool|​null</td>
<td>​<span class="summary">$key の前のキー</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6593123577634bbddfe4e0d959a864c937795013-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-classobj" class="anchor"></a>[N] ryunosuke\Functions\Package\classobj\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-2" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-classobj--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_bdb7caf31b4f2369d7e9483f302fd510f8e400a4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-auto_loader()" class="anchor"></a>[F] auto_loader <small><span class="summary">vendor/autoload.php を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/auto_loader.php#L9-L37" target="_blank">auto_loader.php#9~37</a></p>
</div>
<details>
<summary class="">vendor/autoload.php を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function auto_loader(?string $startdir = null): string</div></pre>
<div class="description">
<p>かなり局所的な実装で vendor ディレクトリを変更していたりするとそれだけで例外になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(auto_loader())-&gt;contains('autoload.php');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$startdir = null</code></td>
<td>​<span class="summary">高速化用の検索開始ディレクトリを指定するが、どちらかと言えばテスト用</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">autoload.php のフルパス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c6d08c0bfd252c0eb7552c950e68761141ed49e9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_aliases()" class="anchor"></a>[F] class_aliases <small><span class="summary">遅延ロードする class_alias</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_aliases.php#L7-L45" target="_blank">class_aliases.php#7~45</a></p>
</div>
<details>
<summary class="">遅延ロードする class_alias</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_aliases(array $aliases): array</div></pre>
<div class="description">
<p>class_alias は即座にオートロードされるが、この関数は必要とされるまでオートロードしない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">class_aliases([
    'TestCase' =&gt; \PHPUnit\Framework\TestCase::class,
]);
that(class_exists('TestCase', false))-&gt;isFalse(); // オートロードを走らせなければまだ定義されていない
that(class_exists('TestCase', true))-&gt;isTrue();   // オートロードを走らせなければ定義されている</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$aliases</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">エイリアス配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_503906f6b0a172a88597be0a970172c11b2eeb1e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_constants()" class="anchor"></a>[F] class_constants <small><span class="summary">クラス定数を配列で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_constants.php#L8-L68" target="_blank">class_constants.php#8~68</a></p>
</div>
<details>
<summary class="">クラス定数を配列で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_constants(
    string|object $class,
    ?int $filter = null
): array</div></pre>
<div class="description">
<p><code>(new \ReflectionClass($class))-&gt;getConstants()</code> とほぼ同じだが、可視性でフィルタができる。<span class="implicit-br">
</span>さらに「自分自身の定義か？」でもフィルタできる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$class = new class extends \ArrayObject
{
    private   const C_PRIVATE   = 'private';
    protected const C_PROTECTED = 'protected';
    public    const C_PUBLIC    = 'public';
};
// 普通に全定数を返す
that(class_constants($class))-&gt;isSame([
    'C_PRIVATE'      =&gt; 'private',
    'C_PROTECTED'    =&gt; 'protected',
    'C_PUBLIC'       =&gt; 'public',
    'STD_PROP_LIST'  =&gt; \ArrayObject::STD_PROP_LIST,
    'ARRAY_AS_PROPS' =&gt; \ArrayObject::ARRAY_AS_PROPS,
]);
// public のみを返す
that(class_constants($class, IS_PUBLIC))-&gt;isSame([
    'C_PUBLIC'       =&gt; 'public',
    'STD_PROP_LIST'  =&gt; \ArrayObject::STD_PROP_LIST,
    'ARRAY_AS_PROPS' =&gt; \ArrayObject::ARRAY_AS_PROPS,
]);
// 自身定義でかつ public のみを返す
that(class_constants($class, IS_OWNSELF | IS_PUBLIC))-&gt;isSame([
    'C_PUBLIC'       =&gt; 'public',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​object</td>
<td>​<code>$class</code></td>
<td>​<span class="summary">クラス名 or オブジェクト</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$filter = null</code></td>
<td>​<span class="summary">アクセスレベル定数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">クラス定数の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_bdab1c340fd6ad97e69ba05e23a5bc1a91038adb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_extends()" class="anchor"></a>[F] class_extends <small><span class="summary">インスタンスを動的に拡張する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_extends.php#L14-L258" target="_blank">class_extends.php#14~258</a></p>
</div>
<details>
<summary class="">インスタンスを動的に拡張する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_extends(
    T $object,
    \Closure[] $methods,
    array $fields = [],
    array $implements = []
): T</div></pre>
<div class="description">
<p>インスタンスに特異メソッド・特異フィールドのようなものを生やす。<span class="implicit-br">
</span>ただし、特異フィールドの用途はほとんどない（php はデフォルトで特異フィールドのような動作なので）。<span class="implicit-br">
</span>そのクラスの <code>__set</code>/<code>__get</code> が禁止されている場合に使えるかもしれない程度。</p>
<p>クロージャ配列を渡すと特異メソッドになる。<span class="implicit-br">
</span>そのクロージャの $this は元オブジェクトで bind される。<span class="implicit-br">
</span>ただし、static closure を渡した場合はそれは static メソッドとして扱われる。</p>
<p>$implements でインターフェースの配列を渡すとすべてが動的に implement される。<span class="implicit-br">
</span>つまり得られたオブジェクトが instanceof を通るようになる。<span class="implicit-br">
</span>もちろんメソッド配列としてその名前が含まれていなければならない。</p>
<p>内部的にはいわゆる Decorator パターンを動的に実行しているだけであり、実行速度は劣悪。<span class="implicit-br">
</span>当然ながら final クラス/メソッドの拡張もできない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// Exception に「count」メソッドと「コードとメッセージを結合して返す」メソッドを動的に生やす
$object = new \Exception('hoge', 123);
$newobject = class_extends($object, [
    'count'       =&gt; function () { return $this-&gt;code; },
    'codemessage' =&gt; function () {
        // bind されるので protected フィールドが使える
        return $this-&gt;code . ':' . $this-&gt;message;
    },
], [], [\Countable::class]);
that($newobject-&gt;count())-&gt;isSame(123);
that($newobject-&gt;codemessage())-&gt;isSame('123:hoge');
that($newobject)-&gt;isInstanceOf(\Countable::class); // instanceof をパスできる

// オーバーライドもできる（ArrayObject の count を2倍になるように上書き）
$object = new \ArrayObject([1, 2, 3]);
$newobject = class_extends($object, [
    'count' =&gt; function () {
        // parent は元オブジェクトを表す
        return parent::count() * 2;
    },
]);
that($newobject-&gt;count())-&gt;isSame(6);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--T">T</a></td>
<td>​<code>$object</code></td>
<td>​<span class="summary">対象オブジェクト</span></td>
</tr>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a>[]</td>
<td>​<code>$methods</code></td>
<td>​<span class="summary">注入するメソッド</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$fields = []</code></td>
<td>​<span class="summary">注入するフィールド</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$implements = []</code></td>
<td>​<span class="summary">実装するインターフェース</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--T">T</a></td>
<td>​<span class="summary">$object を拡張した object</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7f99ff8413c9a653a4bbc493b17ba03d87bc9af6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_loader()" class="anchor"></a>[F] class_loader <small><span class="summary">composer のクラスローダを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_loader.php#L8-L26" target="_blank">class_loader.php#8~26</a></p>
</div>
<details>
<summary class="">composer のクラスローダを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_loader(?string $startdir = null): Composer\Autoload\ClassLoader</div></pre>
<div class="description">
<p>かなり局所的な実装で vendor ディレクトリを変更していたりするとそれだけで例外になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(class_loader())-&gt;isInstanceOf(\Composer\Autoload\ClassLoader::class);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$startdir = null</code></td>
<td>​<span class="summary">高速化用の検索開始ディレクトリを指定するが、どちらかと言えばテスト用</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--Composer-Autoload-ClassLoader">ClassLoader</a></td>
<td>​<span class="summary">クラスローダ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_77e3b09d0dcb78ce0396d9c92c16dbf14bd7f326-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_map()" class="anchor"></a>[F] class_map <small><span class="summary">指定クラスローダで読み込まれるであろう class =&gt; file を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_map.php#L13-L116" target="_blank">class_map.php#13~116</a></p>
</div>
<details>
<summary class="">指定クラスローダで読み込まれるであろう class =&gt; file を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_map(
    ?object|?Composer\Autoload\ClassLoader $loader = null,
    ?string $basePath = null,
    bool $cache = true
): array</div></pre>
<div class="description">
<p>実質的には composer で読み込まれるクラスマップを返す。<span class="implicit-br">
</span>つまり <code>dump-autoload -o</code> したときの getClassMap 相当を返す。</p>
<p>ファイル名からクラス名を逆引きする都合上、猛烈に遅いので注意。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?object|​?<a href="#--Composer-Autoload-ClassLoader">ClassLoader</a></td>
<td>​<code>$loader = null</code></td>
<td>​<span class="summary">オートローダオブジェクト</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$basePath = null</code></td>
<td>​<span class="summary">パスが相対パスだった場合の基底ディレクトリ</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$cache = true</code></td>
<td>​<span class="summary">キャッシュを使用するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">[class =&gt; file] の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a708fa7c5cebe80acc09f629168af063e976058b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_namespace()" class="anchor"></a>[F] class_namespace <small><span class="summary">クラスの名前空間部分を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_namespace.php#L7-L29" target="_blank">class_namespace.php#7~29</a></p>
</div>
<details>
<summary class="">クラスの名前空間部分を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_namespace(string|object $class): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(class_namespace('vendor\\namespace\\ClassName'))-&gt;isSame('vendor\\namespace');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​object</td>
<td>​<code>$class</code></td>
<td>​<span class="summary">対象クラス・オブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">クラスの名前空間</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_51b764e589c08b92dd0e00f6195b8fd72560f3fc-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_replace()" class="anchor"></a>[F] class_replace <small><span class="summary">既存（未読み込みに限る）クラスを強制的に置換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_replace.php#L16-L175" target="_blank">class_replace.php#16~175</a></p>
</div>
<details>
<summary class="">既存（未読み込みに限る）クラスを強制的に置換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_replace(
    string $class,
    \Closure|object|array $register
)</div></pre>
<div class="description">
<p>例えば継承ツリーが下記の場合を考える。</p>
<p>classA &lt;- classB &lt;- classC</p>
<p>この場合、「classC は classB に」「classB は classA に」それぞれ依存している、と考えることができる。<span class="implicit-br">
</span>これは静的に決定的であり、この依存を壊したり注入したりする手段は存在しない。<span class="implicit-br">
</span>例えば classA の実装を差し替えたいときに、いかに classA を継承した classAA を定義したとしても classB の親は classA で決して変わらない。</p>
<p>この関数を使うと本当に classA そのものを弄るので、継承ツリーを下記のように変えることができる。</p>
<p>classA &lt;- classAA &lt;- classB &lt;- classC</p>
<p>つまり、classA を継承した classAA を定義してそれを classA とみなすことが可能になる。<span class="implicit-br">
</span>ただし、内部的には class_alias を使用して実現しているので厳密には異なるクラスとなる。</p>
<p>実際のところかなり強力な機能だが、同時にかなり黒魔術的なので乱用は控えたほうがいい。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// Y1 extends X1 だとしてクラス定義でオーバーライドする
class_replace('\\ryunosuke\\Test\\Package\\files\\classes\\X1', function () {
    // アンスコがついたクラスが定義されるので匿名クラスを返す
    return new class() extends \ryunosuke\Test\Package\files\classes\X1_
    {
        function method(){return 'this is X1d';}
        function newmethod(){return 'this is newmethod';}
    };
});
// X1 を継承している Y1 にまで影響が出ている（X1 を完全に置換できたということ）
that((new \ryunosuke\Test\Package\files\classes\Y1())-&gt;method())-&gt;isSame('this is X1d');
that((new \ryunosuke\Test\Package\files\classes\Y1())-&gt;newmethod())-&gt;isSame('this is newmethod');

// Y2 extends X2 だとしてクロージャ配列でオーバーライドする
class_replace('\\ryunosuke\\Test\\Package\\files\classes\\X2', fn() =&gt; [
    'method'    =&gt; function () {return 'this is X2d';},
    'newmethod' =&gt; function () {return 'this is newmethod';},
]);
// X2 を継承している Y2 にまで影響が出ている（X2 を完全に置換できたということ）
that((new \ryunosuke\Test\Package\files\classes\Y2())-&gt;method())-&gt;isSame('this is X2d');
that((new \ryunosuke\Test\Package\files\classes\Y2())-&gt;newmethod())-&gt;isSame('this is newmethod');

// メソッド定義だけであればクロージャではなく配列指定でも可能。さらに trait 配列を渡すとそれらを use できる
class_replace('\\ryunosuke\\Test\\Package\\files\classes\\X3', [
    [\ryunosuke\Test\Package\files\classes\XTrait::class],
    'method' =&gt; function () {return 'this is X3d';},
]);
// X3 を継承している Y3 にまで影響が出ている（X3 を完全に置換できたということ）
that((new \ryunosuke\Test\Package\files\classes\Y3())-&gt;method())-&gt;isSame('this is X3d');
// トレイトのメソッドも生えている
that((new \ryunosuke\Test\Package\files\classes\Y3())-&gt;traitMethod())-&gt;isSame('this is XTrait::traitMethod');

// メソッドとトレイトだけならば無名クラスを渡すことでも可能
class_replace('\\ryunosuke\\Test\\Package\\files\classes\\X4', new class() {
    use \ryunosuke\Test\Package\files\classes\XTrait;
    function method(){return 'this is X4d';}
});
// X4 を継承している Y4 にまで影響が出ている（X4 を完全に置換できたということ）
that((new \ryunosuke\Test\Package\files\classes\Y4())-&gt;method())-&gt;isSame('this is X4d');
// トレイトのメソッドも生えている
that((new \ryunosuke\Test\Package\files\classes\Y4())-&gt;traitMethod())-&gt;isSame('this is XTrait::traitMethod');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$class</code></td>
<td>​<span class="summary">対象クラス名</span></td>
</tr>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a>|​object|​array</td>
<td>​<code>$register</code></td>
<td>​<span class="summary">置換クラスを定義 or 返すクロージャ or 定義メソッド配列 or 無名クラス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ee2db82f775b91aba372c39118e8050040a5c87a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_shorten()" class="anchor"></a>[F] class_shorten <small><span class="summary">クラスの名前空間部分を除いた短い名前を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_shorten.php#L7-L28" target="_blank">class_shorten.php#7~28</a></p>
</div>
<details>
<summary class="">クラスの名前空間部分を除いた短い名前を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_shorten(string|object $class): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(class_shorten('vendor\\namespace\\ClassName'))-&gt;isSame('ClassName');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​object</td>
<td>​<code>$class</code></td>
<td>​<span class="summary">対象クラス・オブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">クラスの短い名前</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_80c8f508e68e68c843b336b966e6b6014bb8abf5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-class_uses_all()" class="anchor"></a>[F] class_uses_all <small><span class="summary">クラスが use しているトレイトを再帰的に取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/class_uses_all.php#L7-L65" target="_blank">class_uses_all.php#7~65</a></p>
</div>
<details>
<summary class="">クラスが use しているトレイトを再帰的に取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function class_uses_all(
    string|object $class,
    bool $autoload = true
): array</div></pre>
<div class="description">
<p>トレイトが use しているトレイトが use しているトレイトが use している・・・のような場合もすべて返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">trait T1{}
trait T2{use T1;}
trait T3{use T2;}
that(class_uses_all(new class{use T3;}))-&gt;isSame([
    'Example\\T3' =&gt; 'Example\\T3', // クラスが直接 use している
    'Example\\T2' =&gt; 'Example\\T2', // T3 が use している
    'Example\\T1' =&gt; 'Example\\T1', // T2 が use している
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​object</td>
<td>​<code>$class</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$autoload = true</code></td>
<td>​<span class="summary">オートロードを呼ぶか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">トレイト名の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f1cebc5bc65371cd2ee6f10b77b08393a18320f1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-const_exists()" class="anchor"></a>[F] const_exists <small><span class="summary">クラス定数が存在するか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/const_exists.php#L7-L57" target="_blank">const_exists.php#7~57</a></p>
</div>
<details>
<summary class="">クラス定数が存在するか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function const_exists(
    string|object $classname,
    string $constname = ""
): bool</div></pre>
<div class="description">
<p>グローバル定数も調べられる。ので実質的には defined とほぼ同じで違いは下記。</p>
<ul class=" simple">
<li>defined は単一引数しか与えられないが、この関数は2つの引数も受け入れる</li>
<li>defined は private const で即死するが、この関数はきちんと調べることができる</li>
<li>ClassName::class は常に true を返す</li>
</ul>
<p>あくまで存在を調べるだけで実際にアクセスできるかは分からないので注意（<code>property_exists</code> と同じ）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// クラス定数が調べられる（1引数、2引数どちらでも良い）
that(const_exists('ArrayObject::STD_PROP_LIST'))-&gt;isTrue();
that(const_exists('ArrayObject', 'STD_PROP_LIST'))-&gt;isTrue();
that(const_exists('ArrayObject::UNDEFINED'))-&gt;isFalse();
that(const_exists('ArrayObject', 'UNDEFINED'))-&gt;isFalse();
// グローバル（名前空間）もいける
that(const_exists('PHP_VERSION'))-&gt;isTrue();
that(const_exists('UNDEFINED'))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​object</td>
<td>​<code>$classname</code></td>
<td>​<span class="summary">調べるクラス</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$constname = ""</code></td>
<td>​<span class="summary">調べるクラス定数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">定数が存在するなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_34130dbcbda1144312fd1be1ca1969e7097f0658-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-namespace_detect()" class="anchor"></a>[F] namespace_detect <small><span class="summary">ディレクトリ構造から名前空間を推測して返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/namespace_detect.php#L8-L74" target="_blank">namespace_detect.php#8~74</a></p>
</div>
<details>
<summary class="">ディレクトリ構造から名前空間を推測して返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function namespace_detect(string $location): string</div></pre>
<div class="description">
<p>指定パスに名前空間を持つような php ファイルが有るならその名前空間を返す。<span class="implicit-br">
</span>指定パスに名前空間を持つような php ファイルが無いなら親をたどる。<span class="implicit-br">
</span>親に名前空間を持つような php ファイルが有るならその名前空間＋ローカルパスを返す。</p>
<p>言葉で表すとややこしいが、「そのパスに配置しても違和感の無い名前空間」を返してくれるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// Example 用としてこのパッケージの Transporter を使用してみる
$dirname = dirname(class_loader()-&gt;findFile(\ryunosuke\Functions\Transporter::class));
// "$dirname/Hoge" の名前空間を推測して返す
that(namespace_detect("$dirname/Hoge"))-&gt;isSame("ryunosuke\\Functions\\Hoge");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$location</code></td>
<td>​<span class="summary">配置パス。ファイル名を与えるとそのファイルを配置すべきクラス名を返す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">名前空間</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f9a6b101661260a15bd8a8849b2a899e6b53eda6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-object_dive()" class="anchor"></a>[F] object_dive <small><span class="summary">パス形式でプロパティ値を取得</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/object_dive.php#L7-L45" target="_blank">object_dive.php#7~45</a></p>
</div>
<details>
<summary class="">パス形式でプロパティ値を取得</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function object_dive(
    object $object,
    string|array $path,
    mixed $default = null,
    string $delimiter = "."
): mixed</div></pre>
<div class="description">
<p>存在しない場合は $default を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$class = (object) [
    'a' =&gt; (object) [
        'b' =&gt; (object) [
            'c' =&gt; 'vvv'
        ]
    ]
];
that(object_dive($class, 'a.b.c'))-&gt;isSame('vvv');
that(object_dive($class, 'a.b.x', 9))-&gt;isSame(9);
// 配列を与えても良い。その場合 $delimiter 引数は意味をなさない
that(object_dive($class, ['a', 'b', 'c']))-&gt;isSame('vvv');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​object</td>
<td>​<code>$object</code></td>
<td>​<span class="summary">調べるオブジェクト</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$path</code></td>
<td>​<span class="summary">パス文字列。配列も与えられる</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">無かった場合のデフォルト値</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$delimiter = "."</code></td>
<td>​<span class="summary">パスの区切り文字。大抵は '.' か '/'</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">パスが示すプロパティ値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_92d2193c77ef94929413b501c3395dea86c5f55d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-object_id()" class="anchor"></a>[F] object_id <small><span class="summary">重複しない spl_object_id</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/object_id.php#L7-L80" target="_blank">object_id.php#7~80</a></p>
</div>
<details>
<summary class="">重複しない spl_object_id</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function object_id(null|object|int $objectOrId): null|int|object</div></pre>
<div class="description">
<p>内部でオブジェクト自体は保持しない。<span class="implicit-br">
</span>つまり、そのオブジェクトは GC の対象になる。</p>
<p>オブジェクトを与えると一意な整数を返す。<span class="implicit-br">
</span>内部で連番を保持するので PHP_INT_MAX まで生成できる。<span class="implicit-br">
</span>PHP_INT_MAX を超えた場合の挙動は未定義（まぁまずありえないだろう）。<span class="implicit-br">
</span>null は特別扱いとして必ず 0 を返す。</p>
<p>逆に整数を与えると対応したオブジェクトを返す。<span class="implicit-br">
</span>設定していないか既に GC されている場合は null を返す。<span class="implicit-br">
</span>0 は特別扱いとして必ず null を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// spl_object_id は容易に重複するが・・・
that(spl_object_id(new \stdClass()) === spl_object_id(new \stdClass()))-&gt;isTrue();
// この object_id 関数は重複しない
that(object_id(new \stdClass()) === object_id(new \stdClass()))-&gt;isFalse();

$o = new \stdClass();
// オブジェクトを与えると固有IDを返す
that($id = object_id($o))-&gt;isInt();
// そのIDを与えると元のオブジェクトが得られる
that($o === object_id($id))-&gt;isTrue();
// 参照を握っているわけではないので GC されていると null を返す
unset($o);
that(null === object_id($id))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​null|​object|​int</td>
<td>​<code>$objectOrId</code></td>
<td>​<span class="summary">対象オブジェクト or オブジェクトID</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​null|​int|​object</td>
<td>​<span class="summary">オブジェクトID or 対象オブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f0b05dbdc5d379e0bd54fb3dccab30f8c67391a4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-object_properties()" class="anchor"></a>[F] object_properties <small><span class="summary">オブジェクトのプロパティを可視・不可視を問わず取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/object_properties.php#L7-L82" target="_blank">object_properties.php#7~82</a></p>
</div>
<details>
<summary class="">オブジェクトのプロパティを可視・不可視を問わず取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function object_properties(
    object $object,
    array &amp;$privates = []
): array</div></pre>
<div class="description">
<p>get_object_vars + no public プロパティを返すイメージ。<span class="implicit-br">
</span>クロージャだけは特別扱いで this + use 変数を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$object = new #[\AllowDynamicProperties] class('something', 42) extends \Exception{};
$object-&gt;oreore = 'oreore';

// get_object_vars はそのスコープから見えないプロパティを取得できない
// var_dump(get_object_vars($object));

// array キャストは全て得られるが null 文字を含むので扱いにくい
// var_dump((array) $object);

// この関数を使えば不可視プロパティも取得できる
that(object_properties($object))-&gt;subsetEquals([
    'message' =&gt; 'something',
    'code'    =&gt; 42,
    'oreore'  =&gt; 'oreore',
]);

// クロージャは this と use 変数を返す
that(object_properties(fn() =&gt; $object))-&gt;is([
    'this'   =&gt; $this,
    'object' =&gt; $object,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​object</td>
<td>​<code>$object</code></td>
<td>​<span class="summary">オブジェクト</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$privates = []</code></td>
<td>​<span class="summary">継承ツリー上の private が格納される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">全プロパティの配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_320cc8882133052eb656fe5ecc956de0ad616295-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-object_storage()" class="anchor"></a>[F] object_storage <small><span class="summary">オブジェクトに付加データを付与する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/object_storage.php#L9-L169" target="_blank">object_storage.php#9~169</a></p>
</div>
<details>
<summary class="">オブジェクトに付加データを付与する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function object_storage(string $namespace = "global"): ObjectStorage|object</div></pre>
<div class="description">
<p>実質的に WeakMap と同じ。<span class="implicit-br">
</span>ただし php 内部では本来オブジェクトであるべきものもリソースとして扱われる（curl とか）ので統一のためにリソースも扱える。</p>
<p>典型的な利用法として「クロージャに値を持たせたい」がある。<span class="implicit-br">
</span>クロージャに限らず、大抵の内部オブジェクトは動的プロパティを生やせないので、値の保持がめんどくさい。<span class="implicit-br">
</span>（spl_object_id は重複するので使えないし、下手に実装すると参照が握られて GC されない羽目になる）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$storage = object_storage('test');
$closure = fn() =&gt; 123;
$resource = tmpfile();

// このように set すると・・・
$storage-&gt;set($closure, 'attached data1');
// get で取り出せる
that($storage-&gt;get($closure))-&gt;isSame('attached data1');
// リソースも扱える
$storage-&gt;set($resource, 'attached data2');
that($storage-&gt;get($resource))-&gt;isSame('attached data2');

// 名前空間が同じならインスタンスをまたいで取得できる
$storage2 = object_storage('test');
that($storage2-&gt;get($closure))-&gt;isSame('attached data1');

// オブジェクトが死ぬと同時に消える
unset($closure);
that($storage2-&gt;count())-&gt;isSame(1);
// リソースの場合は close でも消える
fclose($resource);
that($storage2-&gt;count())-&gt;isSame(0);
that($storage2-&gt;get($resource))-&gt;is(null);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$namespace = "global"</code></td>
<td>​<span class="summary">名前空間</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ObjectStorage">ObjectStorage</a>|​object</td>
<td>​<span class="summary">ストレージオブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_26c51b04ce86edf0c33dad2467078eeaa0ab721c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-register_autoload_function()" class="anchor"></a>[F] register_autoload_function <small><span class="summary">オートロード前後にコールバックする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/register_autoload_function.php#L9-L87" target="_blank">register_autoload_function.php#9~87</a></p>
</div>
<details>
<summary class="">オートロード前後にコールバックする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function register_autoload_function(
    ?callable $before = null,
    ?callable $after = null
): object</div></pre>
<div class="description">
<p>before を使って「クラスを読み込み前に動的に書き換える」のようなことが可能になる。<span class="implicit-br">
</span>after を使って「<code>__initialize</code> を呼ぶ」のような規約を定めればスタティックイニシャライザのようなことが可能になる。</p>
<p>prepend なオートローダで実装してあるので、その後のさらに prepend されたようなオートローダでの読み込みは感知できない。<span class="implicit-br">
</span>もちろんロード済みクラスも感知できない。</p>
<p>before 内で無条件にクラスを呼ぶと無限ループになるので注意（オートローダが呼ばれて before が呼ばれてオートローダが呼ばれて before が呼ばれて・・・）。</p>
<p>ローダーオブジェクトを返すが特に意味はなく、使うべきではない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?callable</td>
<td>​<code>$before = null</code></td>
<td>​<span class="summary">読み込み前コールバック</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$after = null</code></td>
<td>​<span class="summary">読み込み後コールバック</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​object</td>
<td>​<span class="summary">ローダーオブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_173a3d3216828cfa5f7dc6e2b9ef9b84d5d89c37-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-stdclass()" class="anchor"></a>[F] stdclass <small><span class="summary">stdClass を生成して返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/stdclass.php#L7-L30" target="_blank">stdclass.php#7~30</a></p>
</div>
<details>
<summary class="">stdClass を生成して返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function stdclass(mixed ...$fields): \stdClass</div></pre>
<div class="description">
<p>object キャストとほとんど同じだが、名前付き可変引数を採用しているので JSON ライクに宣言することができる。<span class="implicit-br">
</span>その代わり数値キー等の php の識別子として不正なキーを生やすことはできない。<span class="implicit-br">
</span>（厳密に言えば名前付き引数を使わなければ数値キーは生成できるが…そんなことをするなら普通に object キャストをすればよい）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 名前付き可変引数でコールできる
that(stdclass(a: 1, b: 2))-&gt;isInstanceOf(\stdClass::class);
// iterable も渡せる（この場合は実質的に object キャストと同義）
that(stdclass(...['a' =&gt; 1, 'b' =&gt; 2]))-&gt;isInstanceOf(\stdClass::class);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$fields</code></td>
<td>​<span class="summary">メンバー配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/reserved.classes.php" target="_blank">stdClass</a></td>
<td>​<span class="summary">stdClass</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ee13659e616c9d01724e6bf3b21e58e8341e025e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-type_exists()" class="anchor"></a>[F] type_exists <small><span class="summary">型が存在するか返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/classobj/type_exists.php#L7-L44" target="_blank">type_exists.php#7~44</a></p>
</div>
<details>
<summary class="">型が存在するか返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function type_exists(
    string $typename,
    bool $autoload = true
): bool</div></pre>
<div class="description">
<p>class/interface/trait/enum exists の合せ技。<span class="implicit-br">
</span>trait/enum のように今後型的なものがさらに増えるかもしれないし、class_exists だけして interface/trait が抜けているコードを何度も見てきた。<span class="implicit-br">
</span>それを一元管理するような関数となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(class_exists(\Throwable::class))-&gt;isFalse();     // class_exists は class にしか反応しない
that(interface_exists(\Exception::class))-&gt;isFalse(); // interface_exists は interface にしか反応しない
that(trait_exists(\Error::class))-&gt;isFalse();         // trait_exists は trait にしか反応しない
// type_exists であれば全てに反応する
that(type_exists(\Throwable::class))-&gt;isTrue();
that(type_exists(\Exception::class))-&gt;isTrue();
that(type_exists(\Error::class))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$typename</code></td>
<td>​<span class="summary">調べる型名</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$autoload = true</code></td>
<td>​<span class="summary">オートロードを行うか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">型が存在するなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4de48d4388c4d819d0c9fb742924cde2f72c2155-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-database" class="anchor"></a>[N] ryunosuke\Functions\Package\database\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-3" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-database--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_9df2dc7d2184e9198c5a51cea0d4aed8bf12f759-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-sql_bind()" class="anchor"></a>[F] sql_bind <small><span class="summary">ものすごく雑に SQL に値を埋め込む</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/database/sql_bind.php#L10-L52" target="_blank">sql_bind.php#10~52</a></p>
</div>
<details>
<summary class="">ものすごく雑に SQL に値を埋め込む</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function sql_bind(
    string $sql,
    array|mixed $values,
    ?callable $quote = null
): mixed</div></pre>
<div class="description">
<p>非常に荒くアドホックに実装しているのでこの関数で得られた SQL を<strong>実際に実行してはならない</strong>。<span class="implicit-br">
</span>あくまでログ出力やデバッグ用途で視認性を高める目的である。</p>
<p>プレースホルダは ? か :alnum で混在していても良い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(sql_bind('select ?', 1))-&gt;isSame("select 1");
that(sql_bind('select :hoge', ['hoge' =&gt; 'hoge']))-&gt;isSame("select 'hoge'");
that(sql_bind('select ?, :hoge', [1, 'hoge' =&gt; 'hoge']))-&gt;isSame("select 1, 'hoge'");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$sql</code></td>
<td>​<span class="summary">値を埋め込む SQL</span></td>
</tr>
<tr>
<td>​array|​mixed</td>
<td>​<code>$values</code></td>
<td>​<span class="summary">埋め込む値</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$quote = null</code></td>
<td>​<span class="summary">値をクォートするクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">値が埋め込まれた SQL</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_54219aabfbe99edbbdc539071645e258656a3a2a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-sql_format()" class="anchor"></a>[F] sql_format <small><span class="summary">ものすごく雑に SQL を整形する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/database/sql_format.php#L9-L1122" target="_blank">sql_format.php#9~1122</a></p>
</div>
<details>
<summary class="">ものすごく雑に SQL を整形する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function sql_format(
    string $sql,
    array $options = []
): string</div></pre>
<div class="description">
<p>非常に荒くアドホックに実装しているのでこの関数で得られた SQL を<strong>実際に実行してはならない</strong>。<span class="implicit-br">
</span>あくまでログ出力やデバッグ用途で視認性を高める目的である。</p>
<p>JOIN 句は FROM 句とみなさず、別句として処理する。<span class="implicit-br">
</span>AND と &amp;&amp; は微妙に処理が異なる。 AND は改行されるが &amp;&amp; は改行されない（OR と || も同様）。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$sql</code></td>
<td>​<span class="summary">整形する SQL</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">整形オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">整形された SQL</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b86d2501243e0ae4277cbdf0a101149b9a0fd5b4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-sql_quote()" class="anchor"></a>[F] sql_quote <small><span class="summary">ものすごく雑に値をクオートする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/database/sql_quote.php#L9-L51" target="_blank">sql_quote.php#9~51</a></p>
</div>
<details>
<summary class="">ものすごく雑に値をクオートする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function sql_quote(mixed $value): mixed</div></pre>
<div class="description">
<p>非常に荒くアドホックに実装しているのでこの関数で得られた値で<strong>実際に実行してはならない</strong>。<span class="implicit-br">
</span>あくまでログ出力やデバッグ用途で視認性を高める目的である。</p>
<ul class=" simple">
<li>null は NULL になる</li>
<li>数字はそのまま数字になる</li>
<li>bool は 0 or 1 になる</li>
<li>配列は再帰的にカンマ区切りになる<ul class=" simple">
<li>この実装はエラー回避の意味合いが強く、実装は変更される可能性がある</li>
</ul>
</li>
<li>それ以外は addcslashes される</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(sql_quote(null))-&gt;isSame('NULL');
that(sql_quote(123))-&gt;isSame(123);
that(sql_quote(true))-&gt;isSame(1);
that(sql_quote("hoge"))-&gt;isSame("'hoge'");
that(sql_quote([1, 2, 3]))-&gt;isSame("1,2,3");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">クオートする値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">クオートされた値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1093c750d598f02cfba862e72e85a3860c9aaf68-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-dataformat" class="anchor"></a>[N] ryunosuke\Functions\Package\dataformat\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-4" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-dataformat--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_c9dada1d5db72c7737abde69c3d6f9460bfc0ce7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-css_selector()" class="anchor"></a>[F] css_selector <small><span class="summary">CSS セレクタ文字をパースして配列で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/css_selector.php#L7-L154" target="_blank">css_selector.php#7~154</a></p>
</div>
<details>
<summary class="">CSS セレクタ文字をパースして配列で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function css_selector(string $selector): array</div></pre>
<div class="description">
<p>包含などではない属性セレクタを与えると属性として認識する。<span class="implicit-br">
</span>独自仕様として・・・</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>[!attr]</dt>
<dd>否定属性として false を返す</dd>
</div>
<div class="dtdd-container">
<dt><span class="badge " data-badge-title="">styles</span></dt>
<dd>style 属性とみなす</dd>
</div>
</dl>
<p>がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(css_selector('#hoge.c1.c2[name=hoge\[\]][href="http://hoge"][hidden][!readonly]{width:123px;height:456px}'))-&gt;is([
    'id'       =&gt; 'hoge',
    'class'    =&gt; ['c1', 'c2'],
    'name'     =&gt; 'hoge[]',
    'href'     =&gt; 'http://hoge',
    'hidden'   =&gt; true,
    'readonly' =&gt; false,
    'style'    =&gt; [
        'width'  =&gt; '123px',
        'height' =&gt; '456px',
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$selector</code></td>
<td>​<span class="summary">CSS セレクタ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">属性配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_54e954fdd6c39e241c01a595b3bea9001fd4a783-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-csv_export()" class="anchor"></a>[F] csv_export <small><span class="summary">連想配列の配列を CSV 的文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/csv_export.php#L14-L211" target="_blank">csv_export.php#14~211</a></p>
</div>
<details>
<summary class="">連想配列の配列を CSV 的文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function csv_export(
    iterable $csvarrays,
    array $options = []
): string|int</div></pre>
<div class="description">
<p>CSV ヘッダ行は全連想配列のキーの共通項となる。<span class="implicit-br">
</span>順番には依存しないが、余計な要素があってもそのキーはヘッダには追加されないし、データ行にも含まれない。<span class="implicit-br">
</span>ただし、オプションで headers が与えられた場合はそれを使用する。<span class="implicit-br">
</span>この headers オプションに連想配列を与えるとヘッダ文字列変換になる（[key =&gt; header] で「key を header で吐き出し」となる）。<span class="implicit-br">
</span>数値配列を与えると単純に順序指定での出力指定になるが、ヘッダ行が出力されなくなる。</p>
<p>callback オプションが渡された場合は「あらゆる処理の最初」にコールされる。<span class="implicit-br">
</span>つまりヘッダの読み換えや文字エンコーディングの変換が行われる前の状態でコールされる。<span class="implicit-br">
</span>また、 false を返すとその要素はスルーされる。</p>
<p>output オプションにリソースを渡すとそこに対して書き込みが行われる（fclose はされない）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルな実行例
$csvarrays = [
    ['a' =&gt; 'A1', 'b' =&gt; 'B1', 'c' =&gt; 'C1'],             // 普通の行
    ['c' =&gt; 'C2', 'a' =&gt; 'A2', 'b' =&gt; 'B2'],             // 順番が入れ替わっている行
    ['c' =&gt; 'C3', 'a' =&gt; 'A3', 'b' =&gt; 'B3', 'x' =&gt; 'X'], // 余計な要素が入っている行
];
that(csv_export($csvarrays))-&gt;is("a,b,c
A1,B1,C1
A2,B2,C2
A3,B3,C3
");

// ヘッダを指定できる
that(csv_export($csvarrays, [
    'headers' =&gt; ['a' =&gt; 'A', 'c' =&gt; 'C'], // a と c だけを出力＋ヘッダ文字変更
]))-&gt;is("A,C
A1,C1
A2,C2
A3,C3
");

// ヘッダ行を出さない
that(csv_export($csvarrays, [
    'headers' =&gt; ['a', 'c'], // a と c だけを出力＋ヘッダ行なし
]))-&gt;is("A1,C1
A2,C2
A3,C3
");

// structure:true で配列も扱える
that(csv_export([
    ['scalar' =&gt; '123', 'list' =&gt; ['list11', 'list12'], 'hash' =&gt; ['a' =&gt; 'hash1A', 'b' =&gt; 'hash1B']],
    ['scalar' =&gt; '456', 'list' =&gt; ['list21', 'list22'], 'hash' =&gt; ['a' =&gt; 'hash2A', 'b' =&gt; 'hash2B']],
], [
    'structure' =&gt; true,
]))-&gt;is("scalar,list[],list[],hash[a],hash[b]
123,list11,list12,hash1A,hash1B
456,list21,list22,hash2A,hash2B
");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$csvarrays</code></td>
<td>​<span class="summary">連想配列の配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列。fputcsv の第3引数以降もここで指定する</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int</td>
<td>​<span class="summary">CSV 的文字列。output オプションを渡した場合は書き込みバイト数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e184bedafb768fe76b0cd4a599a3e30f15f57049-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-csv_import()" class="anchor"></a>[F] csv_import <small><span class="summary">CSV 的文字列を連想配列の配列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/csv_import.php#L13-L224" target="_blank">csv_import.php#13~224</a></p>
</div>
<details>
<summary class="">CSV 的文字列を連想配列の配列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function csv_import(
    string|resource $csvstring,
    array $options = []
): array</div></pre>
<div class="description">
<p>1行目をヘッダ文字列とみなしてそれをキーとした連想配列の配列を返す。<span class="implicit-br">
</span>ただし、オプションで headers が与えられた場合はそれを使用する。<span class="implicit-br">
</span>この headers オプションはヘッダフィルタも兼ねる（[n =&gt; header] で「n 番目フィールドを header で取り込み」となる）。<span class="implicit-br">
</span>入力にヘッダがありかつ headers に連想配列が渡された場合はフィルタ兼読み換えとなる（Example を参照）。</p>
<p>structure オプションが渡された場合は query like なヘッダーで配列になる。</p>
<p>callback オプションが渡された場合は「あらゆる処理の最後」にコールされる。<span class="implicit-br">
</span>つまりヘッダの読み換えや文字エンコーディングの変換が行われた後の状態でコールされる。<span class="implicit-br">
</span>また、 false を返すとその要素はスルーされる。</p>
<p>メモリ効率は意識しない（どうせ配列を返すので意識しても無駄）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルな実行例
that(csv_import("
a,b,c
A1,B1,C1
A2,B2,C2
A3,B3,C3
"))-&gt;is([
    ['a' =&gt; 'A1', 'b' =&gt; 'B1', 'c' =&gt; 'C1'],
    ['a' =&gt; 'A2', 'b' =&gt; 'B2', 'c' =&gt; 'C2'],
    ['a' =&gt; 'A3', 'b' =&gt; 'B3', 'c' =&gt; 'C3'],
]);

// ヘッダを指定できる
that(csv_import("
A1,B1,C1
A2,B2,C2
A3,B3,C3
", [
    'headers' =&gt; [0 =&gt; 'a', 2 =&gt; 'c'], // 1がないので1番目のフィールドを読み飛ばしつつ、0, 2 は "a", "c" として取り込む
]))-&gt;is([
    ['a' =&gt; 'A1', 'c' =&gt; 'C1'],
    ['a' =&gt; 'A2', 'c' =&gt; 'C2'],
    ['a' =&gt; 'A3', 'c' =&gt; 'C3'],
]);

// ヘッダありで連想配列で指定するとキーの読み換えとなる（指定しなければ読み飛ばしも行える）
that(csv_import("
a,b,c
A1,B1,C1
A2,B2,C2
A3,B3,C3
", [
    'headers' =&gt; ['a' =&gt; 'hoge', 'c' =&gt; 'piyo'], // a は hoge, c は piyo で読み込む。 b は指定がないので飛ばされる
]))-&gt;is([
    ['hoge' =&gt; 'A1', 'piyo' =&gt; 'C1'],
    ['hoge' =&gt; 'A2', 'piyo' =&gt; 'C2'],
    ['hoge' =&gt; 'A3', 'piyo' =&gt; 'C3'],
]);

// structure:true で配列も扱える
that(csv_import("
scalar,list[],list[],hash[a],hash[b]
123,list11,list12,hash1A,hash1B
456,list21,list22,hash2A,hash2B
", [
    'structure' =&gt; true,
]))-&gt;is([
    ['scalar' =&gt; '123', 'list' =&gt; ['list11', 'list12'], 'hash' =&gt; ['a' =&gt; 'hash1A', 'b' =&gt; 'hash1B']],
    ['scalar' =&gt; '456', 'list' =&gt; ['list21', 'list22'], 'hash' =&gt; ['a' =&gt; 'hash2A', 'b' =&gt; 'hash2B']],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​resource</td>
<td>​<code>$csvstring</code></td>
<td>​<span class="summary">CSV 的文字列。ファイルポインタでも良いが終了後に必ず閉じられる</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列。fgetcsv の第3引数以降もここで指定する</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">連想配列の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_424bb8950e2cced13f16d18969c1c7df549a9e79-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-html_attr()" class="anchor"></a>[F] html_attr <small><span class="summary">配列を html の属性文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/html_attr.php#L8-L218" target="_blank">html_attr.php#8~218</a></p>
</div>
<details>
<summary class="">配列を html の属性文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function html_attr(
    iterable $array,
    string|array|null $options = []
): string|array</div></pre>
<div class="description">
<p>data-* や style, 論理属性など、全てよしなに変換して文字列で返す。<span class="implicit-br">
</span>返り値の文字列はエスケープが施されており、基本的にはそのまま html に埋め込んで良い。<span class="implicit-br">
</span>（オプション次第では危険だったり乱れたりすることはある）。</p>
<p>separator オプションを指定すると属性の区切り文字を指定できる。<span class="implicit-br">
</span>大抵の場合は半角スペースであり、少し特殊な場合に改行文字を指定するくらいだろう。<span class="implicit-br">
</span>ただし、この separator に null を与えると文字列ではなく生の配列で返す。<span class="implicit-br">
</span>この配列は <code>属性名 =&gt; 属性値</code> な生の配列であり、エスケープも施されていない。<span class="implicit-br">
</span>$options 自体に文字列を与えた場合は separator 指定とみなされる。</p>
<p>属性の変換ルールは下記。</p>
<ul class=" simple">
<li>属性名が数値の場合は属性としては生成されない</li>
<li>属性名は camelCase -&gt; cahin-case の変換が行われる</li>
<li>値が null の場合は無条件で無視される<ul class=" simple">
<li>下記 false との違いは「配列返しの場合に渡ってくるか？」である（null は無条件フィルタなので配列返しでも渡ってこない）</li>
</ul>
</li>
<li>値が true の場合は論理属性とみなし値なしで生成される</li>
<li>値が false の場合は論理属性とみなし、 属性としては生成されない</li>
<li>値が配列の場合は ","（カンマ）で結合される<ul class=" simple">
<li>これは観測範囲内でカンマ区切りが多いため（srcset, accept など）。属性によってはカンマが適切ではない場合がある</li>
<li>更にその配列が文字キーを持つ場合、キーが "=" で結合される<ul class=" simple">
<li>これは観測範囲内で = 区切りが多いため（viewport など）。属性によっては = が適切ではない場合がある</li>
</ul>
</li>
</ul>
</li>
<li>値が配列で属性名が class, style, data の場合は下記の特殊な挙動を示す<dl class="docutils field-list">
<div class="dtdd-container">
<dt>class</dt>
<dd>半角スペースで結合される<ul class=" simple">
<li>キーは無視される</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>style</dt>
<dd>キーが css 名、値が css 値として ";" で結合される<ul class=" simple">
<li>キーは cahin-case に変換される</li>
<li>キーが数値の場合は値がそのまま追加される</li>
<li>値が配列の場合は半角スペースで結合される</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>data-</dt>
<dd>キーが data 名、値が data 値として data 属性になる<ul class=" simple">
<li>キーは cahin-case に変換される</li>
<li>値が真偽値以外のスカラーの場合はそのまま、非スカラー||真偽値の場合は json で埋め込まれる<ul class=" simple">
<li>これは jQuery において json をよしなに扱うことができるため</li>
</ul>
</li>
</ul>
</dd>
</div>
</dl>
</li>
</ul>
<p>※ 上記における「配列」とは iterable を指すが、toString を実装した iterable なオブジェクトは toString が優先され、文字列とみなされる</p>
<p>複雑に見えるが「よしなに」やってくれると考えて良い。<span class="implicit-br">
</span>配列や真偽値で分岐が大量にあるが、大前提として「string だった場合は余計なことはしない」がある。<span class="implicit-br">
</span>ので迷ったり予期しない結果の場合は呼び出し側で文字列化して呼べば良い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(html_attr([
    // camelCase は camel-case になる
    'camelCase' =&gt; '&lt;value&gt;',
    // true は論理属性 true とみなし、値なし属性になる
    'checked'   =&gt; true,
    // false は論理属性 false とみなし、属性として現れない
    'disabled'  =&gt; false,
    // null は無条件で無視され、属性として現れない
    'readonly'  =&gt; null,
    // 配列はカンマで結合される
    'srcset'    =&gt; [
        'hoge.jpg 1x',
        'fuga.jpg 2x',
    ],
    // 連想配列は = で結合される
    'content'   =&gt; [
        'width' =&gt; 'device-width',
        'scale' =&gt; '1.0',
    ],
    // class はスペースで結合される
    'class'     =&gt; ['hoge', 'fuga'],
    // style 原則的に proerty:value; とみなす
    'style'     =&gt; [
        'color'           =&gt; 'red',
        'backgroundColor' =&gt; 'white',      // camel-case になる
        'margin'          =&gt; [1, 2, 3, 4], // スペースで結合される
        'opacity:0.5',                     // 直値はそのまま追加される
    ],
    // data- はその分属性が生える
    'data-'     =&gt; [
        'camelCase' =&gt; 123,
        'hoge'      =&gt; false,        // 真偽値は文字列として埋め込まれる
        'fuga'      =&gt; "fuga",       // 文字列はそのまま文字列
        'piyo'      =&gt; ['a' =&gt; 'A'], // 非スカラー以外は json になる
    ],
], ['separator' =&gt; "\n"]))-&gt;is('camel-case="&amp;lt;value&amp;gt;"
checked
srcset="hoge.jpg 1x,fuga.jpg 2x"
content="width=device-width,scale=1.0"
class="hoge fuga"
style="color:red;background-color:white;margin:1 2 3 4;opacity:0.5"
data-camel-case="123"
data-hoge="false"
data-fuga="fuga"
data-piyo="{&amp;quot;a&amp;quot;:&amp;quot;A&amp;quot;}"');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">属性配列</span></td>
</tr>
<tr>
<td>​string|​array|​null</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<span class="summary">属性文字列 or 属性配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_245e8fe8cc3b21b1e585dd1d2bfc9a20daa81154-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-html_strip()" class="anchor"></a>[F] html_strip <small><span class="summary">html の空白類を除去して minify する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/html_strip.php#L9-L132" target="_blank">html_strip.php#9~132</a></p>
</div>
<details>
<summary class="">html の空白類を除去して minify する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function html_strip(
    string $html,
    array $options = []
): string</div></pre>
<div class="description">
<p>文字列的ではなく DOM 的に行うのでおかしな部分 html を食わせると意図しない結果になる可能性がある。<span class="implicit-br">
</span>その副作用として属性のクオートやタグ内空白は全て正規化される。</p>
<p>html コメントも削除される。<span class="implicit-br">
</span>また、空白が意味を持つタグ（textarea, pre）は対象にならない。<span class="implicit-br">
</span>さらに、php を含むような html （テンプレート）の php タグは一切の対象外となる。</p>
<p>これらの挙動の一部はオプションで指定が可能。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// e.g. id が " でクオートされている
// e.g. class のクオートが " になっている
// e.g. タグ内空白（id, class の間隔等）がスペース1つになっている
// e.g. php タグは一切変更されていない
// e.g. textarea は保持されている
that(html_strip("&lt;span  id=id  class='c1  c2  c3'&gt;&lt;?= '&lt;hoge&gt;  &lt;/hoge&gt;' ?&gt; a  b  c &lt;/span&gt; &lt;pre&gt; a  b  c &lt;/pre&gt;"))-&gt;isSame('&lt;span id="id" class="c1  c2  c3"&gt;&lt;?= \'&lt;hoge&gt;  &lt;/hoge&gt;\' ?&gt; a b c &lt;/span&gt;&lt;pre&gt; a  b  c &lt;/pre&gt;');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$html</code></td>
<td>​<span class="summary">html 文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">空白除去された html 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d5d02aa1e41fa6227a33a8ce974c2ea026cfebef-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-html_tag()" class="anchor"></a>[F] html_tag <small><span class="summary">css セレクタから html 文字列を生成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/html_tag.php#L11-L110" target="_blank">html_tag.php#11~110</a></p>
</div>
<details>
<summary class="">css セレクタから html 文字列を生成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function html_tag(string|array $selector): string</div></pre>
<div class="description">
<p><code>tag#id.class[attr=value]</code> のような css セレクタから <code>&lt;tag id="id" class="class" attr="value"&gt;&lt;/tag&gt;</code> のような html 文字列を返す。<span class="implicit-br">
</span>配列を与えるとキーがセレクタ、値がコンテント文字列になる。<span class="implicit-br">
</span>さらに値が配列だと再帰して生成する。</p>
<p>値や属性は適切に htmlspecialchars される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 単純文字列はただのタグを生成する
that(
    html_tag('a#hoge.c1.c2[name=hoge\[\]][href="http://hoge"][hidden]'))
    -&gt;isSame('&lt;a id="hoge" class="c1 c2" name="hoge[]" href="http://hoge" hidden&gt;&lt;/a&gt;'
);
// ペア配列を与えるとコンテント文字列になる
that(
    html_tag(['a.c1#hoge.c2[name=hoge\[\]][href="http://hoge"][hidden]' =&gt; "this is text's content"]))
    -&gt;isSame('&lt;a id="hoge" class="c1 c2" name="hoge[]" href="http://hoge" hidden&gt;this is text&amp;#039;s content&lt;/a&gt;'
);
// ネストした配列を与えると再帰される
that(
    html_tag([
        'div#wrapper' =&gt; [
            'b.class1' =&gt; [
                '&lt;plain&gt;',
            ],
            'b.class2' =&gt; [
                '&lt;plain1&gt;',
                's' =&gt; '&lt;strike&gt;',
                '&lt;plain2&gt;',
            ],
        ],
    ]))
    -&gt;isSame('&lt;div id="wrapper"&gt;&lt;b class="class1"&gt;&amp;lt;plain&amp;gt;&lt;/b&gt;&lt;b class="class2"&gt;&amp;lt;plain1&amp;gt;&lt;s&gt;&amp;lt;strike&amp;gt;&lt;/s&gt;&amp;lt;plain2&amp;gt;&lt;/b&gt;&lt;/div&gt;'
);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<code>$selector</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">html 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_53be715afc2345c725169a25c5ca7de692f32ed8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ini_export()" class="anchor"></a>[F] ini_export <small><span class="summary">連想配列を INI 的文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/ini_export.php#L10-L53" target="_blank">ini_export.php#10~53</a></p>
</div>
<details>
<summary class="">連想配列を INI 的文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ini_export(
    array $iniarray,
    array $options = []
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(ini_export(['a' =&gt; 1, 'b' =&gt; 'B', 'c' =&gt; PHP_SAPI]))-&gt;is('a = 1
b = "B"
c = "cli"
');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$iniarray</code></td>
<td>​<span class="summary">ini 化する配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">ini 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_878ab063977b7f9dbf63e149fa2c445639a9d9ca-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ini_import()" class="anchor"></a>[F] ini_import <small><span class="summary">INI 的文字列を連想配列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/ini_import.php#L7-L33" target="_blank">ini_import.php#7~33</a></p>
</div>
<details>
<summary class="">INI 的文字列を連想配列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ini_import(
    string $inistring,
    array $options = []
): array</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(ini_import("
a = 1
b = 'B'
c = PHP_VERSION
"))-&gt;is(['a' =&gt; 1, 'b' =&gt; 'B', 'c' =&gt; PHP_VERSION]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$inistring</code></td>
<td>​<span class="summary">ini 文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0a934f09034e5c1afe0d7f89d851fb8d11417bbf-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-json_export()" class="anchor"></a>[F] json_export <small><span class="summary">json_encode のプロキシ関数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/json_export.php#L15-L224" target="_blank">json_export.php#15~224</a></p>
</div>
<details>
<summary class="">json_encode のプロキシ関数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function json_export(
    mixed $value,
    array $options = []
): string</div></pre>
<div class="description">
<p>引数体系とデフォルト値を変更してある。また、エラー時に例外が飛ぶ。</p>
<p>下記の拡張オプションがある。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>JSON_INLINE_LEVEL</dt>
<dd>PRETTY_PRINT 時に指定以上の階層をインライン化する（数値以外にパスで階層も指定できる）</dd>
</div>
<div class="dtdd-container">
<dt>JSON_INLINE_SCALARLIST</dt>
<dd>PRETTY_PRINT 時にスカラーのみのリストをインライン化する</dd>
</div>
<div class="dtdd-container">
<dt>JSON_INDENT</dt>
<dd>PRETTY_PRINT 時にインデント数・文字列を指定する</dd>
</div>
<div class="dtdd-container">
<dt>JSON_CLOSURE</dt>
<dd>任意のリテラルを埋め込む<ul class=" simple">
<li>クロージャの返り値がそのまま埋め込まれるので、文字列化可能な結果を返さなければならない</li>
</ul>
</dd>
</div>
</dl>
<p>JSON_ES5 を与えると JSON5 互換でエンコードされる。<span class="implicit-br">
</span>その際下記のプションも使用可能になる。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>JSON_TEMPLATE_LITERAL</dt>
<dd>改行を含む文字列をテンプレートリテラルで出力する</dd>
</div>
<div class="dtdd-container">
<dt>JSON_TRAILING_COMMA</dt>
<dd>末尾カンマを強制する</dd>
</div>
<div class="dtdd-container">
<dt>JSON_COMMENT_PREFIX</dt>
<dd>コメントとして埋め込まれるキープレフィックスを指定する<ul class=" simple">
<li>そのキーで始まる要素が文字列なら // コメントになる</li>
<li>そのキーで始まる要素が配列なら /* コメントになる</li>
</ul>
</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// オプションはこのように [定数 =&gt; bool] で渡す。false は指定されていないとみなされる（JSON_MAX_DEPTH 以外）
that(json_export(['a' =&gt; 'A', 'b' =&gt; 'B'], [
   JSON_PRETTY_PRINT =&gt; false,
]))-&gt;is('{"a":"A","b":"B"}');
// json5 でコメント付きかつ末尾カンマ強制モード
that(json_export(['a' =&gt; 'A', '#comment' =&gt; 'this is comment', 'b' =&gt; 'B'], [
   JSON_ES5            =&gt; true,
   JSON_TRAILING_COMMA =&gt; true,
   JSON_COMMENT_PREFIX =&gt; '#',
   JSON_PRETTY_PRINT   =&gt; true,
]))-&gt;is('{
    a: "A",
    // this is comment
    b: "B",
}');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">encode する値</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">JSON_*** をキーにした連想配列。 値が false は指定されていないとみなされる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">JSON 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6c01d1caad47dd0f7294556d9d815cbe893845db-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-json_import()" class="anchor"></a>[F] json_import <small><span class="summary">json_decode のプロキシ関数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/json_import.php#L14-L394" target="_blank">json_import.php#14~394</a></p>
</div>
<details>
<summary class="">json_decode のプロキシ関数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function json_import(
    string $value,
    array $options = []
): mixed</div></pre>
<div class="description">
<p>引数体系とデフォルト値を変更してある。</p>
<p>JSON_ES5 に null か true を渡すと json5 としてでデコードする（null はまず json_decode で試みる、true は json5 のみ）。<span class="implicit-br">
</span>その場合拡張オプションとして下記がある。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>JSON_INT_AS_STRING</dt>
<dd>常に整数を文字列で返す</dd>
</div>
<div class="dtdd-container">
<dt>JSON_FLOAT_AS_STRING</dt>
<dd>常に小数を文字列で返す</dd>
</div>
<div class="dtdd-container">
<dt>JSON_BARE_AS_STRING</dt>
<dd>bare string を文字列として扱う</dd>
</div>
<div class="dtdd-container">
<dt>JSON_TEMPLATE_LITERAL</dt>
<dd>テンプレートリテラルが使用可能になる<ul class=" simple">
<li>あくまで「文字列の括りに ` が使えるようになる」というものでテンプレートリテラルそのものではない</li>
<li>末尾のインデントと同じインデントがすべて除去され、前後の改行は取り除かれる</li>
</ul>
</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// オプションはこのように [定数 =&gt; bool] で渡す。false は指定されていないとみなされる（JSON_MAX_DEPTH 以外）
that(json_import('{"a":"A","b":"B"}', [
   JSON_OBJECT_AS_ARRAY =&gt; true,
]))-&gt;is(['a' =&gt; 'A', 'b' =&gt; 'B']);

// json5 が使える
that(json_import('{a: "A", b: "B", }'))-&gt;is(['a' =&gt; 'A', 'b' =&gt; 'B']);

// テンプレートリテラル
that(json_import('`
    1
    2
    3
    `', [
    JSON_TEMPLATE_LITERAL =&gt; true,
]))-&gt;is("1\n2\n3");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">JSON 文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">JSON_*** をキーにした連想配列。値が false は指定されていないとみなされる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">decode された値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f7df6f8fb2bb03d9a6c70a29c66fa8d0910e9749-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ltsv_export()" class="anchor"></a>[F] ltsv_export <small><span class="summary">配列を LTSV 的文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/ltsv_export.php#L8-L83" target="_blank">ltsv_export.php#8~83</a></p>
</div>
<details>
<summary class="">配列を LTSV 的文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ltsv_export(
    array $ltsvarray,
    array $options = []
): string</div></pre>
<div class="description">
<p>ラベル文字列に ":" を含む場合は例外を投げる（ラベルにコロンが来るとどうしようもない）。</p>
<p>escape オプションで「LTSV 的にまずい文字」がその文字でエスケープされる（具体的には "\n" と "\t"）。<span class="implicit-br">
</span>デフォルトでは "\" でエスケープされるので、整合性が崩れることはない。</p>
<p>encode オプションで「文字列化できない値」が来たときのその関数を通して出力される（その場合、目印として値の両サイドに ` が付く）。<span class="implicit-br">
</span>デフォルトでは json_encode される。</p>
<p>エンコード機能はおまけに過ぎない（大抵の場合はそんな機能は必要ない）。<span class="implicit-br">
</span>ので、この実装は互換性を維持せず変更される可能性がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルな実行例
that(ltsv_export([
    "label1" =&gt; "value1",
    "label2" =&gt; "value2",
]))-&gt;is("label1:value1  label2:value2");

// タブや改行文字のエスケープ
that(ltsv_export([
    "label1" =&gt; "val\tue1",
    "label2" =&gt; "val\nue2",
]))-&gt;is("label1:val\\tue1   label2:val\\nue2");

// 配列のエンコード
that(ltsv_export([
    "label1" =&gt; "value1",
    "label2" =&gt; [1, 2, 3],
]))-&gt;is("label1:value1  label2:`[1,2,3]`");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$ltsvarray</code></td>
<td>​<span class="summary">配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">LTSV 的文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_45cb280272e74f2ac3490112a921f20b5f7f3d82-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ltsv_import()" class="anchor"></a>[F] ltsv_import <small><span class="summary">LTSV 的文字列を配列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/ltsv_import.php#L8-L83" target="_blank">ltsv_import.php#8~83</a></p>
</div>
<details>
<summary class="">LTSV 的文字列を配列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ltsv_import(
    string $ltsvstring,
    array $options = []
): array</div></pre>
<div class="description">
<p>escape オプションで「LTSV 的にまずい文字」がその文字でエスケープされる（具体的には "\n" と "\t"）。<span class="implicit-br">
</span>デフォルトでは "\" でエスケープされるので、整合性が崩れることはない。</p>
<p>decode オプションで「`` で囲まれた値」が来たときのその関数を通して出力される。<span class="implicit-br">
</span>デフォルトでは json_decode される。</p>
<p>エンコード機能はおまけに過ぎない（大抵の場合はそんな機能は必要ない）。<span class="implicit-br">
</span>ので、この実装は互換性を維持せず変更される可能性がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルな実行例
that(ltsv_import("label1:value1 label2:value2"))-&gt;is([
    "label1" =&gt; "value1",
    "label2" =&gt; "value2",
]);

// タブや改行文字のエスケープ
that(ltsv_import("label1:val\\tue1  label2:val\\nue2"))-&gt;is([
    "label1" =&gt; "val\tue1",
    "label2" =&gt; "val\nue2",
]);

// 配列のデコード
that(ltsv_import("label1:value1 label2:`[1,2,3]`"))-&gt;is([
    "label1" =&gt; "value1",
    "label2" =&gt; [1, 2, 3],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$ltsvstring</code></td>
<td>​<span class="summary">LTSV 的文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5253151fe9248705a9845795f8c935d47d2b327b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-markdown_list()" class="anchor"></a>[F] markdown_list <small><span class="summary">配列を markdown リスト文字列にする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/markdown_list.php#L7-L82" target="_blank">markdown_list.php#7~82</a></p>
</div>
<details>
<summary class="">配列を markdown リスト文字列にする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function markdown_list(
    array $array,
    array $option = []
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 最初の "\n" に意味はない（ズレると見づらいので冒頭に足しているだけ）
that("\n" . markdown_list([
    'dict'        =&gt; [
        'Key1' =&gt; 'Value1',
        'Key2' =&gt; 'Value2',
    ],
    'list'        =&gt; ['Item1', 'Item2', 'Item3'],
    'dict &amp; list' =&gt; [
        'Key' =&gt; 'Value',
        ['Item1', 'Item2', 'Item3'],
    ],
], ['separator' =&gt; ':']))-&gt;is("
- dict:
    - Key1:Value1
    - Key2:Value2
- list:
    - Item1
    - Item2
    - Item3
- dict &amp; list:
    - Key:Value
        - Item1
        - Item2
        - Item3
");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$option = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">markdown リスト文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3b392006616d63c8337291d580a570b5de8c3a44-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-markdown_table()" class="anchor"></a>[F] markdown_table <small><span class="summary">連想配列の配列を markdown テーブル文字列にする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/markdown_table.php#L13-L117" target="_blank">markdown_table.php#13~117</a></p>
</div>
<details>
<summary class="">連想配列の配列を markdown テーブル文字列にする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function markdown_table(
    array $array,
    array $option = []
): string</div></pre>
<div class="description">
<p>見出しはキーの和集合で生成され、改行は <code>&lt;br&gt;</code> に置換される。<span class="implicit-br">
</span>要素が全て数値の場合は右寄せになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 最初の "\n" に意味はない（ズレると見づらいので冒頭に足しているだけ）
that("\n" . markdown_table([
   ['a' =&gt; 'a1', 'b' =&gt; 'b1'],
   ['b' =&gt; 'b2', 'c' =&gt; '2'],
   ['a' =&gt; 'a3', 'c' =&gt; '3'],
]))-&gt;is("
| a   | b   |   c |
| --- | --- | --: |
| a1  | b1  |     |
|     | b2  |   2 |
| a3  |     |   3 |
");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">連想配列の配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$option = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">markdown テーブル文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9c8e22cba170b903a5e39182d9c7b78762276ed2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-paml_export()" class="anchor"></a>[F] paml_export <small><span class="summary">連想配列を paml 的文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/paml_export.php#L9-L73" target="_blank">paml_export.php#9~73</a></p>
</div>
<details>
<summary class="">連想配列を paml 的文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function paml_export(
    array $pamlarray,
    array $options = []
): string</div></pre>
<div class="description">
<p>paml で出力することはまずないのでおまけ（import との対称性のために定義している）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(paml_export([
    'n' =&gt; null,
    'f' =&gt; false,
    'i' =&gt; 123,
    'd' =&gt; 3.14,
    's' =&gt; 'this is string',
]))-&gt;isSame('n: null, f: false, i: 123, d: 3.14, s: "this is string"');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$pamlarray</code></td>
<td>​<span class="summary">配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">PAML 的文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_37d2c46c4b468a9e1f4cd771d080820c5c0fe814-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-paml_import()" class="anchor"></a>[F] paml_import <small><span class="summary">paml 的文字列をパースする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/paml_import.php#L9-L168" target="_blank">paml_import.php#9~168</a></p>
</div>
<details>
<summary class="">paml 的文字列をパースする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function paml_import(
    string $pamlstring,
    array $options = []
): array</div></pre>
<div class="description">
<p>paml とは yaml を簡易化したような独自フォーマットを指す（Php Array Markup Language）。<span class="implicit-br">
</span>ざっくりと下記のような特徴がある。</p>
<ul class=" simple">
<li>ほとんど yaml と同じだがフロースタイルのみでキーコロンの後のスペースは不要</li>
<li>yaml のアンカーや複数ドキュメントのようなややこしい仕様はすべて未対応</li>
<li>配列を前提にしているので、トップレベルの <code>[]</code> <code>{}</code> は不要</li>
<li><code>[]</code> でいわゆる php の配列、 <code>{}</code> で stdClass を表す（オプション指定可能）</li>
<li>bare string で php の定数を表す（クラス定数も完全修飾すれば使用可能）</li>
</ul>
<p>簡易的な設定の注入に使える（yaml は標準で対応していないし、json や php 配列はクオートの必要やケツカンマ問題がある）。<span class="implicit-br">
</span>なお、かなり緩くパースしてるので基本的にエラーにはならない。</p>
<p>早見表：</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>php</dt>
<dd><code>["n" =&gt; null, "f" =&gt; false, "i" =&gt; 123, "d" =&gt; 3.14, "s" =&gt; "this is string", "a" =&gt; [1, 2, "x" =&gt; "X"]]</code><ul class=" simple">
<li>ダブルアローとキーのクオートが冗長</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>json</dt>
<dd><code>{"n":null, "f":false, "i":123, "d":3.14, "s":"this is string", "a":{"0": 1, "1": 2, "x": "X"}}</code><ul class=" simple">
<li>キーのクオートが冗長だしケツカンマ非許容</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>yaml</dt>
<dd><code>{n: null, f: false, i: 123, d: 3.14, s: "this is string", a: {0: 1, 1: 2, x: X}}</code><ul class=" simple">
<li>理想に近いが、コロンの後にスペースが必要だし連想配列が少々難。なにより拡張や外部ライブラリが必要</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>paml</dt>
<dd><code>n:null, f:false, i:123, d:3.14, s:"this is string", a:[1, 2, x:X]</code><ul class=" simple">
<li>シンプルイズベスト</li>
</ul>
</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// こういったスカラー型はほとんど yaml と一緒だが、コロンの後のスペースは不要（あってもよい）
that(paml_import('n:null, f:false, i:123, d:3.14, s:"this is string"'))-&gt;isSame([
    'n' =&gt; null,
    'f' =&gt; false,
    'i' =&gt; 123,
    'd' =&gt; 3.14,
    's' =&gt; 'this is string',
]);
// 配列が使える（キーは連番なら不要）。ネストも可能
that(paml_import('a:[1,2,x:X,3], nest:[a:[b:[c:[X]]]]'))-&gt;isSame([
    'a'    =&gt; [1, 2, 'x' =&gt; 'X', 3],
    'nest' =&gt; [
        'a' =&gt; [
            'b' =&gt; [
                'c' =&gt; ['X']
            ],
        ],
    ],
]);
// bare 文字列で定数が使える。::class も特別扱いで定数とみなす
that(paml_import('pv:PHP_VERSION, ao:ArrayObject::STD_PROP_LIST, class:ArrayObject::class'))-&gt;isSame([
    'pv'    =&gt; \PHP_VERSION,
    'ao'    =&gt; \ArrayObject::STD_PROP_LIST,
    'class' =&gt; \ArrayObject::class,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$pamlstring</code></td>
<td>​<span class="summary">PAML 文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">php 配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_14ad283e0831783d65b6182eaa3e6710f94f3b99-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-xmlss_export()" class="anchor"></a>[F] xmlss_export <small><span class="summary">連想配列の配列を XML SpreadSheet 的文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/xmlss_export.php#L13-L462" target="_blank">xmlss_export.php#13~462</a></p>
</div>
<details>
<summary class="">連想配列の配列を XML SpreadSheet 的文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function xmlss_export(
    iterable $xmlssarrays,
    array $options = []
): string|int</div></pre>
<div class="description">
<p>単純に入出力に足る最低限の xml を返す（かつ1シートのみ）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$xmlss = xmlss_export([
    ['id' =&gt; 1, 'name' =&gt; 'hoge', 'flag' =&gt; true],
    ['id' =&gt; 2, 'name' =&gt; 'fuga', 'flag' =&gt; true],
    ['id' =&gt; 3, 'name' =&gt; 'piyo', 'flag' =&gt; false],
], [
    'xml'   =&gt; ['style' =&gt; ['Default' =&gt; ['Name' =&gt; null]]],
    'break' =&gt; "\n",
]);
// 実際はスタイルやコメント、幅などに対応しているが長くなるので割愛
that($xmlss)-&gt;is(&lt;&lt;&lt;XMLSS
&lt;?xml version="1.0"?&gt;
&lt;?mso-application progid="Excel.Sheet"?&gt;
&lt;Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"&gt;
 &lt;Worksheet ss:Name="Sheet1"&gt;
  &lt;Table ss:ExpandedColumnCount="3"&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;id&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;name&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;flag&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Number"&gt;1&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;hoge&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Boolean"&gt;1&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Number"&gt;2&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;fuga&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Boolean"&gt;1&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Number"&gt;3&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;piyo&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Boolean"&gt;&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
  &lt;/Table&gt;
 &lt;/Worksheet&gt;
&lt;/Workbook&gt;
XMLSS,);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$xmlssarrays</code></td>
<td>​<span class="summary">連想配列の配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int</td>
<td>​<span class="summary">XML SpreadSheet 的文字列。output オプションを渡した場合は書き込みバイト数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f4b776c4f14d66f965dcb6090f90126318a8e318-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-xmlss_import()" class="anchor"></a>[F] xmlss_import <small><span class="summary">XML SpreadSheet 的文字列を連想配列の配列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/dataformat/xmlss_import.php#L12-L312" target="_blank">xmlss_import.php#12~312</a></p>
</div>
<details>
<summary class="">XML SpreadSheet 的文字列を連想配列の配列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function xmlss_import(
    string|resource $xmlssstring,
    array $options = []
): array|iterable</div></pre>
<div class="description">
<p>厳密な形式チェックは特に行わないが、xml としての体裁や最低限 Workbook/Worksheet だけはチェックされる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// このような xml を読み込ませると
$rows = xmlss_import(&lt;&lt;&lt;XMLSS
&lt;?xml version="1.0"?&gt;
&lt;?mso-application progid="Excel.Sheet"?&gt;
&lt;Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"&gt;
 &lt;Worksheet ss:Name="Sheet1"&gt;
  &lt;Table ss:ExpandedColumnCount="3"&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;id&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;name&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;flag&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Number"&gt;1&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;hoge&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Boolean"&gt;1&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Number"&gt;2&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;fuga&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Boolean"&gt;1&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
   &lt;Row&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Number"&gt;3&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="String"&gt;piyo&lt;/Data&gt;&lt;/Cell&gt;
    &lt;Cell&gt;&lt;Data ss:Type="Boolean"&gt;&lt;/Data&gt;&lt;/Cell&gt;
   &lt;/Row&gt;
  &lt;/Table&gt;
 &lt;/Worksheet&gt;
&lt;/Workbook&gt;
XMLSS, [
    'method' =&gt; 'sax',
]);
// このような配列を返す
that($rows)-&gt;is([
    ['id' =&gt; 1, 'name' =&gt; 'hoge', 'flag' =&gt; true],
    ['id' =&gt; 2, 'name' =&gt; 'fuga', 'flag' =&gt; true],
    ['id' =&gt; 3, 'name' =&gt; 'piyo', 'flag' =&gt; false],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​resource</td>
<td>​<code>$xmlssstring</code></td>
<td>​<span class="summary">XML SpreadSheet 的文字列。ファイルポインタでも良い</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​iterable</td>
<td>​<span class="summary">連想配列の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a639dfa41603d8e7126b2971dd2904a3867ff005-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-datetime" class="anchor"></a>[N] ryunosuke\Functions\Package\datetime\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-5" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-datetime--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_b5a7b6e0fdb31b00fd9f311c34e7441ea0e44c37-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_alter()" class="anchor"></a>[F] date_alter <small><span class="summary">日付を除外日リストに基づいてずらす</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_alter.php#L8-L44" target="_blank">date_alter.php#8~44</a></p>
</div>
<details>
<summary class="">日付を除外日リストに基づいてずらす</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_alter(
    string|int|\DateTimeInterface $datetime,
    array $excluded_dates,
    ?int $follow_count,
    string $format = "Y-m-d"
): string|null</div></pre>
<div class="description">
<p>典型的には「祝日前の営業日」「祝日後の営業日」のような代理日を返すイメージ。<span class="implicit-br">
</span>$follow_count に応じて下記のように返す。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>null</dt>
<dd>除外日でもずらさないでそのまま返す</dd>
</div>
<div class="dtdd-container">
<dt>-N</dt>
<dd>除外日なら最大N日分前倒しした日付を返す</dd>
</div>
<div class="dtdd-container">
<dt>+N</dt>
<dd>除外日なら最大N日分先送りした日付を返す</dd>
</div>
<div class="dtdd-container">
<dt>0</dt>
<dd>除外日でもずらさないで null を返す</dd>
</div>
</dl>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int|​<a href="https://php.net/manual/class.datetimeinterface.php" target="_blank">DateTimeInterface</a></td>
<td>​<code>$datetime</code></td>
<td>​<span class="summary">調べる日付</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$excluded_dates</code></td>
<td>​<span class="summary">除外日（いわゆる祝休日リスト）</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$follow_count</code></td>
<td>​<span class="summary">ずらす範囲</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$format = "Y-m-d"</code></td>
<td>​<span class="summary">日付フォーマット（$excluded_dates の形式＋返り値の形式）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​null</td>
<td>​<span class="summary">代替日。除外日 null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9856cefc016b4dbbb606beb35fdf54f8263dde90-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_convert()" class="anchor"></a>[F] date_convert <small><span class="summary">日時文字列をよしなに別のフォーマットに変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_convert.php#L12-L116" target="_blank">date_convert.php#12~116</a></p>
</div>
<details>
<summary class="">日時文字列をよしなに別のフォーマットに変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_convert(
    ?string $format,
    string|int|float|\DateTimeInterface|null $datetimedata = null
): string|\DateTimeInterface</div></pre>
<div class="description">
<p>マイクロ秒にも対応している。<span class="implicit-br">
</span>かなり適当に和暦にも対応している。</p>
<p>拡張書式は下記。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>J</dt>
<dd>日本元号<ul class=" simple">
<li>e.g. 平成</li>
<li>e.g. 令和</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>b</dt>
<dd>日本元号略称<ul class=" simple">
<li>e.g. H</li>
<li>e.g. R</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>k</dt>
<dd>日本元号年<ul class=" simple">
<li>e.g. 平成7年</li>
<li>e.g. 令和1年</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>K</dt>
<dd>日本元号年（1年が元年）<ul class=" simple">
<li>e.g. 平成7年</li>
<li>e.g. 令和元年</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>x</dt>
<dd>日本語曜日<ul class=" simple">
<li>e.g. 日</li>
<li>e.g. 月</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>Q</dt>
<dd>月内週番号（商が第N、余が曜日）<ul class=" simple">
<li>e.g. 6（7 * 0 + 6 第1土曜日）</li>
<li>e.g. 15（7 * 2 + 1 第3月曜日）</li>
</ul>
</dd>
</div>
</dl>
<p>php8.2 から x,X が追加されたため上記はあくまで参考となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 和暦を Y/m/d H:i:s に変換
that(date_convert('Y/m/d H:i:s', '昭和31年12月24日 12時34分56秒'))-&gt;isSame('1956/12/24 12:34:56');
// 単純に「マイクロ秒が使える date」としても使える
$now = 1234567890.123; // テストがしづらいので固定時刻にする
that(date_convert('Y/m/d H:i:s.u', $now))-&gt;isSame('2009/02/14 08:31:30.122999');
// $format に DateTimeInterface 実装クラス名を与えるとそのインスタンスを返す
that(date_convert(\DateTimeImmutable::class, $now))-&gt;isInstanceOf(\DateTimeImmutable::class);
// null は DateTimeInterface を意味する
that(date_convert(null, $now))-&gt;isInstanceOf(\DateTimeImmutable::class);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$format</code></td>
<td>​<span class="summary">フォーマット</span></td>
</tr>
<tr>
<td>​string|​int|​float|​<a href="https://php.net/manual/class.datetimeinterface.php" target="_blank">DateTimeInterface</a>|​null</td>
<td>​<code>$datetimedata = null</code></td>
<td>​<span class="summary">日時データ。省略時は microtime</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​<a href="https://php.net/manual/class.datetimeinterface.php" target="_blank">DateTimeInterface</a></td>
<td>​<span class="summary">日時文字列。$format が null の場合は DateTime</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c3692b463eec8f4fbd7dd118330b8cf69c094e68-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_fromto()" class="anchor"></a>[F] date_fromto <small><span class="summary">日時っぽい文字列とフォーマットを与えると取りうる範囲を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_fromto.php#L8-L70" target="_blank">date_fromto.php#8~70</a></p>
</div>
<details>
<summary class="">日時っぽい文字列とフォーマットを与えると取りうる範囲を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_fromto(
    string $format,
    string $datetimestring
): array|null</div></pre>
<div class="description">
<p>与えられた日時の最大の切り捨て日時と最小の切り上げ日時の配列を返す。<span class="implicit-br">
</span>日付文字列はある程度よしなに補完される（例えば "2014/12" は"2014年12月01日" と解釈されるし "12/24" は "今年12月24日" と解釈される）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(date_fromto('Y/m/d H:i:s', '2010/11'))-&gt;isSame(["2010/11/01 00:00:00", "2010/12/01 00:00:00"]);
that(date_fromto('Y/m/d H:i:s', '2010/11/24'))-&gt;isSame(["2010/11/24 00:00:00", "2010/11/25 00:00:00"]);
that(date_fromto('Y/m/d H:i:s', '2010/11/24 13'))-&gt;isSame(["2010/11/24 13:00:00", "2010/11/24 14:00:00"]);
that(date_fromto('Y/m/d H:i:s', '2010/11/24 13:24'))-&gt;isSame(["2010/11/24 13:24:00", "2010/11/24 13:25:00"]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$format</code></td>
<td>​<span class="summary">フォーマット。 null を与えるとタイムスタンプで返す</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$datetimestring</code></td>
<td>​<span class="summary">日時データ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​null</td>
<td>​<span class="summary">[from ～ to] な配列。解釈できない場合は null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5192f08a9e24ed0ace73e2bde6a65bd6bf9d49e2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_interval()" class="anchor"></a>[F] date_interval <small><span class="summary">ISO8601継続時間文字列を DateInterval に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_interval.php#L7-L76" target="_blank">date_interval.php#7~76</a></p>
</div>
<details>
<summary class="">ISO8601継続時間文字列を DateInterval に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_interval(string $interval): \DateInterval</div></pre>
<div class="description">
<p>各要素には負数を与えることができる。<span class="implicit-br">
</span>秒にはミリ秒を与えることもできる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 普通のISO8601継続時間
that(date_interval('P1Y2M3DT4H5M6S'))-&gt;format('%R%Y-%M-%DT%H:%I:%S.%f')-&gt;is('+01-02-03T04:05:06.0');
// 負数が使える
that(date_interval('P1Y2M3DT4H5M-6S'))-&gt;format('%R%Y-%M-%DT%H:%I:%S.%f')-&gt;is('+01-02-03T04:05:-6.0');
// ミリ秒が使える
that(date_interval('P1Y2M3DT4H5M6.789S'))-&gt;format('%R%Y-%M-%DT%H:%I:%S.%f')-&gt;is('+01-02-03T04:05:06.788999');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$interval</code></td>
<td>​<span class="summary">ISO8601継続時間文字列か相対表記</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.dateinterval.php" target="_blank">DateInterval</a></td>
<td>​<span class="summary">DateInterval オブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5ac54e4764526b6396ef4690f52310365915ec71-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_interval_second()" class="anchor"></a>[F] date_interval_second <small><span class="summary">DateInterval を秒に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_interval_second.php#L11-L55" target="_blank">date_interval_second.php#11~55</a></p>
</div>
<details>
<summary class="">DateInterval を秒に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_interval_second(
    \DateInterval|string|float|int $interval,
    string|float|int $basetime = 0
): float|int</div></pre>
<div class="description">
<p>1ヶ月の間隔は時期によって異なるため、 $basetime 次第で結果が変わることがあるので注意。<span class="implicit-br">
</span>$interval は DateInterval だけでなく ISO8601 文字列も与えることができる。<span class="implicit-br">
</span>その際、下記の拡張仕様がある。</p>
<ul class=" simple">
<li>先頭の正負記号（-+）を受け入れる（DateInterval-&gt;invert で表現される）</li>
<li>秒だけは小数表記を受け入れる（DateInterval-&gt;f で表現される。元々 ISO8601 の仕様だが DateInterval は対応していないっぽい）</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 1分30秒は90秒
that(date_interval_second('PT1M30S'))-&gt;isSame(90);
// 負数が使える
that(date_interval_second('-PT1M30S'))-&gt;isSame(-90);
// 秒は小数が使える
that(date_interval_second('-PT1M30.5S'))-&gt;isSame(-90.5);

// 1980/01/01 からの3ヶ月は 7862400 秒（うるう年なので 91 日）
that(date_interval_second('P3M', '1980/01/01'))-&gt;isSame(7862400);
// 1981/01/01 からの3ヶ月は 7776000 秒（うるう年じゃないので 90 日）
that(date_interval_second('P3M', '1981/01/01'))-&gt;isSame(7776000);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.dateinterval.php" target="_blank">DateInterval</a>|​string|​float|​int</td>
<td>​<code>$interval</code></td>
<td>​<span class="summary">DateInterval インスタンスか間隔を表す ISO8601 文字列</span></td>
</tr>
<tr>
<td>​string|​float|​int</td>
<td>​<code>$basetime = 0</code></td>
<td>​<span class="summary">基準日時（省略時 1970/01/01 00:00:00）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​float|​int</td>
<td>​<span class="summary">秒（$interval-&gt;f を含んでいるとき float で返す）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fd4fdbc523bd788227ae600991f9da169ab095de-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_interval_string()" class="anchor"></a>[F] date_interval_string <small><span class="summary">秒を世紀・年・月・日・時間・分・秒・ミリ秒の各要素に分解する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_interval_string.php#L11-L205" target="_blank">date_interval_string.php#11~205</a></p>
</div>
<details>
<summary class="">秒を世紀・年・月・日・時間・分・秒・ミリ秒の各要素に分解する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_interval_string(
    \DateInterval|string|float|int $interval,
    string|array|\Closure $format = null,
    string|int $limit_type = "y"
): string|\DateInterval</div></pre>
<div class="description">
<p>例えば <code>60 * 60 * 24 * 900 + 12345.678</code> （約900日12345秒）は・・・</p>
<ul class=" simple">
<li>2 年（約900日なので）</li>
<li>5 ヶ月（約(900 - 365 * 2 = 170)日なので）</li>
<li>18 日（約(170 - 30.416 * 5 = 18)日なので）</li>
<li>3 時間（約12345秒なので）</li>
<li>25 分（約(12345 - 3600 * 3 = 1545)秒なので）</li>
<li>45 秒（約(1545 - 60 * 25 = 45)秒なので）</li>
<li>678 ミリ秒（.678 部分そのまま）</li>
</ul>
<p>となる（年はうるう年未考慮で365日、月は30.41666666日で換算）。</p>
<p>$format を与えると DateInterval::format して文字列で返す。与えないと DateInterval をそのまま返す。<span class="implicit-br">
</span>$format はクロージャを与えることができる。クロージャを与えた場合、各要素を引数としてコールバックされる。<span class="implicit-br">
</span>$format は配列で与えることができる。配列で与えた場合、 0 になる要素は省かれる。<span class="implicit-br">
</span>セパレータを与えたり、pre/suffix を与えたりできるが、難解なので省略する。</p>
<p>$limit_type で換算のリミットを指定できる。例えば 'y' を指定すると「2年5ヶ月」となるが、 'm' を指定すると「29ヶ月」となる。<span class="implicit-br">
</span>数値を与えるとその範囲でオートスケールする。例えば 3 を指定すると値が大きいとき <code>ymd</code> の表示になり、年が 0 になると <code>mdh</code> の表示に切り替わるようになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 書式文字列指定（%vはミリ秒）
that(date_interval_string(60 * 60 * 24 * 900 + 12345.678, '%Y/%M/%D %H:%I:%S.%v'))-&gt;isSame('02/05/18 03:25:45.678');

// 書式にクロージャを与えるとコールバックされる（引数はスケールの小さい方から）
that(date_interval_string(60 * 60 * 24 * 900 + 12345.678, fn() =&gt; implode(',', func_get_args())))-&gt;isSame('678,45,25,3,18,5,2,0');

// リミットを指定（month までしか計算しないので year は 0 になり month は 29になる）
that(date_interval_string(60 * 60 * 24 * 900 + 12345.678, '%Y/%M/%D %H:%I:%S.%v', 'm'))-&gt;isSame('00/29/18 03:25:45.678');

// 書式に配列を与えてリミットに数値を与えるとその範囲でオートスケールする
$format = [
    'y' =&gt; '%y年',
    'm' =&gt; '%mヶ月',
    'd' =&gt; '%d日',
    ' ',
    'h' =&gt; '%h時間',
    'i' =&gt; '%i分',
    's' =&gt; '%s秒',
];
// 数が大きいので年・月・日の3要素のみ
that(date_interval_string(60 * 60 * 24 * 900 + 12345, $format, 3))-&gt;isSame('2年5ヶ月18日');
// 数がそこそこだと日・時間・分の3要素に切り替わる
that(date_interval_string(60 * 60 * 24 * 20 + 12345, $format, 3))-&gt;isSame('20日 3時間25分');
// どんなに数が小さくても3要素以下にはならない
that(date_interval_string(1234, $format, 3))-&gt;isSame('0時間20分34秒');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.dateinterval.php" target="_blank">DateInterval</a>|​string|​float|​int</td>
<td>​<code>$interval</code></td>
<td>​<span class="summary">DateInterval インスタンスか間隔を表す ISO8601 文字列</span></td>
</tr>
<tr>
<td>​string|​array|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$format = null</code></td>
<td>​<span class="summary">時刻フォーマット</span></td>
</tr>
<tr>
<td>​string|​int</td>
<td>​<code>$limit_type = "y"</code></td>
<td>​<span class="summary">どこまで換算するか（[c</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​<a href="https://php.net/manual/class.dateinterval.php" target="_blank">DateInterval</a></td>
<td>​<span class="summary">時間差文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_009f1b54e48c61272c25d586c661b8bcd4d748a8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_match()" class="anchor"></a>[F] date_match <small><span class="summary">日時と cron ライクな表記のマッチングを行う</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_match.php#L9-L216" target="_blank">date_match.php#9~216</a></p>
</div>
<details>
<summary class="">日時と cron ライクな表記のマッチングを行う</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_match(
    mixed $datetime,
    string $cronlike
): bool</div></pre>
<div class="description">
<p>YYYY/MM/DD(W) hh:mm:ss のようなパターンを与える。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>YYYY</dt>
<dd>年を表す（1～9999）</dd>
</div>
<div class="dtdd-container">
<dt>MM</dt>
<dd>月を表す（1～12）</dd>
</div>
<div class="dtdd-container">
<dt>DD</dt>
<dd>日を表す（1～31, 99,L で末日を表す）<ul class=" simple">
<li>e.g. 2/99 は 2/28,2/29 を表す（年に依存）</li>
<li>e.g. 2/L も同様</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>W</dt>
<dd>曜日を表す（0～6, #N で第Nを表す、#o,#e で隔週を表す）<ul class=" simple">
<li>e.g. 3 は毎水曜日を表す</li>
<li>e.g. 3#4 は第4水曜日を表す</li>
<li>e.g. 5#L は最終水曜日を表す</li>
<li>e.g. 4#o は隔週水曜日を表す（週番号奇数）</li>
<li>e.g. 4#e は隔週水曜日を表す（週番号偶数）</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>hh</dt>
<dd>時を表す（任意で 0～23）</dd>
</div>
<div class="dtdd-container">
<dt>mm</dt>
<dd>分を表す（任意で 0～59）</dd>
</div>
<div class="dtdd-container">
<dt>ss</dt>
<dd>秒を表す（任意で 0～59）</dd>
</div>
</dl>
<p>DD と W は AND 判定される（cron は OR）。<span class="implicit-br">
</span>また <code>/</code>（毎）にあたる表記はない。</p>
<p>9,L は「最後」を意味し、文脈に応じた値に書き換わる。<span class="implicit-br">
</span>「最終」が可変である日付と曜日のみ指定可能。<span class="implicit-br">
</span>例えば <code>2012/02/99</code> は「2014/02/29」になるし、<code>2012/02/**(3#L)</code> は「2012/02の最終水曜」になる。</p>
<p>各区切り内の値は下記が許可される。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>*</dt>
<dd>任意の値を表す（桁合わせのためにいくつあってもよい）</dd>
</div>
<div class="dtdd-container">
<dt>値</dt>
<dd>特定の一つの数値を表す</dd>
</div>
<div class="dtdd-container">
<dt>数字-数字</dt>
<dd>範囲を表す</dd>
</div>
<div class="dtdd-container">
<dt>数字,数字</dt>
<dd>いずれかを表す</dd>
</div>
</dl>
<p><code>*</code> 以外は複合できるので Example を参照。</p>
<p>この関数は実験的なので互換性担保に含まれない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 2014年の12月にマッチする
that(date_match('2014/12/24 12:34:56', '2014/12/*'))-&gt;isTrue();
that(date_match('2014/11/24 12:34:56', '2014/12/*'))-&gt;isFalse();
that(date_match('2015/12/24 12:34:56', '2014/12/*'))-&gt;isFalse();
// 2014年の12月20日～25日にマッチする
that(date_match('2014/12/24 12:34:56', '2014/12/20-25'))-&gt;isTrue();
that(date_match('2014/12/26 12:34:56', '2014/12/20-25'))-&gt;isFalse();
that(date_match('2015/12/24 12:34:56', '2014/12/20-25'))-&gt;isFalse();
// 2014年の12月10,20,30日にマッチする
that(date_match('2014/12/20 12:34:56', '2014/12/10,20,30'))-&gt;isTrue();
that(date_match('2014/12/24 12:34:56', '2014/12/10,20,30'))-&gt;isFalse();
that(date_match('2015/12/30 12:34:56', '2014/12/10,20,30'))-&gt;isFalse();
// 2014年の12月10,20~25,30日にマッチする
that(date_match('2014/12/24 12:34:56', '2014/12/10,20-25,30'))-&gt;isTrue();
that(date_match('2014/12/26 12:34:56', '2014/12/10,20-25,30'))-&gt;isFalse();
that(date_match('2015/12/26 12:34:56', '2014/12/10,20-25,30'))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$datetime</code></td>
<td>​<span class="summary">日時を表す引数</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$cronlike</code></td>
<td>​<span class="summary">マッチパターン</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">マッチしたら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_915a39492d55113727eb8afe02531485f9f1fa83-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_modulate()" class="anchor"></a>[F] date_modulate <small><span class="summary">日時を加減算する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_modulate.php#L9-L70" target="_blank">date_modulate.php#9~70</a></p>
</div>
<details>
<summary class="">日時を加減算する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_modulate(
    string $datetimedata,
    int|string|\DateInterval $modify
): string</div></pre>
<div class="description">
<p>フォーマットを維持しつつ日時文字列の最小単位でよしなに加算する。<span class="implicit-br">
</span>具体的には Example を参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 年加算
that(date_modulate('2014', 1))-&gt;isSame('2015');
// 月加算
that(date_modulate('2014/12', 1))-&gt;isSame('2015/01');
// 日加算
that(date_modulate('2014/12/24', 1))-&gt;isSame('2014/12/25');
// 時加算
that(date_modulate('2014/12/24 12', 1))-&gt;isSame('2014/12/24 13');
// 分加算
that(date_modulate('2014/12/24 12:34', 1))-&gt;isSame('2014/12/24 12:35');
// 秒加算
that(date_modulate('2014/12/24 12:34:56', 1))-&gt;isSame('2014/12/24 12:34:57');
// ミリ秒加算
that(date_modulate('2014/12/24 12:34:56.789', 1))-&gt;isSame('2014/12/24 12:34:56.790');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$datetimedata</code></td>
<td>​<span class="summary">日時文字列</span></td>
</tr>
<tr>
<td>​int|​string|​<a href="https://php.net/manual/class.dateinterval.php" target="_blank">DateInterval</a></td>
<td>​<code>$modify</code></td>
<td>​<span class="summary">加減算値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">加算された日時文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_05beef2414a93efd1852a739bb2f61a4debedc19-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_parse_format()" class="anchor"></a>[F] date_parse_format <small><span class="summary">日時文字列のフォーマットを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_parse_format.php#L8-L169" target="_blank">date_parse_format.php#8~169</a></p>
</div>
<details>
<summary class="">日時文字列のフォーマットを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_parse_format(
    string $datetimestring,
    array &amp;$parsed = []
): ?string</div></pre>
<div class="description">
<p>例えば "2014/12/24 12:34:56" から "Y/m/d H:i:s" を逆算して返す。<span class="implicit-br">
</span>精度は非常に低く、相対表現なども未対応（そもそも逆算は一意に決まるものでもない）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// RFC3339
that(date_parse_format('2014-12-24T12:34:56'))-&gt;isSame('Y-m-d\TH:i:s');
// 日本式
that(date_parse_format('2014/12/24 12:34:56'))-&gt;isSame('Y/m/d H:i:s');
// アメリカ式
that(date_parse_format('12/24/2014 12:34:56'))-&gt;isSame('m/d/Y H:i:s');
// イギリス式
that(date_parse_format('24.12.2014 12:34:56'))-&gt;isSame('d.m.Y H:i:s');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$datetimestring</code></td>
<td>​<span class="summary">日時文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$parsed = []</code></td>
<td>​<span class="summary">パースの参考情報が格納される（内部向け）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">フォーマット文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c130ab5c15399efcd84ce24e4a57f89c142041ee-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_timestamp()" class="anchor"></a>[F] date_timestamp <small><span class="summary">日時的なものをよしなにタイムスタンプに変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_timestamp.php#L9-L190" target="_blank">date_timestamp.php#9~190</a></p>
</div>
<details>
<summary class="">日時的なものをよしなにタイムスタンプに変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_timestamp(
    string|int|float|\DateTimeInterface $datetimedata,
    int|null $baseTimestamp = null
): int|float|null</div></pre>
<div class="description">
<p>マイクロ秒にも対応している。つまり返り値は int か float になる。<span class="implicit-br">
</span>また、相対指定の +1 month の月末問題は起きないようにしてある。</p>
<p>かなり適当に和暦にも対応している。<span class="implicit-br">
</span>さらに必要に迫られてかなり特殊な対応を行っているので Example を参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 普通の日時文字列
that(date_timestamp('2014/12/24 12:34:56'))-&gt;isSame(strtotime('2014/12/24 12:34:56'));
// 和暦
that(date_timestamp('昭和31年12月24日 12時34分56秒'))-&gt;isSame(strtotime('1956/12/24 12:34:56'));
// 相対指定
that(date_timestamp('2012/01/31 +1 month'))-&gt;isSame(strtotime('2012/02/29'));
that(date_timestamp('2012/03/31 -1 month'))-&gt;isSame(strtotime('2012/02/29'));
// マイクロ秒
that(date_timestamp('2014/12/24 12:34:56.789'))-&gt;isSame(1419392096.789);

// ベース日時
$baseTimestamp = strtotime('2012/01/31');
// ベース日時の25日（strtotime の序数日付は first/last しか対応していないが、この関数は対応している）
that(date_timestamp('25th of this month', $baseTimestamp))-&gt;isSame(strtotime('2012/01/25'));
// ベース日時の第2月曜（strtotime の序数曜日は 1st のような表記に対応していないが、この関数は対応している）
that(date_timestamp('2nd monday of this month', $baseTimestamp))-&gt;isSame(strtotime('2012/01/09'));</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int|​float|​<a href="https://php.net/manual/class.datetimeinterface.php" target="_blank">DateTimeInterface</a></td>
<td>​<code>$datetimedata</code></td>
<td>​<span class="summary">日時データ</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$baseTimestamp = null</code></td>
<td>​<span class="summary">日時データ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float|​null</td>
<td>​<span class="summary">タイムスタンプ。パース失敗時は null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_510ba2fc4f8ccc1053f5d1cec308abc6f369e69d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-date_validate()" class="anchor"></a>[F] date_validate <small><span class="summary">日時文字列のバリデーション</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/date_validate.php#L8-L71" target="_blank">date_validate.php#8~71</a></p>
</div>
<details>
<summary class="">日時文字列のバリデーション</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function date_validate(
    string $datetime_string,
    string $format = "Y/m/d H:i:s",
    int $overhour = 0
): bool</div></pre>
<div class="description">
<p>存在しない日付・時刻・相対指定などは全て不可。<span class="implicit-br">
</span>あくまで「2014/12/24 12:34:56」のような形式と妥当性だけでチェックする。<span class="implicit-br">
</span>$overhour 引数で 27:00 のような拡張時刻も許容させることができる（6 を指定すればいわゆる30時間制になる）。</p>
<p>日時形式は結構複雑なので「正しいはずだがなぜか false になる」という事象が頻発する。<span class="implicit-br">
</span>その時、調査が大変（どの段階で false になっているか分からない）なので＠で抑制しつつも内部的には user_error を投げている。<span class="implicit-br">
</span>このエラーは error_get_last で取得可能だが、行儀の悪い（＠抑制を見ない）エラーハンドラが設定されていると例外として送出されることがあるので注意。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$datetime_string</code></td>
<td>​<span class="summary">日付形式の文字列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$format = "Y/m/d H:i:s"</code></td>
<td>​<span class="summary">フォーマット文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$overhour = 0</code></td>
<td>​<span class="summary">24時以降をどこまで許すか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">valid な日時なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fd247fcb3bc2d6da0c30f7a47b43c66538b50819-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-now()" class="anchor"></a>[F] now <small><span class="summary">現在日時を float で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/datetime/now.php#L7-L36" target="_blank">now.php#7~36</a></p>
</div>
<details>
<summary class="">現在日時を float で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function now(bool $persistence = true): float</div></pre>
<div class="description">
<p>microtime(true) と同じ。<span class="implicit-br">
</span>ただし、引数 $persistence を true(デフォルト) にすると以降の呼び出しですべて同じ値を返すようになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 現在時刻
$now = now();
sleep(1);
// 1秒経っても同じ値を返す
that(now())-&gt;is($now);
// false を与えると新しい時刻を返す
that(now(false))-&gt;isNot($now);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<code>$persistence = true</code></td>
<td>​<span class="summary">固定化フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​float</td>
<td>​<span class="summary">現在日時</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_25a7c761951265da22169a1bbd9f7386cff212ef-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-errorfunc" class="anchor"></a>[N] ryunosuke\Functions\Package\errorfunc\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-6" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-errorfunc--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_78c49f457d1459235deac6b40ad35a5d7fecbf6c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-add_error_handler()" class="anchor"></a>[F] add_error_handler <small><span class="summary">エラーハンドラを追加する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/errorfunc/add_error_handler.php#L7-L46" target="_blank">add_error_handler.php#7~46</a></p>
</div>
<details>
<summary class="">エラーハンドラを追加する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function add_error_handler(
    callable $handler,
    int $error_types = 32767
): callable|null</div></pre>
<div class="description">
<p>追加したエラーハンドラが false を返すと標準のエラーハンドラではなく、直近の設定されていたエラーハンドラに移譲される。<span class="implicit-br">
</span>（直近にエラーハンドラが設定されていなかったら標準ハンドラになる）。</p>
<p>「局所的にエラーハンドラを変更したいけど特定の状況は設定済みハンドラへ流したい」という状況はまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// @ 付きなら元々のハンドラに移譲、@ なしなら何らかのハンドリングを行う例
add_error_handler(function ($errno) {
    if (!(error_reporting() &amp; $errno)) {
        // この false はマニュアルにある「この関数が FALSE を返した場合は、通常のエラーハンドラが処理を引き継ぎます」ではなく、
        // 「さっきまで設定されていたエラーハンドラが処理を引き継ぎます」という意味になる
        return false;
    }
    // do something
});
// false の扱いが異なるだけでその他の挙動はすべて set_error_handler と同じなので restore_error_handler で戻せる
restore_error_handler();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$handler</code></td>
<td>​<span class="summary">エラーハンドラ</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$error_types = 32767</code></td>
<td>​<span class="summary">エラータイプ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable|​null</td>
<td>​<span class="summary">直近に設定されていたエラーハンドラ（未設定の場合は null）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_21d0d458735b5c31e45ff97cf7ada1fa3a1d5112-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-backtrace()" class="anchor"></a>[F] backtrace <small><span class="summary">特定条件までのバックトレースを取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/errorfunc/backtrace.php#L7-L66" target="_blank">backtrace.php#7~66</a></p>
</div>
<details>
<summary class="">特定条件までのバックトレースを取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function backtrace(
    int $flags = DEBUG_BACKTRACE_PROVIDE_OBJECT,
    array $options = []
): array</div></pre>
<div class="description">
<p>第2引数 $options を満たすトレース以降を返す。<span class="implicit-br">
</span>$options は ['$trace の key' =&gt; "条件"] を渡す。<span class="implicit-br">
</span>条件は文字列かクロージャで、文字列の場合は緩い一致、クロージャの場合は true を返した場合にそれ以降を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">function f001 () {return backtrace(0, ['function' =&gt; __NAMESPACE__ . '\\f002', 'limit' =&gt; 2]);}
function f002 () {return f001();}
function f003 () {return f002();}
$traces = f003();
// limit 指定してるので2個
that($traces)-&gt;count(2);
// 「function が f002 以降」を返す
that($traces[0])-&gt;subsetEquals([
    'function' =&gt; __NAMESPACE__ . '\\f002'
]);
that($traces[1])-&gt;subsetEquals([
    'function' =&gt; __NAMESPACE__ . '\\f003'
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$flags = DEBUG_BACKTRACE_PROVIDE_OBJECT</code></td>
<td>​<span class="summary">debug_backtrace の引数</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">フィルタ条件</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">バックトレース</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8c9c2afbe8e7af586610515273e3d7f1bd55f188-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-error()" class="anchor"></a>[F] error <small><span class="summary">エラー出力する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/errorfunc/error.php#L9-L70" target="_blank">error.php#9~70</a></p>
</div>
<details>
<summary class="">エラー出力する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function error(
    string|mixed $message,
    resource|string|mixed $destination = null
): int</div></pre>
<div class="description">
<p>第1引数 $message はそれらしく文字列化されて出力される。基本的にはあらゆる型を与えて良い。</p>
<p>第2引数 $destination で出力対象を指定する。省略すると error_log 設定に従う。<span class="implicit-br">
</span>文字列を与えるとファイル名とみなし、ファイルに追記される。<span class="implicit-br">
</span>ファイルを開くが、<strong>ファイルは閉じない</strong>。閉じ処理は php の終了処理に身を任せる。<span class="implicit-br">
</span>したがって閉じる必要がある場合はファイルポインタを渡す必要がある。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​mixed</td>
<td>​<code>$message</code></td>
<td>​<span class="summary">出力メッセージ</span></td>
</tr>
<tr>
<td>​resource|​string|​mixed</td>
<td>​<code>$destination = null</code></td>
<td>​<span class="summary">出力先</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">書き込んだバイト数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0a9f318dc2d602a794289c8403218fe3d713f98d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-set_all_error_handler()" class="anchor"></a>[F] set_all_error_handler <small><span class="summary">あらゆるエラーをハンドルする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/errorfunc/set_all_error_handler.php#L7-L128" target="_blank">set_all_error_handler.php#7~128</a></p>
</div>
<details>
<summary class="">あらゆるエラーをハンドルする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function set_all_error_handler(
    \Closure $handler,
    bool $atmark_error = false,
    int $reserved_byte = 0
): callable</div></pre>
<div class="description">
<p>実質的には set_error_handler+set_exception_handler+register_shutdown_function してるだけ。<span class="implicit-br">
</span>あと小細工して初動エラーも拾うがあまり気にしなくてよい。</p>
<p>ハンドラの引数は Throwable 固定（エラーの場合は Error に変換されてコールされる）。<span class="implicit-br">
</span>ハンドラが true/null を返すと設定前（ない場合は標準）のハンドラがコールされる。<span class="implicit-br">
</span>実用上は「ログるかログらないか」くらいの差でしかない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$handler</code></td>
<td>​<span class="summary">実行されるクロージャ</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$atmark_error = false</code></td>
<td>​<span class="summary">エラー抑制演算子をハンドリングするか</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$reserved_byte = 0</code></td>
<td>​<span class="summary">fatal 用に予約するサイズ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<span class="summary">キャンセルする callable</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_192ca678d9d9df612786408a1e2d74f751804431-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-set_error_exception_handler()" class="anchor"></a>[F] set_error_exception_handler <small><span class="summary">エラーを ErrorException に変換するハンドラを設定する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/errorfunc/set_error_exception_handler.php#L8-L49" target="_blank">set_error_exception_handler.php#8~49</a></p>
</div>
<details>
<summary class="">エラーを ErrorException に変換するハンドラを設定する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function set_error_exception_handler(
    int $error_levels = E_ALL,
    bool $handle_atmark_error = false
): callable</div></pre>
<div class="description">
<p>かなり局所的だが、使用するケースは結構ある。<span class="implicit-br">
</span>戻り値として callable を返すので、それを呼べば restore される。<span class="implicit-br">
</span>あるいは参照が切れれば RAII で restore される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 呼ぶとエラーが例外に変換されるようになる
$restore = set_error_exception_handler();
try {
    $array = [];
    $dummy = $array['undefined'];
}
catch (\Throwable $t) {
    // undefined 例外が飛ぶ
    that($t)-&gt;isInstanceof(\ErrorException::class);
}
finally {
    // こうするとハンドラが戻る
    $restore();
}</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$error_levels = E_ALL</code></td>
<td>​<span class="summary">エラーレベル</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$handle_atmark_error = false</code></td>
<td>​<span class="summary">エラー抑制時もハンドリングするか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<span class="summary">restore するコールバック</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6c1df4a64a103bc52e090232aed56617d39df763-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-set_trace_logger()" class="anchor"></a>[F] set_trace_logger <small><span class="summary">メソッド呼び出しロガーを仕込む</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/errorfunc/set_trace_logger.php#L8-L40" target="_blank">set_trace_logger.php#8~40</a></p>
</div>
<details>
<summary class="">メソッド呼び出しロガーを仕込む</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function set_trace_logger(
    Psr\Log\LoggerInterface $logger,
    string $target
): mixed</div></pre>
<div class="description">
<p>この関数はかなり実験的なもので、互換性を考慮しない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--Psr-Log-LoggerInterface">LoggerInterface</a></td>
<td>​<code>$logger</code></td>
<td>​<span class="summary">書き出すファイル名</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$target</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c7d9f90a9d255b6010aa19c6fe2b77169917942f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-stacktrace()" class="anchor"></a>[F] stacktrace <small><span class="summary">スタックトレースを文字列で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/errorfunc/stacktrace.php#L10-L150" target="_blank">stacktrace.php#10~150</a></p>
</div>
<details>
<summary class="">スタックトレースを文字列で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function stacktrace(
    ?array $traces = null,
    int|string|array $option = []
): string|array</div></pre>
<div class="description">
<p><code>(new \Exception())-&gt;getTraceAsString()</code> と実質的な役割は同じ。<span class="implicit-br">
</span>ただし、 getTraceAsString は引数が Array になったりクラス名しか取れなかったり微妙に使い勝手が悪いのでもうちょっと情報量を増やしたもの。</p>
<p>第1引数 $traces はトレース的配列を受け取る（<code>(new \Exception())-&gt;getTrace()</code> とか）。<span class="implicit-br">
</span>未指定時は debug_backtrace() で採取する。</p>
<p>第2引数 $option は文字列化する際の設定を指定する。<span class="implicit-br">
</span>情報量が増える分、機密も含まれる可能性があるため、 mask オプションで塗りつぶすキーや引数名を指定できる（クロージャの引数までは手出ししないため留意）。<span class="implicit-br">
</span>limit と format は比較的指定頻度が高いかつ互換性維持のため配列オプションではなく直に渡すことが可能になっている。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?array</td>
<td>​<code>$traces = null</code></td>
<td>​<span class="summary">debug_backtrace 的な配列</span></td>
</tr>
<tr>
<td>​int|​string|​array</td>
<td>​<code>$option = []</code></td>
<td>​<span class="summary">オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<span class="summary">トレース文字列（delimiter オプションに null を渡すと配列で返す）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_07d17f86b459c3b7d07c529e12404b407938a9e3-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-exec" class="anchor"></a>[N] ryunosuke\Functions\Package\exec\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-7" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-exec--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_930e49fd3aef57aaa4f2d89b5a73bcf413a2de48-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-process()" class="anchor"></a>[F] process <small><span class="summary">proc_open ～ proc_close の一連の処理を行う</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/exec/process.php#L8-L53" target="_blank">process.php#8~53</a></p>
</div>
<details>
<summary class="">proc_open ～ proc_close の一連の処理を行う</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function process(
    string $command,
    array|string $args = [],
    string|resource $stdin = "",
    string|resource &amp;$stdout = "",
    string|resource &amp;$stderr = "",
    ?string $cwd = null,
    ?array $env = null,
    ?array $options = null
): int</div></pre>
<div class="description">
<p>標準入出力は文字列で受け渡しできるが、決め打ち実装なのでいわゆる対話型なプロセスは起動できない。<span class="implicit-br">
</span>また、標準入出力はリソース型を渡すこともできる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// サンプル実行用ファイルを用意
$phpfile = sys_get_temp_dir() . '/rf-sample.php';
file_put_contents($phpfile, "&lt;?php
    fwrite(STDOUT, fgets(STDIN));
    fwrite(STDERR, 'err');
    exit((int) ini_get('max_file_uploads'));
");
// 引数と標準入出力エラーを使った単純な例
$rc = process(PHP_BINARY, [
    '-d' =&gt; 'max_file_uploads=123',
    $phpfile,
], 'out', $stdout, $stderr);
that($rc)-&gt;isSame(123); // -d で与えた max_file_uploads で exit してるので 123
that($stdout)-&gt;isSame('out'); // 標準出力に標準入力を書き込んでいるので "out" が格納される
that($stderr)-&gt;isSame('err'); // 標準エラーに書き込んでいるので "err" が格納される</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$command</code></td>
<td>​<span class="summary">実行コマンド。php7.4 未満では escapeshellcmd される</span></td>
</tr>
<tr>
<td>​array|​string</td>
<td>​<code>$args = []</code></td>
<td>​<span class="summary">コマンドライン引数。php7.4 未満では文字列はそのまま結合され、配列は escapeshellarg された上でキーと結合される</span></td>
</tr>
<tr>
<td>​string|​resource</td>
<td>​<code>$stdin = ""</code></td>
<td>​<span class="summary">標準入力（string を渡すと単純に読み取れられる。resource を渡すと fread される）</span></td>
</tr>
<tr>
<td>​string|​resource</td>
<td>​<code>&amp;$stdout = ""</code></td>
<td>​<span class="summary">標準出力（string を渡すと参照渡しで格納される。resource を渡すと fwrite される）</span></td>
</tr>
<tr>
<td>​string|​resource</td>
<td>​<code>&amp;$stderr = ""</code></td>
<td>​<span class="summary">標準エラー（string を渡すと参照渡しで格納される。resource を渡すと fwrite される）</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$cwd = null</code></td>
<td>​<span class="summary">作業ディレクトリ</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$env = null</code></td>
<td>​<span class="summary">環境変数</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$options = null</code></td>
<td>​<span class="summary">その他の追加オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">リターンコード</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d74bc4fb7442cd87327a6b1ab8a1032c67f092e7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-process_async()" class="anchor"></a>[F] process_async <small><span class="summary">proc_open ～ proc_close の一連の処理を行う（非同期版）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/exec/process_async.php#L8-L251" target="_blank">process_async.php#8~251</a></p>
</div>
<details>
<summary class="">proc_open ～ proc_close の一連の処理を行う（非同期版）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function process_async(
    string $command,
    array|string $args = [],
    string|resource $stdin = "",
    string|resource &amp;$stdout = "",
    string|resource &amp;$stderr = "",
    ?string $cwd = null,
    ?array $env = null,
    ?array $options = null
): ProcessAsync|object</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$command</code></td>
<td>​<span class="summary">実行コマンド</span></td>
</tr>
<tr>
<td>​array|​string</td>
<td>​<code>$args = []</code></td>
<td>​<span class="summary">コマンドライン引数。文字列はそのまま結合され、配列は escapeshellarg された上でキーと結合される</span></td>
</tr>
<tr>
<td>​string|​resource</td>
<td>​<code>$stdin = ""</code></td>
<td>​<span class="summary">標準入力（string を渡すと単純に読み取れられる。resource を渡すと fread される）</span></td>
</tr>
<tr>
<td>​string|​resource</td>
<td>​<code>&amp;$stdout = ""</code></td>
<td>​<span class="summary">標準出力（string を渡すと参照渡しで格納される。resource を渡すと fwrite される）</span></td>
</tr>
<tr>
<td>​string|​resource</td>
<td>​<code>&amp;$stderr = ""</code></td>
<td>​<span class="summary">標準エラー（string を渡すと参照渡しで格納される。resource を渡すと fwrite される）</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$cwd = null</code></td>
<td>​<span class="summary">作業ディレクトリ</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$env = null</code></td>
<td>​<span class="summary">環境変数</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$options = null</code></td>
<td>​<span class="summary">その他の追加オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ProcessAsync">ProcessAsync</a>|​object</td>
<td>​<span class="summary">プロセスオブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--process%28%29">process()</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fd05e6c0b0cdf5fb9907d7531c0e9ea580826a60-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-process_closure()" class="anchor"></a>[F] process_closure <small><span class="summary">クロージャを別プロセスで実行する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/exec/process_closure.php#L15-L121" target="_blank">process_closure.php#15~121</a></p>
</div>
<details>
<summary class="">クロージャを別プロセスで実行する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function process_closure(
    \Closure $closure,
    mixed $args = [],
    bool|int $throw = true,
    ?array $autoload = null,
    ?string $workdir = null,
    $env = null,
    ?array $options = null
): ProcessAsync|object</div></pre>
<div class="description">
<p>process_parallel の単一クロージャ特化版。<span class="implicit-br">
</span>クロージャを別プロセスでバックグラウンド実行して結果を返すオブジェクトを返す。<span class="implicit-br">
</span>クロージャは独自の方法でエクスポートしてから実行するので可能な限り this bind は外したほうが良い。</p>
<p>バックグラウンドで実行するので指定クロージャを実行中に別のことができる。<span class="implicit-br">
</span>これはマルチコアを活かすのにも有用であるし、IO を伴う処理を効率よく実行できる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$hugefile1 = tempnam(sys_get_temp_dir(), 't');
$hugefile2 = tempnam(sys_get_temp_dir(), 't');
file_put_contents($hugefile1, str_repeat('x', 1024* 1024)); // もっとでかくないと効果は薄いがテストなのであまり大きくしない
file_put_contents($hugefile2, str_repeat('y', 1024* 1024));
// 超絶でかいファイルの sha1 を計算してる間に・・・
$hash1 = process_closure(static fn() =&gt; sha1_file($hugefile1));
$hash2 = process_closure(static fn() =&gt; sha1_file($hugefile2));
// ここで別のことができる（裏で処理は走っている）
// doSomething())
// 返り値オブジェクトをコールすると結果が得られる（この時、処理が未完なら待たされる）
that($hash1())-&gt;is('e37f4d5be56713044d62525e406d250a722647d6');
that($hash2())-&gt;is('2b6a7ad91a60e40a5fd37abe06e165dc7498b24e');

// あるいは http リクエストを走らせている間に・・・
$start = microtime(true);
$response1 = process_closure(static fn($url) =&gt; file_get_contents($url), TESTWEBSERVER . '/delay/2');
$response2 = process_closure(static fn($url) =&gt; file_get_contents($url), TESTWEBSERVER . '/delay/2');
// 別のことができる（裏でリクエストは走っている）
// doSomething())
// 返り値オブジェクトをコールするとレスポンスが得られる
that($response1())-&gt;isNotEmpty();
that($response2())-&gt;isNotEmpty();
// トータルで2秒程度である（少なくとも 2 * 2 で4秒にはならない）
that(microtime(true) - $start)-&gt;break()-&gt;isBetween(2.0, 4.0);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$closure</code></td>
<td>​<span class="summary">非同期実行するクロージャ</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$args = []</code></td>
<td>​<span class="summary">クロージャの引数</span></td>
</tr>
<tr>
<td>​bool|​int</td>
<td>​<code>$throw = true</code></td>
<td>​<span class="summary">exitcode で例外を投げるか（現在は bool のみ対応）</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$autoload = null</code></td>
<td>​<span class="summary">実行前に読み込むスクリプト。省略時は自動検出された vendor/autoload.php と function_configure/process.autoload</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$workdir = null</code></td>
<td>​<span class="summary">ワーキングディレクトリ。省略時はテンポラリディレクトリ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$env = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$options = null</code></td>
<td>​<span class="summary">その他の追加オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ProcessAsync">ProcessAsync</a>|​object</td>
<td>​<span class="summary">プロセスオブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e818dc6eee815094b362678ecfa52aadf67be3d7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-process_parallel()" class="anchor"></a>[F] process_parallel <small><span class="summary">複数の callable を並列で実行する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/exec/process_parallel.php#L10-L131" target="_blank">process_parallel.php#10~131</a></p>
</div>
<details>
<summary class="">複数の callable を並列で実行する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function process_parallel(
    callable|callable[] $tasks,
    array $args = [],
    ?array $autoload = null,
    ?string $workdir = null,
    $env = null,
    ?array $options = null
): array</div></pre>
<div class="description">
<p>callable はクロージャも使用できるが、独自の方法でエクスポートしてから実行するので可能な限り this bind は外したほうが良い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"># 単一のクロージャを複数の引数で回す
$t = microtime(true);
$result = process_parallel(static function ($arg1, $arg2) {
    usleep(1000 * 1000);
    fwrite(STDOUT, "this is stdout");
    fwrite(STDERR, "this is stderr");
    return $arg1 + $arg2;
}, ['a' =&gt; [1, 2], 'b' =&gt; [2, 3], [3, 4]]);
// 1000ms かかる処理を3本実行するが、トータル時間は 3000ms ではなくそれ以下になる（多少のオーバーヘッドはある）
that(microtime(true) - $t)-&gt;break()-&gt;lessThan(2.0);
// 実行結果は下記のような配列で返ってくる（その際キーは維持される）
that($result)-&gt;isSame([
    'a' =&gt; [
        'status' =&gt; 0,
        'stdout' =&gt; "this is stdout",
        'stderr' =&gt; "this is stderr",
        'return' =&gt; 3,
    ],
    'b' =&gt; [
        'status' =&gt; 0,
        'stdout' =&gt; "this is stdout",
        'stderr' =&gt; "this is stderr",
        'return' =&gt; 5,
    ],
    [
        'status' =&gt; 0,
        'stdout' =&gt; "this is stdout",
        'stderr' =&gt; "this is stderr",
        'return' =&gt; 7,
    ],
]);
# 複数のクロージャを複数の引数で回す（この場合、引数のキーは合わせなければならない）
$t = microtime(true);
$result = process_parallel([
    'a' =&gt; static function ($arg1, $arg2) {
        usleep(300 * 1000);
        return $arg1 + $arg2;
    },
    'b' =&gt; static function ($arg1, $arg2) {
        usleep(500 * 1000);
        return $arg1 * $arg2;
    },
    static function ($arg) {
        usleep(1000 * 1000);
        exit($arg);
    },
], ['a' =&gt; [1, 2], 'b' =&gt; [2, 3], [127]]);
// 300,500,1000ms かかる処理を3本実行するが、トータル時間は 1800ms ではなくそれ以下になる（多少のオーバーヘッドはある）
that(microtime(true) - $t)-&gt;break()-&gt;lessThan(1.5);
// 実行結果は下記のような配列で返ってくる（その際キーは維持される）
that($result)-&gt;isSame([
    'a' =&gt; [
        'status' =&gt; 0,
        'stdout' =&gt; "",
        'stderr' =&gt; "",
        'return' =&gt; 3,
    ],
    'b' =&gt; [
        'status' =&gt; 0,
        'stdout' =&gt; "",
        'stderr' =&gt; "",
        'return' =&gt; 6,
    ],
    [
        'status' =&gt; 127,  // 終了コードが入ってくる
        'stdout' =&gt; "",
        'stderr' =&gt; "",
        'return' =&gt; null,
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable|​callable[]</td>
<td>​<code>$tasks</code></td>
<td>​<span class="summary">並列実行する callable. 単一の場合は引数分実行して結果を返す</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$args = []</code></td>
<td>​<span class="summary">各々の引数。$tasks が配列の場合はそれに対応する引数配列。単一の場合は実行回数も兼ねた引数配列</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$autoload = null</code></td>
<td>​<span class="summary">実行前に読み込むスクリプト。省略時は自動検出された vendor/autoload.php と function_configure/process.autoload</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$workdir = null</code></td>
<td>​<span class="summary">ワーキングディレクトリ。省略時はテンポラリディレクトリ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$env = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>$options = null</code></td>
<td>​<span class="summary">その他の追加オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">実行結果（['return' =&gt; callable の返り値, 'status' =&gt; 終了コード, 'stdout' =&gt; 標準出力, 'stderr' =&gt; 標準エラー]）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_077de5f34282d2750359064d2a03585216ce8088-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-filesystem" class="anchor"></a>[N] ryunosuke\Functions\Package\filesystem\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-8" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-filesystem--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_c84d6538d5f276e549e2629238d9900a1a1de427-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cp_rf()" class="anchor"></a>[F] cp_rf <small><span class="summary">ディレクトリのコピー</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/cp_rf.php#L8-L79" target="_blank">cp_rf.php#8~79</a></p>
</div>
<details>
<summary class="">ディレクトリのコピー</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cp_rf(
    string $src,
    string $dst
): bool</div></pre>
<div class="description">
<p>$dst に / を付けると「$dst に自身をコピー」する。付けないと「$dst に中身をコピー」するという動作になる。</p>
<p>ディレクトリではなくファイルを与えても動作する（copy とほぼ同じ動作になるが、対象にディレクトリを指定できる点が異なる）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// /tmp/src/hoge.txt, /tmp/src/dir/fuga.txt を作っておく
$tmp = sys_get_temp_dir();
file_set_contents("$tmp/src/hoge.txt", 'hoge');
file_set_contents("$tmp/src/dir/fuga.txt", 'fuga');

// "/" を付けないと中身コピー
cp_rf("$tmp/src", "$tmp/dst1");
that("$tmp/dst1/hoge.txt")-&gt;fileEquals('hoge');
that("$tmp/dst1/dir/fuga.txt")-&gt;fileEquals('fuga');
// "/" を付けると自身コピー
cp_rf("$tmp/src", "$tmp/dst2/");
that("$tmp/dst2/src/hoge.txt")-&gt;fileEquals('hoge');
that("$tmp/dst2/src/dir/fuga.txt")-&gt;fileEquals('fuga');

// $src はファイルでもいい（$dst に "/" を付けるとそのディレクトリにコピーする）
cp_rf("$tmp/src/hoge.txt", "$tmp/dst3/");
that("$tmp/dst3/hoge.txt")-&gt;fileEquals('hoge');
// $dst に "/" を付けないとそのパスとしてコピー（copy と完全に同じ）
cp_rf("$tmp/src/hoge.txt", "$tmp/dst4");
that("$tmp/dst4")-&gt;fileEquals('hoge');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$src</code></td>
<td>​<span class="summary">コピー元パス</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$dst</code></td>
<td>​<span class="summary">コピー先パス。末尾/でディレクトリであることを明示できる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">成功した場合に TRUE を、失敗した場合に FALSE を返します</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3c290f398dc6d36153d2675b23f9b1e846d4def4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-dir_clean()" class="anchor"></a>[F] dir_clean <small><span class="summary">指定条件のファイル・ディレクトリを再帰的に消す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/dir_clean.php#L8-L79" target="_blank">dir_clean.php#8~79</a></p>
</div>
<details>
<summary class="">指定条件のファイル・ディレクトリを再帰的に消す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function dir_clean(
    string $directory,
    int $atime = 0,
    int $mtime = 0,
    array|string $excludePattern = []
): array</div></pre>
<div class="description">
<p>tmpwatch みたいなもので、キャッシュなどのゴミ掃除に使う想定。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 1時間以上アクセスのないファイルを消す
dir_clean(sys_get_temp_dir() . '/cache',
    atime: 3600,
);
// 1時間以上更新されていないファイルを消す
dir_clean(sys_get_temp_dir() . '/cache',
    mtime: 3600,
);
// 2時間以上アクセスのない かつ 1時間以上更新されていないファイルを消す（両指定は AND）
dir_clean(sys_get_temp_dir() . '/cache',
    atime: 7200,
    mtime: 3600,
);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$directory</code></td>
<td>​<span class="summary">対象ディレクトリ</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$atime = 0</code></td>
<td>​<span class="summary">対象アクセス日時秒数</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$mtime = 0</code></td>
<td>​<span class="summary">対象更新日時秒数</span></td>
</tr>
<tr>
<td>​array|​string</td>
<td>​<code>$excludePattern = []</code></td>
<td>​<span class="summary">除外パターン</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">消したエントリ配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d77e622032b869753468556765c7cf1bacc7312c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-dir_diff()" class="anchor"></a>[F] dir_diff <small><span class="summary">ファイルツリーを比較して配列で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/dir_diff.php#L9-L115" target="_blank">dir_diff.php#9~115</a></p>
</div>
<details>
<summary class="">ファイルツリーを比較して配列で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function dir_diff(
    string $path1,
    string $path2,
    array $options = []
): array</div></pre>
<div class="description">
<p>ファイル名をキーとし、</p>
<ul class=" simple">
<li>$path1 にしかないファイルは true</li>
<li>$path2 にしかないファイルは false</li>
<li>両方にあり、内容が異なる場合はなんらかの文字列（comparator オプション）</li>
<li>両方にあり、内容が同じ場合は結果に含まれない</li>
</ul>
<p>comparator オプションは両方に存在した場合にコールされるので差分を返したり更新日時を返したリできる。<span class="implicit-br">
</span>comparator が null を返した場合、その要素は内容が同じとみなされ、結果配列に含まれなくなる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルツリーを用意
$dir1 = sys_get_temp_dir() . '/diff1';
$dir2 = sys_get_temp_dir() . '/diff2';
file_set_tree([
    $dir1 =&gt; [
        'file1.txt' =&gt; 'file1',
        'file2.txt' =&gt; 'file2',
        'sub1' =&gt; [
            'file.txt' =&gt; 'sub1file',
        ],
        'sub2' =&gt; [],
    ],
    $dir2 =&gt; [
        'file1.txt' =&gt; 'file1',
        'file2.txt' =&gt; 'FILE2',
        'sub1' =&gt; [],
        'sub2' =&gt; [
            'file.txt' =&gt; 'sub2file',
        ],
    ],
]);
// dir_diff すると下記のような差分が得られる
$DS = DIRECTORY_SEPARATOR;
that(dir_diff($dir1, $dir2))-&gt;is([
    // "file1.txt" =&gt; "",         // 差分がないので含まれない
    "file2.txt" =&gt; "",            // 両方に存在して差分あり
    "sub1{$DS}file.txt" =&gt; true,  // dir1 にのみ存在する
    "sub2{$DS}file.txt" =&gt; false, // dir2 にのみ存在する
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$path1</code></td>
<td>​<span class="summary">パス1</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$path2</code></td>
<td>​<span class="summary">パス2</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">比較配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6c80b1fabf8f9f17aa30b72c0681d6def6e9df3c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-dirmtime()" class="anchor"></a>[F] dirmtime <small><span class="summary">ディレクトリの最終更新日時を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/dirmtime.php#L7-L54" target="_blank">dirmtime.php#7~54</a></p>
</div>
<details>
<summary class="">ディレクトリの最終更新日時を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function dirmtime(
    string $dirname,
    bool $recursive = true
): int</div></pre>
<div class="description">
<p>「ディレクトリの最終更新日時」とは filemtime で得られる結果ではなく、「配下のファイル群で最も新しい日時」を表す。<span class="implicit-br">
</span>ディレクトリの mtime も検出に含まれるので、ファイルを削除した場合も検知できる。</p>
<p>ファイル名を与えると例外を投げる。<span class="implicit-br">
</span>空ディレクトリの場合は自身の mtime を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$dirname = sys_get_temp_dir() . '/mtime';
rm_rf($dirname);
mkdir($dirname);

// この時点では現在日時（単純に自身の更新日時）
that(dirmtime($dirname))-&gt;isBetween(time() - 2, time());
// ファイルを作って更新するとその時刻
touch("$dirname/tmp", time() + 10);
that(dirmtime($dirname))-&gt;isSame(time() + 10);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$dirname</code></td>
<td>​<span class="summary">ディレクトリ名</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$recursive = true</code></td>
<td>​<span class="summary">再帰フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">最終更新日時</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4fa2ed560f25ed5e0f4dc3d630103985f0ee3f29-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-dirname_r()" class="anchor"></a>[F] dirname_r <small><span class="summary">コールバックが true 相当を返すまで親ディレクトリを辿り続ける</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/dirname_r.php#L7-L40" target="_blank">dirname_r.php#7~40</a></p>
</div>
<details>
<summary class="">コールバックが true 相当を返すまで親ディレクトリを辿り続ける</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function dirname_r(
    string $path,
    callable $callback
): mixed</div></pre>
<div class="description">
<p>コールバックには親ディレクトリが引数として渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// //tmp/a/b/file.txt を作っておく
$tmp = sys_get_temp_dir();
file_set_contents("$tmp/a/b/file.txt", 'hoge');
// /a/b/c/d/e/f から開始して「どこかの階層の file.txt を探したい」という状況を想定
$callback = fn($path) =&gt; realpath("$path/file.txt");
that(dirname_r("$tmp/a/b/c/d/e/f", $callback))-&gt;isSame(realpath("$tmp/a/b/file.txt"));</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$path</code></td>
<td>​<span class="summary">パス名</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">コールバック</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">$callback の返り値。頂上まで辿ったら null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_18957a1661d304e41384310697c3d10206b11e4f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_equals()" class="anchor"></a>[F] file_equals <small><span class="summary">ファイルが同じ内容か返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_equals.php#L8-L84" target="_blank">file_equals.php#8~84</a></p>
</div>
<details>
<summary class="">ファイルが同じ内容か返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_equals(
    string $file1,
    string $file2,
    ?int $chunk_size = null
): bool</div></pre>
<div class="description">
<p>ファイルサイズで比較して一致したら更に内容を読んで判定する。<span class="implicit-br">
</span>ディレクトリ同士の場合は直下のファイル群を内容とみなして判定する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルを用意
$testpath1 = sys_get_temp_dir() . '/file_equals1.txt';
$testpath2 = sys_get_temp_dir() . '/file_equals2.txt';
$testpath3 = sys_get_temp_dir() . '/file_equals3.txt';
file_put_contents($testpath1, "hoge");
file_put_contents($testpath2, "foo");
file_put_contents($testpath3, "hoge");
// 異なるなら false
that(file_equals($testpath1, $testpath2))-&gt;isFalse();
// 同じなら true
that(file_equals($testpath1, $testpath3))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$file1</code></td>
<td>​<span class="summary">ファイル名1</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$file2</code></td>
<td>​<span class="summary">ファイル名2</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$chunk_size = null</code></td>
<td>​<span class="summary">読み込みチャンクサイズ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">ファイルが同じ内容なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c88edac6f071ed62da5fc8762861c5c510a92ec7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_extension()" class="anchor"></a>[F] file_extension <small><span class="summary">ファイルの拡張子を変更する。引数を省略すると拡張子を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_extension.php#L7-L43" target="_blank">file_extension.php#7~43</a></p>
</div>
<details>
<summary class="">ファイルの拡張子を変更する。引数を省略すると拡張子を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_extension(
    string $filename,
    string $extension = ""
): string</div></pre>
<div class="description">
<p>pathinfo に準拠。例えば「filename.hoge.fuga」のような形式は「fuga」が変換対象になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(file_extension('filename.ext'))-&gt;isSame('ext');
that(file_extension('filename.ext', 'txt'))-&gt;isSame('filename.txt');
that(file_extension('filename.ext', ''))-&gt;isSame('filename');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">調べるファイル名</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$extension = ""</code></td>
<td>​<span class="summary">拡張子。nullや空文字なら拡張子削除</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">拡張子変換後のファイル名 or 拡張子</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6b04ee336833dcf1735c8b540854e60b8b88d0eb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_get_arrays()" class="anchor"></a>[F] file_get_arrays <small><span class="summary">指定ファイルを拡張子別に php の配列として読み込む</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_get_arrays.php#L10-L94" target="_blank">file_get_arrays.php#10~94</a></p>
</div>
<details>
<summary class="">指定ファイルを拡張子別に php の配列として読み込む</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_get_arrays(
    string $filename,
    array $options = []
): array</div></pre>
<div class="description">
<p>形式は拡張子で自動判別する。<span class="implicit-br">
</span>その際、2重拡張子で hoge.sjis.csv のように指定するとそのファイルのエンコーディングを指定したことになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// csv ファイルを読み込んで配列で返す
file_put_contents($csvfile = sys_get_temp_dir() . '/hoge.csv', 'a,b,c
1,2,3
4,5,6
7,8,9
');
that(file_get_arrays($csvfile))-&gt;isSame([
    ['a' =&gt; '1', 'b' =&gt; '2', 'c' =&gt; '3'],
    ['a' =&gt; '4', 'b' =&gt; '5', 'c' =&gt; '6'],
    ['a' =&gt; '7', 'b' =&gt; '8', 'c' =&gt; '9'],
]);

// sjis の json ファイルを読み込んで配列で返す
file_put_contents($jsonfile = sys_get_temp_dir() . '/hoge.sjis.json', '[
{"a": 1, "b": 2, "c": 3},
{"a": 4, "b": 5, "c": 6},
{"a": 7, "b": 8, "c": 9}
]');
that(file_get_arrays($jsonfile))-&gt;isSame([
    ['a' =&gt; 1, 'b' =&gt; 2, 'c' =&gt; 3],
    ['a' =&gt; 4, 'b' =&gt; 5, 'c' =&gt; 6],
    ['a' =&gt; 7, 'b' =&gt; 8, 'c' =&gt; 9],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">読み込むファイル名</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">各種オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">レコード配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9a6c9c070f1d0c1fe59fc79aa0a9f48477af790e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_list()" class="anchor"></a>[F] file_list <small><span class="summary">ファイル一覧を配列で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_list.php#L11-L114" target="_blank">file_list.php#11~114</a></p>
</div>
<details>
<summary class="">ファイル一覧を配列で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_list(
    string $dirname,
    array $filter_condition = []
): ?array</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルを用意
$DS = DIRECTORY_SEPARATOR;
$tmp = sys_get_temp_dir() . "{$DS}file_list";
rm_rf($tmp, false);
file_set_contents("$tmp/a.txt", 'a');
file_set_contents("$tmp/dir/b.txt", 'b');
file_set_contents("$tmp/dir/dir/c.txt", 'c');
// ファイル一覧が取得できる
that(file_list($tmp))-&gt;equalsCanonicalizing([
    "$tmp{$DS}a.txt",
    "$tmp{$DS}dir{$DS}b.txt",
    "$tmp{$DS}dir{$DS}dir{$DS}c.txt",
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$dirname</code></td>
<td>​<span class="summary">調べるディレクトリ名</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$filter_condition = []</code></td>
<td>​<span class="summary">フィルタ条件</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?array</td>
<td>​<span class="summary">ファイルの配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8dda5b3641fd528daeda8d3a5056bc1cc39626b0-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_matcher()" class="anchor"></a>[F] file_matcher <small><span class="summary">各種属性を指定してファイルのマッチングを行うクロージャを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_matcher.php#L12-L223" target="_blank">file_matcher.php#12~223</a></p>
</div>
<details>
<summary class="">各種属性を指定してファイルのマッチングを行うクロージャを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_matcher(array $filter_condition): \Closure</div></pre>
<div class="description">
<p>※ 内部向け</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$filter_condition</code></td>
<td>​<span class="summary">マッチャーコンディション配列（ソースを参照）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<span class="summary">ファイルマッチャー</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6b4af7154bf0f910a0dbfeeb10f9592062f96e5b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_mimetype()" class="anchor"></a>[F] file_mimetype <small><span class="summary">ファイルの mimetype を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_mimetype.php#L10-L81" target="_blank">file_mimetype.php#10~81</a></p>
</div>
<details>
<summary class="">ファイルの mimetype を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_mimetype(
    string $filename,
    array|bool $prefer_extension = [],
    ?array &amp;$parameters = null
): string|null</div></pre>
<div class="description">
<p>mime_content_type の http 対応版。<span class="implicit-br">
</span>変更点は下記。</p>
<ul class=" simple">
<li>http(s) に対応（HEAD メソッドで取得する）</li>
<li>失敗時に false ではなく null を返す</li>
</ul>
<p>for compatible: $prefer_extension と $parameters 引数は将来的に入れ替わる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(file_mimetype(__FILE__))-&gt;is('text/x-php');
that(file_mimetype('http://httpbin.org/get?name=value'))-&gt;is('application/json');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">ファイル名（URL）</span></td>
</tr>
<tr>
<td>​array|​bool</td>
<td>​<code>$prefer_extension = []</code></td>
<td>​<span class="summary">extension =&gt; mimetype のマップ（true を与えると組み込みを使用する）</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>&amp;$parameters = null</code></td>
<td>​<span class="summary">引数=値 の連想配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​null</td>
<td>​<span class="summary">MIME タイプ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e90935fbffcf944eccdf94a1ba89ca90de3fdbd5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_pos()" class="anchor"></a>[F] file_pos <small><span class="summary">範囲指定でファイルを読んで位置を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_pos.php#L9-L88" target="_blank">file_pos.php#9~88</a></p>
</div>
<details>
<summary class="">範囲指定でファイルを読んで位置を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_pos(
    string $filename,
    string|array $needle,
    int $start = 0,
    int|null $end = null,
    int|null $chunksize = null
): ?int</div></pre>
<div class="description">
<p>$needle に配列を与えると OR 的動作で一つでも見つかった時点の位置を返す。<span class="implicit-br">
</span>このとき「どれが見つかったか？」は得られない（場合によっては不便なので将来の改修対象）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルを用意
$testpath = sys_get_temp_dir() . '/file_pos.txt';
file_put_contents($testpath, "hoge\nfuga\npiyo\nfuga");
// fuga の位置を返す
that(file_pos($testpath, 'fuga'))-&gt;is(5);
// 2つ目の fuga の位置を返す
that(file_pos($testpath, 'fuga', 6))-&gt;is(15);
// 見つからない場合は false を返す
that(file_pos($testpath, 'hogera'))-&gt;is(null);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">ファイル名</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">探す文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$start = 0</code></td>
<td>​<span class="summary">読み込み位置</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$end = null</code></td>
<td>​<span class="summary">読み込むまでの位置。省略時は指定なし（最後まで）。負数は後ろからのインデックス</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$chunksize = null</code></td>
<td>​<span class="summary">読み込みチャンクサイズ。省略時は 4096 の倍数に正規化</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?int</td>
<td>​<span class="summary">$needle の位置。見つからなかった場合は null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_33ff71f7e14bc853a8cdd157b54e2167a1ab2d55-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_rewrite_contents()" class="anchor"></a>[F] file_rewrite_contents <small><span class="summary">ファイルを読み込んで内容をコールバックに渡して書き込む</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_rewrite_contents.php#L7-L68" target="_blank">file_rewrite_contents.php#7~68</a></p>
</div>
<details>
<summary class="">ファイルを読み込んで内容をコールバックに渡して書き込む</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_rewrite_contents(
    string $filename,
    callable $callback,
    int $operation = 0
): int</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルを用意
$testpath = sys_get_temp_dir() . '/rewrite.txt';
file_put_contents($testpath, 'hoge');
// 前後に 'pre-', '-fix' を付与する
file_rewrite_contents($testpath, fn($contents, $fp) =&gt; "pre-$contents-fix");
that($testpath)-&gt;fileEquals('pre-hoge-fix');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">読み書きするファイル名</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">書き込む内容。引数で $contents, $fp が渡ってくる</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$operation = 0</code></td>
<td>​<span class="summary">ロック定数（LOCL_SH, LOCK_EX, LOCK_NB）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">書き込まれたバイト数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6642d312be81710e7f0d8f46d594fc9c2c33a928-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_rotate()" class="anchor"></a>[F] file_rotate <small><span class="summary">ファイルをローテーションする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_rotate.php#L9-L140" target="_blank">file_rotate.php#9~140</a></p>
</div>
<details>
<summary class="">ファイルをローテーションする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_rotate(
    string $filename,
    bool $ifempty = false,
    bool $copytruncate = false,
    bool $append = false,
    ?string $olddir = null,
    ?string $dateformat = null,
    ?int $rotate = null,
    ?int $compress = null
): ?array</div></pre>
<div class="description">
<p>オプションは logrotate に意図的に似せてある。<span class="implicit-br">
</span>返り値としてローテーションファイル配列を返す。<span class="implicit-br">
</span>基本的に決め打ちな使い方で細かいオプションは実装していない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルを用意
rm_rf(sys_get_temp_dir() . '/rotate');
$logfile = sys_get_temp_dir() . '/rotate/log.txt';
file_set_contents($logfile, '');
// 5回ローテートしてみる
foreach (range(1, 5) as $i) {
    file_rotate($logfile, ifempty: true, rotate: 4, compress: 2, dateformat: "-$i"); // dateformat は普通は日付書式文字列（↓の確認がしんどくなるのでここでは連番）
}
// rotate:4 効果で全部で4世代であり、compress:2 効果でうち2世代は圧縮されている
$dirname = dirname($logfile);
that(glob("$dirname/log-*"))-&gt;is([
    "$dirname/log-2.txt.gz",
    "$dirname/log-3.txt.gz",
    "$dirname/log-4.txt",
    "$dirname/log-5.txt",
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">対象ファイル名</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$ifempty = false</code></td>
<td>​<span class="summary">空ファイルでもローテーションするか</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$copytruncate = false</code></td>
<td>​<span class="summary">同じファイル（inode）を使い続けるか</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$append = false</code></td>
<td>​<span class="summary">既存ローテーションファイルに追記するか</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$olddir = null</code></td>
<td>​<span class="summary">ローテーションファイルのディレクトリ</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$dateformat = null</code></td>
<td>​<span class="summary">ローテーションファイルのサフィックス</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$rotate = null</code></td>
<td>​<span class="summary">保持世代数（null で無世代）</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$compress = null</code></td>
<td>​<span class="summary">圧縮世代数（例えば 3 を指定すると3世代目から圧縮される）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?array</td>
<td>​<span class="summary">ローテーションファイル配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ce76bfa7e7c4568a5ef8b23c1266a983f1949c1a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_set_contents()" class="anchor"></a>[F] file_set_contents <small><span class="summary">ディレクトリも掘る file_put_contents</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_set_contents.php#L9-L56" target="_blank">file_set_contents.php#9~56</a></p>
</div>
<details>
<summary class="">ディレクトリも掘る file_put_contents</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_set_contents(
    string $filename,
    string $data,
    int $umask = 2
): ?int</div></pre>
<div class="description">
<p>書き込みは一時ファイルと rename を使用してアトミックに行われる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">file_set_contents(sys_get_temp_dir() . '/not/filename.ext', 'hoge');
that(file_get_contents(sys_get_temp_dir() . '/not/filename.ext'))-&gt;isSame('hoge');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">書き込むファイル名</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$data</code></td>
<td>​<span class="summary">書き込む内容</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$umask = 2</code></td>
<td>​<span class="summary">ディレクトリを掘る際の umask</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?int</td>
<td>​<span class="summary">書き込まれたバイト数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a5dd32a53c185f9bcf27ffdf7815623ec26fd559-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_set_tree()" class="anchor"></a>[F] file_set_tree <small><span class="summary">ツリー構造で file_set_contents する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_set_tree.php#L10-L67" target="_blank">file_set_tree.php#10~67</a></p>
</div>
<details>
<summary class="">ツリー構造で file_set_contents する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_set_tree(
    array $contents_tree,
    ?int $umask = null
): array</div></pre>
<div class="description">
<p>値が配列の場合はディレクトリ、それ以外の場合はファイルとなる。<span class="implicit-br">
</span>値がクロージャーの場合はコールされる。<span class="implicit-br">
</span>返り値として書き込んだバイト数のフルパス配列を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 一時ディレクトリにツリー構造でファイルを配置する
$root = sys_get_temp_dir();
file_set_tree([
    $root =&gt; [
        'hoge.txt' =&gt; 'HOGE',
        'dir1' =&gt; [
            'fuga.txt' =&gt; 'FUGA',
            'dir2'     =&gt; [
                'piyo.txt' =&gt; 'PIYO',
            ],
        ],
    ],
]);
that("$root/hoge.txt")-&gt;fileEquals('HOGE');
that("$root/dir1/fuga.txt")-&gt;fileEquals('FUGA');
that("$root/dir1/dir2/piyo.txt")-&gt;fileEquals('PIYO');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$contents_tree</code></td>
<td>​<span class="summary">コンテンツツリー</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$umask = null</code></td>
<td>​<span class="summary">umask</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">書き込まれたバイト数配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_bf765898be8828226aa5c3be99215ad5fb3958f5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_slice()" class="anchor"></a>[F] file_slice <small><span class="summary">file の行範囲を指定できる板</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_slice.php#L7-L111" target="_blank">file_slice.php#7~111</a></p>
</div>
<details>
<summary class="">file の行範囲を指定できる板</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_slice(
    string $filename,
    int $start_line = 1,
    ?int $length = null,
    int $flags = 0,
    ?resource $context = null
): array</div></pre>
<div class="description">
<p>原則 file をベースに作成しているが、一部独自仕様がある。</p>
<ul class=" simple">
<li>結果配列は行番号がキーになる<ul class=" simple">
<li>あくまで行番号なので 1 オリジン</li>
<li>スキップされた行は歯抜けになる</li>
</ul>
</li>
<li>FILE_SKIP_EMPTY_LINES の動作が FILE_IGNORE_NEW_LINES ありきではない<ul class=" simple">
<li>file における FILE_SKIP_EMPTY_LINES の単独指定は意味を成さないっぽい<ul class=" simple">
<li>FILE_IGNORE_NEW_LINES しないと空文字ではなく改行文字が含まれるので空判定にならないようだ</li>
</ul>
</li>
<li>この関数はその動作を撤廃しており、単独で FILE_SKIP_EMPTY_LINES を指定しても空行が飛ばされる動作になっている</li>
</ul>
</li>
<li>$end_line に負数を指定すると行番号の直指定となる<ul class=" simple">
<li><code>file_slice($filename, 120, -150)</code> で 120行目から150行目までを読む</li>
<li>負数なのは気持ち悪いが、範囲指定のハイフン（120-150）だと思えば割と自然</li>
</ul>
</li>
</ul>
<p>使用用途としては</p>
<ol class="">
<li>巨大ファイルの前半だけ読みたい</li>
<li>1行だけサクッと読みたい</li>
</ol>
<p>が挙げられる。</p>
<p>1 は自明（file は全行読む）だが、終端付近を読む場合は file の方が若干速い。<span class="implicit-br">
</span>ただし、期待値としてはこの関数の方が格段に低い（file は下手すると何十倍も遅い）。</p>
<p>2 は典型的には「1行目だけ読みたい」場合、fopen+fgets+fclose(finally)という手順を踏む必要があり煩雑になる。<span class="implicit-br">
</span>この関数を使えばサクッと取得することができる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルを用意（奇数行は行番号、偶数行は空行）
$testpath = sys_get_temp_dir() . '/file_slice.txt';
file_put_contents($testpath, implode("\n", array_map(fn($n) =&gt; $n % 2 ? $n : "", range(1, 20))));
// 3行目から4行を返す
that(file_slice($testpath, 3, 4))-&gt;is([
    3 =&gt; "3\n",
    4 =&gt; "\n",
    5 =&gt; "5\n",
    6 =&gt; "\n",
]);
// 3行目から6行目までを返す
that(file_slice($testpath, 3, -6))-&gt;is([
    3 =&gt; "3\n",
    4 =&gt; "\n",
    5 =&gt; "5\n",
    6 =&gt; "\n",
]);
// 改行文字や空行を含めない（キーは保持される）
that(file_slice($testpath, 3, 4, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES))-&gt;is([
    3 =&gt; "3",
    5 =&gt; "5",
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">ファイル名</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$start_line = 1</code></td>
<td>​<span class="summary">開始行。1 オリジン</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$length = null</code></td>
<td>​<span class="summary">終了行。null を指定すると最後まで読む。負数にすると行番号直指定になる</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">file と同じフラグ定数（FILE_IGNORE_NEW_LINES, etc）</span></td>
</tr>
<tr>
<td>​?resource</td>
<td>​<code>$context = null</code></td>
<td>​<span class="summary">file と同じ context 指定</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">部分行</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9a0f76c27ebf65f4f8f0dac7e12e84a852965837-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_suffix()" class="anchor"></a>[F] file_suffix <small><span class="summary">ファイル名にサフィックスを付与する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_suffix.php#L7-L42" target="_blank">file_suffix.php#7~42</a></p>
</div>
<details>
<summary class="">ファイル名にサフィックスを付与する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_suffix(
    string $filename,
    string $suffix
): string</div></pre>
<div class="description">
<p>pathinfoに非準拠。例えば「filename.hoge.fuga」のような形式は「filename」が変換対象になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(file_suffix('filename.ext', '-min'))-&gt;isSame('filename-min.ext');
that(file_suffix('filename.ext1.ext2', '-min'))-&gt;isSame('filename-min.ext1.ext2');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">パス・ファイル名</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$suffix</code></td>
<td>​<span class="summary">付与するサフィックス</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">サフィックスが付与されたパス名</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c9020aafcf94be74a52658ca557f27410b716802-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-file_tree()" class="anchor"></a>[F] file_tree <small><span class="summary">ディレクトリ階層をツリー構造で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/file_tree.php#L9-L74" target="_blank">file_tree.php#9~74</a></p>
</div>
<details>
<summary class="">ディレクトリ階層をツリー構造で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function file_tree(
    string $dirname,
    array $filter_condition = []
): ?array</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 適当にファイルを用意
$DS = DIRECTORY_SEPARATOR;
$tmp = sys_get_temp_dir() . "{$DS}file_tree";
rm_rf($tmp, false);
file_set_contents("$tmp/a.txt", 'a');
file_set_contents("$tmp/dir/b.txt", 'b');
file_set_contents("$tmp/dir/dir/c.txt", 'c');
// ファイルツリーが取得できる
that(file_tree($tmp))-&gt;is([
    'file_tree' =&gt; [
        'a.txt' =&gt; "$tmp{$DS}a.txt",
        'dir'   =&gt; [
            'b.txt' =&gt; "$tmp{$DS}dir{$DS}b.txt",
            'dir'   =&gt; [
                'c.txt' =&gt; "$tmp{$DS}dir{$DS}dir{$DS}c.txt",
            ],
        ],
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$dirname</code></td>
<td>​<span class="summary">調べるディレクトリ名</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$filter_condition = []</code></td>
<td>​<span class="summary">フィルタ条件</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?array</td>
<td>​<span class="summary">ツリー構造の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7b3702f285aba3ad621877209754a240308594c3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-fnmatch_and()" class="anchor"></a>[F] fnmatch_and <small><span class="summary">fnmatch の AND 版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/fnmatch_and.php#L8-L42" target="_blank">fnmatch_and.php#8~42</a></p>
</div>
<details>
<summary class="">fnmatch の AND 版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function fnmatch_and(
    array|string $patterns,
    string $string,
    int $flags = 0
): bool</div></pre>
<div class="description">
<p>$patterns のうちどれか一つでもマッチしなかったら false を返す。<span class="implicit-br">
</span>$patterns が空だと例外を投げる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// すべてにマッチするので true
that(fnmatch_and(['*aaa*', '*bbb*'], 'aaaXbbbX'))-&gt;isTrue();
// aaa にはマッチするが bbb にはマッチしないので false
that(fnmatch_and(['*aaa*', '*bbb*'], 'aaaX'))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​string</td>
<td>​<code>$patterns</code></td>
<td>​<span class="summary">パターン配列（単一文字列可）</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">調べる文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">FNM_***</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">すべてにマッチしたら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_da3a7fcab1b5350c146712cd32999fc7bc6abba7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-fnmatch_or()" class="anchor"></a>[F] fnmatch_or <small><span class="summary">fnmatch の OR 版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/fnmatch_or.php#L8-L42" target="_blank">fnmatch_or.php#8~42</a></p>
</div>
<details>
<summary class="">fnmatch の OR 版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function fnmatch_or(
    array|string $patterns,
    string $string,
    int $flags = 0
): bool</div></pre>
<div class="description">
<p>$patterns のうちどれか一つでもマッチしたら true を返す。<span class="implicit-br">
</span>$patterns が空だと例外を投げる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// aaa にマッチするので true
that(fnmatch_or(['*aaa*', '*bbb*'], 'aaaX'))-&gt;isTrue();
// どれともマッチしないので false
that(fnmatch_or(['*aaa*', '*bbb*'], 'cccX'))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​string</td>
<td>​<code>$patterns</code></td>
<td>​<span class="summary">パターン配列（単一文字列可）</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">調べる文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">FNM_***</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">どれかにマッチしたら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0c34178f318046ae5ea61732526f94b6e0e1161b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-globstar()" class="anchor"></a>[F] globstar <small><span class="summary">globstar（再帰パターン有効）な glob</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/globstar.php#L7-L51" target="_blank">globstar.php#7~51</a></p>
</div>
<details>
<summary class="">globstar（再帰パターン有効）な glob</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function globstar(
    string $pattern,
    int $flags = 0
): ?array</div></pre>
<div class="description">
<p>file_list でも代替可能だが、もっと手軽にササっとファイル一覧が欲しいこともある。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$pattern</code></td>
<td>​<span class="summary">glob パターン。** が使えること以外は glob と同じ</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">glob フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?array</td>
<td>​<span class="summary">マッチしたファイル名配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c7dacc65a43bf138423d568d47ab83db610c77e1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mkdir_p()" class="anchor"></a>[F] mkdir_p <small><span class="summary">ディレクトリを再帰的に掘る</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/mkdir_p.php#L7-L29" target="_blank">mkdir_p.php#7~29</a></p>
</div>
<details>
<summary class="">ディレクトリを再帰的に掘る</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mkdir_p(
    string $dirname,
    int $umask = 2
): bool</div></pre>
<div class="description">
<p>既に存在する場合は何もしない（エラーも出さない）。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$dirname</code></td>
<td>​<span class="summary">ディレクトリ名</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$umask = 2</code></td>
<td>​<span class="summary">ディレクトリを掘る際の umask</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">作成したら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_02f97e89679206cc98f323c9c2bef5229421ecb6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-path_is_absolute()" class="anchor"></a>[F] path_is_absolute <small><span class="summary">パスが絶対パスか判定する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/path_is_absolute.php#L7-L48" target="_blank">path_is_absolute.php#7~48</a></p>
</div>
<details>
<summary class="">パスが絶対パスか判定する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function path_is_absolute(string $path): bool</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(path_is_absolute('/absolute/path'))-&gt;isTrue();
that(path_is_absolute('relative/path'))-&gt;isFalse();
// Windows 環境では下記も true になる
if (DIRECTORY_SEPARATOR === '\\') {
    that(path_is_absolute('\\absolute\\path'))-&gt;isTrue();
    that(path_is_absolute('C:\\absolute\\path'))-&gt;isTrue();
}</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$path</code></td>
<td>​<span class="summary">パス文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">絶対パスなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0d80351aff160eb22148901eef88ff0d1751747f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-path_normalize()" class="anchor"></a>[F] path_normalize <small><span class="summary">パスを正規化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/path_normalize.php#L7-L69" target="_blank">path_normalize.php#7~69</a></p>
</div>
<details>
<summary class="">パスを正規化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function path_normalize(string $path): string</div></pre>
<div class="description">
<p>具体的には ./ や ../ を取り除いたり連続したディレクトリ区切りをまとめたりする。<span class="implicit-br">
</span>realpath ではない。のでシンボリックリンクの解決などはしない。その代わりファイルが存在しなくても使用することができる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$DS = DIRECTORY_SEPARATOR;
that(path_normalize('/path/to/something'))-&gt;isSame("{$DS}path{$DS}to{$DS}something");
that(path_normalize('/path/through/../something'))-&gt;isSame("{$DS}path{$DS}something");
that(path_normalize('./path/current/./through/../something'))-&gt;isSame("path{$DS}current{$DS}something");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$path</code></td>
<td>​<span class="summary">パス文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">正規化されたパス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0c0b42b54af9d7c26018172f0aed4035570c1672-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-path_parse()" class="anchor"></a>[F] path_parse <small><span class="summary">パスをパースする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/path_parse.php#L7-L156" target="_blank">path_parse.php#7~156</a></p>
</div>
<details>
<summary class="">パスをパースする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function path_parse(string $path): array</div></pre>
<div class="description">
<p>pathinfo の（ほぼ）上位互換で下記の差異がある。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>drive</dt>
<dd>Windows 環境におけるドライブ文字</dd>
</div>
<div class="dtdd-container">
<dt>root</dt>
<dd>絶対パスの場合はルートパス</dd>
</div>
<div class="dtdd-container">
<dt>parents</dt>
<dd>正規化したディレクトリ名の配列</dd>
</div>
<div class="dtdd-container">
<dt>dirnames</dt>
<dd>ディレクトリ名の配列（余計なことはしない）</dd>
</div>
<div class="dtdd-container">
<dt>localname</dt>
<dd>複数拡張子を考慮した本当のファイル名部分</dd>
</div>
<div class="dtdd-container">
<dt>localpath</dt>
<dd>ディレクトリ名（余計なことはしない）＋複数拡張子を考慮した本当のファイル名部分（フルパス - 拡張子）</dd>
</div>
<div class="dtdd-container">
<dt>extensions</dt>
<dd>複数拡張子の配列（余計なことはしない）</dd>
</div>
</dl>
<p>「余計なことはしない」とは空文字をフィルタしたりパスを正規化したりを指す。<span class="implicit-br">
</span>結果のキーはバージョンアップで増えることがある（その場合は互換性破壊とはみなさない）。</p>
<p>なお、いわゆる URL はサポートしない（スキーム付きを与えた場合の挙動は未定義）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$DS = DIRECTORY_SEPARATOR;
// 色々混ぜたサンプル
that(path_parse('C:/dir1/.././dir2/file.sjis..min.js'))-&gt;is([
    "dirname"    =&gt; "C:/dir1/.././dir2",
    "basename"   =&gt; "file.sjis..min.js",
    "extension"  =&gt; "js",
    "filename"   =&gt; "file.sjis..min",
    // ここまでオリジナルの pathinfo 結果
    "drive"      =&gt; "C:",
    "root"       =&gt; "/",                          // 環境依存しない元のルートパス
    "parents"    =&gt; ["dir2"],                     // 正規化されたディレクトリ配列
    "dirnames"   =&gt; ["dir1", "..", ".", "dir2"],  // 余計なことをしていないディレクトリ配列
    "localname"  =&gt; "file",                       // 複数拡張子を考慮した本当のファイル名部分
    "localpath"  =&gt; "C:/dir1/.././dir2{$DS}file", // ↑にディレクトリ名を付与したもの
    "extensions" =&gt; ["sjis", "", "min", "js"],    // 余計なことをしていない拡張子配列
]);
// linux における絶対パス
that(path_parse('/dir1/dir2/file.sjis.min.js'))-&gt;is([
    "dirname"    =&gt; "/dir1/dir2",
    "basename"   =&gt; "file.sjis.min.js",
    "extension"  =&gt; "js",
    "filename"   =&gt; "file.sjis.min",
    // ここまでオリジナルの pathinfo 結果
    "drive"      =&gt; "",                    // 環境を問わず空
    "root"       =&gt; "/",                   // 絶対パスなので "/"
    "parents"    =&gt; ["dir1", "dir2"],      // ..等がないので dirnames と同じ
    "dirnames"   =&gt; ["dir1", "dir2"],      // ディレクトリ配列
    "localname"  =&gt; "file",
    "localpath"  =&gt; "/dir1/dir2{$DS}file",
    "extensions" =&gt; ["sjis", "min", "js"], // 余計なことをしていない拡張子配列
]);
// linux における相対パス
that(path_parse('dir1/dir2/file.sjis.min.js'))-&gt;is([
    "dirname"    =&gt; "dir1/dir2",
    "basename"   =&gt; "file.sjis.min.js",
    "extension"  =&gt; "js",
    "filename"   =&gt; "file.sjis.min",
    // ここまでオリジナルの pathinfo 結果
    "drive"      =&gt; "",
    "root"       =&gt; "",                    // 相対パスなので空（ここ以外は絶対パスと同じ）
    "parents"    =&gt; ["dir1", "dir2"],
    "dirnames"   =&gt; ["dir1", "dir2"],
    "localname"  =&gt; "file",
    "localpath"  =&gt; "dir1/dir2{$DS}file",
    "extensions" =&gt; ["sjis", "min", "js"],
]);
// ディレクトリ無し
that(path_parse('file.sjis.min.js'))-&gt;is([
    "dirname"    =&gt; ".",
    "basename"   =&gt; "file.sjis.min.js",
    "extension"  =&gt; "js",
    "filename"   =&gt; "file.sjis.min",
    // ここまでオリジナルの pathinfo 結果
    "drive"      =&gt; "",
    "root"       =&gt; "",
    "parents"    =&gt; [], // オリジナルの pathinfo のようにドットが紛れ込んだりはしない
    "dirnames"   =&gt; [], // オリジナルの pathinfo のようにドットが紛れ込んだりはしない
    "localname"  =&gt; "file",
    "localpath"  =&gt; "file",
    "extensions" =&gt; ["sjis", "min", "js"],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$path</code></td>
<td>​<span class="summary">パス</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">パス情報</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_46e1ca8431984f3612ccc21e9c115c957a648ac2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-path_relative()" class="anchor"></a>[F] path_relative <small><span class="summary">パスを相対パスに変換して正規化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/path_relative.php#L8-L39" target="_blank">path_relative.php#8~39</a></p>
</div>
<details>
<summary class="">パスを相対パスに変換して正規化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function path_relative(
    string $from,
    string $to
): string</div></pre>
<div class="description">
<p>$from から $to への相対パスを返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$DS = DIRECTORY_SEPARATOR;
that(path_relative('/a/b/c/X', '/a/b/c/d/X'))-&gt;isSame("..{$DS}d{$DS}X");
that(path_relative('/a/b/c/d/X', '/a/b/c/X'))-&gt;isSame("..{$DS}..{$DS}X");
that(path_relative('/a/b/c/X', '/a/b/c/X'))-&gt;isSame("");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$from</code></td>
<td>​<span class="summary">元パス</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$to</code></td>
<td>​<span class="summary">対象パス</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">相対パス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_04c3163a3c4ea8b02c48ee752990d94d9f332c95-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-path_resolve()" class="anchor"></a>[F] path_resolve <small><span class="summary">パスを絶対パスに変換して正規化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/path_resolve.php#L9-L46" target="_blank">path_resolve.php#9~46</a></p>
</div>
<details>
<summary class="">パスを絶対パスに変換して正規化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function path_resolve(string ...$paths): ?string</div></pre>
<div class="description">
<p>可変引数で与えられた文字列群を結合して絶対パス化して返す。<span class="implicit-br">
</span>出来上がったパスが絶対パスでない場合は PATH 環境変数を使用して解決を試みる。<span class="implicit-br">
</span>それでも絶対パスにできない場合は null を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$DS = DIRECTORY_SEPARATOR;
that(path_resolve('/absolute/path'))-&gt;isSame("{$DS}absolute{$DS}path");
that(path_resolve('/absolute/path/through', '../current/./path'))-&gt;isSame("{$DS}absolute{$DS}path{$DS}current{$DS}path");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>...$paths</code></td>
<td>​<span class="summary">パス文字列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">絶対パス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0e81a7fdc00848624a2aeb2debcfcd1107e64720-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-rm_rf()" class="anchor"></a>[F] rm_rf <small><span class="summary">中身があっても消せる rmdir</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/rm_rf.php#L7-L59" target="_blank">rm_rf.php#7~59</a></p>
</div>
<details>
<summary class="">中身があっても消せる rmdir</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function rm_rf(
    string $dirname,
    bool $self = true
): bool</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">mkdir(sys_get_temp_dir() . '/new/make/dir', 0777, true);
rm_rf(sys_get_temp_dir() . '/new');
that(file_exists(sys_get_temp_dir() . '/new'))-&gt;isSame(false);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$dirname</code></td>
<td>​<span class="summary">削除するディレクトリ名。glob パターンが使える</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$self = true</code></td>
<td>​<span class="summary">自分自身も含めるか。false を与えると中身だけを消す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">成功した場合に TRUE を、失敗した場合に FALSE を返します</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_95c551eafcf5595b97ddd364408f2103eb9ef549-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-rsync()" class="anchor"></a>[F] rsync <small><span class="summary">php レイヤーで rsync 的なことをする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/rsync.php#L20-L461" target="_blank">rsync.php#20~461</a></p>
</div>
<details>
<summary class="">php レイヤーで rsync 的なことをする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function rsync(
    string $src,
    string $dst,
    array $options = []
): \Generator</div></pre>
<div class="description">
<p>rsync プロトコルを喋ったりオプションを完全網羅していたりはしない（意図的に合わせたりはしているが）。<span class="implicit-br">
</span>単純に必要に迫られて実装したものであり、効率も度外視。</p>
<p>generator で実装されており、動作ログを generate する。<span class="implicit-br">
</span>generator は返り値として統計情報を返す。</p>
<p>ただの劣化 rsync だが php 実装なのでストリームラッパーさえ実装すればプロトコルを超えることができる。<span class="implicit-br">
</span>やる気になればリモート間転送も可能（自身経由なので速度は劣悪になるが）。<span class="implicit-br">
</span>つまり file -&gt; S3 や S3 -&gt; S3 等も可能。</p>
<p>generate される文字列は互換性を担保しない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$src</code></td>
<td>​<span class="summary">送信側ディレクトリ</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$dst</code></td>
<td>​<span class="summary">受信側ディレクトリ</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.generator.php" target="_blank">Generator</a></td>
<td>​<span class="summary">動作ログを返す generator</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e56b989afb5f41843e63406fdbb1bb1995ee5a92-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strmode()" class="anchor"></a>[F] strmode <small><span class="summary">8進数値を ls -l 準拠なパーミッション文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/strmode.php#L7-L70" target="_blank">strmode.php#7~70</a></p>
</div>
<details>
<summary class="">8進数値を ls -l 準拠なパーミッション文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strmode(int $octet): string</div></pre>
<div class="description">
<p>000_0000 のような6桁を想定しているが、 0000 のような3桁でも受け入れる。<span class="implicit-br">
</span>その場合、ファイル種別のプレフィックスは付与されず、 "rwxrwxrwx" のような9文字を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 通常ファイル 0700
that(strmode(010_0700))-&gt;is('-rwx------');
// ディレクトリ 0770
that(strmode(004_0770))-&gt;is('drwxrwx---');
// ファイル種別はなくても良い
that(strmode(0770))-&gt;is('rwxrwx---');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$octet</code></td>
<td>​<span class="summary">8進数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">パーミッション文字列（ls -l 準拠）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c4718d6d8d09e61068a0941b12a359890e0e6a27-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strmode2oct()" class="anchor"></a>[F] strmode2oct <small><span class="summary">ls -l 準拠なパーミッション文字列を8進数値に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/strmode2oct.php#L7-L81" target="_blank">strmode2oct.php#7~81</a></p>
</div>
<details>
<summary class="">ls -l 準拠なパーミッション文字列を8進数値に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strmode2oct(string $perms): int</div></pre>
<div class="description">
<p>drwxrwxrwx のような10文字を想定しているが、 rwxrwxrwx のような9文字でも受け入れる。</p>
<p>set や sticky は現時点では未対応。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 通常ファイル rwx------
that(strmode2oct('-rwx------'))-&gt;is(010_0700);
// ディレクトリ rwxrwx---
that(strmode2oct('drwxrwx---'))-&gt;is(004_0770);
// 9文字でも良い
that(strmode2oct('rwxrwx---'))-&gt;is(0770);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$perms</code></td>
<td>​<span class="summary">パーミッション文字列（ls -l 準拠）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">8進数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_577dbd0a82f5a2925dabfc8cfc96de1e2110ec16-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-tmpname()" class="anchor"></a>[F] tmpname <small><span class="summary">終了時に削除される一時ファイル名を生成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/filesystem/tmpname.php#L8-L54" target="_blank">tmpname.php#8~54</a></p>
</div>
<details>
<summary class="">終了時に削除される一時ファイル名を生成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function tmpname(
    string $prefix = "rft",
    ?string $dir = null
): string</div></pre>
<div class="description">
<p>tempnam とほぼ同じで違いは下記。</p>
<ul class=" simple">
<li>引数が逆</li>
<li>終了時に削除される</li>
<li>失敗時に false を返すのではなく例外を投げる</li>
</ul>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$prefix = "rft"</code></td>
<td>​<span class="summary">ファイル名プレフィックス</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$dir = null</code></td>
<td>​<span class="summary">生成ディレクトリ。省略時は sys_get_temp_dir()</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">一時ファイル名</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e54471128dc28548da7b78e95b847fad53dcc50b-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-funchand" class="anchor"></a>[N] ryunosuke\Functions\Package\funchand\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-9" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-funchand--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_e77ed980cf6e76b738ca96b449c3001526aaf7f8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-by_builtin()" class="anchor"></a>[F] by_builtin <small><span class="summary">Countable#count, Serializable#serialize などの「ネイティブ由来かメソッド由来か」を判定して返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/by_builtin.php#L7-L65" target="_blank">by_builtin.php#7~65</a></p>
</div>
<details>
<summary class="">Countable#count, Serializable#serialize などの「ネイティブ由来かメソッド由来か」を判定して返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function by_builtin(
    object|string $class,
    string $function
): bool</div></pre>
<div class="description">
<p>Countable#count, Serializable#serialize のように「インターフェースのメソッド名」と「ネイティブ関数名」が一致している必要がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">class CountClass implements \Countable
{
    public function count(): int {
        // count 経由なら 1 を、メソッド経由なら 0 を返す
        return (int) by_builtin($this, 'count');
    }
}
$counter = new CountClass();
that(count($counter))-&gt;isSame(1);
that($counter-&gt;count())-&gt;isSame(0);</div></pre>
<p>のように判定できる。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​object|​string</td>
<td>​<code>$class</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$function</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">ネイティブなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ec1950cb95df049fabc77c9951b8260a42b92cfa-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-chain()" class="anchor"></a>[F] chain <small><span class="summary">関数をメソッドチェーンできるオブジェクトを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/chain.php#L12-L271" target="_blank">chain.php#12~271</a></p>
</div>
<details>
<summary class="">関数をメソッドチェーンできるオブジェクトを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function chain(mixed $source = null): ChainObject</div></pre>
<div class="description">
<p>ChainObject という関数をチェーンできるオブジェクトを返す。<span class="implicit-br">
</span>ChainObject は大抵のグローバル関数がアノテーションされており、コード補完することが出来る（利便性のためであり、IDE がエラーなどを出しても呼び出し自体は可能）。<span class="implicit-br">
</span>呼び出しは「第1引数に現在の値が適用」されて実行される（下記の func[X] コールで任意の位置に適用されることもできる）。</p>
<p>下記の特殊ルールにより、特殊な呼び出し方ができる。</p>
<ul class=" simple">
<li>nullsafe 設定にすると「値が null の場合は呼び出し自体を行わない」という動作になり null をそのまま返す</li>
<li>array_XXX, str_XXX は省略して XXX で呼び出せる<ul class=" simple">
<li>省略した結果、他の関数と被る場合は可能な限り型で一致する呼び出しを行う</li>
</ul>
</li>
<li>func(..., <em>, ...) で </em> で「値があたる位置」を明示できる<ul class=" simple">
<li><code>str_replace('from', 'to', _)</code> のように呼び出せる</li>
</ul>
</li>
<li>func[1] で「引数1（0 ベースなので要は2番目）に適用して func を呼び出す」ことができる<ul class=" simple">
<li>func[2], func[3] 等も呼び出し可能</li>
</ul>
</li>
<li>func['E'] で eval される文字列のクロージャを呼べる<ul class=" simple">
<li>引数名は <code>$1</code>, <code>$2</code> のような文字列で指定できる</li>
<li><code>$X</code> が無いときに限り 最左に <code>$1</code> が自動付与される</li>
</ul>
</li>
<li>引数が1つの呼び出しは () を省略できる</li>
</ul>
<p>この特殊ルールは普通に使う分にはそこまで気にしなくて良い。<span class="implicit-br">
</span>map や filter を駆使しようとすると必要になるが、イテレーション目的ではなく文字列のチェインなどが目的であればほぼ使うことはない。</p>
<p>上記を含むメソッド呼び出しはすべて自分自身を返すので、最終結果を得たい場合は <code>invoke</code> を実行する必要がある。<span class="implicit-br">
</span>ただし、 IteratorAggregate が実装されているので、配列の場合に限り foreach で直接回すことができる。<span class="implicit-br">
</span>その他、 Stringable や Countable, JsonSerializable など「値が必要になりそうなインターフェース」が実装されている。</p>
<p>用途は配列のイテレーションを想定しているが、あくまで「チェイン可能にする」が目的なので、ソースが文字列だろうとオブジェクトだろうと何でも呼び出しが可能。<span class="implicit-br">
</span>ただし、遅延評価も最適化も何もしていないので、 chain するだけでも動作は相当遅くなることに注意。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"># 1～9 のうち「5以下を抽出」して「値を2倍」して「合計」を出すシチュエーション
$n1_9 = range(1, 9);
// 素の php で処理したもの。パッと見で何してるか分からないし、処理の順番が思考と逆なので混乱する
that(array_sum(array_map(fn($v) =&gt; $v * 2, array_filter($n1_9, fn($v) =&gt; $v &lt;= 5))))-&gt;isSame(30);
// chain でクロージャを渡したもの。処理の順番が思考どおりだが、 fn() が微妙にうざい（array_ は省略できるので filter, map, sum のような呼び出しができている）
that(chain($n1_9)-&gt;filter(fn($v) =&gt; $v &lt;= 5)-&gt;maps(fn($v) =&gt; $v * 2)-&gt;sum()())-&gt;isSame(30);
// func['E'] を介したもの。かなり直感的だが eval なので少し不安
that(chain($n1_9)-&gt;filter['E']('&lt;= 5')-&gt;maps['E']('* 2')-&gt;sum()())-&gt;isSame(30);

# "hello   world" を「" " で分解」して「空文字を除去」してそれぞれに「ucfirst」して「"/" で結合」して「rot13」して「md5」して「大文字化」するシチュエーション
$string = 'hello   world';
// 素の php で処理したもの。もはやなにがなんだか分からない
that(strtoupper(md5(str_rot13(implode('/', array_map('ucfirst', array_filter(explode(' ', $string))))))))-&gt;isSame('10AF4DAF67D0D666FCEA0A8C6EF57EE7');
// chain だとかなりそれっぽくできる。 explode/implode の第1引数は区切り文字なので func[1] 構文を使用している。また、 rot13 以降は引数がないので () を省略している
that(chain($string)-&gt;explode[1](' ')-&gt;filter()-&gt;maps('ucfirst')-&gt;implode[1]('/')-&gt;rot13-&gt;md5-&gt;strtoupper()())-&gt;isSame('10AF4DAF67D0D666FCEA0A8C6EF57EE7');

 # よくある DB レコードをあれこれするシチュエーション
$rows = [
    ['id' =&gt; 1, 'name' =&gt; 'hoge', 'sex' =&gt; 'F', 'age' =&gt; 17, 'salary' =&gt; 230000],
    ['id' =&gt; 3, 'name' =&gt; 'fuga', 'sex' =&gt; 'M', 'age' =&gt; 43, 'salary' =&gt; 480000],
    ['id' =&gt; 7, 'name' =&gt; 'piyo', 'sex' =&gt; 'M', 'age' =&gt; 21, 'salary' =&gt; 270000],
    ['id' =&gt; 9, 'name' =&gt; 'hage', 'sex' =&gt; 'F', 'age' =&gt; 30, 'salary' =&gt; 320000],
];
// e.g. 男性の平均給料
that(chain($rows)-&gt;where['E']('sex', '=== "M"')-&gt;column('salary')-&gt;mean()())-&gt;isSame(375000);
// e.g. 女性の平均年齢
that(chain($rows)-&gt;where['E']('sex', '=== "F"')-&gt;column('age')-&gt;mean()())-&gt;isSame(23.5);
// e.g. 30歳以上の平均給料
that(chain($rows)-&gt;where['E']('age', '&gt;= 30')-&gt;column('salary')-&gt;mean()())-&gt;isSame(400000);
// e.g. 20～30歳の平均給料
that(chain($rows)-&gt;where['E']('age', '&gt;= 20')-&gt;where['E']('age', '&lt;= 30')-&gt;column('salary')-&gt;mean()())-&gt;isSame(295000);
// e.g. 男性の最小年齢
that(chain($rows)-&gt;where['E']('sex', '=== "M"')-&gt;column('age')-&gt;min()())-&gt;isSame(21);
// e.g. 女性の最大給料
that(chain($rows)-&gt;where['E']('sex', '=== "F"')-&gt;column('salary')-&gt;max()())-&gt;isSame(320000);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$source = null</code></td>
<td>​<span class="summary">元データ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ChainObject">ChainObject</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fffdb7612fe05900621a44b39f38e0b7baab65f8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-func_eval()" class="anchor"></a>[F] func_eval <small><span class="summary">指定コードで eval するクロージャを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/func_eval.php#L9-L56" target="_blank">func_eval.php#9~56</a></p>
</div>
<details>
<summary class="">指定コードで eval するクロージャを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function func_eval(
    string $expression,
    mixed ...$variadic
): \Closure</div></pre>
<div class="description">
<p>create_function のクロージャ版みたいなもの。<span class="implicit-br">
</span>参照渡しは未対応。</p>
<p>コード中の <code>$1</code>, <code>$2</code> 等の文字は <code>func_get_arg(1)</code> のような引数関数に変換される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$func_eval = func_eval('$a + $b + $c', 'a', 'b', 'c');
that($func_eval(1, 2, 3))-&gt;isSame(6);

// $X による参照
$func_eval = func_eval('$1 + $2 + $3');
that($func_eval(1, 2, 3))-&gt;isSame(6);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$expression</code></td>
<td>​<span class="summary">eval コード</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">引数名（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<span class="summary">新しいクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_306990bb7c853266a4d1882dd8eeae5f8c7977ae-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-func_method()" class="anchor"></a>[F] func_method <small><span class="summary">指定メソッドを呼び出すクロージャを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/func_method.php#L7-L49" target="_blank">func_method.php#7~49</a></p>
</div>
<details>
<summary class="">指定メソッドを呼び出すクロージャを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function func_method(
    string $methodname,
    mixed ...$defaultargs
): \Closure</div></pre>
<div class="description">
<p>この関数を呼ぶとメソッドのクロージャを返す。<span class="implicit-br">
</span>そのクロージャにオブジェクトを与えて呼び出すとそれはメソッド呼び出しとなる。</p>
<p>オプションでデフォルト引数を設定できる（Example を参照）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 与えられた引数を結合して返すメソッド hoge を持つクラス
$object = new class()
{
    function hoge(...$args) { return implode(',', $args); }
};
// hoge を呼び出すクロージャ
$hoge = func_method('hoge');
// ↑を使用して $object の hoge を呼び出す
that($hoge($object, 1, 2, 3))-&gt;isSame('1,2,3');

// デフォルト値付きで hoge を呼び出すクロージャ
$hoge789 = func_method('hoge', 7, 8, 9);
// ↑を使用して $object の hoge を呼び出す（引数指定してるので結果は同じ）
that($hoge789($object, 1, 2, 3))-&gt;isSame('1,2,3');
// 同上（一部デフォルト値）
that($hoge789($object, 1, 2))-&gt;isSame('1,2,9');
// 同上（全部デフォルト値）
that($hoge789($object))-&gt;isSame('7,8,9');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$methodname</code></td>
<td>​<span class="summary">メソッド名</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$defaultargs</code></td>
<td>​<span class="summary">メソッドのデフォルト引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<span class="summary">メソッドを呼び出すクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4c5d50d4d8bf38a93801289f4fc5f4fb65e43e27-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-func_new()" class="anchor"></a>[F] func_new <small><span class="summary">指定クラスのコンストラクタを呼び出すクロージャを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/func_new.php#L7-L33" target="_blank">func_new.php#7~33</a></p>
</div>
<details>
<summary class="">指定クラスのコンストラクタを呼び出すクロージャを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function func_new(
    string $classname,
    mixed ...$defaultargs
): \Closure</div></pre>
<div class="description">
<p>この関数を呼ぶとコンストラクタのクロージャを返す。</p>
<p>オプションでデフォルト引数を設定できる（Example を参照）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// Exception のコンストラクタを呼ぶクロージャ
$newException = func_new(\Exception::class, 'hoge');
// デフォルト引数を使用して Exception を作成
that($newException()-&gt;getMessage())-&gt;isSame('hoge');
// 引数を指定して Exception を作成
that($newException('fuga')-&gt;getMessage())-&gt;isSame('fuga');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$classname</code></td>
<td>​<span class="summary">クラス名</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$defaultargs</code></td>
<td>​<span class="summary">コンストラクタのデフォルト引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<span class="summary">コンストラクタを呼び出すクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_bf6467742f108cbd7ecabbf9294834096aa98033-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-func_operator()" class="anchor"></a>[F] func_operator <small><span class="summary">演算子のクロージャを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/func_operator.php#L7-L86" target="_blank">func_operator.php#7~86</a></p>
</div>
<details>
<summary class="">演算子のクロージャを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function func_operator(
    string $operator,
    mixed ...$operands
): \Closure</div></pre>
<div class="description">
<p>関数ベースなので <code>??</code> のような言語組み込みの特殊な演算子は若干希望通りにならない（Notice が出る）。<span class="implicit-br">
</span>2つ目以降の引数でオペランドを指定できる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$not = func_operator('!');    // 否定演算子クロージャ
that(false)-&gt;isSame($not(true));

$minus = func_operator('-'); // マイナス演算子クロージャ
that($minus(2))-&gt;isSame(-2);       // 引数1つで呼ぶと1項演算子
that($minus(3, 2))-&gt;isSame(3 - 2); // 引数2つで呼ぶと2項演算子

$cond = func_operator('?:'); // 条件演算子クロージャ
that($cond('OK', 'NG'))-&gt;isSame('OK' ?: 'NG');               // 引数2つで呼ぶと2項演算子
that($cond(false, 'OK', 'NG'))-&gt;isSame(false ? 'OK' : 'NG'); // 引数3つで呼ぶと3項演算子

$gt5 = func_operator('&lt;=', 5); // 5以下を判定するクロージャ
that(array_filter([1, 2, 3, 4, 5, 6, 7, 8, 9], $gt5))-&gt;isSame([1, 2, 3, 4, 5]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$operator</code></td>
<td>​<span class="summary">演算子</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$operands</code></td>
<td>​<span class="summary">右オペランド</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<span class="summary">演算子のクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6cc813cc629ac5eb2f146572c1dd0100e45d5b26-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-func_user_func_array()" class="anchor"></a>[F] func_user_func_array <small><span class="summary">パラメータ定義数に応じて呼び出し引数を可変にしてコールする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/func_user_func_array.php#L9-L52" target="_blank">func_user_func_array.php#9~52</a></p>
</div>
<details>
<summary class="">パラメータ定義数に応じて呼び出し引数を可変にしてコールする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function func_user_func_array(callable|null $callback): callable</div></pre>
<div class="description">
<p>デフォルト引数はカウントされない。必須パラメータの数で呼び出す。</p>
<p>$callback に null を与えると例外的に「第1引数を返すクロージャ」を返す。</p>
<p>php の標準関数は定義数より多い引数を投げるとエラーを出すのでそれを抑制したい場合に使う。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// strlen に2つの引数を渡してもエラーにならない
$strlen = func_user_func_array('strlen');
that($strlen('abc', null))-&gt;isSame(3);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable|​null</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">呼び出すクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<span class="summary">引数ぴったりで呼び出すクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3556b2f8aa07b59ebbe3c77beb9144025f0e1f58-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-func_wiring()" class="anchor"></a>[F] func_wiring <small><span class="summary">引数の型情報に基づいてワイヤリングしたクロージャを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/func_wiring.php#L8-L38" target="_blank">func_wiring.php#8~38</a></p>
</div>
<details>
<summary class="">引数の型情報に基づいてワイヤリングしたクロージャを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function func_wiring(
    callable $callable,
    array|\ArrayAccess $dependency
): \Closure</div></pre>
<div class="description">
<p>$dependency に数値キーの配列を混ぜるとデフォルト値として使用される。<span class="implicit-br">
</span>得られたクロージャの呼び出し時に引数を与える事ができる。</p>
<p>parameter_wiring も参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$closure = fn ($a, $b) =&gt; func_get_args();
$new_closure = func_wiring($closure, [
    '$a' =&gt; 'a',
    '$b' =&gt; 'b',
    1    =&gt; 'B',
]);
that($new_closure())-&gt;isSame(['a', 'B']);    // 同時指定の場合は数値キー優先
that($new_closure('A'))-&gt;isSame(['A', 'B']); // 呼び出し時の引数優先</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">対象 callable</span></td>
</tr>
<tr>
<td>​array|​<a href="https://php.net/manual/class.arrayaccess.php" target="_blank">ArrayAccess</a></td>
<td>​<code>$dependency</code></td>
<td>​<span class="summary">引数候補配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<span class="summary">引数を確定したクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ab9fc14a064b9aa7c26e761df916dbef4f997460-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-function_alias()" class="anchor"></a>[F] function_alias <small><span class="summary">関数のエイリアスを作成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/function_alias.php#L10-L77" target="_blank">function_alias.php#10~77</a></p>
</div>
<details>
<summary class="">関数のエイリアスを作成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function function_alias(
    callable $original,
    string $alias
)</div></pre>
<div class="description">
<p>単に移譲するだけではなく、参照渡し・参照返しも模倣される。<span class="implicit-br">
</span>その代わり、単純なエイリアスではなく別定義で吐き出すので「エイリアス」ではなく「処理が同じな別関数」と思ったほうがよい。</p>
<p>静的であればクラスメソッドも呼べる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// trim のエイリアス
function_alias('trim', 'trim_alias');
that(trim_alias(' abc '))-&gt;isSame('abc');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$original</code></td>
<td>​<span class="summary">元となる関数</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$alias</code></td>
<td>​<span class="summary">関数のエイリアス名</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b21c0356ea91c61592eba3ab162e7ea2b8dd68e9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-function_shorten()" class="anchor"></a>[F] function_shorten <small><span class="summary">関数の名前空間部分を除いた短い名前を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/function_shorten.php#L7-L19" target="_blank">function_shorten.php#7~19</a></p>
</div>
<details>
<summary class="">関数の名前空間部分を除いた短い名前を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function function_shorten(string $function): string</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$function</code></td>
<td>​<span class="summary">短くする関数名</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">短い関数名</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b5e160457cefbfce39d9015905cb4a6f0164d12c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_bindable_closure()" class="anchor"></a>[F] is_bindable_closure <small><span class="summary">$this を bind 可能なクロージャか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/is_bindable_closure.php#L7-L24" target="_blank">is_bindable_closure.php#7~24</a></p>
</div>
<details>
<summary class="">$this を bind 可能なクロージャか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_bindable_closure(\Closure $closure): bool</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(is_bindable_closure(function () {}))-&gt;isTrue();
that(is_bindable_closure(static function () {}))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$closure</code></td>
<td>​<span class="summary">調べるクロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">$this を bind 可能なクロージャなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e2e04387f2af673556590246d8fc0aef8a183a0f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_callback()" class="anchor"></a>[F] is_callback <small><span class="summary">callable のうち、関数文字列を false で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/funchand/is_callback.php#L7-L50" target="_blank">is_callback.php#7~50</a></p>
</div>
<details>
<summary class="">callable のうち、関数文字列を false で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_callback(mixed $callable): bool</div></pre>
<div class="description">
<p>歴史的な経緯で php の callable は多岐に渡る。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>単純なコールバック</dt>
<dd><code>"strtolower"</code></dd>
</div>
<div class="dtdd-container">
<dt>staticメソッドのコール</dt>
<dd><code>["ClassName", "method"]</code></dd>
</div>
<div class="dtdd-container">
<dt>オブジェクトメソッドのコール</dt>
<dd><code>[$object, "method"]</code></dd>
</div>
<div class="dtdd-container">
<dt>staticメソッドのコール</dt>
<dd><code>"ClassName::method"</code></dd>
</div>
<div class="dtdd-container">
<dt>相対指定によるstaticメソッドのコール</dt>
<dd><code>["ClassName", "parent::method"]</code></dd>
</div>
<div class="dtdd-container">
<dt>__invoke実装オブジェクト</dt>
<dd><code>$object</code></dd>
</div>
<div class="dtdd-container">
<dt>クロージャ</dt>
<dd><code>fn() =&gt; something()</code></dd>
</div>
</dl>
<p>上記のうち 1 を callable とはみなさず false を返す。<span class="implicit-br">
</span>現代的には <code>Closure::fromCallable</code>, <code>$object-&gt;method(...)</code> などで callable == Closure という概念が浸透しているが、そうでないこともある。<span class="implicit-br">
</span>本ライブラリでも <code>preg_splice</code> や <code>array_sprintf</code> などで頻出しているので関数として定義する。</p>
<p>副作用はなく、クラスのロードや関数の存在チェックなどは行わない。あくまで型と形式で判定する。<span class="implicit-br">
</span>引数は callable でなくても構わない。その場合単に false を返す。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">対象 callable</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">関数呼び出しの callable なら false</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_eb60908b0d21ce0b4612ee8e22d3863158ab6407-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-info" class="anchor"></a>[N] ryunosuke\Functions\Package\info\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-10" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-info--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_93416947a09257831d1289a75b8997935dd65d4d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ansi_colorize()" class="anchor"></a>[F] ansi_colorize <small><span class="summary">文字列に ANSI Color エスケープシーケンスを埋め込む</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/ansi_colorize.php#L7-L72" target="_blank">ansi_colorize.php#7~72</a></p>
</div>
<details>
<summary class="">文字列に ANSI Color エスケープシーケンスを埋め込む</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ansi_colorize(
    string $string,
    string $color
): string</div></pre>
<div class="description">
<ul class=" simple">
<li>"blue" のような小文字色名は文字色</li>
<li>"BLUE" のような大文字色名は背景色</li>
<li>"bold" のようなスタイル名は装飾</li>
</ul>
<p>となる。その区切り文字は現在のところ厳密に定めていない（<code>fore+back|bold</code> のような形式で定めることも考えたけどメリットがない）。<span class="implicit-br">
</span>つまり、アルファベット以外で分割するので、</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt><code>blue|WHITE@bold</code></dt>
<dd>文字青・背景白・太字</dd>
</div>
<div class="dtdd-container">
<dt><code>blue WHITE bold underscore</code></dt>
<dd>文字青・背景白・太字・下線</dd>
</div>
<div class="dtdd-container">
<dt><code>italic|bold,blue+WHITE</code></dt>
<dd>文字青・背景白・太字・斜体</dd>
</div>
</dl>
<p>という動作になる（記号で区切られていれば形式はどうでも良いということ）。<span class="implicit-br">
</span>ただ、この指定方法は変更が入る可能性が高いのでスペースあたりで区切っておくのがもっとも無難。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$color</code></td>
<td>​<span class="summary">色とスタイル文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">エスケープシーケンス付きの文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5157a2187da6d0ff7c785dee0dfc5ec5a22accf6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ansi_strip()" class="anchor"></a>[F] ansi_strip <small><span class="summary">ANSI エスケープ文字を取り除く</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/ansi_strip.php#L7-L27" target="_blank">ansi_strip.php#7~27</a></p>
</div>
<details>
<summary class="">ANSI エスケープ文字を取り除く</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ansi_strip(string $string): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$ansi_string = ansi_colorize('hoge', 'bold red');
// エスケープ文字も含めて 19 文字
that(strlen($ansi_string))-&gt;isSame(19);
// ansi_strip すると本来の hoge がえられる
that(ansi_strip($ansi_string))-&gt;isSame('hoge');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">ANSI エスケープ文字が取り除かれた文字</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6cb6a1cc16f636118d507f1d518be3a3a4f07fd9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-arguments()" class="anchor"></a>[F] arguments <small><span class="summary">コマンドライン引数をパースして引数とオプションを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/arguments.php#L10-L185" target="_blank">arguments.php#10~185</a></p>
</div>
<details>
<summary class="">コマンドライン引数をパースして引数とオプションを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function arguments(
    array $rule,
    array|string|null $argv = null
): array</div></pre>
<div class="description">
<p>少しリッチな <a href="http://php.net/manual/function.getopt.php" target="_blank">getopt</a> として使える（shell 由来のオプション構文(a:b::)はどうも馴染みにくい）。<span class="implicit-br">
</span>ただし「値が必須なオプション」はサポートしない。<span class="implicit-br">
</span>もっとも、オプションとして空文字が来ることはほぼ無いのでデフォルト値を空文字にすることで対応可能。</p>
<p>$rule に従って <code>--noval filename --opt optval</code> のような文字列・配列をパースする。<span class="implicit-br">
</span>$rule 配列の仕様は下記。</p>
<ul class=" simple">
<li>キーは「オプション名」を指定する。ただし・・・<ul class=" simple">
<li>数値キーは「引数」を意味する</li>
<li>スペースの後に「ショート名」を与えられる</li>
</ul>
</li>
<li>値は「デフォルト値」を指定する。ただし・・・<ul class=" simple">
<li><code>[]</code> は「複数値オプション」を意味する（配列にしない限り同オプションの多重指定は許されない）</li>
<li><code>null</code> は「値なしオプション」を意味する（スイッチングオプション）</li>
</ul>
</li>
<li>空文字キーは解釈自体のオプションを与える<ul class=" simple">
<li>今のところ throw のみの実装。配列ではなく bool を与えられる</li>
</ul>
</li>
</ul>
<p>上記の仕様でパースして「引数は数値連番、オプションはオプション名をキーとした配列」を返す。<span class="implicit-br">
</span>なお、いわゆる「引数」はどこに来ても良い（前オプション、後オプションの区別がない）。</p>
<p>$argv には配列や文字列が与えられるが、ほとんどテスト用に近く、普通は未指定で $argv を使うはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// いくつか織り交ぜたスタンダードな例
$rule = [
    'opt'       =&gt; 'def',    // 基本的には「デフォルト値」を表す
    'longopt l' =&gt; '',       // スペース区切りで「ショート名」を意味する
    1           =&gt; 'defarg', // 数値キーは「引数」を意味する
];
that(arguments($rule, '--opt optval arg1 -l longval'))-&gt;isSame([
    'opt'     =&gt; 'optval',  // optval と指定している
    'longopt' =&gt; 'longval', // ショート名指定でも本来の名前で返ってくる
    'arg1',   // いわゆるコマンドライン引数（optval は opt に飲まれるので含まれない）
    'defarg', // いわゆるコマンドライン引数（与えられていないが、ルールの 1 =&gt; 'defarg' が活きている）
]);

// 「値なしオプション」と「複数値オプション」の例
$rule = [
    'noval1 l'  =&gt; null, // null は「値なしオプション」を意味する（指定されていれば true されていなければ false を返す）
    'noval2 m'  =&gt; null, // 同上
    'noval3 n'  =&gt; null, // 同上
    'opts o' =&gt; [],      // 配列を与えると「複数値オプション」を表す
];
that(arguments($rule, '--opts o1 -ln arg1 -o o2 arg2 --opts o3'))-&gt;isSame([
    'noval1' =&gt; true,  // -ln で同時指定されているので true
    'noval2' =&gt; false, // -ln で同時指定されてないので false
    'noval3' =&gt; true,  // -ln の同時指定されているので true
    'opts'   =&gt; ['o1', 'o2', 'o3'], // ロング、ショート混在でも OK
    'arg1', // 一見 -ln のオプション値に見えるが、 noval は値なしなので引数として得られる
    'arg2', // 前オプション、後オプションの区別はないのでどこに居ようと引数として得られる
]);

// 空文字で解釈自体のオプションを与える
$rule = [
    ''  =&gt; false, // 定義されていないオプションが来ても例外を投げずに引数として処理する
];
that(arguments($rule, '--long A -short B'))-&gt;isSame([
    '--long', // 明らかにオプション指定に見えるが、 long というオプションは定義されていないので引数として解釈される
    'A',      // 同上。long のオプション値に見えるが、ただの引数
    '-short', // 同上。short というオプションは定義されていない
    'B',      // 同上。short のオプション値に見えるが、ただの引数
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$rule</code></td>
<td>​<span class="summary">オプションルール</span></td>
</tr>
<tr>
<td>​array|​string|​null</td>
<td>​<code>$argv = null</code></td>
<td>​<span class="summary">パースするコマンドライン引数。未指定時は $argv が使用される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">コマンドライン引数＋オプション</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9b72e4f17f6b4fe1e8cf86ace2e25c1d001f09ec-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cpu_timer()" class="anchor"></a>[F] cpu_timer <small><span class="summary">CPU 時間を計れるオブジェクトを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/cpu_timer.php#L7-L112" target="_blank">cpu_timer.php#7~112</a></p>
</div>
<details>
<summary class="">CPU 時間を計れるオブジェクトを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cpu_timer(): CpuTimer|object</div></pre>
<div class="description">
<p>コンストラクタ（あるいは start）時点から stop までの下記を返す。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>real</dt>
<dd>実際の経過時間</dd>
</div>
<div class="dtdd-container">
<dt>time</dt>
<dd>CPU時間（user + system）</dd>
</div>
<div class="dtdd-container">
<dt>user</dt>
<dd>ユーザー時間</dd>
</div>
<div class="dtdd-container">
<dt>system</dt>
<dd>システム時間</dd>
</div>
<div class="dtdd-container">
<dt>idle</dt>
<dd>アイドル時間（real - time）</dd>
</div>
<div class="dtdd-container">
<dt>time%</dt>
<dd>CPU使用率（time / real）</dd>
</div>
<div class="dtdd-container">
<dt>user%</dt>
<dd>ユーザー使用率（user / time）</dd>
</div>
<div class="dtdd-container">
<dt>system%</dt>
<dd>システム使用率（system / time）</dd>
</div>
<div class="dtdd-container">
<dt>idle%</dt>
<dd>アイドル率（idle / real）</dd>
</div>
</dl>
<p>要するに POSIX の time コマンドとほぼ同じで、計算から導出できる値がちょっと増えただけ。</p>
<ul class=" simple">
<li>user が大きい場合（time と user が近い場合）、ユーザーランドの処理が多かったことを表す</li>
<li>system が大きい場合（time と system が近い場合）、システムコールが多かったことを表す</li>
<li>idle が大きい場合（real と time が離れている場合）、ネットワークや IO 等で CPU が遊んでいたことを表す<ul class=" simple">
<li>もっとも、コア数によってはその限りではない（単に他のプロセスを捌いていただけ、もあり得る）</li>
<li>linux 版 getrusage だとコンテキストスイッチが取れるので傾向は表せるけど…正確には無理だし Windows が対応していないので未対応</li>
</ul>
</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$timer = cpu_timer();
foreach (range(0, 999) as $i) {
   // ファイル IO を伴う sha1 なら user,system,idle を程よく使うはず
   $hash = sha1_file(__FILE__);
}
//var_dump($timer-&gt;result());
//{
//  real: 0.13377594947814941,
//  user: 0.078125,
//  system: 0.046875,
//  time: 0.125,
//  idle: 0.008775949478149414,
//  user%: 62.5,
//  system%: 37.5,
//  time%: 93.4398152191154,
//  idle%: 6.560184780884589,
//}</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--CpuTimer">CpuTimer</a>|​object</td>
<td>​<span class="summary">タイマーオブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_293a6c05d861b206532cd9d735305d1585d40ff3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-finalize()" class="anchor"></a>[F] finalize <small><span class="summary">自身が死ぬときに指定 callable を呼ぶオブジェクトを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/finalize.php#L7-L49" target="_blank">finalize.php#7~49</a></p>
</div>
<details>
<summary class="">自身が死ぬときに指定 callable を呼ぶオブジェクトを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function finalize(callable $finalizer): callable</div></pre>
<div class="description">
<p>invoke を実装しているので明示的にも呼べる。<span class="implicit-br">
</span>明示的だろうと暗黙的だろうと必ず1回しか呼ばれない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$called = 0;
$finalizer = finalize(function()use(&amp;$called){$called++;});
that($called)-&gt;is(0); // まだ呼ばれていない

// コールすると・・・
$finalizer();
that($called)-&gt;is(1); // 呼ばれている

// unset（GC）でも呼ばれる
unset($finalizer);
that($called)-&gt;is(1); // が、一度しか呼ばれないので呼ばれない</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$finalizer</code></td>
<td>​<span class="summary">実行する php コード</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<span class="summary">GC 時に $finalizer を実行する callable</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_167dd4981cc9f34afa743aa6c4de722a25062cd3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-get_modified_files()" class="anchor"></a>[F] get_modified_files <small><span class="summary">初回読み込み時から変更のあったファイル配列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/get_modified_files.php#L8-L65" target="_blank">get_modified_files.php#8~65</a></p>
</div>
<details>
<summary class="">初回読み込み時から変更のあったファイル配列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function get_modified_files(
    string|array $target_pattern = "*.php",
    string|array $ignore_pattern = "*.phtml"
): array</div></pre>
<div class="description">
<p>初回呼び出し時は必ず空配列を返し、以後の呼び出しで変更のあったファイルを返す。<span class="implicit-br">
</span>削除されたファイルも変更とみなす。</p>
<p>用途的には「php で書かれたデーモンで、変更感知して自動で再起動する（systemd に任せる）」がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 別プロセスで3秒後に自分自身を触る
$p = process_async(PHP_BINARY, ['-r' =&gt; 'sleep(3);touch($argv[1]);', __FILE__]);

$time = microtime(true);
foreach (range(1, 10) as $i) {
    // 何らかのデーモン（完全に wait する系ではなく時々処理が戻ってくる必要がある）
    sleep(1);

    // 自身の変更を感知したら break なり exit なりで抜ける（大抵はそのまま終了する。起動は systemd に丸投げする）
    if (get_modified_files(__FILE__)) {
        break;
    }
}
// 全ループすると10秒かかるが、大体3秒程度で抜けているはず
that(microtime(true) - $time)-&gt;break()-&gt;lt(3.9);
unset($p);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<code>$target_pattern = "*.php"</code></td>
<td>​<span class="summary">対象ファイルパターン（マッチしないものは無視される）</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$ignore_pattern = "*.phtml"</code></td>
<td>​<span class="summary">除外ファイルパターン（マッチしたものは無視される）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">変更のあったファイル名配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fa55460af76109257d06e4218ab6bd4072c34c77-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-get_uploaded_files()" class="anchor"></a>[F] get_uploaded_files <small><span class="summary">$_FILES の構造を組み替えて $_POST などと同じにする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/get_uploaded_files.php#L9-L34" target="_blank">get_uploaded_files.php#9~34</a></p>
</div>
<details>
<summary class="">$_FILES の構造を組み替えて $_POST などと同じにする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function get_uploaded_files(?array $files = null): array</div></pre>
<div class="description">
<p>$_FILES の配列構造はバグとしか思えないのでそれを是正する関数。<span class="implicit-br">
</span>第1引数 $files は指定可能だが、大抵は $_FILES であり、指定するのはテスト用。</p>
<p>サンプルを書くと長くなるので例は<a href="#--ryunosuke-Test-Package-utilityTest%3A%3Atest_get_uploaded_files%28%29">テストファイル</a>を参照。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?array</td>
<td>​<code>$files = null</code></td>
<td>​<span class="summary">$_FILES の同じ構造の配列。省略時は $_FILES</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">$_FILES を $_POST などと同じ構造にした配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7799d71b5c10ea9ff35d17a215558dcc49070799-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-getenvs()" class="anchor"></a>[F] getenvs <small><span class="summary">連想配列を元に環境変数を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/getenvs.php#L8-L72" target="_blank">getenvs.php#8~72</a></p>
</div>
<details>
<summary class="">連想配列を元に環境変数を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function getenvs(iterable $env_vars): array</div></pre>
<div class="description">
<p>配列のキーで取得するキーを指定できる。<span class="implicit-br">
</span>連番の場合は元の環境変数名がキーとして使用される。</p>
<p>環境変数が存在しない場合、false ではなく null になる。<span class="implicit-br">
</span>環境変数名に配列を与えた場合、順に取得を試みて、見つからなかった場合に null になる。</p>
<p>キーが指定されておらず、さらに環境変数候補数が1以外で環境変数が見つからない場合は例外を投げる。<span class="implicit-br">
</span>（返すキーが一意に定まらない場合に例外を投げる）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">putenv('ENV1=env_1');
putenv('ENV2=env_2');
putenv('ENV3=env_3');

that(getenvs([
    'ENV1',                           // キー指定がない
    'e2' =&gt; 'ENV2',                   // キー指定がある
    'e3' =&gt; ['ENV4', 'ENV3', 'ENV2'], // 配列の左から取得を試みる
    'e8' =&gt; 'ENV8',                   // 存在しない環境変数
    'e9' =&gt; ['ENV9', 'ENV8', 'ENV7'], // 存在しない環境変数配列
]))-&gt;is([
    'ENV1' =&gt; 'env_1', // キー指定がない場合、環境変数名がキーになる
    'e2'   =&gt; 'env_2', // キー指定がある場合、それがキーになる
    'e3'   =&gt; 'env_3', // ENV3 が見つかった
    'e8'   =&gt; null,    // ENV8 が見つからないので null
    'e9'   =&gt; null,    // ENV9, ENV8, ENV7 のどれも見つからないので null
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$env_vars</code></td>
<td>​<span class="summary">[キー =&gt; 環境変数名]</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">環境変数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_71ede590a60acd0c88687c26df18668aa21c3b7b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ini_sets()" class="anchor"></a>[F] ini_sets <small><span class="summary">複数の php.ini の設定をまとめて設定する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/ini_sets.php#L8-L32" target="_blank">ini_sets.php#8~32</a></p>
</div>
<details>
<summary class="">複数の php.ini の設定をまとめて設定する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ini_sets(array $values): callable</div></pre>
<div class="description">
<p>返り値として「もとに戻すためのクロージャ」を返すので、復元するためにはそのクロージャを呼ぶだけで良い。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$values</code></td>
<td>​<span class="summary">ini のエントリ名と値の配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<span class="summary">ini を元に戻す callable</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e43bb4fa3cb7b4275fb6a4a6acbe0cf056582c3f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_ansi()" class="anchor"></a>[F] is_ansi <small><span class="summary">リソースが ansi color に対応しているか返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/is_ansi.php#L7-L36" target="_blank">is_ansi.php#7~36</a></p>
</div>
<details>
<summary class="">リソースが ansi color に対応しているか返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_ansi(resource $stream): bool</div></pre>
<div class="description">
<p>パイプしたりリダイレクトしていると false を返す。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​resource</td>
<td>​<code>$stream</code></td>
<td>​<span class="summary">調べるリソース</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">ansi color に対応しているなら true</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://github.com/symfony/console/blob/v4.2.8/Output/StreamOutput.php#L98" target="_blank">https://github.com/symfony/console/blob/v4.2.8/Output/StreamOutput.php#L98</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5558e8fcce63c17ec9f69b848f11d05df518fe15-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-php_binary()" class="anchor"></a>[F] php_binary <small><span class="summary">php-cli のパスを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/php_binary.php#L7-L33" target="_blank">php_binary.php#7~33</a></p>
</div>
<details>
<summary class="">php-cli のパスを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function php_binary(): string|null</div></pre>
<div class="description">
<p>見つからない場合は null を返す。<span class="implicit-br">
</span>実質的には PHP_BINARY と同じと考えてよい。<span class="implicit-br">
</span>ただ PHP_BINARY は SAPI によって異なるので fpm 時にはこの関数を用いて php-cli のパスを得る必要がある。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​null</td>
<td>​<span class="summary">php-cli のパス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b5dfff0c7f231b0d6204fe149af52440a4edc646-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-setenvs()" class="anchor"></a>[F] setenvs <small><span class="summary">連想配列を元に環境変数を設定する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/setenvs.php#L7-L42" target="_blank">setenvs.php#7~42</a></p>
</div>
<details>
<summary class="">連想配列を元に環境変数を設定する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function setenvs(iterable $env_vars): array</div></pre>
<div class="description">
<p>値に null を渡すと環境変数の削除動作となる。<span class="implicit-br">
</span>返り値として成否配列を返すが、この返り値の形式は互換性を維持せず、変更になる可能性がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">setenvs([
    'ENV1' =&gt; 'e1',
    'ENV2' =&gt; 'e2',
    'ENV3' =&gt; null,
]);
that(getenv('ENV1'))-&gt;isSame('e1');
that(getenv('ENV2'))-&gt;isSame('e2');
that(getenv('ENV3'))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$env_vars</code></td>
<td>​<span class="summary">[環境変数名 =&gt; 値]</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">成否配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5478c8e586f3bde2171556c4ae95fc2a61d338a1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-sys_get_memory()" class="anchor"></a>[F] sys_get_memory <small><span class="summary">システムのメモリを取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/sys_get_memory.php#L11-L61" target="_blank">sys_get_memory.php#11~61</a></p>
</div>
<details>
<summary class="">システムのメモリを取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function sys_get_memory(int $cacheSecond = 0): array</div></pre>
<div class="description">
<p>php にはメモリ情報を返す関数が存在しないので共通のために作成。<span class="implicit-br">
</span>Windows 版はかなりやっつけなので過度に呼んではならない。</p>
<p>$cacheSecond を指定するとその秒数分はキャッシュを返すようになる。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$cacheSecond = 0</code></td>
<td>​<span class="summary">キャッシュ秒数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">メモリ情報</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e90a5ee35837e9dd2a45d9a222487cba6878f877-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-sys_set_temp_dir()" class="anchor"></a>[F] sys_set_temp_dir <small><span class="summary">sys_get_temp_dir が返すディレクトリを変更する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/sys_set_temp_dir.php#L9-L61" target="_blank">sys_set_temp_dir.php#9~61</a></p>
</div>
<details>
<summary class="">sys_get_temp_dir が返すディレクトリを変更する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function sys_set_temp_dir(
    string $directory,
    bool $creates = true,
    $check_settled = true
): bool</div></pre>
<div class="description">
<p>ただし、sys_get_temp_dir は一度でも呼ぶと内部的にキャッシュされるので、必ず呼ぶ前に設定しなければならない。<span class="implicit-br">
</span>相対パスを指定すると標準設定からの相対になる。</p>
<p>$check_settled はデバッグ用なので運用では使わないこと。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$directory</code></td>
<td>​<span class="summary">一時ディレクトリ</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$creates = true</code></td>
<td>​<span class="summary">設定すると同時に作成するか</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$check_settled = true</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">成功時に true</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://github.com/php/php-src/blob/af6c11c5f060870d052a2b765dc634d9e47d0f18/main/php_open_temporary_file.c" target="_blank">https://github.com/php/php-src/blob/af6c11c5f060870d052a2b765dc634d9e47d0f18/main/php_open_temporary_file.c</a></td>
<td>​<span class="summary">Example:</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f1b7cf5b60ccf8858324b88036c31ca2be30dbf9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-system_status()" class="anchor"></a>[F] system_status <small><span class="summary">システムの各種情報配列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/info/system_status.php#L12-L469" target="_blank">system_status.php#12~469</a></p>
</div>
<details>
<summary class="">システムの各種情報配列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function system_status(
    string $siunit = "",
    string $datetime_format = DateTime::RFC3339
): array</div></pre>
<div class="description">
<p>Windows 版はオマケ実装。<span class="implicit-br">
</span>この関数の結果は互換性を考慮しない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$siunit = ""</code></td>
<td>​<span class="summary">バイト系数値の単位</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$datetime_format = DateTime::RFC3339</code></td>
<td>​<span class="summary">日時系のフォーマット</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_54adcf57e1f6cce3c7c7a2d28266de91e18e54aa-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-iterator" class="anchor"></a>[N] ryunosuke\Functions\Package\iterator\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-11" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-iterator--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_b5619f685bb7553085cc33fba239998204d6a5b7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-iterator_chunk()" class="anchor"></a>[F] iterator_chunk <small><span class="summary">イテレータも使える array_chunk</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/iterator/iterator_chunk.php#L7-L129" target="_blank">iterator_chunk.php#7~129</a></p>
</div>
<details>
<summary class="">イテレータも使える array_chunk</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function iterator_chunk(
    iterable $iterator,
    int|\Closure $length,
    bool $preserve_keys = false
): \Generator[]|\Generator</div></pre>
<div class="description">
<p>Generator を返す Generator を返す。<span class="implicit-br">
</span>foreach で使う分には普通の配列と遜色なく使うことができる。</p>
<p>大本 Generator は return 値として総数を返す。<span class="implicit-br">
</span>各種 Generator は return 値として要素数を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 要素7の Generator を3つに分割
$generator = (function () {
    yield 'a';
    yield 'b';
    yield 'c';
    yield 'd';
    yield 'e';
    yield 'f';
    yield 'g';
})();
$generators = iterator_chunk($generator, 3);

// 3要素
that(iterator_to_array($generators-&gt;current()))-&gt;is(['a', 'b', 'c']);
that($generators-&gt;current()-&gt;getReturn())-&gt;is(3);
// 3要素
$generators-&gt;next();
that(iterator_to_array($generators-&gt;current()))-&gt;is(['d', 'e', 'f']);
that($generators-&gt;current()-&gt;getReturn())-&gt;is(3);
// 1要素
$generators-&gt;next();
that(iterator_to_array($generators-&gt;current()))-&gt;is(['g']);
that($generators-&gt;current()-&gt;getReturn())-&gt;is(1);
// 大本の Generator は総数を返す
$generators-&gt;next();
that($generators-&gt;getReturn())-&gt;is(7);

// ハイフンが来るたびに分割（クロージャ内で next しているため、ハイフン自体は結果に含まれない）
$generator = (function () {
    yield 'a';
    yield 'b';
    yield '-';
    yield 'c';
    yield 'd';
    yield 'e';
    yield 'f';
    yield '-';
    yield 'g';
})();
$generators = iterator_chunk($generator, function ($v, $k, $n, $c, $it) {
    if ($v === '-') {
        $it-&gt;next();
        return false;
    }
    return true;
});

that(iterator_to_array($generators-&gt;current()))-&gt;is(['a', 'b']);
$generators-&gt;next();
that(iterator_to_array($generators-&gt;current()))-&gt;is(['c', 'd', 'e', 'f']);
$generators-&gt;next();
that(iterator_to_array($generators-&gt;current()))-&gt;is(['g']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$iterator</code></td>
<td>​<span class="summary">イテレータ</span></td>
</tr>
<tr>
<td>​int|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$length</code></td>
<td>​<span class="summary">チャンクサイズ。クロージャを渡すと毎ループ(値, キー, ステップ, チャンク番号, イテレータ)でコールされて false を返すと1チャンク終了となる</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$preserve_keys = false</code></td>
<td>​<span class="summary">キーの保存フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.generator.php" target="_blank">Generator</a>[]|​<a href="https://php.net/manual/class.generator.php" target="_blank">Generator</a></td>
<td>​<span class="summary">チャンク化された Generator</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_37d9f11f726916a9e7005ad796d902c1dc004342-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-iterator_combine()" class="anchor"></a>[F] iterator_combine <small><span class="summary">キーと値のイテレータから キー =&gt; 値 なイテレータを作る</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/iterator/iterator_combine.php#L7-L45" target="_blank">iterator_combine.php#7~45</a></p>
</div>
<details>
<summary class="">キーと値のイテレータから キー =&gt; 値 なイテレータを作る</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function iterator_combine(
    iterable $keys,
    iterable $values
): \Iterator</div></pre>
<div class="description">
<p>要するに array_combine のイテレータ版。<span class="implicit-br">
</span>数が一致しないと array_combine と同様例外を投げるが、呼び出し時点では投げられず、ループ後に呼ばれることに注意。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 配列から key =&gt; value なイテレータを作る
$it = iterator_combine(['a', 'b', 'c'], [1, 2, 3]);
that(iterator_to_array($it))-&gt;isSame(['a' =&gt; 1, 'b' =&gt; 2, 'c' =&gt; 3]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$keys</code></td>
<td>​<span class="summary">キー</span></td>
</tr>
<tr>
<td>​iterable</td>
<td>​<code>$values</code></td>
<td>​<span class="summary">値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.iterator.php" target="_blank">Iterator</a></td>
<td>​<span class="summary">$key =&gt; $value なイテレータ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_357623d3ad0eb996c2cba45d9693fa82b07e5c9b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-iterator_join()" class="anchor"></a>[F] iterator_join <small><span class="summary">複数の iterator を一括して回せる iterator を返す。</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/iterator/iterator_join.php#L7-L45" target="_blank">iterator_join.php#7~45</a></p>
</div>
<details>
<summary class="">複数の iterator を一括して回せる iterator を返す。</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function iterator_join(
    iterable $iterables,
    $preserve_keys = true
): \Iterator</div></pre>
<div class="description">
<p>要するにほぼ AppendIterator のラッパーだが、$iterable には配列も渡すことができるし、キーも振り直すことができる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$iterator = iterator_join([
    ['A'],                     // ただの配列
    new \ArrayIterator(['B']), // Iterator
    (fn() =&gt; yield 'C')(),     // Generator
], false);
// 上記を回すと 1 ループで全要素を回せる
that(iterator_to_array($iterator))-&gt;is(['A', 'B', 'C']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$iterables</code></td>
<td>​<span class="summary">結合する iterable</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$preserve_keys = true</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.iterator.php" target="_blank">Iterator</a></td>
<td>​<span class="summary">一括で回せる iterator</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c95d751db9eb2c8eb2a7cac2dcc52f90fddc0f9b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-iterator_map()" class="anchor"></a>[F] iterator_map <small><span class="summary">array_map の iterator 版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/iterator/iterator_map.php#L7-L67" target="_blank">iterator_map.php#7~67</a></p>
</div>
<details>
<summary class="">array_map の iterator 版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function iterator_map(
    ?callable $callback,
    iterable ...$iterables
): \Iterator</div></pre>
<div class="description">
<p>基本的に array_map と同じ動作にしてあるが、下記の点が異なる。</p>
<ul class=" simple">
<li>$callback に null, $iterables に1つだけ渡したときも zip 的動作をする<ul class=" simple">
<li>array_map は1つの時の一貫性がなく、やや非直感的な動作をする</li>
</ul>
</li>
<li>値だけではなくキーも渡ってくる<ul class=" simple">
<li>例えば $iterables が2つの場合 <code>($v1, $v2, $k1, $k2)</code> の4引数が渡ってくる</li>
</ul>
</li>
</ul>
<p>数が不一致の場合、(v, k) の組が共に null で渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// いわゆる zip 操作
$it = iterator_map(null, (function () {
    yield 1;
    yield 2;
    yield 3;
})(), (function () {
    yield 7;
    yield 8;
    yield 9;
})());
that(iterator_to_array($it))-&gt;isSame([[1, 7], [2, 8], [3, 9]]);

// キーも渡ってくる
$it = iterator_map(fn($v1, $v2, $k1, $k2) =&gt; "$k1:$v1, $k2:$v2", (function () {
    yield 'a' =&gt; 1;
    yield 'b' =&gt; 2;
    yield 'c' =&gt; 3;
})(), (function () {
    yield 'g' =&gt; 7;
    yield 'h' =&gt; 8;
    yield 'i' =&gt; 9;
})());
that(iterator_to_array($it))-&gt;isSame(["a:1, g:7", "b:2, h:8", "c:3, i:9"]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">コールバック</span></td>
</tr>
<tr>
<td>​iterable</td>
<td>​<code>...$iterables</code></td>
<td>​<span class="summary">iterable</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.iterator.php" target="_blank">Iterator</a></td>
<td>​<span class="summary">コールバックを適用した iterable</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f48ad35e205551163951a1839855c317fadcf20b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-iterator_maps()" class="anchor"></a>[F] iterator_maps <small><span class="summary">iterable にコールバック（複数）を適用した Iterator を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/iterator/iterator_maps.php#L8-L42" target="_blank">iterator_maps.php#8~42</a></p>
</div>
<details>
<summary class="">iterable にコールバック（複数）を適用した Iterator を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function iterator_maps(
    iterable $iterable,
    callable ...$callbacks
): \Iterator</div></pre>
<div class="description">
<p>指定したコールバックで複数回回してマップする。<span class="implicit-br">
</span>引数は (値, キー, 連番) が渡ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// Generator の値を2乗してから3を足す
$it = iterator_maps((function () {
    yield 1;
    yield 2;
    yield 3;
})(), fn($v) =&gt; $v ** 2, fn($v) =&gt; $v + 3);
that(iterator_to_array($it))-&gt;isSame([4, 7, 12]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$iterable</code></td>
<td>​<span class="summary">iterable</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>...$callbacks</code></td>
<td>​<span class="summary">コールバック</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.iterator.php" target="_blank">Iterator</a></td>
<td>​<span class="summary">コールバックを適用した iterable</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5df171f206337b599edaad217c795b54d9405b82-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-iterator_split()" class="anchor"></a>[F] iterator_split <small><span class="summary">iterator から頭何件かを取り出してチャンク化して返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/iterator/iterator_split.php#L7-L80" target="_blank">iterator_split.php#7~80</a></p>
</div>
<details>
<summary class="">iterator から頭何件かを取り出してチャンク化して返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function iterator_split(
    iterable $iterable,
    array $chunk_sizes,
    bool $preserve_keys = false
): array</div></pre>
<div class="description">
<p>rewind できない iterator から頭1件だけ取り出して rewind して再ループしたい、という状況が稀によくある。<span class="implicit-br">
</span>この関数と iterator_join と組み合わせればそれが容易に実現できる。</p>
<p>$iterable には配列も渡すことができる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$generator = function () {
    yield 'a';
    yield 'b';
    yield 'c';
    yield 'd';
    yield 'e';
    yield 'f';
    yield 'g';
};
// 要素7の Generator から頭1,2件を取り出す
[$one, $two, $gen] = iterator_split($generator(), [1, 2]);
// 最初の要素は1件
that($one)-&gt;is(['a']);
// 次の要素は2件
that($two)-&gt;is(['b', 'c']);
// かならず最後の要素に元の iterator が来る
that($gen)-&gt;isInstanceOf(\Iterator::class);

// $chunk_sizes の配列のキーは返り値のキーになる
['one' =&gt; $one, 'two' =&gt; $two, 0 =&gt; $gen] = iterator_split($generator(), ['one' =&gt; 1, 'two' =&gt; 2]);
// one は1件
that($one)-&gt;is(['a']);
// two は2件
that($two)-&gt;is(['b', 'c']);
// かならず最後の要素に元の iterator が来る
that($gen)-&gt;isInstanceOf(\Iterator::class);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$iterable</code></td>
<td>​<span class="summary">対象 iterator</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$chunk_sizes</code></td>
<td>​<span class="summary">各チャンクの数を指定する</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$preserve_keys = false</code></td>
<td>​<span class="summary">キーを保存するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">$chunk_sizes の数+1 の iterable 配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_43a67e0ac9e7596ee7b8f6355bb5862a34ce2916-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-math" class="anchor"></a>[N] ryunosuke\Functions\Package\math\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-12" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-math--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_94a0c1106efe2f400e412fff5b02f3e70e82c66d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-average()" class="anchor"></a>[F] average <small><span class="summary">引数の意味平均値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/average.php#L7-L25" target="_blank">average.php#7~25</a></p>
</div>
<details>
<summary class="">引数の意味平均値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function average(mixed ...$variadic): mixed</div></pre>
<div class="description">
<ul class=" simple">
<li>3座標の重心座標とか日付の平均とかそういうもの</li>
<li>配列は個数ではなくフラット展開した要素を対象にする</li>
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象の変数・配列・リスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">意味平均値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_46ca66353fb0e4ee715e3c1641b8455233513103-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-base_convert_array()" class="anchor"></a>[F] base_convert_array <small><span class="summary">配列を対象とした base_convert</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/base_convert_array.php#L7-L64" target="_blank">base_convert_array.php#7~64</a></p>
</div>
<details>
<summary class="">配列を対象とした base_convert</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function base_convert_array(
    array $array,
    int $from_base,
    int $to_base
): array</div></pre>
<div class="description">
<p>配列の各要素を数値の桁とみなして基数を変換する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 123(10進)を7B(16進)に変換
that(base_convert_array([1, 2, 3], 10, 16))-&gt;isSame([7, 11]);
// つまりこういうこと（10 * 10^2 + 20 * 10^1 + 30 * 10^0 =&gt; 4 * 16^2 + 12 * 16^1 + 14 * 16^0）
that(base_convert_array([10, 20, 30], 10, 16))-&gt;isSame([4, 12, 14]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">対象配列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$from_base</code></td>
<td>​<span class="summary">変換元基数</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$to_base</code></td>
<td>​<span class="summary">変換先基数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">基数変換後の配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://github.com/tuupola/base62/blob/2.x/LICENSE" target="_blank">https://github.com/tuupola/base62/blob/2.x/LICENSE</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2d7bda68af458dd167d00078d37274b8c3f0e7ea-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-calculate_formula()" class="anchor"></a>[F] calculate_formula <small><span class="summary">数式を計算して結果を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/calculate_formula.php#L9-L61" target="_blank">calculate_formula.php#9~61</a></p>
</div>
<details>
<summary class="">数式を計算して結果を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function calculate_formula(string $formula): int|float</div></pre>
<div class="description">
<p>内部的には eval で計算するが、文字列や関数呼び出しなどは受け付けないため原則としてセーフティ。<span class="implicit-br">
</span>許可されるのは定数・数値リテラルと演算子のみ。<span class="implicit-br">
</span>定数を許可しているのは PI(3.14) や HOUR(3600) などの利便性のため。<span class="implicit-br">
</span>定数値が非数値の場合、強制的に数値化して警告を促す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(calculate_formula('1 + 2 - 3 * 4'))-&gt;isSame(-9);
that(calculate_formula('1 + (2 - 3) * 4'))-&gt;isSame(-3);
that(calculate_formula('PHP_INT_SIZE * 3'))-&gt;isSame(PHP_INT_SIZE * 3);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$formula</code></td>
<td>​<span class="summary">計算式</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float</td>
<td>​<span class="summary">計算結果</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a0db5f37913509baee787c394cb126677aa2b14f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-clamp()" class="anchor"></a>[F] clamp <small><span class="summary">値を一定範囲に収める</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/clamp.php#L7-L55" target="_blank">clamp.php#7~55</a></p>
</div>
<details>
<summary class="">値を一定範囲に収める</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function clamp(
    int|mixed $value,
    int|mixed $min,
    int|mixed $max,
    bool $circulative = false
): int</div></pre>
<div class="description">
<p>$circulative に true を渡すと値が循環する。<span class="implicit-br">
</span>ただし、循環的な型に限る（整数のみ？）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 5～9 に収める
that(clamp(4, 5, 9))-&gt;isSame(5); // 4 は [5～9] の範囲外なので 5 に切り上げられる
that(clamp(5, 5, 9))-&gt;isSame(5); // 範囲内なのでそのまま
that(clamp(6, 5, 9))-&gt;isSame(6); // 範囲内なのでそのまま
that(clamp(7, 5, 9))-&gt;isSame(7); // 範囲内なのでそのまま
that(clamp(8, 5, 9))-&gt;isSame(8); // 範囲内なのでそのまま
that(clamp(9, 5, 9))-&gt;isSame(9); // 範囲内なのでそのまま
that(clamp(10, 5, 9))-&gt;isSame(9); // 10 は [5～9] の範囲外なので 9 に切り下げられる

// 5～9 に収まるように循環する
that(clamp(4, 5, 9, true))-&gt;isSame(9); // 4 は [5～9] の範囲外なので循環して 9 になる
that(clamp(5, 5, 9, true))-&gt;isSame(5); // 範囲内なのでそのまま
that(clamp(6, 5, 9, true))-&gt;isSame(6); // 範囲内なのでそのまま
that(clamp(7, 5, 9, true))-&gt;isSame(7); // 範囲内なのでそのまま
that(clamp(8, 5, 9, true))-&gt;isSame(8); // 範囲内なのでそのまま
that(clamp(9, 5, 9, true))-&gt;isSame(9); // 範囲内なのでそのまま
that(clamp(10, 5, 9, true))-&gt;isSame(5); // 10 は [5～9] の範囲外なので循環して 5 になる</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">対象の値</span></td>
</tr>
<tr>
<td>​int|​mixed</td>
<td>​<code>$min</code></td>
<td>​<span class="summary">最小値</span></td>
</tr>
<tr>
<td>​int|​mixed</td>
<td>​<code>$max</code></td>
<td>​<span class="summary">最大値</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$circulative = false</code></td>
<td>​<span class="summary">true だと切り詰めるのではなく循環する</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">一定範囲に収められた値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ef1c8164b9d16ebe5fb320e1bbed077464a6a176-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-decimal()" class="anchor"></a>[F] decimal <small><span class="summary">数値を指定桁数に丸める</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/decimal.php#L7-L69" target="_blank">decimal.php#7~69</a></p>
</div>
<details>
<summary class="">数値を指定桁数に丸める</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function decimal(
    int|float $value,
    int $precision = 0,
    mixed $mode = 0
): float</div></pre>
<div class="description">
<p>感覚的には「桁数指定できる ceil/floor」に近い。<span class="implicit-br">
</span>ただし、正の方向(ceil)、負の方向(floor)以外にも0の方向、無限大の方向も実装されている（さらに四捨五入もできる）。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>0   </dt>
<dd>0 に近づく方向： 絶対値が必ず減る</dd>
</div>
<div class="dtdd-container">
<dt>null</dt>
<dd>0 から離れる方向： 絶対値が必ず増える</dd>
</div>
<div class="dtdd-container">
<dt>-INF</dt>
<dd>負の無限大の方向： 数値として必ず減る</dd>
</div>
<div class="dtdd-container">
<dt>+INF </dt>
<dd>正の無限大の方向： 数値として必ず増える</dd>
</div>
</dl>
<p>のように「持っていきたい方向（の数値）」を指定すれば良い（正負自動だけ null で特殊だが）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(decimal(-3.14, 1, 0))-&gt;isSame(-3.1);    // 0 に近づく方向
that(decimal(-3.14, 1, null))-&gt;isSame(-3.2); // 0 から離れる方向
that(decimal(-3.14, 1, -INF))-&gt;isSame(-3.2); // 負の無限大の方向
that(decimal(-3.14, 1, +INF))-&gt;isSame(-3.1); // 正の無限大の方向

that(decimal(3.14, 1, 0))-&gt;isSame(3.1);    // 0 に近づく方向
that(decimal(3.14, 1, null))-&gt;isSame(3.2); // 0 から離れる方向
that(decimal(3.14, 1, -INF))-&gt;isSame(3.1); // 負の無限大の方向
that(decimal(3.14, 1, +INF))-&gt;isSame(3.2); // 正の無限大の方向</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">丸める値</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$precision = 0</code></td>
<td>​<span class="summary">有効桁数</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$mode = 0</code></td>
<td>​<span class="summary">丸めモード（0</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​float</td>
<td>​<span class="summary">丸めた値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f2f92b99ab182d760195e69b830ecc85fc92684d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-maximum()" class="anchor"></a>[F] maximum <small><span class="summary">引数の最大値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/maximum.php#L8-L28" target="_blank">maximum.php#8~28</a></p>
</div>
<details>
<summary class="">引数の最大値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function maximum(mixed ...$variadic): mixed</div></pre>
<div class="description">
<ul class=" simple">
<li>配列は個数ではなくフラット展開した要素を対象にする</li>
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(maximum(-1, 0, 1))-&gt;isSame(1);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象の変数・配列・リスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">最大値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_25bb382592ae0789d433c7b30498306a934338b3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mean()" class="anchor"></a>[F] mean <small><span class="summary">引数の相加平均値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/mean.php#L8-L31" target="_blank">mean.php#8~31</a></p>
</div>
<details>
<summary class="">引数の相加平均値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mean(mixed ...$variadic): int|float</div></pre>
<div class="description">
<ul class=" simple">
<li>is_numeric でない値は除外される（計算結果に影響しない）</li>
<li>配列は個数ではなくフラット展開した要素を対象にする</li>
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(mean(1, 2, 3, 4, 5, 6))-&gt;isSame(3.5);
that(mean(1, '2', 3, 'noize', 4, 5, 'noize', 6))-&gt;isSame(3.5);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象の変数・配列・リスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float</td>
<td>​<span class="summary">相加平均値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1825656132e76cec1678feac3ff4e7d0a3df4bae-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-median()" class="anchor"></a>[F] median <small><span class="summary">引数の中央値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/median.php#L8-L44" target="_blank">median.php#8~44</a></p>
</div>
<details>
<summary class="">引数の中央値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function median(mixed ...$variadic): mixed</div></pre>
<div class="description">
<ul class=" simple">
<li>要素数が奇数の場合は完全な中央値/偶数の場合は中2つの平均。「平均」という概念が存在しない値なら中2つの後の値</li>
<li>配列は個数ではなくフラット展開した要素を対象にする</li>
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 偶数個なので中2つの平均
that(median(1, 2, 3, 4, 5, 6))-&gt;isSame(3.5);
// 奇数個なのでど真ん中
that(median(1, 2, 3, 4, 5))-&gt;isSame(3);
// 偶数個だが文字列なので中2つの後
that(median('a', 'b', 'c', 'd'))-&gt;isSame('c');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象の変数・配列・リスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">中央値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_cd569ddb67f097fffc4c51788756471bfccaf88d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-minimum()" class="anchor"></a>[F] minimum <small><span class="summary">引数の最小値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/minimum.php#L8-L28" target="_blank">minimum.php#8~28</a></p>
</div>
<details>
<summary class="">引数の最小値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function minimum(mixed ...$variadic): mixed</div></pre>
<div class="description">
<ul class=" simple">
<li>配列は個数ではなくフラット展開した要素を対象にする</li>
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(minimum(-1, 0, 1))-&gt;isSame(-1);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象の変数・配列・リスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">最小値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6ba67fed3aa14922d0d87f9fa44c774a3fac90ac-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mode()" class="anchor"></a>[F] mode <small><span class="summary">引数の最頻値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/mode.php#L9-L46" target="_blank">mode.php#9~46</a></p>
</div>
<details>
<summary class="">引数の最頻値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mode(mixed ...$variadic): mixed</div></pre>
<div class="description">
<ul class=" simple">
<li>等価比較は文字列で行う。小数時は注意。おそらく php.ini の precision に従うはず</li>
<li>等価値が複数ある場合の返り値は不定</li>
<li>配列は個数ではなくフラット展開した要素を対象にする</li>
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(mode(0, 1, 2, 2, 3, 3, 3))-&gt;isSame(3);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象の変数・配列・リスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">最頻値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_dc7dc6b54a64a9aedcb4f630c5cb9a309606b89e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-sum()" class="anchor"></a>[F] sum <small><span class="summary">引数の合計値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/math/sum.php#L8-L30" target="_blank">sum.php#8~30</a></p>
</div>
<details>
<summary class="">引数の合計値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function sum(mixed ...$variadic): mixed</div></pre>
<div class="description">
<ul class=" simple">
<li>is_numeric でない値は除外される（計算結果に影響しない）</li>
<li>配列は個数ではなくフラット展開した要素を対象にする</li>
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(sum(1, 2, 3, 4, 5, 6))-&gt;isSame(21);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">対象の変数・配列・リスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">合計値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_72eef4873771b4e17aae7219bac8507a577030d6-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-misc" class="anchor"></a>[N] ryunosuke\Functions\Package\misc\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-13" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-misc--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_71a65b946dfb1dcdae6f653976921f72b017f4ec-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-annotation_parse()" class="anchor"></a>[F] annotation_parse <small><span class="summary">アノテーションっぽい文字列をそれっぽくパースして返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/annotation_parse.php#L14-L207" target="_blank">annotation_parse.php#14~207</a></p>
</div>
<details>
<summary class="">アノテーションっぽい文字列をそれっぽくパースして返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function annotation_parse(
    string|\Reflector $annotation,
    array|mixed $schema = [],
    string|array $nsfiles = []
): array</div></pre>
<div class="description">
<p>$annotation にはリフレクションオブジェクトも渡せる。<span class="implicit-br">
</span>その場合、getDocComment や getFilename, getNamespaceName などを用いてある程度よしなに名前解決する。<span class="implicit-br">
</span>もっとも、@Class(args) 形式を使わないのであれば特に意味はない。</p>
<p>$schame で「どのように取得するか？」のスキーマ定義が渡せる。<span class="implicit-br">
</span>スキーマ定義は連想配列で各アノテーションごとに下記のような定義を指定でき、連想配列でない場合はすべてのアノテーションにおいて指定したとみなされる。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>true</dt>
<dd>余計なことはせず、アノテーションの文字列をそのまま返す</dd>
</div>
<div class="dtdd-container">
<dt>false</dt>
<dd>下記にようによしなに変換して返す</dd>
</div>
<div class="dtdd-container">
<dt>[]</dt>
<dd>複数値モードを強制する</dd>
</div>
<div class="dtdd-container">
<dt>null</dt>
<dd>単一値モードを強制する</dd>
</div>
</dl>
<p>アノテーションの仕様は下記（すべて $schema が false であるとする）。</p>
<dl class="docutils field-list">
</dl><li>@から行末まで（1行に複数のアノテーションは含められない）<ul class=" simple">
<li>ただし行末が <code>({[</code> のいずれかであれば次の <code>]})</code> までブロックを記載する機会が与えられる</li>
<li>ブロックを見つけたときは本来値となるべき値がキーに、ブロックが値となり、結果は必ず配列化される</li>
</ul>
</li>
<li>同じアノテーションを複数見つけたときは配列化される</li>
<div class="dtdd-container">
<dt><code>@hogera</code></dt>
<dd>値なしは null を返す</dd>
</div>
<div class="dtdd-container">
<dt><code>@hogera v1 "v2 v3"</code></dt>
<dd>["v1", "v2 v3"] という配列として返す</dd>
</div>
<div class="dtdd-container">
<dt><code>@hogera {key: 123}</code></dt>
<dd>["key" =&gt; 123] という（連想）配列として返す</dd>
</div>
<div class="dtdd-container">
<dt><code>@hogera [123, 456]</code></dt>
<dd>[123, 456] という連番配列として返す</dd>
</div>
<div class="dtdd-container">
<dt><code>@hogera ("2019/12/23")</code></dt>
<dd>hogera で解決できるクラス名で new して返す（$filename 引数の指定が必要）</dd>
</div>
<li>下3つの形式はアノテーション区切りのスペースはあってもなくても良い</li>

<p>$schema が true だと上記のような変換は一切行わず、素朴な文字列で返す。<span class="implicit-br">
</span>あくまで簡易実装であり、本格的に何かをしたいなら専用のパッケージを導入したほうが良い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$annotations = annotation_parse('

@noval
@single this is value
@closure this is value
@array this is value
@hash {key: 123}
@list [1, 2, 3]
@ArrayObject([1, 2, 3])
@block message {
    this is message1
    this is message2
}
@same this is same value1
@same this is same value2
@same this is same value3
', [
    'single'  =&gt; true,
    'closure' =&gt; fn($value) =&gt; explode(' ', strtoupper($value)),
]);
that($annotations)-&gt;is([
    'noval'       =&gt; null,                        // 値なしは null になる
    'single'      =&gt; 'this is value',             // $schema 指定してるので文字列になる
    'closure'     =&gt; ['THIS', 'IS', 'VALUE'],     // $schema 指定してそれがクロージャだとコールバックされる
    'array'       =&gt; ['this', 'is', 'value'],     // $schema 指定していないので配列になる
    'hash'        =&gt; ['key' =&gt; '123'],            // 連想配列になる
    'list'        =&gt; [1, 2, 3],                   // 連番配列になる
    'ArrayObject' =&gt; new \ArrayObject([1, 2, 3]), // new されてインスタンスになる
    "block"       =&gt; [                            // ブロックはブロック外をキーとした連想配列になる（複数指定でキーは指定できるイメージ）
        "message" =&gt; ["this is message1\n    this is message2"],
    ],
    'same'        =&gt; [                            // 複数あるのでそれぞれの配列になる
        ['this', 'is', 'same', 'value1'],
        ['this', 'is', 'same', 'value2'],
        ['this', 'is', 'same', 'value3'],
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​<a href="https://php.net/manual/class.reflector.php" target="_blank">Reflector</a></td>
<td>​<code>$annotation</code></td>
<td>​<span class="summary">アノテーション文字列</span></td>
</tr>
<tr>
<td>​array|​mixed</td>
<td>​<code>$schema = []</code></td>
<td>​<span class="summary">スキーマ定義</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$nsfiles = []</code></td>
<td>​<span class="summary">ファイル名 or [ファイル名 =&gt; 名前空間名]</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">アノテーション配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6c7f236d7326396ac9dd0b826738c661ccbde63c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-console_log()" class="anchor"></a>[F] console_log <small><span class="summary">js の console に値を吐き出す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/console_log.php#L7-L46" target="_blank">console_log.php#7~46</a></p>
</div>
<details>
<summary class="">js の console に値を吐き出す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function console_log(mixed ...$values)</div></pre>
<div class="description">
<p>script タグではなく X-ChromeLogger-Data を使用する。<span class="implicit-br">
</span>したがってヘッダ送信前に呼ぶ必要がある。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$values</code></td>
<td>​<span class="summary">出力する値（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://craig.is/writing/chrome-logger/techspecs" target="_blank">https://craig.is/writing/chrome-logger/techspecs</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_068c3494b9e65f3e990cce9e680db5495b4ab11c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-evaluate()" class="anchor"></a>[F] evaluate <small><span class="summary">eval のプロキシ関数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/evaluate.php#L8-L78" target="_blank">evaluate.php#8~78</a></p>
</div>
<details>
<summary class="">eval のプロキシ関数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function evaluate(
    string $phpcode,
    array $contextvars = [],
    int $cachesize = 256
): mixed</div></pre>
<div class="description">
<p>一度ファイルに吐いてから require した方が opcache が効くので抜群に速い。<span class="implicit-br">
</span>また、素の eval は ParseError が起こったときの表示がわかりにくすぎるので少し見やすくしてある。</p>
<p>関数化してる以上 eval におけるコンテキストの引き継ぎはできない。<span class="implicit-br">
</span>ただし、引数で変数配列を渡せるようにしてあるので get_defined_vars を併用すれば基本的には同じ（$this はどうしようもない）。</p>
<p>短いステートメントだと opcode が少ないのでファイルを経由せず直接 eval したほうが速いことに留意。<span class="implicit-br">
</span>一応引数で指定できるようにはしてある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$a = 1;
$b = 2;
$phpcode = ';
$c = $a + $b;
return $c * 3;
';
that(evaluate($phpcode, get_defined_vars()))-&gt;isSame(9);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$phpcode</code></td>
<td>​<span class="summary">実行する php コード</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$contextvars = []</code></td>
<td>​<span class="summary">コンテキスト変数配列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$cachesize = 256</code></td>
<td>​<span class="summary">キャッシュするサイズ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">eval の return 値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6c7519b904304b9f3544b7cbbe7cad8bab62a753-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-namespace_parse()" class="anchor"></a>[F] namespace_parse <small><span class="summary">php ファイルをパースして名前空間配列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/namespace_parse.php#L11-L311" target="_blank">namespace_parse.php#11~311</a></p>
</div>
<details>
<summary class="">php ファイルをパースして名前空間配列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function namespace_parse(
    string $filename,
    array $options = []
): array</div></pre>
<div class="description">
<p>ファイル内で use/use const/use function していたり、シンボルを定義していたりする箇所を検出して名前空間単位で返す。<span class="implicit-br">
</span>クラスコンテキストでの解決できないシンボルはその名前空間として返す。<span class="implicit-br">
</span>つまり、 use せずに いきなり new Hoge() などとしてもその同一名前空間の Hoge として返す。<span class="implicit-br">
</span>これは同一名前空間であれば use せずとも使用できる php の仕様に合わせるため。<span class="implicit-br">
</span>対象はクラスのみであり、定数・関数は対象外。<span class="implicit-br">
</span>use せずに hoge_function() などとしても、それが同一名前空間なのかグローバルにフォールバックされるのかは静的には決して分からないため。</p>
<p>その他、#[AttributeName]や ClassName::class など、おおよそクラス名が必要とされるコンテキストでのシンボルは全て返される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// このような php ファイルをパースすると・・・
file_set_contents(sys_get_temp_dir() . '/namespace.php', '
&lt;?php
namespace NS1;
use ArrayObject as AO;
use function strlen as SL;
function InnerFunc(){}
class InnerClass{}
define("OUTER\\\\CONST", "OuterConst");

namespace NS2;
use RuntimeException as RE;
use const COUNT_RECURSIVE as CR;
class InnerClass{}
const InnerConst = 123;

// いきなり Hoge を new してみる
new Hoge();
');
// このような名前空間配列が得られる
that(namespace_parse(sys_get_temp_dir() . '/namespace.php'))-&gt;isSame([
    'NS1' =&gt; [
        'const'    =&gt; [],
        'function' =&gt; [
            'SL'        =&gt; 'strlen',
            'InnerFunc' =&gt; 'NS1\\InnerFunc',
        ],
        'alias'    =&gt; [
            'AO'         =&gt; 'ArrayObject',
            'InnerClass' =&gt; 'NS1\\InnerClass',
        ],
    ],
    'OUTER' =&gt; [
        'const'    =&gt; [
            'CONST' =&gt; 'OUTER\\CONST',
        ],
        'function' =&gt; [],
        'alias'    =&gt; [],
    ],
    'NS2' =&gt; [
        'const'    =&gt; [
            'CR'         =&gt; 'COUNT_RECURSIVE',
            'InnerConst' =&gt; 'NS2\\InnerConst',
        ],
        'function' =&gt; [],
        'alias'    =&gt; [
            'RE'         =&gt; 'RuntimeException',
            'InnerClass' =&gt; 'NS2\\InnerClass',
            'Hoge'       =&gt; 'NS2\\Hoge', // 同一名前空間として返される
        ],
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$filename</code></td>
<td>​<span class="summary">ファイル名</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">名前空間配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6e965dbe5c33b9643a99fa738adaaf6eae2a7c32-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-namespace_resolve()" class="anchor"></a>[F] namespace_resolve <small><span class="summary">エイリアス名を完全修飾名に解決する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/namespace_resolve.php#L8-L73" target="_blank">namespace_resolve.php#8~73</a></p>
</div>
<details>
<summary class="">エイリアス名を完全修飾名に解決する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function namespace_resolve(
    string $shortname,
    string|array $nsfiles,
    array $targets = ["const", "function", "alias"]
): string|null</div></pre>
<div class="description">
<p>例えばあるファイルのある名前空間で <code>use Hoge\Fuga\Piyo;</code> してるときの <code>Piyo</code> を <code>Hoge\Fuga\Piyo</code> に解決する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// このような php ファイルがあるとして・・・
file_set_contents(sys_get_temp_dir() . '/symbol.php', '
&lt;?php
namespace vendor\NS;

use ArrayObject as AO;
use function strlen as SL;

function InnerFunc(){}
class InnerClass{}
');
// 下記のように解決される
that(namespace_resolve('AO', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('ArrayObject');
that(namespace_resolve('SL', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('strlen');
that(namespace_resolve('InnerFunc', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('vendor\\NS\\InnerFunc');
that(namespace_resolve('InnerClass', sys_get_temp_dir() . '/symbol.php'))-&gt;isSame('vendor\\NS\\InnerClass');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$shortname</code></td>
<td>​<span class="summary">エイリアス名</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$nsfiles</code></td>
<td>​<span class="summary">ファイル名 or [ファイル名 =&gt; 名前空間名]</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$targets = ["const", "function", "alias"]</code></td>
<td>​<span class="summary">エイリアスタイプ（'const', 'function', 'alias' のいずれか）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​null</td>
<td>​<span class="summary">完全修飾名。解決できなかった場合は null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5e7ec55b03b3ae3b66f35373d27d85d6ebeb55a4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-php_highlight()" class="anchor"></a>[F] php_highlight <small><span class="summary">php のコードをハイライトする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/php_highlight.php#L9-L181" target="_blank">php_highlight.php#9~181</a></p>
</div>
<details>
<summary class="">php のコードをハイライトする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function php_highlight(
    string $phpcode,
    array|int $options = []
): string</div></pre>
<div class="description">
<p>SAPI に応じて自動でハイライトする（html タグだったり ASCII color だったり）。<span class="implicit-br">
</span>highlight_string の CLI 対応版とも言える。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$phpcode</code></td>
<td>​<span class="summary">ハイライトする php コード</span></td>
</tr>
<tr>
<td>​array|​int</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">ハイライトされた php コード</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_64a69a666f68b105478e428bc797cff0b0e7675a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-php_indent()" class="anchor"></a>[F] php_indent <small><span class="summary">php のコードのインデントを調整する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/php_indent.php#L7-L134" target="_blank">php_indent.php#7~134</a></p>
</div>
<details>
<summary class="">php のコードのインデントを調整する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function php_indent(
    string $phpcode,
    array|int|string $options = []
): string</div></pre>
<div class="description">
<p>baseline で基準インデント位置を指定する。<span class="implicit-br">
</span>その基準インデントを削除した後、指定したインデントレベルでインデントするようなイメージ。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$phpcode = '
    echo 123;

    if (true) {
        echo 456;
    }
';
// 数値指定は空白換算
that(php_indent($phpcode, 8))-&gt;isSame('
        echo 123;

        if (true) {
            echo 456;
        }
');
// 文字列を指定すればそれが使用される
that(php_indent($phpcode, "  "))-&gt;isSame('
  echo 123;

  if (true) {
      echo 456;
  }
');
// オプション指定
that(php_indent($phpcode, [
    'baseline'  =&gt; 1,    // 基準インデントの行番号（負数で下からの指定になる）
    'indent'    =&gt; 4,    // インデント指定（上記の数値・文字列指定はこれの糖衣構文）
    'trimempty' =&gt; true, // 空行を trim するか
    'heredoc'   =&gt; true, // Flexible Heredoc もインデントするか
]))-&gt;isSame('
    echo 123;

    if (true) {
        echo 456;
    }
');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$phpcode</code></td>
<td>​<span class="summary">インデントする php コード</span></td>
</tr>
<tr>
<td>​array|​int|​string</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">インデントされた php コード</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_40505ce2b182a3b7dbf909861da4e57ac2e5fba1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-php_opcode()" class="anchor"></a>[F] php_opcode <small><span class="summary">コード断片の opcode を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/php_opcode.php#L9-L46" target="_blank">php_opcode.php#9~46</a></p>
</div>
<details>
<summary class="">コード断片の opcode を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function php_opcode(
    string $phpcode,
    int $level = 131072
): string</div></pre>
<div class="description">
<p>php レベルでサクッと取りたいことはあるし、ini 設定がややややこしく、簡単に取れない場合があるので関数化した。<span class="implicit-br">
</span>phpdbg 等ではなく opcache で出すため、与えたコードは実行されることに注意。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$phpcode</code></td>
<td>​<span class="summary">php コード</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$level = 131072</code></td>
<td>​<span class="summary">opt_debug_level に渡される（URL 参照だが、正味使うのは 0x10000:最適化前, 0x20000:最適化後 くらいだろう）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">opcode</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://www.npopov.com/2022/05/22/The-opcache-optimizer.html" target="_blank">https://www.npopov.com/2022/05/22/The-opcache-optimizer.html</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9baecc392acd7fd165116ce75c9577741dbcd165-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-php_parse()" class="anchor"></a>[F] php_parse <small><span class="summary">php のコード断片をパースする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/php_parse.php#L8-L258" target="_blank">php_parse.php#8~258</a></p>
</div>
<details>
<summary class="">php のコード断片をパースする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function php_parse(
    string $phpcode,
    array|int $option = []
): \PhpToken[]</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$phpcode</code></td>
<td>​<span class="summary">パースする php コード</span></td>
</tr>
<tr>
<td>​array|​int</td>
<td>​<code>$option = []</code></td>
<td>​<span class="summary">パースオプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.phptoken.php" target="_blank">PhpToken</a>[]</td>
<td>​<span class="summary">トークン配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_402661736fb81ce1dbce574ad4893545e438e451-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-php_strip()" class="anchor"></a>[F] php_strip <small><span class="summary">文字列から php コードを取り除く</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/php_strip.php#L9-L116" target="_blank">php_strip.php#9~116</a></p>
</div>
<details>
<summary class="">文字列から php コードを取り除く</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function php_strip(
    string $phtml,
    array $option = [],
    array &amp;$mapping = []
): string</div></pre>
<div class="description">
<p>正確にはオプションの replacer で指定したものに置換される（デフォルト空文字なので削除になる）。<span class="implicit-br">
</span>replacer にクロージャを渡すと(phpコード, 出現番号) が渡ってくるので、それに応じて値を返せばそれに置換される。<span class="implicit-br">
</span>文字列を指定すると自動で出現番号が付与される。</p>
<p>$mapping 配列には「どれをどのように」と言った変換表が格納される。<span class="implicit-br">
</span>典型的には strtr に渡して php コードを復元させるのに使用する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$phtml = 'begin php code &lt;?php echo 123 ?&gt; end';
// php コードが消えている
that(php_strip($phtml))-&gt;is('begin php code  end');
// $mapping を使用すると元の文字列に復元できる
$html = php_strip($phtml, [], $mapping);
that(strtr($html, $mapping))-&gt;is($phtml);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$phtml</code></td>
<td>​<span class="summary">php コードを含む文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$option = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$mapping = []</code></td>
<td>​<span class="summary">変換表が格納される参照変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">php コードが除かれた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5b33a220c2c9cb13c9f856a9930ff848c462f669-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-php_tokens()" class="anchor"></a>[F] php_tokens <small><span class="summary">PhpToken に便利メソッドを生やした配列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/php_tokens.php#L10-L238" target="_blank">php_tokens.php#10~238</a></p>
</div>
<details>
<summary class="">PhpToken に便利メソッドを生やした配列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function php_tokens(
    string $code,
    int $flags = 0
): PhpTokens[]</div></pre>
<div class="description">
<p>php_parse とは似て非なる（あっちは何がしたいのかよく分からなくなっている）。<span class="implicit-br">
</span>この関数はシンプルに PhpToken の拡張版として動作する。</p>
<p>生えているメソッドは下記。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>__debugInfo</dt>
<dd>デバッグしやすい情報で吐き出す</dd>
</div>
<div class="dtdd-container">
<dt>clone</dt>
<dd>新プロパティを指定して clone する</dd>
</div>
<div class="dtdd-container">
<dt>name</dt>
<dd>getTokenName のエイリアス</dd>
</div>
<div class="dtdd-container">
<dt>prev</dt>
<dd>条件一致した直前のトークンを返す<ul class=" simple">
<li>引数未指定時は isIgnorable でないもの</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>next</dt>
<dd>条件一致した直後のトークンを返す<ul class=" simple">
<li>引数未指定時は isIgnorable でないもの</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>find</dt>
<dd>ブロック内部を読み飛ばしつつ指定トークンを探す</dd>
</div>
<div class="dtdd-container">
<dt>end</dt>
<dd>自身の対応するペアトークンまで飛ばして返す<ul class=" simple">
<li>要するに { や (, " などの中途半端ではない終わりのトークンを返す</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>contents</dt>
<dd>自身と end 間のトークンを文字列化する</dd>
</div>
<div class="dtdd-container">
<dt>resolve</dt>
<dd>text が名前空間を解決して完全修飾になったトークンを返す</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$phpcode = '&lt;?php
// dummy
namespace Hogera;
class Example
{
    // something
}';

$tokens = php_tokens($phpcode);
// name でトークン名が得られる
that($tokens[0])-&gt;name()-&gt;is('T_OPEN_TAG');
// ↑の次はコメントだが next で namespace が得られる
that($tokens[0])-&gt;next()-&gt;text-&gt;is('namespace');
// 同じく↑の次はホワイトスペースだが next で Hogera が得られる
that($tokens[0])-&gt;next()-&gt;next()-&gt;text-&gt;is('Hogera');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$code</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">パースオプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--PhpTokens">PhpTokens</a>[]</td>
<td>​<span class="summary">トークン配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7baa7bfc3ca39faa03bb7cebfaaee602044073ef-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-unique_id()" class="anchor"></a>[F] unique_id <small><span class="summary">一意な文字列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/misc/unique_id.php#L7-L189" target="_blank">unique_id.php#7~189</a></p>
</div>
<details>
<summary class="">一意な文字列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function unique_id(
    array &amp;$id_info = [],
    array $debug = []
): string</div></pre>
<div class="description">
<p>最大でも8バイト（64ビット）に収まるようにしてある。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>41bit</dt>
<dd>1ミリ秒単位</dd>
</div>
<div class="dtdd-container">
<dt>7bit</dt>
<dd>シーケンス</dd>
</div>
<div class="dtdd-container">
<dt>16bit</dt>
<dd>IPv4ホストアドレス</dd>
</div>
</dl>
<p>いわゆる snowflake 系で sonyflake が近い。</p>
<p>シーケンスは「単位時間（1ミリ秒）あたりに発行できる数」を表す。<span class="implicit-br">
</span>7bit で少し少ないが、生成にファイルロックを使用しているため、1ミリ秒で 128 回生成されることがそもそもレアケース。<span class="implicit-br">
</span>7bit を超えると強制的に1ミリ秒待って timestamp を変えることで重複を防ぐ（≒その時は発行に1ミリ秒かかる）。</p>
<p>複数の IPv4 アドレスを持つ場合はサブネットが最も長いもの（ホストアドレスが最も短いもの）が使用される。<span class="implicit-br">
</span>IPv6 は未対応で、サブネット /16 未満も未対応。</p>
<p>引数はデバッグ用でいくつか用意しているが、実運用としては引数ゼロとして扱うこと。</p>
<p>以下、思考過程と備考。</p>
<ul class=" simple">
<li>単調増加の値としてタイムスタンプを採用<ul class=" simple">
<li>如何にホスト・シーケンスが同じになろうと発行時刻が別なら別IDにするためのプレフィックスとして使用する</li>
<li>時間が巻き戻らない限りは大丈夫</li>
<li>2093年までしか発行できない（<code>(2 ** 41) * (10 ** -3) / 60 / 60 / 24 / 365</code> = 69.73 年）</li>
</ul>
</li>
<li>サーバー間で重複を許したくない場合の候補は下記で、現在は IPv4 を採用している<ul class=" simple">
<li>ホスト名<ul class=" simple">
<li>文字列で大きさが読めないし一意である保証もない</li>
</ul>
</li>
<li>MAC アドレス<ul class=" simple">
<li>一意だが少し大きすぎる</li>
<li>下3桁がシリアルIDらしいので同メーカーなら重複しないかもしれない</li>
<li>ただそもそも php で MAC アドレスを簡単に得る手段がない</li>
</ul>
</li>
<li>IPv4<ul class=" simple">
<li>サーバー間で重複を許さないような id の生成は大抵クラスタを組んでいて IP が振られているはず</li>
<li>そして 4byte でユニークな IP が振られることはまずない（大抵は 2,3byte で固有のはず。/12未満のクラスタ構成なんて見たことない）</li>
</ul>
</li>
<li>IPv6<ul class=" simple">
<li>桁が大きすぎる</li>
<li>まだまだ IPv4 も現役なので積極的に採用する理由に乏しい</li>
</ul>
</li>
<li>引数で machine id を渡す<ul class=" simple">
<li>大抵のシステムでホスト数は1,2桁だろうので小bitで済む</li>
<li>でも引数無しにしたかった</li>
</ul>
</li>
</ul>
</li>
<li>プロセス間の重複（シーケンス）はファイルロックを使用して採番している<ul class=" simple">
<li>プロセスIDを採用してたが思ったより大きすぎた（現代的な linux ではデフォルト 2**22 らしい）</li>
<li>逐次ロックなので大量生成には全く向かない</li>
</ul>
</li>
</ul>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>&amp;$id_info = []</code></td>
<td>​<span class="summary">元になった生成データのレシーバ引数</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$debug = []</code></td>
<td>​<span class="summary">デバッグ用引数（配列で内部の動的な値を指定できる）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">一意なバイナリ文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9aa130a52f18c8a6b1204263867153cb2aa9a80a-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-network" class="anchor"></a>[N] ryunosuke\Functions\Package\network\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-14" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-network--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_5aebf3a03490f11a73e05aefbf55fb502404bcf8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cidr2ip()" class="anchor"></a>[F] cidr2ip <small><span class="summary">cidr 内の IP アドレスを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/cidr2ip.php#L8-L38" target="_blank">cidr2ip.php#8~38</a></p>
</div>
<details>
<summary class="">cidr 内の IP アドレスを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cidr2ip(string $cidr): array</div></pre>
<div class="description">
<p>すべての IP アドレスを返すため、<code>/1</code> のような極端な値を投げてはならない。<span class="implicit-br">
</span>（Generator の方がいいかもしれない）。</p>
<p>ipv6 は今のところ未対応。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(cidr2ip('192.168.0.0/30'))-&gt;isSame(['192.168.0.0', '192.168.0.1', '192.168.0.2', '192.168.0.3']);
that(cidr2ip('192.168.0.255/30'))-&gt;isSame(['192.168.0.252', '192.168.0.253', '192.168.0.254', '192.168.0.255']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$cidr</code></td>
<td>​<span class="summary">cidr</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">IP アドレス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_10f8accf766c3113b42c03c18303b1963ee53bc5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cidr_parse()" class="anchor"></a>[F] cidr_parse <small><span class="summary">cidr を分割する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/cidr_parse.php#L7-L30" target="_blank">cidr_parse.php#7~30</a></p>
</div>
<details>
<summary class="">cidr を分割する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cidr_parse(string $cidr): array</div></pre>
<div class="description">
<p>※ 内部向け</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$cidr</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">[$address, $networkBit, $localBit]</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9ad58ca42541f2622d50c7da97473ab714a1c1fb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-dns_resolve()" class="anchor"></a>[F] dns_resolve <small><span class="summary">TTL 対応の DNS リゾルバ</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/dns_resolve.php#L10-L317" target="_blank">dns_resolve.php#10~317</a></p>
</div>
<details>
<summary class="">TTL 対応の DNS リゾルバ</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function dns_resolve(
    string $hostname,
    int $type = ryunosuke\Functions\Package\DNS_A,
    string $returnAs = "value",
    int $ttl0 = 0,
    int $nxdomainTtl = 60,
    bool $flush = false,
    array $hosts = []
)</div></pre>
<div class="description">
<p>server を指定して自ら UDP で問い合わせたりするような機能はない（将来的にはやってもいいけど）。<span class="implicit-br">
</span>リゾルバとしては OS に設定されているネームサーバが使われる（php で言えば dns_get_record）。</p>
<p>hosts ファイルに記載されているレコードは ttl が 0 になるが、 $ttl0 で明示指定できる。<span class="implicit-br">
</span>$nxdomainTtl もほぼ hosts 用の引数（SOA がないドメインなんてほぼ存在しない）。</p>
<p>結果はローカルファイルシステムに保存されるので TTL が切れるまでは別プロセスでも同じ結果を返す。<span class="implicit-br">
</span>ネガティブキャッシュも実装されており TTL は SOA の minimum-ttl に従う。</p>
<p>$returnAs で返り値の形式を指定できる。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>'raw'</dt>
<dd>ほぼ生のまま返す（「ほぼ」というのは type ごとにカテゴライズされるため）</dd>
</div>
<div class="dtdd-container">
<dt>'values'</dt>
<dd>主たる値を配列で返す（「主たる」とは A だったら IP, MX だったら優先度ソート済みの target）</dd>
</div>
<div class="dtdd-container">
<dt>'value'</dt>
<dd>主たる値をスカラーで返す（「主たる」とは A だったらランダムの IP, MX だったら高優先度 target）</dd>
</div>
</dl>
<p>いずれにせよ DNS_XXX に複数の値を含めると複数の値を返し得るので注意。<span class="implicit-br">
</span>（根本的に raw+ALL 以外の複数値指定は推奨しない）。</p>
<p>普通は 'value' で十分で、MX で別レコードにリトライしたい場合くらいにしか 'values' は使用しない。<span class="implicit-br">
</span>'raw' に至ってはほぼデバック・確認用で通常用途での使用はほぼないはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// example.com A の主たる値をスカラーで返す
that(dns_resolve('example.com', DNS_A, 'value'))-&gt;isString(); // '96.7.128.175' 等（毎回異なる）
// example.com A の主たる値を配列で返す
that(dns_resolve('example.com', DNS_A, 'values'))-&gt;isArray(); // ['23.192.228.80'] 等（順番は毎回異なる）
// example.com 全レコードをカテゴライズして返す
that(dns_resolve('example.com', DNS_ALL, 'raw'))-&gt;hasKeyAll(['A', 'AAAA', 'SOA']); // var_dump してみれば一発で分かる</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$hostname</code></td>
<td>​<span class="summary">取得するドメイン名</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$type = ryunosuke\Functions\Package\DNS_A</code></td>
<td>​<span class="summary">取得するレコードタイプ</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$returnAs = "value"</code></td>
<td>​<span class="summary">返り値のタイプ</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$ttl0 = 0</code></td>
<td>​<span class="summary">TTL が 0（hosts 等）の場合の代替値</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$nxdomainTtl = 60</code></td>
<td>​<span class="summary">SOA がない場合（hosts 等）のネガティブキャッシュの TTL</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$flush = false</code></td>
<td>​<span class="summary">フラッシュフラグ</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$hosts = []</code></td>
<td>​<span class="summary">注入用 hosts ファイルだが実質的にテスト用</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a1d3be06430728268e6a40c4cbe012189fe59c7e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-fcgi_request()" class="anchor"></a>[F] fcgi_request <small><span class="summary">FastCGI リクエストを行う</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/fcgi_request.php#L12-L276" target="_blank">fcgi_request.php#12~276</a></p>
</div>
<details>
<summary class="">FastCGI リクエストを行う</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function fcgi_request(
    string $url,
    array $params = [],
    array|string $stdin = "",
    array $options = []
): array</div></pre>
<div class="description">
<p>※ 完全に特定用途向けで普通の使い方は想定していない</p>
<p>できるだけ http に似せたかったので $url からある程度 $params を推測して自動設定する。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>TCP</dt>
<dd>tcp://localhost:9000/path/to/script?a=A</dd>
</div>
<div class="dtdd-container">
<dt>UDS</dt>
<dd>unix://run%2Fphp-fpm%2Fwww.sock/path/to/script?a=A<ul class=" simple">
<li>とても気持ち悪いので UDS ファイルは $options で渡すこともできる</li>
<li>unix:///path/to/script?a=A ($options:['udsFile' =&gt; '/run/php-fpm/www.sock'])<span class="implicit-br">
</span>上記で SCRIPT_FILENAME, QUERY_STRING が設定される。<span class="implicit-br">
</span>$stdin を指定すると REQUEST_METHOD, CONTENT_LENGTH 等も設定される。<span class="implicit-br">
</span>$stdin は配列を渡すとよしなに扱われる。</li>
</ul>
</dd>
</div>
</dl>
<p>$params の自動設定は明示指定を決して上書きしない。<span class="implicit-br">
</span>ただし null だけは上書きするので自動設定の明示に使える。</p>
<p>「任意のホスト（http ではないのでドメイン（≒Host ヘッダ））」に「ドキュメントルートと無関係」に「fpm のコンテキストで実行」できることがほぼ唯一のメリット。<span class="implicit-br">
</span>要するに cli から fpm の opcache を温めたいような限定的なケースでしか使わないし使うべきでない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">URL</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$params = []</code></td>
<td>​<span class="summary">FCGI パラメータ</span></td>
</tr>
<tr>
<td>​array|​string</td>
<td>​<code>$stdin = ""</code></td>
<td>​<span class="summary">FCGI ボディ</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">その他のオプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">FCGI レスポンス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d1ffdebbce32378a68286a7d223a32ad4955418e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-getipaddress()" class="anchor"></a>[F] getipaddress <small><span class="summary">接続元となる IP を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/getipaddress.php#L8-L72" target="_blank">getipaddress.php#8~72</a></p>
</div>
<details>
<summary class="">接続元となる IP を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function getipaddress(string|int|null $target = null): ?string</div></pre>
<div class="description">
<p>IP を指定してそこへ接続する際の SourceIP を返す（省略すると最初のエントリを返す）。<span class="implicit-br">
</span>複数のネットワークにマッチした場合の結果は不定（最長が無難だろうがそもそも SourceIP がどうなるかが不定）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 何らかの IP アドレスが返ってくる
that(getipaddress())-&gt;isValidIpv4();
// 自分への接続元は自分なので 127.0.0.1 を返す
that(getipaddress('127.0.0.9'))-&gt;isSame('127.0.0.1');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int|​null</td>
<td>​<code>$target = null</code></td>
<td>​<span class="summary">接続先</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">IP アドレス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3df5f5167b4ff3bde77a45d7df231c8ea0e8c9ed-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_bechmark()" class="anchor"></a>[F] http_bechmark <small><span class="summary">http のベンチマークを取る</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_benchmark.php#L11-L138" target="_blank">http_benchmark.php#11~138</a></p>
</div>
<details>
<summary class="">http のベンチマークを取る</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_bechmark(
    array|string $urls,
    int $requests = 10,
    int $concurrency = 3,
    $output = null
): array</div></pre>
<div class="description">
<p>結果の各意味合いは下記の通り。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>status</dt>
<dd>http status code の統計<ul class=" simple">
<li>200 以外が混ざっている場合は何かが間違ってるので結果を疑うべき</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>wait</dt>
<dd>接続確立後から最初の応答までの時間（いわゆる TTFB）<ul class=" simple">
<li>ストリーミングなどしていなければ（かつ相手先が php であれば）これが実質的な応答速度と言える（バッファリングされるため transfer はただの消化試合になる）</li>
<li>全体として遅いならスコアは低いと言ってよい</li>
<li>min/max の差が激しいならおそらく捌き切れていない（backlog に溜まるなど）</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>transfer</dt>
<dd>最初の応答から全レスポンス完了までの時間<ul class=" simple">
<li>いわゆる帯域…のような単純な値ではない</li>
<li>例えばストリーミングをしている場合はその生成速度と言える</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>total</dt>
<dd>TCP/TLS 等のメタい時間を除いた合計時間<ul class=" simple">
<li>レスポンスサイズに引きずられるため参考程度でよい</li>
<li>敢えて言うなら min/max の差が激しいようなら何かを疑うべき</li>
</ul>
</dd>
</div>
</dl>
<p>例えば下記のような php のベンチを取ると概ね wait:1, transfer:2, total:3 になる。</p>
<pre data-label=""><div class="code">ob_end_clean();
sleep(1);
echo "wait";
flush();
sleep(2);
echo 'done';</div></pre>
<p>外れ値のフィルタなどは行わない。<span class="implicit-br">
</span>例えば backlog に溜まって応答が10倍になったとしてもそれは外れ値ではないだろう。<span class="implicit-br">
</span>と考えるとそもそも「外れ値」の定義自体が不可能であり、余計なことは一切しない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​string</td>
<td>​<code>$urls</code></td>
<td>​<span class="summary">URLs</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$requests = 10</code></td>
<td>​<span class="summary">合計リクエスト</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$concurrency = 3</code></td>
<td>​<span class="summary">同時接続数</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$output = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">結果配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_29e24928a4526e92438b4faeac96cf7ebf1646ed-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_delete()" class="anchor"></a>[F] http_delete <small><span class="summary"><a href="#--http_request%28%29">http_request</a> の DELETE 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_delete.php#L8-L26" target="_blank">http_delete.php#8~26</a></p>
</div>
<details>
<summary class=""><a href="#--http_request%28%29">http_request</a> の DELETE 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_delete(
    string $url,
    mixed $data = [],
    $options = [],
    &amp;$response_header = [],
    &amp;$info = []
): mixed</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">対象 URL</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$data = []</code></td>
<td>​<span class="summary">パラメータ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$response_header = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$info = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">レスポンスボディ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_18e797239bc16f0a3c9fc1f999071e33d7642c4f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_get()" class="anchor"></a>[F] http_get <small><span class="summary"><a href="#--http_request%28%29">http_request</a> の GET 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_get.php#L9-L29" target="_blank">http_get.php#9~29</a></p>
</div>
<details>
<summary class=""><a href="#--http_request%28%29">http_request</a> の GET 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_get(
    string $url,
    mixed $data = [],
    $options = [],
    &amp;$response_header = [],
    &amp;$info = []
): mixed</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">対象 URL</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$data = []</code></td>
<td>​<span class="summary">パラメータ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$response_header = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$info = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">レスポンスボディ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_cf30bbad0b1627167da4e075f0a3a589a55a569e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_head()" class="anchor"></a>[F] http_head <small><span class="summary"><a href="#--http_request%28%29">http_request</a> の HEAD 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_head.php#L8-L26" target="_blank">http_head.php#8~26</a></p>
</div>
<details>
<summary class=""><a href="#--http_request%28%29">http_request</a> の HEAD 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_head(
    string $url,
    mixed $data = [],
    $options = [],
    &amp;$response_header = [],
    &amp;$info = []
): array</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">対象 URL</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$data = []</code></td>
<td>​<span class="summary">パラメータ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$response_header = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$info = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">レスポンスヘッダ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_902f7ede9297ff43507a0be0a843469cc6b7894b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_patch()" class="anchor"></a>[F] http_patch <small><span class="summary"><a href="#--http_request%28%29">http_request</a> の PATCH 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_patch.php#L8-L26" target="_blank">http_patch.php#8~26</a></p>
</div>
<details>
<summary class=""><a href="#--http_request%28%29">http_request</a> の PATCH 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_patch(
    string $url,
    mixed $data = [],
    $options = [],
    &amp;$response_header = [],
    &amp;$info = []
): mixed</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">対象 URL</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$data = []</code></td>
<td>​<span class="summary">パラメータ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$response_header = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$info = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">レスポンスボディ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6797226d891752f0a4f9d08f3920a17451b8d0f4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_post()" class="anchor"></a>[F] http_post <small><span class="summary"><a href="#--http_request%28%29">http_request</a> の POST 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_post.php#L8-L26" target="_blank">http_post.php#8~26</a></p>
</div>
<details>
<summary class=""><a href="#--http_request%28%29">http_request</a> の POST 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_post(
    string $url,
    mixed $data = [],
    $options = [],
    &amp;$response_header = [],
    &amp;$info = []
): mixed</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">対象 URL</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$data = []</code></td>
<td>​<span class="summary">パラメータ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$response_header = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$info = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">レスポンスボディ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d0ce1c8ff8ee1aa4d8c46386cb24dd39cd924801-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_put()" class="anchor"></a>[F] http_put <small><span class="summary"><a href="#--http_request%28%29">http_request</a> の PUT 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_put.php#L8-L26" target="_blank">http_put.php#8~26</a></p>
</div>
<details>
<summary class=""><a href="#--http_request%28%29">http_request</a> の PUT 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_put(
    string $url,
    mixed $data = [],
    $options = [],
    &amp;$response_header = [],
    &amp;$info = []
): mixed</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">対象 URL</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$data = []</code></td>
<td>​<span class="summary">パラメータ</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$response_header = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>&amp;$info = []</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">レスポンスボディ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a0fb4c4ba859a323dc28d477e74e16681cc6d484-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_request()" class="anchor"></a>[F] http_request <small><span class="summary">curl のラッパー関数</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_request.php#L16-L430" target="_blank">http_request.php#16~430</a></p>
</div>
<details>
<summary class="">curl のラッパー関数</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_request(
    array $options = [],
    array &amp;$response_header = [],
    array &amp;$info = []
): mixed</div></pre>
<div class="description">
<p>curl は高機能だけど、低レベルで設定が細かすぎる上に似たようなものが大量にあるので素で書くのが割とつらい。<span class="implicit-br">
</span>のでデフォルトをスタンダードな設定に寄せつつ、多少便利になるようにラップしている。<span class="implicit-br">
</span>まぁ現在では guzzle みたいなクライアントも整ってるし、使い捨てスクリプトでサクッとリクエストを投げたい時用。</p>
<p>生 curl との差異は下記。</p>
<ul class=" simple">
<li><code>CURLOPT_HTTPHEADER</code> は連想配列指定が可能</li>
<li><code>CURLOPT_POSTFIELDS</code> は連想配列・多次元配列指定が可能</li>
<li>単一ファイル指定は単一アップロードになる</li>
</ul>
<p>さらに独自のオプションとして下記がある。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt><code>raw</code> (bool)</dt>
<dd>curl インスタンスと変換クロージャを返すだけになる<ul class=" simple">
<li>ただし、ほぼデバッグや内部用なので指定することはほぼ無いはず</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt><code>async</code> (bool)</dt>
<dd>リクエストを投げて、結果を返すオブジェクトを返す<ul class=" simple">
<li>いわゆる非同期で、すぐさま処理を返し、結果は返り値オブジェクト経由で取得する</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt><code>nobody</code> (bool)</dt>
<dd>ヘッダーの受信が完了したらただちに処理を返す<ul class=" simple">
<li>ボディは空文字になる（CURLOPT_NOBODY とは全く性質が異なるので注意）</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt><code>throw</code> (bool)</dt>
<dd>ステータスコードが 400 以上のときに例外を投げる<ul class=" simple">
<li><code>CURLOPT_FAILONERROR</code> は原則使わないほうがいいと思う</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt><code>retry</code> (float[]|callable)</dt>
<dd>エラーが出た場合にリトライする<ul class=" simple">
<li>配列で指定した回数・秒数のリトライを行う（[1, 2, 3] で、1秒後、2秒後、3秒後になる）</li>
<li>callable を指定するとその callable が false を返すまでリトライする（引数として curl_info が渡ってきて待機秒数を返す）</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt><code>atfile</code> (bool)</dt>
<dd>キーに @ があるフィールドをファイルアップロードとみなす<ul class=" simple">
<li>悪しき <code>CURLOPT_SAFE_UPLOAD</code> の代替。ただし値ではなくキーで判別する</li>
<li>値が配列のフィールドのキーに @ をつけると連番要素のみアップロードになる</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt><code>cachedir</code> (string)</dt>
<dd>GET のときにクライアントキャッシュや 304 キャッシュが効くようになる<ul class=" simple">
<li>Cache-Control の private, public は見ないので一応注意</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt><code>parser</code> (array)</dt>
<dd>Content-Type に基づいて body をパースする<ul class=" simple">
<li>今のところ application/json のみ</li>
</ul>
</dd>
</div>
</dl>
<p>また、頻出するオプションは下記の定数のエイリアスがあり、単純に読み替えられる。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt><code>url</code></dt>
<dd><code>CURLOPT_URL</code></dd>
</div>
<div class="dtdd-container">
<dt><code>method</code></dt>
<dd><code>CURLOPT_CUSTOMREQUEST</code></dd>
</div>
<div class="dtdd-container">
<dt><code>cookie</code></dt>
<dd><code>CURLOPT_COOKIE</code></dd>
</div>
<div class="dtdd-container">
<dt><code>header</code></dt>
<dd><code>CURLOPT_HTTPHEADER</code></dd>
</div>
<div class="dtdd-container">
<dt><code>body</code></dt>
<dd><code>CURLOPT_POSTFIELDS</code></dd>
</div>
<div class="dtdd-container">
<dt><code>cookie_file</code></dt>
<dd><code>CURLOPT_COOKIEJAR</code>, <code>CURLOPT_COOKIEFILE</code></dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$response = http_request([
    'url'    =&gt; TESTWEBSERVER . '/post?name=value',
    'method' =&gt; 'POST',
    'body'   =&gt; ['k1' =&gt; 'v1', 'k2' =&gt; 'v2'],
]);
that($response['args'])-&gt;is([
    'name' =&gt; 'value',
]);
that($response['form'])-&gt;is([
    'k1' =&gt; 'v1',
    'k2' =&gt; 'v2',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">curl_setopt_array に渡される</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$response_header = []</code></td>
<td>​<span class="summary">レスポンスヘッダが連想配列で格納される</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$info = []</code></td>
<td>​<span class="summary">curl_getinfo が格納される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">レスポンスボディ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_73b9ec0858efd70c53422b98b8cc3c7b5e20f47f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-http_requests()" class="anchor"></a>[F] http_requests <small><span class="summary">http リクエストを並列で投げる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/http_requests.php#L8-L206" target="_blank">http_requests.php#8~206</a></p>
</div>
<details>
<summary class="">http リクエストを並列で投げる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function http_requests(
    array $urls,
    array $single_options = [],
    array $multi_options = [],
    array &amp;$infos = []
): array</div></pre>
<div class="description">
<p>$urls で複数の curl を渡し、並列で実行して複数の結果をまとめて返す。<span class="implicit-br">
</span>$urls の要素は単一の文字列か curl のオプションである必要がある。<span class="implicit-br">
</span>リクエストの実体は http_request なので、そっちで使えるオプションは一部を除きすべて使える。</p>
<p>返り値は $urls のキーを保持したまま、レスポンスが返ってきた順にボディを格納して配列で返す。<span class="implicit-br">
</span>構造は下記のサンプルを参照。</p>
<p>ただし、オプションに callback がある場合、各リクエスト完了直後にそれがコールされ、返り値はそのコールバックの返り値になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$responses = http_requests([
    // このように [キー =&gt; CURL オプション] 形式が正しい使い方
    'fuga'             =&gt; [
        CURLOPT_URL     =&gt; 'http://unknown-host',
        CURLOPT_TIMEOUT =&gt; 5,
    ],
    // ただし、このように [キー =&gt; URL] 形式でもいい（オプションはデフォルトが使用される）
    'hoge'             =&gt; 'http://127.0.0.1',
    // さらに、このような [URL =&gt; CURL オプション] 形式も許容される（あまり用途はないだろうが）
    'http://127.0.0.1' =&gt; [
        CURLOPT_TIMEOUT =&gt; 5,
        'callback'      =&gt; fn($key, $body) =&gt; $body,
    ],
], [
    // 第2引数で各リクエストの共通オプションを指定できる（個別指定優先）
    // @see https://www.php.net/manual/ja/function.curl-setopt.php
], [
    // 第3引数でマルチリクエストのオプションを指定できる
    // @see https://www.php.net/manual/ja/function.curl-multi-setopt.php
],
    // 第4引数を与えるとボディ以外の各種情報が格納される
    $infos
);
# 返り値
[
    // キーが維持されるので hoge キー
    'hoge'             =&gt; 'response body',
    // curl のエラーが出た場合は null になる（詳細なエラー情報は $infos に格納される）
    'fuga'             =&gt; null,
    // callback を設定しているので strlen($body) が返り値になる
    'http://127.0.0.1' =&gt; 12345,
];
# 第4引数（要するにキーを維持しつつ [header, curlinfo] が格納される）
[
    'hoge'             =&gt; [['response header'], ['curl_info']],
    'fuga'             =&gt; [['response header'], ['curl_info']],
    'http://127.0.0.1' =&gt; [['response header'], ['curl_info']],
];</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$urls</code></td>
<td>​<span class="summary">実行する curl オプション</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$single_options = []</code></td>
<td>​<span class="summary">全 $urls に適用されるデフォルトオプション</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$multi_options = []</code></td>
<td>​<span class="summary">並列リクエストとしてのオプション</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$infos = []</code></td>
<td>​<span class="summary">curl 情報やヘッダなどが格納される受け変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">レスポンスボディ配列。取得した順番でキーを保持しつつ追加される</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b19bf72c372bf8dad04f6b4b271790a76db08305-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-incidr()" class="anchor"></a>[F] incidr <small><span class="summary">ipv4 の cidr チェック</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/incidr.php#L9-L53" target="_blank">incidr.php#9~53</a></p>
</div>
<details>
<summary class="">ipv4 の cidr チェック</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function incidr(
    string $ipaddr,
    string|array $cidr
): bool</div></pre>
<div class="description">
<p>$ipaddr が $cidr のレンジ内なら true を返す。<span class="implicit-br">
</span>$cidr は複数与えることができ、どれかに合致したら true を返す。</p>
<p>ipv6 は今のところ未対応。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 範囲内なので true
that(incidr('192.168.1.1', '192.168.1.0/24'))-&gt;isTrue();
// 範囲外なので false
that(incidr('192.168.1.1', '192.168.2.0/24'))-&gt;isFalse();
// 1つでも範囲内なら true
that(incidr('192.168.1.1', ['192.168.1.0/24', '192.168.2.0/24']))-&gt;isTrue();
// 全部範囲外なら false
that(incidr('192.168.1.1', ['192.168.2.0/24', '192.168.3.0/24']))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$ipaddr</code></td>
<td>​<span class="summary">調べられる IP/cidr アドレス</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$cidr</code></td>
<td>​<span class="summary">調べる cidr アドレス</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">$ipaddr が $cidr 内なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0f5ed4f8bc6994fc83d649f1ec6d6d42b4432556-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ip2cidr()" class="anchor"></a>[F] ip2cidr <small><span class="summary">IP アドレスを含みうる cidr を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/ip2cidr.php#L7-L58" target="_blank">ip2cidr.php#7~58</a></p>
</div>
<details>
<summary class="">IP アドレスを含みうる cidr を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ip2cidr(
    string $fromipaddr,
    string $toipaddr
): array</div></pre>
<div class="description">
<p>from, to の大小関係には言及しないので、from &gt; to を与えると空配列を返す。</p>
<p>ipv6 は今のところ未対応。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(ip2cidr('192.168.1.1', '192.168.2.64'))-&gt;isSame([
    '192.168.1.1/32',
    '192.168.1.2/31',
    '192.168.1.4/30',
    '192.168.1.8/29',
    '192.168.1.16/28',
    '192.168.1.32/27',
    '192.168.1.64/26',
    '192.168.1.128/25',
    '192.168.2.0/26',
    '192.168.2.64/32',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$fromipaddr</code></td>
<td>​<span class="summary">ipaddrs</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$toipaddr</code></td>
<td>​<span class="summary">ipaddrs</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">cidr</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_434b25d4235bf10ae54fe4199173d698e958d8a8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ip_info()" class="anchor"></a>[F] ip_info <small><span class="summary">ipv4 の情報を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/ip_info.php#L10-L334" target="_blank">ip_info.php#10~334</a></p>
</div>
<details>
<summary class="">ipv4 の情報を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ip_info(
    string $ipaddr,
    array $options = []
): null|array|iterable</div></pre>
<div class="description">
<p>登録機関とか登録日、国等を返すが、実際のところ cc（国）くらいしか使わないはず。<span class="implicit-br">
</span>データソースは各 RIR の delegated-afrinic-latest だが、かなりでかいのでデフォルトでは24時間のキャッシュが効く。<span class="implicit-br">
</span>キャッシュ切れ/効かせないと最悪30秒くらいかかるので注意（バッチで叩くといいと思う）。</p>
<p>$ipaddr に null を渡すと全 ip 情報を返す。<span class="implicit-br">
</span>上記の通り、情報としてかなりでかいので php で処理するのではなく、全取得して RDBMS に登録したり htaccess に書き込んだりするのに使える。</p>
<p>ipv6 は今のところ未対応。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// apnic 管轄
that(ip_info(gethostbyname('www.nic.ad.jp'), ['timeout' =&gt; 300, 'throw' =&gt; false]))-&gt;is([
    'cidr'      =&gt; '192.41.192.0/24',
    'ipaddress' =&gt; '192.41.192.0',
    'netmask'   =&gt; 24,
    'registry'  =&gt; 'apnic',
    'cc'        =&gt; 'JP',
    'date'      =&gt; '19880620',
]);
// arin 管轄
that(ip_info(gethostbyname('www.internic.net'), ['timeout' =&gt; 300, 'throw' =&gt; false]))-&gt;is([
    'cidr'      =&gt; '192.0.32.0/20',
    'ipaddress' =&gt; '192.0.32.0',
    'netmask'   =&gt; 20,
    'registry'  =&gt; 'arin',
    'cc'        =&gt; 'US',
    'date'      =&gt; '20090629',
]);
// こういう特殊なアドレスも一応対応している（全てではない）
that(ip_info('127.0.0.1'))['registry']-&gt;is('RFC1122');
that(ip_info('192.168.0.1'))['registry']-&gt;is('RFC1918');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$ipaddr</code></td>
<td>​<span class="summary">調べる IP アドレス</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​null|​array|​iterable</td>
<td>​<span class="summary">IP の情報。ヒットしない場合は null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9b711439e42d2c833b44f11a590e177960e9237c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ip_normalize()" class="anchor"></a>[F] ip_normalize <small><span class="summary">IP アドレスを正規化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/ip_normalize.php#L8-L82" target="_blank">ip_normalize.php#8~82</a></p>
</div>
<details>
<summary class="">IP アドレスを正規化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ip_normalize(string $ipaddr)</div></pre>
<div class="description">
<p>IPv4 は（あまり有名ではないが）4 オクテット未満や 16,8 進数表記を標準的な 1.2.3.4 形式に正規化する。<span class="implicit-br">
</span>IPv6 は 0 の省略や :: 短縮表記を完全表記の 1111:2222:3333:4444:5555:6666:7777:8888 形式に正規化する。<span class="implicit-br">
</span>完全におかしな形式については例外を投げる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// v4（RFC はないがこのような記法が許されている）
that(ip_normalize('0xff.077.500'))-&gt;isSame('255.63.1.244');
// v6（RFC 5952 の短縮表記を完全表記にする）
that(ip_normalize('a::f'))-&gt;isSame('000a:0000:0000:0000:0000:0000:0000:000f');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$ipaddr</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3ad771a4cc62a2c08a3f73e2163e9594fa179b78-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ping()" class="anchor"></a>[F] ping <small><span class="summary">ネットワーク疎通を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/ping.php#L9-L124" target="_blank">ping.php#9~124</a></p>
</div>
<details>
<summary class="">ネットワーク疎通を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ping(
    string $host,
    int|null $port = null,
    int $timeout = 1,
    string &amp;$errstr = ""
): ?float</div></pre>
<div class="description">
<p>$port を指定すると TCP/UDP、省略（null）すると ICMP で繋ぐ。<span class="implicit-br">
</span>が、 ICMP は root ユーザしか実行できないので ping コマンドにフォールバックする。<span class="implicit-br">
</span>TCP/UDP の分岐はマニュアル通り tcp://, udp:// のようなスキームで行う（スキームがなければ tcp）。</p>
<p>udp は結果が不安定なので信頼しないこと（タイムアウトも疎通 OK とみなされる。プロトコルの仕様上どうしようもない）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 自身へ ICMP ping を打つ（正常終了なら float を返し、失敗なら false を返す）
that(ping('127.0.0.1'))-&gt;isFloat();
// 自身の tcp:1234 が開いているか（開いていれば float を返し、開いていなければ null を返す）
that(ping('tcp://127.0.0.1', 1234))-&gt;isNull();
that(ping('127.0.0.1', 1234))-&gt;isNull(); // tcp はスキームを省略できる</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$host</code></td>
<td>​<span class="summary">ホスト名（プロトコルも指定できる）</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$port = null</code></td>
<td>​<span class="summary">ポート番号。指定しないと ICMP になる</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$timeout = 1</code></td>
<td>​<span class="summary">タイムアウト秒</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>&amp;$errstr = ""</code></td>
<td>​<span class="summary">エラー文字列が格納される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?float</td>
<td>​<span class="summary">成功したときは疎通時間。失敗したときは null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ae56b8ff7a2f63df51214116daec932aec08f9be-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-snmp_trap()" class="anchor"></a>[F] snmp_trap <small><span class="summary">SNMPTrap を送信する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/network/snmp_trap.php#L10-L77" target="_blank">snmp_trap.php#10~77</a></p>
</div>
<details>
<summary class="">SNMPTrap を送信する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function snmp_trap(
    int $version,
    string $target,
    string $community,
    string $enterprise,
    int $specific,
    ?int $generic = null,
    array $variables = [],
    ?string $agent = null,
    int $retry = 0,
    int $timeout = 1
)</div></pre>
<div class="description">
<p>UDP で送ろうかと思ったけど、実装が大変なので snmptrap コマンドに日和っている（ので Windows では動かない）。<span class="implicit-br">
</span>将来的には UDP/TCP にするかもしれない。</p>
<p>インターフェースは v1 に寄せているが、v2 送信も可能。<span class="implicit-br">
</span>大抵の場合、generic:6 で固有トラップを送りたい場合に使うので $generic はオプショナルで未指定の場合自動設定される。</p>
<p>$variables は値の型を見てバインド型を決めるので厳密に渡さなければならない（1 と 1.0 と "1" は全く別の意味になる）。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$version</code></td>
<td>​<span class="summary">snmp バージョン</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$target</code></td>
<td>​<span class="summary">送信先</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$community</code></td>
<td>​<span class="summary">コミュニティ</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$enterprise</code></td>
<td>​<span class="summary">エンタープライズ OID</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$specific</code></td>
<td>​<span class="summary">固有トラップ番号</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$generic = null</code></td>
<td>​<span class="summary">標準トラップ番号</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$variables = []</code></td>
<td>​<span class="summary">バインド変数</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$agent = null</code></td>
<td>​<span class="summary">送信元アドレス（v1のみ）</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$retry = 0</code></td>
<td>​<span class="summary">リトライ回数</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$timeout = 1</code></td>
<td>​<span class="summary">タイムアウト秒</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3ac3e65640241f3641f0d4e7eaaeef6fbf96c178-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-opcache" class="anchor"></a>[N] ryunosuke\Functions\Package\opcache\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-15" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-opcache--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_65cf6b3ff679585b21188a336231e043f2389b88-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-opcache_gc()" class="anchor"></a>[F] opcache_gc <small><span class="summary">opcache を減らす</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/opcache/opcache_gc.php#L7-L64" target="_blank">opcache_gc.php#7~64</a></p>
</div>
<details>
<summary class="">opcache を減らす</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function opcache_gc(
    int $thresholdLifetime = 86400,
    int $thresholdHits = 0,
    bool $deletedFile = true,
    bool $modifiedFile = true,
    ?\Closure $includeCondition = null,
    ?\Closure $excludeCondition = null
): array</div></pre>
<div class="description">
<p>生存期間が $thresholdLifetime 以上で hits が $thresholdHits 以下の opcache を消す。<span class="implicit-br">
</span>cli で呼んでも意味がないので health check script あたりで呼ぶといいかもしれない。</p>
<p>$deletedFile は存在しない場合に消す。<span class="implicit-br">
</span>存在しないファイルは validate_timestamp で次読み込み時に自動で無効になるが、それが無効だったり今すぐ消したいときに使う。<span class="implicit-br">
</span>ので実質的に false 指定することはない（実ファイル無しで opcache のみで運用しているような特殊なケースでしか意味はない）。</p>
<p>$modifiedFile は更新された場合に消す。<span class="implicit-br">
</span>消えたか変更されたかの違いで挙動自体は $deletedFile と同じ（次回無効になるのではなく今すぐ無効化したい場合に使う）。</p>
<p>$includeCondition を指定すると必ず維持される。例えば vendor を維持するなど。<span class="implicit-br">
</span>$excludeCondition を指定すると必ず除去される。例えば php cache を除去するなど。</p>
<p>なお、opcache_invalidate しても無効化されるだけで opcache_get_status のエントリには残る（次回アクセス時に再コンパイルされる）。<span class="implicit-br">
</span>つまり一向に opcache_get_status から消えないのは正常動作。<span class="implicit-br">
</span>（メモリ使用量にはちゃんと換算されているが、スクリプト数には換算されない。おそらくネガティブキャッシュみたいなものなんだろう）。<span class="implicit-br">
</span>この時 opcache.max_accelerated_files を超えていても残り続けるので以後新しいファイルもコンパイルされない。<span class="implicit-br">
</span>基本的に「opcache_reload の前段でコールして無用なキャッシュを保存されないようにする」くらいの用途しかない。</p>
<p>この関数は互換性を考慮しない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$thresholdLifetime = 86400</code></td>
<td>​<span class="summary">生存期間が指定以上を対象にする</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$thresholdHits = 0</code></td>
<td>​<span class="summary">ヒット数が指定以下を対象にする</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$deletedFile = true</code></td>
<td>​<span class="summary">元ファイルが存在しないものを対象にする</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$modifiedFile = true</code></td>
<td>​<span class="summary">元ファイルが変更されたものを対象にする</span></td>
</tr>
<tr>
<td>​?<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$includeCondition = null</code></td>
<td>​<span class="summary">強制的に維持する条件クロージャ</span></td>
</tr>
<tr>
<td>​?<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$excludeCondition = null</code></td>
<td>​<span class="summary">強制的に除去する条件クロージャ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">gc したファイル配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_32887d9f44a98ea00cdfe8dd6a74dd94cc42e750-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-opcache_info()" class="anchor"></a>[F] opcache_info <small><span class="summary">phpinfo の opcache 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/opcache/opcache_info.php#L7-L346" target="_blank">opcache_info.php#7~346</a></p>
</div>
<details>
<summary class="">phpinfo の opcache 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function opcache_info()</div></pre>
<div class="description">
<p>この関数は互換性を考慮しない。</p>
</div>
</details>
</section><section id="_39c77b86f7af93eb685acfcabce1d517829c494b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-opcache_reload()" class="anchor"></a>[F] opcache_reload <small><span class="summary">opcache の保存兼ウォームアップ</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/opcache/opcache_reload.php#L10-L114" target="_blank">opcache_reload.php#10~114</a></p>
</div>
<details>
<summary class="">opcache の保存兼ウォームアップ</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function opcache_reload(
    array $includePatterns = [],
    array $excludePatterns = [],
    bool $reset = false,
    ?bool $ignoreErrors = null,
    ?string $cachefile = null
): array</div></pre>
<div class="description">
<p>コールすると現在キャッシュされている opcache のリストを保存しつつ、必要であれば再コンパイルする。<span class="implicit-br">
</span>動的な preload として使用することを想定しているので定期的に呼ぶ必要がある。<span class="implicit-br">
</span>cli で呼んでも意味がないので health check script あたりで呼ぶといいかもしれない。</p>
<p>health check script で呼ぶ時は $reset に注意。<span class="implicit-br">
</span>true にすると opcache_reset が呼ばれるので再コンパイルが終わるまで処理が遅くなる可能性がある。<span class="implicit-br">
</span>この引数は「ネガティブキャッシュもクリーンにしたい」という状況のためで、logrotate 等で reload してしまえば原則的に指定不要。</p>
<p>preload は強力だが運用が難しく、「動的に育てつつある程度キャッシュできれば構わない」というゆるふわな運用が難しい。<span class="implicit-br">
</span>この関数を呼ぶ script を systemd start 等で叩けばそれだけで簡易ウォームアップとなる。<span class="implicit-br">
</span>様々な理由でそのリクエストは失敗するかもしれないが、本運用には何も影響しない。<span class="implicit-br">
</span>あるいは preload に設定してもよい。少なくともエラーにはならないようにしてある。</p>
<p>この関数は互換性を考慮しない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$includePatterns = []</code></td>
<td>​<span class="summary">対象パターン</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$excludePatterns = []</code></td>
<td>​<span class="summary">除外パターン</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$reset = false</code></td>
<td>​<span class="summary">reset を伴うか</span></td>
</tr>
<tr>
<td>​?bool</td>
<td>​<code>$ignoreErrors = null</code></td>
<td>​<span class="summary">エラーを無視するか（null なら SAPI に応じて自動）</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$cachefile = null</code></td>
<td>​<span class="summary">キャッシュファイル名（原則としてテスト用）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">キャッシュ結果配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c78d6f5e68b17d12bbe5692513bb66d43bc67d1c-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-outcontrol" class="anchor"></a>[N] ryunosuke\Functions\Package\outcontrol\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-16" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-outcontrol--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_137c25cb46ad85b9f1a1709cbaed3b674bc8088e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ob_capture()" class="anchor"></a>[F] ob_capture <small><span class="summary">ob_start ～ ob_get_clean のブロックでコールバックを実行する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/outcontrol/ob_capture.php#L7-L39" target="_blank">ob_capture.php#7~39</a></p>
</div>
<details>
<summary class="">ob_start ～ ob_get_clean のブロックでコールバックを実行する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ob_capture(
    callable $callback,
    mixed ...$variadic
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// コールバック内のテキストが得られる
that(ob_capture(fn() =&gt; print(123)))-&gt;isSame('123');
// こういう事もできる
that(ob_capture(function () {
?&gt;
bare string1
bare string2
&lt;?php
}))-&gt;isSame("bare string1\nbare string2\n");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">実行するコールバック</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">$callback に渡される引数（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">オフスリーンバッファの文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f9a418bf918390f268ec5b25a477e4c1f0805bc4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ob_include()" class="anchor"></a>[F] ob_include <small><span class="summary">変数を extract して include する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/outcontrol/ob_include.php#L7-L41" target="_blank">ob_include.php#7~41</a></p>
</div>
<details>
<summary class="">変数を extract して include する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ob_include(
    string $include_file,
    array $array = []
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// このようなテンプレートファイルを用意すると
file_put_contents(sys_get_temp_dir() . '/template.php', '
This is plain text.
This is &lt;?= $var ?&gt;.
This is &lt;?php echo strtoupper($var) ?&gt;.
');
// このようにレンダリングできる
that(ob_include(sys_get_temp_dir() . '/template.php', ['var' =&gt; 'hoge']))-&gt;isSame('
This is plain text.
This is hoge.
This is HOGE.
');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$include_file</code></td>
<td>​<span class="summary">include するファイル名</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$array = []</code></td>
<td>​<span class="summary">extract される連想変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">レンダリングされた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0a9406885253a871f1e042644aa35bb8596f3126-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ob_stdout()" class="anchor"></a>[F] ob_stdout <small><span class="summary">標準出力をコメント化して埋め込む ob_start</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/outcontrol/ob_stdout.php#L8-L126" target="_blank">ob_stdout.php#8~126</a></p>
</div>
<details>
<summary class="">標準出力をコメント化して埋め込む ob_start</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ob_stdout(): object|string</div></pre>
<div class="description">
<p>非常にニッチな関数で、想定用途は「README.md の中の php を実行して出力結果を埋め込みたい」のみ。<span class="implicit-br">
</span>例えば php のマニュアルみたいな「上記の結果は下記のようになります」は対応が分かりにくいのでコメントで埋め込みたいことがある。<span class="implicit-br">
</span>いちいち結果を手で埋め込むのも馬鹿らしいのでこの関数を使えば自動で埋め込まれる。</p>
<p>言語仕様上の制約で echo/print は不可。<span class="implicit-br">
</span>また、 ob_content 系で途中経過の出力は取れない（chunk_size を指定すると強制フラッシュされるらしいので制御できない）。<span class="implicit-br">
</span>返り値オブジェクトが toString を実装してるのでそれで得ること（ただし返り値は toString であること以外はいかなる前提も置いてはならない）。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​object|​string</td>
<td>​<span class="summary">制御用（デバッグ用）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_79592ecb170e6fbfde372199b25f2e8d67a4c03b-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-pcre" class="anchor"></a>[N] ryunosuke\Functions\Package\pcre\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-17" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-pcre--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_60fd86bdcf4831f5c97158f186b1efbbad50d789-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-glob2regex()" class="anchor"></a>[F] glob2regex <small><span class="summary">glob 記法を正規表現に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/pcre/glob2regex.php#L10-L138" target="_blank">glob2regex.php#10~138</a></p>
</div>
<details>
<summary class="">glob 記法を正規表現に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function glob2regex(
    string $pattern,
    int $flags = 0
): string</div></pre>
<div class="description">
<p>原則的に glob/fnmatch における「パスとしてのマッチ（ディレクトリ区切りの特別扱い）」という性質は失われ、あくまで文字列として扱う。<span class="implicit-br">
</span>サポートしている記法は下記（ <a href="https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%AD%E3%83%96" class="link-url">https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%AD%E3%83%96</a> ）。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt><code>*</code></dt>
<dd>0文字以上の任意の文字列にマッチ</dd>
</div>
<div class="dtdd-container">
<dt><code>?</code></dt>
<dd>任意の1文字にマッチ</dd>
</div>
<div class="dtdd-container">
<dt><code>[...]</code></dt>
<dd>括弧内で列挙されたどれか1文字にマッチ</dd>
</div>
<div class="dtdd-container">
<dt><code>[!...]</code></dt>
<dd>括弧内で列挙されていない何かの1文字にマッチ</dd>
</div>
<div class="dtdd-container">
<dt><code>[0-9]</code></dt>
<dd>括弧内で指定された範囲内の1文字にマッチ</dd>
</div>
<div class="dtdd-container">
<dt><code>[!0-9]</code></dt>
<dd>括弧内で指定されていない範囲内の1文字にマッチ</dd>
</div>
<div class="dtdd-container">
<dt><code>{a,b,c}</code></dt>
<dd>「a」、「b」あるいは「c」のいずれかにマッチ（要 GLOB_BRACE）</dd>
</div>
</dl>
<p>GLOB_RECURSIVE を与えた場合、挙動が下記のように変化する。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt><code>*</code></dt>
<dd>"/" を含まない0文字以上の文字列にマッチ</dd>
</div>
<div class="dtdd-container">
<dt><code>**</code></dt>
<dd>"/" を含む任意の0文字以上の文字列にマッチ</dd>
</div>
</dl>
<p>いわゆる double star での再帰パターンのためだが、ディレクトリセパレータは "/" 固定とする（glob の "\" エスケープと絡んで非常にややこしいため）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$files = ['hoge.jpg', 'test1.jpg', 'test12.jpg', 'test123.png', 'testA.jpg', 'testAB.jpg', 'testABC.png', 'test.jpg', 'test.jpeg'];
// 先頭一致する jpg
that(preg_grep('#' . glob2regex('test*.jpg') . '#', $files))-&gt;isSame([
    1 =&gt; 'test1.jpg',
    2 =&gt; 'test12.jpg',
    4 =&gt; 'testA.jpg',
    5 =&gt; 'testAB.jpg',
    7 =&gt; 'test.jpg',
]);
// 先頭一致した2文字の jpg
that(preg_grep('#' . glob2regex('test??.jpg') . '#', $files))-&gt;isSame([
    2 =&gt; 'test12.jpg',
    5 =&gt; 'testAB.jpg',
]);
// 先頭一致した数値1桁の jpg
that(preg_grep('#' . glob2regex('test[0-9].jpg') . '#', $files))-&gt;isSame([
    1 =&gt; 'test1.jpg',
]);
// 先頭一致した数値1桁でない jpg
that(preg_grep('#' . glob2regex('test[!0-9].jpg') . '#', $files))-&gt;isSame([
    4 =&gt; 'testA.jpg',
]);
// jpeg, jpg のどちらにもマッチ（GLOB_BRACE 使用）
that(preg_grep('#' . glob2regex('test.jp{e,}g', GLOB_BRACE) . '#', $files))-&gt;isSame([
    7 =&gt; 'test.jpg',
    8 =&gt; 'test.jpeg',
]);
// 深い階層を含めたすべての png にマッチ（GLOB_RECURSIVE 使用）
that(preg_grep('#^' . glob2regex('/**.png', GLOB_RECURSIVE) . '$#', [
    '/path/a.png',
    '/path/to/b.png',
    '/path/to/dir/c.png',
]))-&gt;isSame([
    '/path/a.png',
    '/path/to/b.png',
    '/path/to/dir/c.png',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$pattern</code></td>
<td>​<span class="summary">glob パターン文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">glob フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">正規表現パターン文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_11ce500b3d52448024a82440618fee1903ec8e37-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-preg_capture()" class="anchor"></a>[F] preg_capture <small><span class="summary">キャプチャを主軸においた preg_match</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/pcre/preg_capture.php#L7-L46" target="_blank">preg_capture.php#7~46</a></p>
</div>
<details>
<summary class="">キャプチャを主軸においた preg_match</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function preg_capture(
    string $pattern,
    string $subject,
    array $default
): array</div></pre>
<div class="description">
<p>$pattern で $subject をマッチングして $default で埋めて返す。$default はフィルタも兼ねる。<span class="implicit-br">
</span>空文字マッチは「マッチしていない」とみなすので注意（$default が使用される）。</p>
<p>キャプチャを主軸においているので「マッチしなかった」は検出不可能。<span class="implicit-br">
</span>$default がそのまま返ってくる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$pattern = '#(\d{4})/(\d{1,2})(/(\d{1,2}))?#';
$default = [1 =&gt; '2000', 2 =&gt; '1', 4 =&gt; '1'];
// 完全にマッチするのでそれぞれ返ってくる
that(preg_capture($pattern, '2014/12/24', $default))-&gt;isSame([1 =&gt; '2014', 2 =&gt; '12', 4 =&gt; '24']);
// 最後の \d{1,2} はマッチしないのでデフォルト値が使われる
that(preg_capture($pattern, '2014/12', $default))-&gt;isSame([1 =&gt; '2014', 2 =&gt; '12', 4 =&gt; '1']);
// 一切マッチしないので全てデフォルト値が使われる
that(preg_capture($pattern, 'hoge', $default))-&gt;isSame([1 =&gt; '2000', 2 =&gt; '1', 4 =&gt; '1']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$pattern</code></td>
<td>​<span class="summary">正規表現</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$subject</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$default</code></td>
<td>​<span class="summary">デフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">キャプチャした配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_110b4b8fedfe876f501f29b8d49c83eb336da089-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-preg_matches()" class="anchor"></a>[F] preg_matches <small><span class="summary">複数マッチに対応した preg_match</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/pcre/preg_matches.php#L7-L87" target="_blank">preg_matches.php#7~87</a></p>
</div>
<details>
<summary class="">複数マッチに対応した preg_match</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function preg_matches(
    string $pattern,
    string $subject,
    int $flags = 0,
    int $offset = 0
): array</div></pre>
<div class="description">
<p>要するに preg_match_all とほぼ同義だが、下記の差異がある。</p>
<ul class=" simple">
<li>正規表現フラグに "g" フラグが使用できる。 "g" を指定すると preg_match_all 相当の動作になる</li>
<li>キャプチャは参照引数ではなく返り値で返す</li>
<li>「パターン全体マッチ」を表す 0 キーは返さない</li>
<li>上記2つの動作により「マッチしなかったら空配列を返す」という動作になる</li>
<li>名前付きキャプチャーに対応する数値キーは伏せられる</li>
<li>伏せられても数値キーは 0 ベースで通し連番となる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$pattern = '#(\d{4})/(?&lt;month&gt;\d{1,2})(?:/(\d{1,2}))?#';
// 1(month)番目は名前付きキャプチャなので 1 キーとしては含まれず month というキーで返す（2 が詰められて 1 になる）
that(preg_matches($pattern, '2014/12/24'))-&gt;isSame([0 =&gt; '2014', 'month' =&gt; '12', 1 =&gt; '24']);
// 一切マッチしなければ空配列が返る
that(preg_matches($pattern, 'hoge'))-&gt;isSame([]);

// g オプションを与えると preg_match_all 相当の動作になる（flags も使える）
$pattern = '#(\d{4})/(?&lt;month&gt;\d{1,2})(?:/(\d{1,2}))?#g';
that(preg_matches($pattern, '2013/11/23, 2014/12/24', PREG_SET_ORDER))-&gt;isSame([
    [0 =&gt; '2013', 'month' =&gt; '11', 1 =&gt; '23'],
    [0 =&gt; '2014', 'month' =&gt; '12', 1 =&gt; '24'],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$pattern</code></td>
<td>​<span class="summary">正規表現</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$subject</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">PREG 定数</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$offset = 0</code></td>
<td>​<span class="summary">開始位置</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">キャプチャした配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_124077d30f31630e99742c13d5db5afefca5637a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-preg_replaces()" class="anchor"></a>[F] preg_replaces <small><span class="summary">パターン番号を指定して preg_replace する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/pcre/preg_replaces.php#L8-L73" target="_blank">preg_replaces.php#8~73</a></p>
</div>
<details>
<summary class="">パターン番号を指定して preg_replace する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function preg_replaces(
    string $pattern,
    array|string|callable $replacements,
    string $subject,
    int $limit = -1,
    null &amp;$count = null
): string</div></pre>
<div class="description">
<p>パターン番号を指定してそれのみを置換する。<span class="implicit-br">
</span>名前付きキャプチャを使用している場合はキーに文字列も使える。<span class="implicit-br">
</span>値にクロージャを渡した場合はコールバックされて置換される。</p>
<p>$replacements に単一文字列を渡した場合、 <code>[1 =&gt; $replacements]</code> と等しくなる（第1キャプチャを置換）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// a と z に囲まれた数字を XXX に置換する
that(preg_replaces('#a(\d+)z#', [1 =&gt; 'XXX'], 'a123z'))-&gt;isSame('aXXXz');
// 名前付きキャプチャも指定できる
that(preg_replaces('#a(?&lt;digit&gt;\d+)z#', ['digit' =&gt; 'XXX'], 'a123z'))-&gt;isSame('aXXXz');
// クロージャを渡すと元文字列を引数としてコールバックされる
that(preg_replaces('#a(?&lt;digit&gt;\d+)z#', ['digit' =&gt; fn($src) =&gt; $src * 2], 'a123z'))-&gt;isSame('a246z');
// 複合的なサンプル（a タグの href と target 属性を書き換える）
that(preg_replaces('#&lt;a\s+href="(?&lt;href&gt;.*)"\s+target="(?&lt;target&gt;.*)"&gt;#', [
    'href'   =&gt; fn($href) =&gt; strtoupper($href),
    'target' =&gt; fn($target) =&gt; strtoupper($target),
], '&lt;a href="hoge" target="fuga"&gt;inner text&lt;/a&gt;'))-&gt;isSame('&lt;a href="HOGE" target="FUGA"&gt;inner text&lt;/a&gt;');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$pattern</code></td>
<td>​<span class="summary">正規表現</span></td>
</tr>
<tr>
<td>​array|​string|​callable</td>
<td>​<code>$replacements</code></td>
<td>​<span class="summary">置換文字列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$subject</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$limit = -1</code></td>
<td>​<span class="summary">置換回数</span></td>
</tr>
<tr>
<td>​null</td>
<td>​<code>&amp;$count = null</code></td>
<td>​<span class="summary">置換回数格納変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">置換された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_464a14395686a29f615d0cc653bbc5bcb23f47d5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-preg_splice()" class="anchor"></a>[F] preg_splice <small><span class="summary">キャプチャも行える preg_replace</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/pcre/preg_splice.php#L7-L54" target="_blank">preg_splice.php#7~54</a></p>
</div>
<details>
<summary class="">キャプチャも行える preg_replace</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function preg_splice(
    string $pattern,
    string|callable $replacement,
    string $subject,
    array &amp;$matches = [],
    int $limit = -1
): string</div></pre>
<div class="description">
<p>「置換を行いつつ、キャプチャ文字列が欲しい」状況はまれによくあるはず。</p>
<p>$replacement に callable を渡すと preg_replace_callback がコールされる。<span class="implicit-br">
</span>callable とはいっても単純文字列 callble （"strtoupper" など）は callable とはみなされない。<span class="implicit-br">
</span>配列形式の callable や クロージャのみ preg_replace_callback になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 数字を除去しつつその除去された数字を得る
that(preg_splice('#\\d+#', '', 'abc123', $m))-&gt;isSame('abc');
that($m)-&gt;isSame(['123']);

// callable だと preg_replace_callback が呼ばれる
that(preg_splice('#[a-z]+#', fn($m) =&gt; strtoupper($m[0]), 'abc123', $m))-&gt;isSame('ABC123');
that($m)-&gt;isSame(['abc']);

// ただし、 文字列 callable は文字列として扱う
that(preg_splice('#[a-z]+#', 'strtoupper', 'abc123', $m))-&gt;isSame('strtoupper123');
that($m)-&gt;isSame(['abc']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$pattern</code></td>
<td>​<span class="summary">正規表現</span></td>
</tr>
<tr>
<td>​string|​callable</td>
<td>​<code>$replacement</code></td>
<td>​<span class="summary">置換文字列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$subject</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$matches = []</code></td>
<td>​<span class="summary">キャプチャ配列が格納される</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$limit = -1</code></td>
<td>​<span class="summary">置換回数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">置換された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9201b2634f3dcbb713d2830da622e7564778fb00-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-random" class="anchor"></a>[N] ryunosuke\Functions\Package\random\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-18" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-random--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_80d250fe3c837b44ddbd2f566c0d771594107ab5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-probability()" class="anchor"></a>[F] probability <small><span class="summary">一定確率で true を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/probability.php#L7-L42" target="_blank">probability.php#7~42</a></p>
</div>
<details>
<summary class="">一定確率で true を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function probability(
    int $probability,
    int $divisor = 100
): bool</div></pre>
<div class="description">
<p>具体的には $probability / $divisor の確率で true を返す。<span class="implicit-br">
</span>$divisor のデフォルトは 100 にしてあるので、 $probability だけ与えれば $probability パーセントで true を返すことになる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 50% の確率で "hello" を出す
if (probability(50)) {
    echo "hello";
}</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$probability</code></td>
<td>​<span class="summary">分子</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$divisor = 100</code></td>
<td>​<span class="summary">分母</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">true or false</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_380a48d633981cf56e09fd5132fd362897dfa16e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-probability_array()" class="anchor"></a>[F] probability_array <small><span class="summary">指定確率で配列のキーを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/probability_array.php#L8-L70" target="_blank">probability_array.php#8~70</a></p>
</div>
<details>
<summary class="">指定確率で配列のキーを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function probability_array(
    array $array,
    ?int $divisor = 100
): mixed</div></pre>
<div class="description">
<p>確率の合計が 100% を超えている場合は例外を投げる。<span class="implicit-br">
</span>100% に満たない場合は残り確率で null を返す。</p>
<p>分母の 100% は $divisor 引数で指定可能（1000 を指定すればパーミルになる）。<span class="implicit-br">
</span>null を与えると確率の合計値が設定される（いわゆる重み付け乱数になる）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">srand(123);
// a:10%, b:20%, c:30%, d:40% の確率で返す
that(probability_array([
    'a' =&gt; 10,
    'b' =&gt; 20,
    'c' =&gt; 30,
    'd' =&gt; 40,
]))-&gt;isSame('b');

// a:16.6%, b:32.3%, c:50% の確率で返す（いわゆる重み付け）
that(probability_array([
    'a' =&gt; 1,
    'b' =&gt; 2,
    'c' =&gt; 3,
], null))-&gt;isSame('c');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">配列</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$divisor = 100</code></td>
<td>​<span class="summary">分母</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">$array のどれか1つ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_aba1736920d6eadcc0f13619f5d16c59aad04266-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-random_at()" class="anchor"></a>[F] random_at <small><span class="summary">引数をランダムで返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/random_at.php#L7-L26" target="_blank">random_at.php#7~26</a></p>
</div>
<details>
<summary class="">引数をランダムで返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function random_at(mixed ...$args): mixed</div></pre>
<div class="description">
<ul class=" simple">
<li>候補がない場合はエラーではなく例外を投げる</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 1 ～ 6 のどれかを返す
that(random_at(1, 2, 3, 4, 5, 6))-&gt;isAny([1, 2, 3, 4, 5, 6]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$args</code></td>
<td>​<span class="summary">候補</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">引数のうちどれか</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_25577c39b196cf80ce6b29804739ce32ebaafd59-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-random_float()" class="anchor"></a>[F] random_float <small><span class="summary">疑似乱数小数を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/random_float.php#L7-L33" target="_blank">random_float.php#7~33</a></p>
</div>
<details>
<summary class="">疑似乱数小数を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function random_float(
    float $min,
    float $max
): float</div></pre>
<div class="description">
<p>疑似的に生成しているので偏りはあることに注意。<span class="implicit-br">
</span><a href="https://www.php.net/manual/random-randomizer.getfloat.php" class="link-url">https://www.php.net/manual/random-randomizer.getfloat.php</a><span class="implicit-br">
</span><a href="https://www.php.net/manual/random-randomizer.nextfloat.php" class="link-url">https://www.php.net/manual/random-randomizer.nextfloat.php</a></p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// [-M_PI~+M_PI] の区間でランダムに返す
that(random_float(-M_PI, +M_PI))-&gt;isBetween(-M_PI, +M_PI);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​float</td>
<td>​<code>$min</code></td>
<td>​<span class="summary">最小値</span></td>
</tr>
<tr>
<td>​float</td>
<td>​<code>$max</code></td>
<td>​<span class="summary">最大値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​float</td>
<td>​<span class="summary">min～maxの乱数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b4b6f890f6682362eb0b3cc6b47ddf84ab7cd67e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-random_normal()" class="anchor"></a>[F] random_normal <small><span class="summary">正規乱数（正規分布に従う乱数）を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/random_normal.php#L7-L49" target="_blank">random_normal.php#7~49</a></p>
</div>
<details>
<summary class="">正規乱数（正規分布に従う乱数）を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function random_normal(
    float $average = 0.0,
    float $std_deviation = 1.0
): float</div></pre>
<div class="description">
<p>※ ボックス＝ミュラー法</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">mt_srand(4); // テストがコケるので種固定

// 平均 100, 標準偏差 10 の正規乱数を得る
that(random_normal(100, 10))-&gt;isSame(101.16879645296162);
that(random_normal(100, 10))-&gt;isSame(96.49615862542069);
that(random_normal(100, 10))-&gt;isSame(87.74557282679618);
that(random_normal(100, 10))-&gt;isSame(117.93697951557125);
that(random_normal(100, 10))-&gt;isSame(99.1917453115627);
that(random_normal(100, 10))-&gt;isSame(96.74688207698713);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​float</td>
<td>​<code>$average = 0.0</code></td>
<td>​<span class="summary">平均</span></td>
</tr>
<tr>
<td>​float</td>
<td>​<code>$std_deviation = 1.0</code></td>
<td>​<span class="summary">標準偏差</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​float</td>
<td>​<span class="summary">正規乱数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1df038f6557ec89137b63943e5b2e808771482eb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-random_range()" class="anchor"></a>[F] random_range <small><span class="summary">指定範囲内からランダムで返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/random_range.php#L7-L56" target="_blank">random_range.php#7~56</a></p>
</div>
<details>
<summary class="">指定範囲内からランダムで返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function random_range(
    int $min,
    int $max,
    ?int $count = null
): array</div></pre>
<div class="description">
<p>$count を null にすると個数すらもランダムで返す。<span class="implicit-br">
</span>結果は範囲内では重複しない。</p>
<p>範囲が負数の場合は例外を投げるが、$count の 0 や範囲超過数は許容される（array_rand とは違う）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">mt_srand(5); // テストがコケるので種固定

// [10~20] の区間でランダムに3件返す
that(random_range(10, 20, 3))-&gt;is([19, 20, 10]);
// 0 を渡しても OK（単に空配列を返す）
that(random_range(10, 20, 0))-&gt;is([]);
// 範囲超過数を渡しても OK（最大個数で返す）
that(count(random_range(10, 20, 999)))-&gt;is(11);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$min</code></td>
<td>​<span class="summary">最小値</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$max</code></td>
<td>​<span class="summary">最大値</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$count = null</code></td>
<td>​<span class="summary">返す個数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">min～maxの数値の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ee6148586f1998c0d4f10e197f5aeda7885f729a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-random_string()" class="anchor"></a>[F] random_string <small><span class="summary">安全な乱数文字列を生成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/random_string.php#L7-L35" target="_blank">random_string.php#7~35</a></p>
</div>
<details>
<summary class="">安全な乱数文字列を生成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function random_string(
    int $length = 8,
    string $charlist = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"
): string</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<code>$length = 8</code></td>
<td>​<span class="summary">生成文字列長</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$charlist = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</code></td>
<td>​<span class="summary">使用する文字セット</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">乱数文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d9047525e5eef9b81fb3c7809bf17f5d293cec67-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-unique_string()" class="anchor"></a>[F] unique_string <small><span class="summary">文字列に含まれない文字列を生成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/random/unique_string.php#L8-L69" target="_blank">unique_string.php#8~69</a></p>
</div>
<details>
<summary class="">文字列に含まれない文字列を生成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function unique_string(
    string $source,
    string|int $initial = null,
    string|array $charlist = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"
): string</div></pre>
<div class="description">
<p>例えば http のマルチパートバウンダリのような、「競合しない文字列」を生成する。<span class="implicit-br">
</span>実装は愚直に文字列を調べて存在しなければそれを返すようになっている。<span class="implicit-br">
</span>一応初期値や文字セットは指定可能。</p>
<p>$initial に int を与えると初期値としてその文字数分 $charlist から確保する。<span class="implicit-br">
</span>例えば生成後の変更が前提で、ある程度の長さを担保したいときに指定すれば最低でもその長さ以上は保証される。<span class="implicit-br">
</span>$initial に string を与えるとそれがそのまま初期値として使用される。<span class="implicit-br">
</span>例えば「ほぼ存在しない文字列」が予測できるのであればそれを指定すれば無駄な処理が省ける。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 単純に呼ぶと生成1,2文字程度の文字列になる
that(unique_string('hello, world'))-&gt;stringLengthEqualsAny([1, 2]);
// 数値を含んでいないので候補文字に数値のみを指定すれば1文字で「存在しない文字列」となる
that(unique_string('hello, world', null, range(0, 9)))-&gt;stringLengthEquals(1);
// int を渡すと最低でもそれ以上は保証される
that(unique_string('hello, world', 5))-&gt;stringLengthEqualsAny([5, 6]);
// string を渡すとそれが初期値となる
that(unique_string('hello, world', 'prefix-'))-&gt;stringStartsWith('prefix');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$source</code></td>
<td>​<span class="summary">元文字列</span></td>
</tr>
<tr>
<td>​string|​int</td>
<td>​<code>$initial = null</code></td>
<td>​<span class="summary">初期文字列あるいは文字数</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$charlist = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</code></td>
<td>​<span class="summary">使用する文字セット</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">一意な文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_afbf17b63043506d32339a7b9f7e85e4086ee005-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-reflection" class="anchor"></a>[N] ryunosuke\Functions\Package\reflection\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-19" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-reflection--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_daa3b48348aa24fea69b05310a471f69b2927182-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-callable_code()" class="anchor"></a>[F] callable_code <small><span class="summary">callable のコードブロックを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/callable_code.php#L9-L79" target="_blank">callable_code.php#9~79</a></p>
</div>
<details>
<summary class="">callable のコードブロックを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function callable_code(
    callable|\ReflectionFunctionAbstract $callable,
    bool $return_token = false
): array</div></pre>
<div class="description">
<p>返り値は2値の配列。0番目の要素が定義部、1番目の要素が処理部を表す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">list($meta, $body) = callable_code(function (...$args) {return true;});
that($meta)-&gt;isSame('function (...$args)');
that($body)-&gt;isSame('{return true;}');

// ReflectionFunctionAbstract を渡しても動作する
list($meta, $body) = callable_code(new \ReflectionFunction(function (...$args) {return true;}));
that($meta)-&gt;isSame('function (...$args)');
that($body)-&gt;isSame('{return true;}');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable|​<a href="https://php.net/manual/class.reflectionfunctionabstract.php" target="_blank">ReflectionFunctionAbstract</a></td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">コードを取得する callable</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$return_token = false</code></td>
<td>​<span class="summary">true にすると生のトークン配列で返す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">['定義部分', '<span class="badge " data-badge-title="">処理コード</span>']</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f011a6c6ab523c347ccaa4b153792662f430389b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-function_doccomments()" class="anchor"></a>[F] function_doccomments <small><span class="summary">$callable の本体・引数・返り値の DocComment を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/function_doccomments.php#L10-L73" target="_blank">function_doccomments.php#10~73</a></p>
</div>
<details>
<summary class="">$callable の本体・引数・返り値の DocComment を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function function_doccomments(\ReflectionFunctionAbstract|callable $callable): array</div></pre>
<div class="description">
<p>下記のような配列を返す（仕様上 Example が書けない）。</p>
<pre data-label=""><div class="code">[
    "" =&gt; "本体の DocComment",
    0  =&gt; "引数1の DocComment",
    1  =&gt; "引数2の DocComment",
    // ...他の引数
    -1 =&gt; "返り値の DocComment",
];</div></pre>
<p>それぞれ存在しない場合はキー自体が抜け落ちる（null で入ったりはしない）。<span class="implicit-br">
</span>非常に雑に実装しているので、配列や new(8.1以降)の引数に反応することがある。</p>
<p>本体の DocComment は ReflectionFunctionAbstract::getDocComment と同等である。<span class="implicit-br">
</span>引数の DocComment は必ず型宣言の直前（ない場合は引数名の直前）に記述しなければならない。<span class="implicit-br">
</span>返り値の DocComment は必ず型宣言の直前（ない場合は{の直前）に記述しなければならない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.reflectionfunctionabstract.php" target="_blank">ReflectionFunctionAbstract</a>|​callable</td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">対象 callable</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">本体・引数・返り値の DocComment 配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b754dfb06204dcd45c36a826a9e8cb3f9bc8630e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-function_export_false2null()" class="anchor"></a>[F] function_export_false2null <small><span class="summary">存在する関数の内、false 返しを null 返しに再定義したファイルを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/function_export_false2null.php#L10-L94" target="_blank">function_export_false2null.php#10~94</a></p>
</div>
<details>
<summary class="">存在する関数の内、false 返しを null 返しに再定義したファイルを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function function_export_false2null(
    string $namespace,
    bool $false_only = true
): string</div></pre>
<div class="description">
<p>標準関数は歴史的な事情で false を返すものが多い（strpos, strtotime 等）。<span class="implicit-br">
</span>ただ大抵の場合は null の方が好ましいことが多い（int|false より ?int の方が分かりやすいし ?? を駆使できる）。<span class="implicit-br">
</span>（<code>strpos(',', 'hello, world') ?? -1</code> みたいなことができない）。</p>
<p>$false_only:false にすると存在する全関数も返す。false 返しでない関数は単純な委譲で余計なことはしない。<span class="implicit-br">
</span>これは「strpos は nullable だから F\strpos で、他はグローバル」という使い分けの利便性のためだが、出力数が膨大になるので留意。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$namespace</code></td>
<td>​<span class="summary">吐き出す名前空間</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$false_only = true</code></td>
<td>​<span class="summary">false 返しのみか。false を与えると全関数を返す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">吐き出された関数定義を含むファイル内容</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a9b80a17ccea30df7355e21fb2c12e767d4b8133-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-function_parameter()" class="anchor"></a>[F] function_parameter <small><span class="summary">関数/メソッドの引数定義を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/function_parameter.php#L11-L81" target="_blank">function_parameter.php#11~81</a></p>
</div>
<details>
<summary class="">関数/メソッドの引数定義を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function function_parameter(\ReflectionFunctionAbstract|callable $eitherReffuncOrCallable): array</div></pre>
<div class="description">
<p>ほぼ内部向けで外から呼ぶことはあまり想定していない。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.reflectionfunctionabstract.php" target="_blank">ReflectionFunctionAbstract</a>|​callable</td>
<td>​<code>$eitherReffuncOrCallable</code></td>
<td>​<span class="summary">関数/メソッドリフレクション or callable</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">[引数名 =&gt; 引数宣言] の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e2d268208122a8fd8e56b40852b8decb5af52131-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-parameter_default()" class="anchor"></a>[F] parameter_default <small><span class="summary">callable のデフォルト引数を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/parameter_default.php#L9-L66" target="_blank">parameter_default.php#9~66</a></p>
</div>
<details>
<summary class="">callable のデフォルト引数を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function parameter_default(
    callable $callable,
    iterable|array $arguments = []
): array</div></pre>
<div class="description">
<p>オプションで指定もできる。<span class="implicit-br">
</span>負数を指定した場合「最後の引数から数えた位置」になる。</p>
<p>内部関数には使用できない（リフレクションが対応していない）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$f = function ($a, $b = 'b') {};
// デフォルト引数である b を返す
that(parameter_default($f))-&gt;isSame([1 =&gt; 'b']);
// 引数で与えるとそれが優先される
that(parameter_default($f, ['A', 'B']))-&gt;isSame(['A', 'B']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">対象 callable</span></td>
</tr>
<tr>
<td>​iterable|​array</td>
<td>​<code>$arguments = []</code></td>
<td>​<span class="summary">デフォルト引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">デフォルト引数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a60b45d772f159c90834c67ed2a65b776efb25b7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-parameter_length()" class="anchor"></a>[F] parameter_length <small><span class="summary">callable の引数の数を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/parameter_length.php#L8-L39" target="_blank">parameter_length.php#8~39</a></p>
</div>
<details>
<summary class="">callable の引数の数を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function parameter_length(
    callable $callable,
    bool $require_only = false,
    bool $thought_variadic = false
): int</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// trim の引数は2つ
that(parameter_length('trim'))-&gt;isSame(2);
// trim の必須引数は1つ
that(parameter_length('trim', true))-&gt;isSame(1);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">対象 callable</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$require_only = false</code></td>
<td>​<span class="summary">true を渡すと必須パラメータの数を返す</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$thought_variadic = false</code></td>
<td>​<span class="summary">可変引数を考慮するか。 true を渡すと可変引数の場合に無限長を返す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">引数の数</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b51808cc734f78ed79e88f5658e160e7fae76562-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-parameter_wiring()" class="anchor"></a>[F] parameter_wiring <small><span class="summary">callable の引数の型情報に基づいてワイヤリングした引数配列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/parameter_wiring.php#L9-L108" target="_blank">parameter_wiring.php#9~108</a></p>
</div>
<details>
<summary class="">callable の引数の型情報に基づいてワイヤリングした引数配列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function parameter_wiring(
    callable $callable,
    array|\ArrayAccess $dependency
): array</div></pre>
<div class="description">
<p>ワイヤリングは下記のルールに基づいて行われる。</p>
<ul class=" simple">
<li>引数の型とキーが完全一致</li>
<li>引数の型とキーが継承・実装関係<ul class=" simple">
<li>複数一致した場合は解決されない</li>
</ul>
</li>
<li>引数名とキーが完全一致<ul class=" simple">
<li>可変引数は追加</li>
</ul>
</li>
<li>引数のデフォルト値</li>
<li>得られた値がクロージャの場合は再帰的に解決<ul class=" simple">
<li>$this は $dependency になるが FromCallable 経由の場合は元のまま</li>
</ul>
</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$closure = function (\ArrayObject $ao, \Throwable $t, $array, $none, $default1, $default2 = 'default2', ...$misc) { return get_defined_vars(); };
$params = parameter_wiring($closure, [
    \ArrayObject::class      =&gt; $ao = new \ArrayObject([1, 2, 3]),
    \RuntimeException::class =&gt; $t = new \RuntimeException('hoge'),
    '$array'                 =&gt; fn (\ArrayObject $ao) =&gt; (array) $ao,
    4                        =&gt; 'default1',
    '$misc'                  =&gt; ['x', 'y', 'z'],
]);
that($params)-&gt;isSame([
    0 =&gt; $ao,        // 0番目はクラス名が完全一致
    1 =&gt; $t,         // 1番目はインターフェース実装
    2 =&gt; [1, 2, 3],  // 2番目はクロージャをコール
                     // 3番目は解決されない
    4 =&gt; 'default1', // 4番目は順番指定のデフォルト値
    5 =&gt; 'default2', // 5番目は引数定義のデフォルト値
    6 =&gt; 'x',        // 可変引数なのでフラットに展開
    7 =&gt; 'y',
    8 =&gt; 'z',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">対象 callable</span></td>
</tr>
<tr>
<td>​array|​<a href="https://php.net/manual/class.arrayaccess.php" target="_blank">ArrayAccess</a></td>
<td>​<code>$dependency</code></td>
<td>​<span class="summary">引数候補配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">引数配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_92fca3fc116884e27f8cb7afe7ead68cf0e940b6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-reflect_callable()" class="anchor"></a>[F] reflect_callable <small><span class="summary">callable から ReflectionFunctionAbstract を生成する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/reflect_callable.php#L10-L251" target="_blank">reflect_callable.php#10~251</a></p>
</div>
<details>
<summary class="">callable から ReflectionFunctionAbstract を生成する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function reflect_callable(callable $callable): ReflectCallable|\ReflectionFunction|\ReflectionMethod</div></pre>
<div class="description">
<p>実際には ReflectionFunctionAbstract を下記の独自拡張した Reflection クラスを返す（メソッドのオーバーライド等はしていないので完全互換）。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>__invoke</dt>
<dd>元となったオブジェクトを $this として invoke する（関数・クロージャは invoke と同義）</dd>
</div>
<div class="dtdd-container">
<dt>call</dt>
<dd>実行 $this を指定して invoke する（クロージャ・メソッドのみ）<ul class=" simple">
<li>上記二つは <strong>call/</strong>callStatic のメソッドも呼び出せる</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>getDeclaration</dt>
<dd>宣言部のコードを返す</dd>
</div>
<div class="dtdd-container">
<dt>getCode</dt>
<dd>定義部のコードを返す</dd>
</div>
<div class="dtdd-container">
<dt>isAnonymous</dt>
<dd>無名関数なら true を返す（8.2 の isAnonymous 互換）</dd>
</div>
<div class="dtdd-container">
<dt>isStatic</dt>
<dd>$this バインド可能かを返す（クロージャのみ）</dd>
</div>
<div class="dtdd-container">
<dt>getUsedVariables</dt>
<dd>use している変数配列を返す（クロージャのみ）</dd>
</div>
<div class="dtdd-container">
<dt>getClosure</dt>
<dd>元となったオブジェクトを $object としたクロージャを返す（メソッドのみ）<ul class=" simple">
<li>上記二つは <strong>call/</strong>callStatic のメソッドも呼び出せる</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>getTraitMethod</dt>
<dd>トレイト側のリフレクションを返す（メソッドのみ）</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(reflect_callable('sprintf'))-&gt;isInstanceOf(\ReflectionFunction::class);
that(reflect_callable('\Closure::bind'))-&gt;isInstanceOf(\ReflectionMethod::class);

$x = 1;
$closure = function ($a, $b) use (&amp;$x) { return $a + $b; };
$reflection = reflect_callable($closure);
// 単純実行
that($reflection(1, 2))-&gt;is(3);
// 無名クラスを $this として実行
that($reflection-&gt;call(new class(){}, 1, 2))-&gt;is(3);
// 宣言部を返す
that($reflection-&gt;getDeclaration())-&gt;is('function ($a, $b) use (&amp;$x)');
// 定義部を返す
that($reflection-&gt;getCode())-&gt;is('{ return $a + $b; }');
// static か返す
that($reflection-&gt;isStatic())-&gt;is(false);
// use 変数を返す
that($reflection-&gt;getUsedVariables())-&gt;is(['x' =&gt; 1]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$callable</code></td>
<td>​<span class="summary">対象 callable</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ReflectCallable">ReflectCallable</a>|​<a href="https://php.net/manual/class.reflectionfunction.php" target="_blank">ReflectionFunction</a>|​<a href="https://php.net/manual/class.reflectionmethod.php" target="_blank">ReflectionMethod</a></td>
<td>​<span class="summary">リフレクションインスタンス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_52e6cb93e4b15da546ec49d7c4b4b0115da5b155-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-reflect_type_resolve()" class="anchor"></a>[F] reflect_type_resolve <small><span class="summary">ReflectionType の型に \ を付与する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/reflect_type_resolve.php#L8-L39" target="_blank">reflect_type_resolve.php#8~39</a></p>
</div>
<details>
<summary class="">ReflectionType の型に \ を付与する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function reflect_type_resolve(?string $type): ?string</div></pre>
<div class="description">
<p>php8.0 で ReflectionType の __toString が解放されたけど、それをそのまま埋め込んだりすると \ がないのでエラーになったりする。<span class="implicit-br">
</span>この関数を通してから埋め込めば \ が付くので回避できる、という非常にニッチな関数。</p>
<p>型 exists で判定するため、付与するクラスは存在している必要がある（オプション引数で対応するかもしれない）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// このような DNF 型も形式を保ったまま \\ を付与できる
that(reflect_type_resolve('(Countable&amp;Traversable)|object'))-&gt;is('(\\Countable&amp;\\Traversable)|object');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$type</code></td>
<td>​<span class="summary">string だが実用上は getType 等で得られるインスタンスでよい</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">解決された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_79a02b8124b354f2130670be6e275db9b679cc86-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-reflect_types()" class="anchor"></a>[F] reflect_types <small><span class="summary">ReflectionType の型配列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/reflection/reflect_types.php#L7-L304" target="_blank">reflect_types.php#7~304</a></p>
</div>
<details>
<summary class="">ReflectionType の型配列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function reflect_types(\ReflectionFunctionAbstract|\ReflectionType|\ReflectionType[]|null $reflection_type = null): ReflectTypes|object</div></pre>
<div class="description">
<p>ReflectionType のインターフェース・仕様がコロコロ変わってついていけないので関数化した。</p>
<p>ReflectionType に準ずるインスタンスを渡すと取り得る候補を配列ライクなオブジェクトで返す。<span class="implicit-br">
</span>引数は配列で複数与えても良い。よしなに扱って複数型として返す。<span class="implicit-br">
</span>また「Type が一意に導出できる Reflection」を渡しても良い（ReflectionProperty など）。<span class="implicit-br">
</span>null を与えた場合はエラーにはならず、スルーされる（getType は null を返し得るので利便性のため）。</p>
<p>単純に ReflectionType の配列ライクなオブジェクトを返すが、そのオブジェクトは <code>__toString</code> が実装されており、文字列化するとパイプ区切りの型文字列を返す。<span class="implicit-br">
</span>これは 8.0 における ReflectionUnionType の <code>__toString</code> を模倣したものである。<span class="implicit-br">
</span>互換性のある型があった場合、上位の型に内包されて型文字列としては出現しない。</p>
<p>Countable も実装されているが、その結果は「内部 Type の数」ではなく、論理的に「取り得る型の数」を返す。<span class="implicit-br">
</span>例えば <code>?int</code> は型としては1つだが、実際は int, null の2つを取り得るため、 count は 2 を返す。<span class="implicit-br">
</span>端的に言えば「<code>__toString</code> のパイプ区切りの型の数」を返す。</p>
<p>あとは便利メソッドとして下記が生えている。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>jsonSerialize</dt>
<dd>JsonSerializable 実装</dd>
</div>
<div class="dtdd-container">
<dt>getTypes</dt>
<dd>取り得る型をすべて返す（ReflectionUnionType 互換）</dd>
</div>
<div class="dtdd-container">
<dt>getName</dt>
<dd>ReflectionUnionType 非互換 toString な型宣言文字列を返す</dd>
</div>
<div class="dtdd-container">
<dt>allows</dt>
<dd>その値を取りうるか判定して返す</dd>
</div>
</dl>
<p>ReflectionUnionType とは完全互換ではないので、php8.0が完全に使える環境であれば素直に ReflectionUnionType を使ったほうが良い。<span class="implicit-br">
</span>（「常に（型分岐せずに）複数形で扱える」程度のメリットしかない。allows は惜しいが）。</p>
<p>ちなみに型の変遷は下記の通り。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>php7.1</dt>
<dd>ReflectionType::__toString が非推奨になった</dd>
</div>
<div class="dtdd-container">
<dt>php7.1</dt>
<dd>ReflectionNamedType が追加され、各種 getType でそれを返すようになった</dd>
</div>
<div class="dtdd-container">
<dt>php8.0</dt>
<dd>ReflectionType::__toString が非推奨ではなくなった</dd>
</div>
<div class="dtdd-container">
<dt>php8.0</dt>
<dd>ReflectionUnionType が追加され、複合の場合は getType でそれを返すようになった</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$object = new class {
    function method(object $o):?string {}
};
$method = new \ReflectionMethod($object, 'method');
$types = reflect_types($method-&gt;getParameters()[0]-&gt;getType());
// 文字列化すると型宣言文字列を返すし、配列アクセスや count, iterable でそれぞれの型が得られる
that((string) $types)-&gt;is('object');
that($types[0])-&gt;isInstanceOf(\ReflectionType::class);
that(iterator_to_array($types))-&gt;eachIsInstanceOf(\ReflectionType::class);
that(count($types))-&gt;is(1);
// 返り値でも同じ（null 許容なので null が付くし count も 2 になる）
$types = reflect_types($method-&gt;getReturnType());
that((string) $types)-&gt;is('string|null');
that(count($types))-&gt;is(2);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.reflectionfunctionabstract.php" target="_blank">ReflectionFunctionAbstract</a>|​<a href="https://php.net/manual/class.reflectiontype.php" target="_blank">ReflectionType</a>|​<a href="https://php.net/manual/class.reflectiontype.php" target="_blank">ReflectionType</a>[]|​null</td>
<td>​<code>$reflection_type = null</code></td>
<td>​<span class="summary">getType 等で得られるインスタンス</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ReflectTypes">ReflectTypes</a>|​object</td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e708458015f4f18ff1447772e9fd9669598438ba-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-stream" class="anchor"></a>[N] ryunosuke\Functions\Package\stream\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-20" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-stream--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_d92f80acf6230b4c212048910dccfb9019e9c3c0-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-include_stream()" class="anchor"></a>[F] include_stream <small><span class="summary">file スキームを上書きして include/require をフックできるストリームオブジェクトを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/stream/include_stream.php#L7-L294" target="_blank">include_stream.php#7~294</a></p>
</div>
<details>
<summary class="">file スキームを上書きして include/require をフックできるストリームオブジェクトを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function include_stream(): IncludeStream|object</div></pre>
<div class="description">
<p>register で include/require しようとしている $filename が渡ってくる callable を登録する。<span class="implicit-br">
</span>restore で登録を解除する。</p>
<p>stream wrapper にはスタッキングや取得系関数がないため、この関数を使うと file:// の登録は全て解除されるので注意。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--IncludeStream">IncludeStream</a>|​object</td>
<td>​<span class="summary">stream wrapper オブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_042f2d6d5656f18ef77db2557b43798fe008a127-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-memory_stream()" class="anchor"></a>[F] memory_stream <small><span class="summary">ファイルのように扱えるメモリ上のパスを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/stream/memory_stream.php#L8-L416" target="_blank">memory_stream.php#8~416</a></p>
</div>
<details>
<summary class="">ファイルのように扱えるメモリ上のパスを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function memory_stream(string $path = ""): string</div></pre>
<div class="description">
<p>劣化 vfsStream のようなもの。<span class="implicit-br">
</span>stream wrapper を用いて実装しており、そのプロトコルは初回呼び出し時に1度だけ登録される。<span class="implicit-br">
</span>プロトコル名は決め打ちだが、 php.ini に "rfunc.memory_stream" というキーで文字列を指定するとそれが使用される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// ファイル名のように読み書きができるパスを返す（一時ファイルを使用するよりかなり高速に動作する）
$memory_stream = memory_stream('filename.txt');
// 呼んだだけでは何もしないので存在しない
that(file_exists($memory_stream))-&gt;isSame(false);
// file_put_contents が使える
that(file_put_contents($memory_stream, 'Hello, World'))-&gt;isSame(12);
// file_get_contents が使える
that(file_get_contents($memory_stream))-&gt;isSame('Hello, World');
// 上記の操作で実体が存在している
that(file_exists($memory_stream))-&gt;isSame(true);
// unlink が使える
that(unlink($memory_stream))-&gt;isSame(true);
// unlink したので存在しない
that(file_exists($memory_stream))-&gt;isSame(false);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$path = ""</code></td>
<td>​<span class="summary">パス名（実質的に一意なファイル名）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">メモリ上のパス</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8052efa431b3774e06bbcdbab912d6f67b729c7d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-profiler()" class="anchor"></a>[F] profiler <small><span class="summary">外部ツールに頼らない pure php なプロファイラを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/stream/profiler.php#L8-L116" target="_blank">profiler.php#8~116</a></p>
</div>
<details>
<summary class="">外部ツールに頼らない pure php なプロファイラを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function profiler(array $options = []): \Traversable|callable</div></pre>
<div class="description">
<p>file プロトコル上書きと ticks と debug_backtrace によるかなり無理のある実装なので動かない環境・コードは多い。<span class="implicit-br">
</span>その分お手軽だが下記の注意点がある。</p>
<ul class=" simple">
<li>file プロトコルを上書きするので、既に読み込み済みのファイルは計上されない</li>
<li>tick されないステートメントは計上されない<ul class=" simple">
<li>1行メソッドなどでありがち</li>
</ul>
</li>
<li>A-&gt;B-&gt;C という呼び出しで C が 3秒、B が 2秒、A が1秒かかった場合、 A は 6 秒、B は 5秒、C は 3 秒といて計上される<ul class=" simple">
<li>つまり、配下の呼び出しも重複して計上される</li>
</ul>
</li>
</ul>
<p>この関数を呼んだ時点で計測は始まる。<span class="implicit-br">
</span>返り値としてイテレータを返すので、foreach で回せばコールスタック・回数・時間などが取得できる。<span class="implicit-br">
</span>配列で欲しい場合は直に呼べば良い。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.traversable.php" target="_blank">Traversable</a>|​callable</td>
<td>​<span class="summary">プロファイライテレータ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0aa06288188b1b82db5829c783ac533afcf97b06-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_stream()" class="anchor"></a>[F] var_stream <small><span class="summary">変数をリソースのように扱えるファイルポインタを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/stream/var_stream.php#L8-L174" target="_blank">var_stream.php#8~174</a></p>
</div>
<details>
<summary class="">変数をリソースのように扱えるファイルポインタを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_stream(
    string|null &amp;$var,
    string $initial = ""
): resource</div></pre>
<div class="description">
<p>得られたファイルポインタに fread すれば変数の値が見えるし、 fwrite すれば変数の値が書き換わる。<span class="implicit-br">
</span>逆に変数を書き換えればファイルポインタで得られる値も書き換わる。</p>
<p>用途は主にテスト用。<span class="implicit-br">
</span>例えば「何らかのファイルポインタを要求する処理」に対して fopen や tmpfile を駆使して値の確認をするのは結構めんどくさい。<span class="implicit-br">
</span>（<code>rewind</code> したり <code>stream_get_contents</code> したり削除したりする必要がある）。<span class="implicit-br">
</span>それよりもこの関数で得られたファイルポインタを渡し、 <code>that($var)-&gt;is($expected)</code> とできる方がテストの視認性が良くなる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// $var のファイルポインタを取得
$fp = var_stream($var);
// ファイルポインタに書き込みを行うと変数にも反映される
fwrite($fp, 'hoge');
that($var)-&gt;is('hoge');
// 変数に追記を行うとファイルポインタで読み取れる
$var .= 'fuga';
that(fread($fp, 1024))-&gt;is('fuga');
// 変数をまるっと置換するとファイルポインタ側もまるっと変わる
$var = 'hello, world';
that(stream_get_contents($fp, -1, 0))-&gt;is('hello, world');
// ファイルポインタをゴリっと削除すると変数も空になる
ftruncate($fp, 0);
that($var)-&gt;is('');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​null</td>
<td>​<code>&amp;$var</code></td>
<td>​<span class="summary">対象の変数</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$initial = ""</code></td>
<td>​<span class="summary">初期値。与えたときのみ初期化される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​resource</td>
<td>​<span class="summary">変数のファイルポインタ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e59824c7b98d36d6af63119c5407bb471b069607-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-strings" class="anchor"></a>[N] ryunosuke\Functions\Package\strings\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-21" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-strings--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_f6ff48faae098231c66947eefce0024725b0728e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-camel_case()" class="anchor"></a>[F] camel_case <small><span class="summary">camelCase に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/camel_case.php#L8-L25" target="_blank">camel_case.php#8~25</a></p>
</div>
<details>
<summary class="">camelCase に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function camel_case(
    ?string|string $string,
    ?string|string $delimiter = "_"
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(camel_case('this_is_a_pen'))-&gt;isSame('thisIsAPen');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$delimiter = "_"</code></td>
<td>​<span class="summary">デリミタ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">変換した文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b68cab175ea2f94c921c412cfce903f6cc0c147d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-chain_case()" class="anchor"></a>[F] chain_case <small><span class="summary">chain-case に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/chain_case.php#L8-L25" target="_blank">chain_case.php#8~25</a></p>
</div>
<details>
<summary class="">chain-case に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function chain_case(
    ?string|string $string,
    ?string|string $delimiter = "-"
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(chain_case('ThisIsAPen'))-&gt;isSame('this-is-a-pen');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$delimiter = "-"</code></td>
<td>​<span class="summary">デリミタ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">変換した文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7b8291538e8db32f0e529442ec36779741620ced-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-concat()" class="anchor"></a>[F] concat <small><span class="summary">strcat の空文字回避版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/concat.php#L7-L41" target="_blank">concat.php#7~41</a></p>
</div>
<details>
<summary class="">strcat の空文字回避版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function concat(?string ...$variadic): ?string</div></pre>
<div class="description">
<p>基本は strcat と同じ。ただし、<strong>引数の内1つでも空文字を含むなら空文字を返す</strong>。<span class="implicit-br">
</span>さらに*引数の内1つでも null を含むなら null を返す**。</p>
<p>「プレフィックスやサフィックスを付けたいんだけど、空文字の場合はそのままで居て欲しい」という状況はまれによくあるはず。<span class="implicit-br">
</span>コードで言えば <code>strlen($string) ? 'prefix-' . $string : '';</code> のようなもの。<span class="implicit-br">
</span>可変引数なので 端的に言えば mysql の CONCAT みたいな動作になる。</p>
<pre data-label=""><div class="code language-php php">that(concat('prefix-', 'middle', '-suffix'))-&gt;isSame('prefix-middle-suffix');
that(concat('prefix-', '', '-suffix'))-&gt;isSame('');
that(concat('prefix-', null, '-suffix'))-&gt;isSame(null);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">結合する文字列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">結合した文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_db5626da2eabb807182219e188c221c951f615d0-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-damerau_levenshtein()" class="anchor"></a>[F] damerau_levenshtein <small><span class="summary">Damerau–Levenshtein 距離を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/damerau_levenshtein.php#L7-L84" target="_blank">damerau_levenshtein.php#7~84</a></p>
</div>
<details>
<summary class="">Damerau–Levenshtein 距離を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function damerau_levenshtein(
    string $s1,
    string $s2,
    int $cost_ins = 1,
    int $cost_rep = 1,
    int $cost_del = 1,
    int $cost_swp = 1
): int</div></pre>
<div class="description">
<p>簡単に言えば「転置（入れ替え）を考慮したレーベンシュタイン」である。<span class="implicit-br">
</span>例えば "destroy" と "destory" は 「1挿入1削除=2」であるが、Damerau 版だと「1転置=1」となる。</p>
<p>また、マルチバイト（UTF-8 のみ）にも対応している。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// destroy と destory は普通にレーベンシュタイン距離を取ると 2 になるが・・・
that(levenshtein("destroy", "destory"))-&gt;isSame(2);
// damerau_levenshtein だと1である
that(damerau_levenshtein("destroy", "destory"))-&gt;isSame(1);
// UTF-8 でも大丈夫
that(damerau_levenshtein("あいうえお", "あいえうお"))-&gt;isSame(1);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$s1</code></td>
<td>​<span class="summary">対象文字列1</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$s2</code></td>
<td>​<span class="summary">対象文字列2</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$cost_ins = 1</code></td>
<td>​<span class="summary">挿入のコスト</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$cost_rep = 1</code></td>
<td>​<span class="summary">置換のコスト</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$cost_del = 1</code></td>
<td>​<span class="summary">削除のコスト</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$cost_swp = 1</code></td>
<td>​<span class="summary">転置のコスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">Damerau–Levenshtein 距離</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_55d2c8e4500eadd9ffd6249789f2b74a48d5dd96-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ends_with()" class="anchor"></a>[F] ends_with <small><span class="summary">指定文字列で終わるか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/ends_with.php#L8-L44" target="_blank">ends_with.php#8~44</a></p>
</div>
<details>
<summary class="">指定文字列で終わるか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ends_with(
    ?string|string $string,
    string|string[] $with,
    bool $case_insensitivity = false
): bool</div></pre>
<div class="description">
<p>$with に配列を渡すといずれかで終わるときに true を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(ends_with('abcdef', 'def'))-&gt;isTrue();
that(ends_with('abcdef', 'DEF', true))-&gt;isTrue();
that(ends_with('abcdef', 'xyz'))-&gt;isFalse();
that(ends_with('abcdef', ['d', 'e', 'f']))-&gt;isTrue();
that(ends_with('abcdef', ['x', 'y', 'z']))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">探される文字列</span></td>
</tr>
<tr>
<td>​string|​string[]</td>
<td>​<code>$with</code></td>
<td>​<span class="summary">探す文字列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">対象文字列で終わるなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c2dc32c02daa9f15a0e4918b73a5a4775acec403-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-include_string()" class="anchor"></a>[F] include_string <small><span class="summary">変数を extract して include する（文字列指定）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/include_string.php#L9-L27" target="_blank">include_string.php#9~27</a></p>
</div>
<details>
<summary class="">変数を extract して include する（文字列指定）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function include_string(
    ?string|string $template,
    array $array = []
): string</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$template</code></td>
<td>​<span class="summary">テンプレート文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$array = []</code></td>
<td>​<span class="summary">extract される連想変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">レンダリングされた文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ob_include%28%29">ob_include()</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_01045e097eb9fddb4dde61abdd57cfc10ad490fb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-kvsprintf()" class="anchor"></a>[F] kvsprintf <small><span class="summary">連想配列を指定できるようにした vsprintf</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/kvsprintf.php#L7-L43" target="_blank">kvsprintf.php#7~43</a></p>
</div>
<details>
<summary class="">連想配列を指定できるようにした vsprintf</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function kvsprintf(
    ?string|string $format,
    array $array
): string</div></pre>
<div class="description">
<p>sprintf の順序指定構文('%1$d')にキーを指定できる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(kvsprintf('%hoge$s %fuga$d', ['hoge' =&gt; 'ThisIs', 'fuga' =&gt; '3.14']))-&gt;isSame('ThisIs 3');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$format</code></td>
<td>​<span class="summary">フォーマット文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">フォーマット引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">フォーマットされた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c417eec9cf8fc5b2a9e18d899a2d7e5fbecc5261-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_compatible_encoding()" class="anchor"></a>[F] mb_compatible_encoding <small><span class="summary">指定エンコーディング間に互換性があるかを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_compatible_encoding.php#L7-L101" target="_blank">mb_compatible_encoding.php#7~101</a></p>
</div>
<details>
<summary class="">指定エンコーディング間に互換性があるかを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_compatible_encoding(
    ?string|string $from,
    ?string|string $to
): ?bool</div></pre>
<div class="description">
<p>※ ユースケースとして多い utf8,sjis 以外はほぼ実装していないので注意（かなり適当なのでそれすらも怪しい）</p>
<p>mb_convert_encoding/mb_convert_variables は実際に変換が行われなくても処理が走ってしまうので、それを避けるための関数。<span class="implicit-br">
</span>エンコーディングはただでさえカオスなのに utf8, UTF-8, sjis, sjis-win, cp932 などの表記揺れやエイリアスがあるので判定が結構しんどい。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// ほぼ唯一のユースケース（互換性があるなら変換しない）
if (!mb_compatible_encoding(mb_internal_encoding(), 'utf8')) {
    mb_convert_encoding('utf8 string', 'utf8');
}</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$from</code></td>
<td>​<span class="summary">変換元エンコーディング</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$to</code></td>
<td>​<span class="summary">変換先エンコーディング</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?bool</td>
<td>​<span class="summary">from が to に対して互換性があるなら true（8bit binary の時のみ例外的に null を返す）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_647654c6c22078bdfd25823547ff74abe3890125-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_ellipsis()" class="anchor"></a>[F] mb_ellipsis <small><span class="summary">文字列を指定幅に丸める</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_ellipsis.php#L8-L69" target="_blank">mb_ellipsis.php#8~69</a></p>
</div>
<details>
<summary class="">文字列を指定幅に丸める</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_ellipsis(
    ?string|string $string,
    int $width,
    string $trimmarker = "...",
    int|null $pos = null
): string</div></pre>
<div class="description">
<p>mb_strimwidth と機能的には同じだが、省略文字の差し込み位置を $pos で指定できる。<span class="implicit-br">
</span>$pos は負数が指定できる。負数の場合後ろから数えられる。<span class="implicit-br">
</span>省略した場合は真ん中となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 10文字幅に丸める（$pos 省略なので真ん中が省略される）
that(mb_ellipsis('あいうえお1234567890', 10, '...'))-&gt;isSame('あい...890');
// 10文字幅に丸める（$pos=1 なので1幅目から省略される…が、1文字は「あ」なので前方に切られる）
that(mb_ellipsis('あいうえお1234567890', 10, '...', 1))-&gt;isSame('...567890');
// 10文字幅に丸める（$pos=2 なので2幅目から省略される）
that(mb_ellipsis('あいうえお1234567890', 10, '...', 2))-&gt;isSame('あ...67890');
// 10文字幅に丸める（$pos=-1 なので後ろから1幅目から省略される）
that(mb_ellipsis('あいうえお1234567890', 10, '...', -1))-&gt;isSame('あいう...0');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$width</code></td>
<td>​<span class="summary">丸める幅</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$trimmarker = "..."</code></td>
<td>​<span class="summary">省略文字列</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$pos = null</code></td>
<td>​<span class="summary">省略記号の差し込み位置</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">丸められた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9d5304c48899c3f421ba5156aa5b203ea0b7b537-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_ereg_options()" class="anchor"></a>[F] mb_ereg_options <small><span class="summary">mb_系の全体設定を一括設定する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_ereg_options.php#L8-L66" target="_blank">mb_ereg_options.php#8~66</a></p>
</div>
<details>
<summary class="">mb_系の全体設定を一括設定する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_ereg_options(array $options): callable</div></pre>
<div class="description">
<p>返り値として「コールすると元に戻す callable」を返す。<span class="implicit-br">
</span>あるいはその返り値はスコープが外れると自動で元に戻す処理が行われる。</p>
<p>余計なことはしない素直な実装だが、'encoding' というキーは mb_internal_encoding と regex_encoding の両方に適用される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$recover = mb_ereg_options([
    'internal_encoding' =&gt; 'SJIS', // 今だけは internal_encoding を SJIS にする
    'regex_options'     =&gt; 'ir',   // 今だけは regex_options を ir にする
]);
that($recover)-&gt;isCallable();             // 返り値は callable
that(mb_internal_encoding())-&gt;is('SJIS'); // 今だけは SJIS
that(mb_regex_set_options())-&gt;is('ir');   // 今だけは ir

$recover();
that(mb_internal_encoding())-&gt;is('UTF-8'); // $recover をコールすると戻る
that(mb_regex_set_options())-&gt;is('pr');    // $recover をコールすると戻る</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$options</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<span class="summary">元に戻す callable</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_dc3ce082387eebe286f8bbedfa8d4507720f8726-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_ereg_split()" class="anchor"></a>[F] mb_ereg_split <small><span class="summary">マルチバイト対応 preg_split</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_ereg_split.php#L7-L127" target="_blank">mb_ereg_split.php#7~127</a></p>
</div>
<details>
<summary class="">マルチバイト対応 preg_split</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_ereg_split(
    ?string|string $pattern,
    ?string|string $subject,
    int $limit = -1,
    int $flags = 0
): ?array</div></pre>
<div class="description">
<p>preg_split の PREG_SPLIT_NO_EMPTY, PREG_SPLIT_DELIM_CAPTURE, PREG_SPLIT_OFFSET_CAPTURE も使用できる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"># 下記のようにすべて preg_split と合わせてある
// limit:2
that(mb_ereg_split(",", "a,b,c", 2))-&gt;is(['a', 'b,c']);
// flags:PREG_SPLIT_NO_EMPTY
that(mb_ereg_split(",", ",a,,b,,c,", -1, PREG_SPLIT_NO_EMPTY))-&gt;is(['a', 'b', 'c']);
// flags:PREG_SPLIT_DELIM_CAPTURE
that(mb_ereg_split("(,)", "a,c", -1, PREG_SPLIT_DELIM_CAPTURE))-&gt;is(['a', ',', 'c']);
// flags:PREG_SPLIT_OFFSET_CAPTURE
that(mb_ereg_split(",", "a,b,c", -1, PREG_SPLIT_OFFSET_CAPTURE))-&gt;is([['a', 0], ['b', 2], ['c', 4]]);
# 他の preg_split 特有の動きも同じ
// 例えば limit は PREG_SPLIT_DELIM_CAPTURE には作用しない
that(mb_ereg_split("(,)", "a,b,c", 2, PREG_SPLIT_DELIM_CAPTURE))-&gt;is(['a', ',', 'b,c']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$pattern</code></td>
<td>​<span class="summary">パターン文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$subject</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$limit = -1</code></td>
<td>​<span class="summary">分割数</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$flags = 0</code></td>
<td>​<span class="summary">フラグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?array</td>
<td>​<span class="summary">分割された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c5c20c4be8e6e62034f84cff041cd143db5e7033-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_monospace()" class="anchor"></a>[F] mb_monospace <small><span class="summary">ASCII 文字を1, それ以外を2で計算した文字幅を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_monospace.php#L7-L74" target="_blank">mb_monospace.php#7~74</a></p>
</div>
<details>
<summary class="">ASCII 文字を1, それ以外を2で計算した文字幅を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_monospace(
    ?string|string $string,
    array $codepoints = []
): int</div></pre>
<div class="description">
<p>mb_strwidth は記号も1で返すので若干使いづらい（仕様的にしょうがない）。<span class="implicit-br">
</span>日本語圏内であれば記号や絵文字も2バイト換算の方が便利なことが多いのでそのようにしたもの。</p>
<p>オプションでコードポイント配列を渡すとそれに従って幅を加算する。<span class="implicit-br">
</span>コードポイントの指定は Example を参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(mb_monospace("※★▼…"))-&gt;is(8);     // 記号類も2バイト換算で8
that(mb_monospace("123456７8８"))-&gt;is(11); // 比較用（フォントに依存するが）
that(mb_monospace("Σ(ﾟДﾟ)え!！"))-&gt;is(15); // 半角全角の判定ではなく ASCII 判定なので 15
that(mb_monospace("Σ(ﾟДﾟ)え!！", [         // コードポイントを指定すれば合わせることが可能
    "Σ"    =&gt; 1, // 単体指定（シグマ）
    "Ѐ-ӿ"  =&gt; 1, // 範囲指定（キリル文字）
    0xFF9F =&gt; 1, // 直指定（半角半濁点）
]))-&gt;is(11);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$codepoints = []</code></td>
<td>​<span class="summary">コードポイント配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">等幅の文字幅</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_73a3343d023852977a9c8c60442e7ec7e5bb0b70-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_pad_width()" class="anchor"></a>[F] mb_pad_width <small><span class="summary">マルチバイト版 str_pad</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_pad_width.php#L8-L63" target="_blank">mb_pad_width.php#8~63</a></p>
</div>
<details>
<summary class="">マルチバイト版 str_pad</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_pad_width(
    ?string|string $string,
    int $width,
    string $pad_string = " ",
    int $pad_type = ryunosuke\Functions\Package\STR_PAD_RIGHT
): string</div></pre>
<div class="description">
<p>単純な mb_strlen での実装ではなく mb_monospace による実装となっている。<span class="implicit-br">
</span>「文字数を指定して pad したい」という状況は utf8 で2バイト超えという状況がふさわしくないことが非常に多い。<span class="implicit-br">
</span>多くは単純に「全角は2文字、半角は1文字」というユースケースが多い（埋める文字がスペースなら特に）。</p>
<p>また、$pad_string が切り捨てられることもない。<span class="implicit-br">
</span>標準の str_pad はできるだけ詰めようとして中途半端な $pad_string になることがあるが、その動作は模倣していない。<span class="implicit-br">
</span>端的に「$width を超えないようにできる限り敷き詰めて返す」という動作になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// マルチバイトは2文字幅として換算される
that(mb_pad_width('aaaa', 12, '-'))-&gt;isSame('aaaa--------');
that(mb_pad_width('ああ', 12, '-'))-&gt;isSame('ああ--------');
// $pad_string は切り捨てられない
that(mb_pad_width('aaaa', 12, 'xyz'))-&gt;isSame('aaaaxyzxyz'); // 10文字で返す（あと1回 xyz すると 13 文字になり width を超えてしまう（かといって xy だけを足したりもしない））
that(mb_pad_width('ああ', 12, 'xyz'))-&gt;isSame('ああxyzxyz'); // マルチバイトでも同じ</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$width</code></td>
<td>​<span class="summary">埋める幅</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$pad_string = " "</code></td>
<td>​<span class="summary">埋める文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$pad_type = ryunosuke\Functions\Package\STR_PAD_RIGHT</code></td>
<td>​<span class="summary">埋める位置</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">指定文字で埋められた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7da69b17efd920573b318b078ce06c0cea0c2056-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_str_pad()" class="anchor"></a>[F] mb_str_pad <small><span class="summary">マルチバイト版 str_pad</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><span class="badge alert" data-badge-title="">deprecated </span><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_str_pad.php#L8-L20" target="_blank">mb_str_pad.php#8~20</a></p>
</div>
<details>
<summary class="">マルチバイト版 str_pad</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_str_pad(
    ?string $string,
    $width,
    $pad_string = " ",
    $pad_type = ryunosuke\Functions\Package\STR_PAD_RIGHT
)</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$width</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$pad_string = " "</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$pad_type = ryunosuke\Functions\Package\STR_PAD_RIGHT</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--mb_pad_width%28%29">mb_pad_width()</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_aa97bbf980b6192efd4bba519a505c46ab86a68d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_substr_replace()" class="anchor"></a>[F] mb_substr_replace <small><span class="summary">マルチバイト対応 substr_replace</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_substr_replace.php#L7-L40" target="_blank">mb_substr_replace.php#7~40</a></p>
</div>
<details>
<summary class="">マルチバイト対応 substr_replace</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_substr_replace(
    ?string|string $string,
    ?string|string $replacement,
    int $start,
    ?int $length = null
): string</div></pre>
<div class="description">
<p>本家は配列を与えたりできるが、ややこしいし使う気がしないので未対応。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 2文字目から5文字を「あいうえお」に置換する
that(mb_substr_replace('０１２３４５６７８９', 'あいうえお', 2, 5))-&gt;isSame('０１あいうえお７８９');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$replacement</code></td>
<td>​<span class="summary">置換文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$start</code></td>
<td>​<span class="summary">開始位置</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$length = null</code></td>
<td>​<span class="summary">置換長</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">置換した文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2aa11b3de59593c9de4b4e7c27f60bb3f2997d74-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_trim()" class="anchor"></a>[F] mb_trim <small><span class="summary">マルチバイト対応 trim</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><span class="badge alert" data-badge-title="">deprecated </span><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_trim.php#L7-L19" target="_blank">mb_trim.php#7~19</a></p>
</div>
<details>
<summary class="">マルチバイト対応 trim</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_trim(?string $string)</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://github.com/symfony/polyfill-php84/" target="_blank">https://github.com/symfony/polyfill-php84/</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1b4214da53c1fe159efbb83dd8eb9ee541e6e6e7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-mb_wordwrap()" class="anchor"></a>[F] mb_wordwrap <small><span class="summary">文字列を指定文字幅で改行を挟み込む</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/mb_wordwrap.php#L8-L65" target="_blank">mb_wordwrap.php#8~65</a></p>
</div>
<details>
<summary class="">文字列を指定文字幅で改行を挟み込む</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function mb_wordwrap(
    ?string|string $string,
    int $width,
    ?string $break = "\n"
): string|array</div></pre>
<div class="description">
<p>基本的に wordwrap のマルチバイト対応版だと思って良い。<span class="implicit-br">
</span>ただし下記の点が異なる。</p>
<ul class=" simple">
<li>マルチバイトは一律2文字換算<ul class=" simple">
<li>これ系の関数の「幅」はいわゆる半角/全角として扱ったほうが都合が良い</li>
</ul>
</li>
<li>$cut_long_words 引数はない<ul class=" simple">
<li>用途的に true がデフォだろうし、マルチバイトが絡んでくると「単語」の定義がそもそも曖昧なので実装しない</li>
<li>実装するにしても禁則処理の方が用途は多いだろう</li>
</ul>
</li>
<li>$break に null を与えると配列で返す</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(mb_wordwrap("todayは晴天なり", 10, null))-&gt;is([
    'todayは晴',
    '天なり',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">分割する文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$width</code></td>
<td>​<span class="summary">分割する最大幅</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$break = "\n"</code></td>
<td>​<span class="summary">分割文字</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<span class="summary">指定幅で改行が差し込まれた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_991a1082765dc4024b3da15252c0467e7b356abf-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-multiexplode()" class="anchor"></a>[F] multiexplode <small><span class="summary">explode の配列対応と $limit の挙動を変えたもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/multiexplode.php#L8-L46" target="_blank">multiexplode.php#8~46</a></p>
</div>
<details>
<summary class="">explode の配列対応と $limit の挙動を変えたもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function multiexplode(
    string|array $delimiter,
    ?string|string $string,
    int $limit = PHP_INT_MAX
): array</div></pre>
<div class="description">
<p>$delimiter には配列が使える。いわゆる「複数文字列での分割」の動作になる。</p>
<p>$limit に負数を与えると「その絶対値-1までを結合したものと残り」を返す。<span class="implicit-br">
</span>端的に言えば「正数を与えると後詰めでその個数で返す」「負数を与えると前詰めでその（絶対値）個数で返す」という動作になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 配列を与えると複数文字列での分割
that(multiexplode([',', ' ', '|'], 'a,b c|d'))-&gt;isSame(['a', 'b', 'c', 'd']);
// 負数を与えると前詰め
that(multiexplode(',', 'a,b,c,d', -2))-&gt;isSame(['a,b,c', 'd']);
// もちろん上記2つは共存できる
that(multiexplode([',', ' ', '|'], 'a,b c|d', -2))-&gt;isSame(['a,b c', 'd']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<code>$delimiter</code></td>
<td>​<span class="summary">分割文字列。配列可</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$limit = PHP_INT_MAX</code></td>
<td>​<span class="summary">分割数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">分割された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5d03051465c98c7e1ee1d59c3d0017905ff1c111-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-namespace_split()" class="anchor"></a>[F] namespace_split <small><span class="summary">文字列を名前空間とローカル名に区切ってタプルで返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/namespace_split.php#L7-L38" target="_blank">namespace_split.php#7~38</a></p>
</div>
<details>
<summary class="">文字列を名前空間とローカル名に区切ってタプルで返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function namespace_split(?string|string $string): array</div></pre>
<div class="description">
<p>class_namespace/class_shorten や function_shorten とほぼ同じだが下記の違いがある。</p>
<ul class=" simple">
<li>あくまで文字列として処理する<ul class=" simple">
<li>例えば class_namespace は get_class されるが、この関数は（いうなれば） strval される</li>
</ul>
</li>
<li>\ を trim しないし、特別扱いもしない<ul class=" simple">
<li><code>ns\\hoge</code> と <code>\\ns\\hoge</code> で返り値が微妙に異なる</li>
<li><code>ns\\</code> のような場合は名前空間だけを返す</li>
</ul>
</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(namespace_split('ns\\hoge'))-&gt;isSame(['ns', 'hoge']);
that(namespace_split('hoge'))-&gt;isSame(['', 'hoge']);
that(namespace_split('ns\\'))-&gt;isSame(['ns', '']);
that(namespace_split('\\hoge'))-&gt;isSame(['', 'hoge']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">[namespace, localname]</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7b5655760f5e5a8ac3d699fd1b262b3b35c51d1a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-ngram()" class="anchor"></a>[F] ngram <small><span class="summary">N-gram 化して配列で返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/ngram.php#L7-L40" target="_blank">ngram.php#7~40</a></p>
</div>
<details>
<summary class="">N-gram 化して配列で返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function ngram(
    ?string|string $string,
    int $N,
    string $encoding = "UTF-8"
): array</div></pre>
<div class="description">
<p>素朴な実装であり特記事項はない。<span class="implicit-br">
</span>末端要素や除去フィルタくらいは実装するかもしれない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(ngram("あいうえお", 1))-&gt;isSame(["あ", "い", "う", "え", "お"]);
that(ngram("あいうえお", 2))-&gt;isSame(["あい", "いう", "うえ", "えお", "お"]);
that(ngram("あいうえお", 3))-&gt;isSame(["あいう", "いうえ", "うえお", "えお", "お"]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$N</code></td>
<td>​<span class="summary">N-gram の N</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$encoding = "UTF-8"</code></td>
<td>​<span class="summary">マルチバイトエンコーディング</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">N-gram 配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b9be415c6b83f3fbe95450c63cae8adc45e43dbd-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-pascal_case()" class="anchor"></a>[F] pascal_case <small><span class="summary">PascalCase に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/pascal_case.php#L7-L26" target="_blank">pascal_case.php#7~26</a></p>
</div>
<details>
<summary class="">PascalCase に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function pascal_case(
    ?string|string $string,
    ?string|string $delimiter = "_"
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(pascal_case('this_is_a_pen'))-&gt;isSame('ThisIsAPen');
that(pascal_case('this_is-a-pen', '-_'))-&gt;isSame('ThisIsAPen');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$delimiter = "_"</code></td>
<td>​<span class="summary">デリミタ（複数可）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">変換した文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f767f220e30a7c7b0785f971f3fc22a5fef8b8b3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-quoteexplode()" class="anchor"></a>[F] quoteexplode <small><span class="summary">エスケープやクオートに対応した explode</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/quoteexplode.php#L9-L79" target="_blank">quoteexplode.php#9~79</a></p>
</div>
<details>
<summary class="">エスケープやクオートに対応した explode</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function quoteexplode(
    string|array $delimiter,
    ?string|string $string,
    ?int $limit = null,
    array|string $enclosures = "'\"",
    string $escape = "\\",
    array $options = []
): array</div></pre>
<div class="description">
<p>$enclosures は配列で開始・終了文字が別々に指定できるが、実装上の都合で今のところ1文字ずつのみ。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルな例
that(quoteexplode(',', 'a,b,c\\,d,"e,f"'))-&gt;isSame([
    'a', // 普通に分割される
    'b', // 普通に分割される
    'c\\,d', // \\ でエスケープしているので区切り文字とみなされない
    '"e,f"', // "" でクオートされているので区切り文字とみなされない
]);

// $enclosures で囲い文字の開始・終了文字を明示できる
that(quoteexplode(',', 'a,b,{e,f}', null, ['{' =&gt; '}']))-&gt;isSame([
    'a', // 普通に分割される
    'b', // 普通に分割される
    '{e,f}', // { } で囲まれているので区切り文字とみなされない
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<code>$delimiter</code></td>
<td>​<span class="summary">分割文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$limit = null</code></td>
<td>​<span class="summary">分割数。負数未対応</span></td>
</tr>
<tr>
<td>​array|​string</td>
<td>​<code>$enclosures = "'\""</code></td>
<td>​<span class="summary">囲い文字。 ["start" =&gt; "end"] で開始・終了が指定できる</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$escape = "\\"</code></td>
<td>​<span class="summary">エスケープ文字</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">分割された配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9d51f5174345c808fa73df4a3abb44b9d5f6dee5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-render_file()" class="anchor"></a>[F] render_file <small><span class="summary">"hoge <span class="badge " data-badge-title="">$hoge</span>" 形式のレンダリングのファイル版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/render_file.php#L8-L21" target="_blank">render_file.php#8~21</a></p>
</div>
<details>
<summary class="">"hoge <span class="badge " data-badge-title="">$hoge</span>" 形式のレンダリングのファイル版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function render_file(
    ?string|string $template_file,
    array $array
): string</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$template_file</code></td>
<td>​<span class="summary">レンダリングするファイル名</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">レンダリング変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">レンダリングされた文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">See</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--render_string%28%29">render_string()</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_06371173fde8d6b50591704eb16cb375eab246cc-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-render_string()" class="anchor"></a>[F] render_string <small><span class="summary">"hoge <span class="badge " data-badge-title="">$hoge</span>" 形式のレンダリング</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/render_string.php#L8-L84" target="_blank">render_string.php#8~84</a></p>
</div>
<details>
<summary class="">"hoge <span class="badge " data-badge-title="">$hoge</span>" 形式のレンダリング</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function render_string(
    ?string|string $template,
    array $array
): string</div></pre>
<div class="description">
<p>文字列を eval して "hoge <span class="badge " data-badge-title="">$hoge</span>" 形式の文字列に変数を埋め込む。<span class="implicit-br">
</span>基本処理は <code>eval("return '" . addslashes($template) . "';");</code> と考えて良いが、下記が異なる。</p>
<ul class=" simple">
<li>数値キーが参照できる</li>
<li>クロージャは呼び出し結果が埋め込まれる。引数は (変数配列, 自身のキー文字列)</li>
<li>引数をそのまま返すだけの特殊な変数 $_ が宣言される</li>
<li>シングルクォートのエスケープは外される</li>
</ul>
<p>$<em> が宣言されるのは変数配列に '</em>' を含んでいないときのみ（上書きを防止するため）。<span class="implicit-br">
</span>この $_ は php の埋め込み変数の闇を利用するととんでもないことが出来たりする（サンプルやテストコードを参照）。</p>
<p>ダブルクオートはエスケープされるので文字列からの脱出はできない。<span class="implicit-br">
</span>また、 <code>{$_(syntax(""))}</code> のように <span class="badge " data-badge-title="">$_()</span> 構文で " も使えなくなるので \' を使用しなければならない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// クロージャは呼び出し結果が埋め込まれる
that(render_string('$c', ['c' =&gt; fn($vars, $k) =&gt; $k . '-closure']))-&gt;isSame('c-closure');
// 引数をそのまま返すだけの特殊な変数 $_ が宣言される
that(render_string('{$_(123 + 456)}', []))-&gt;isSame('579');
// 要するに '$_()' の中に php の式が書けるようになる
that(render_string('{$_(implode(\',\', $strs))}', ['strs' =&gt; ['a', 'n', 'z']]))-&gt;isSame('a,n,z');
that(render_string('{$_(max($nums))}', ['nums' =&gt; [1, 9, 3]]))-&gt;isSame('9');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$template</code></td>
<td>​<span class="summary">レンダリング文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">レンダリング変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">レンダリングされた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_97e4a5f3a56b01b09877a38388a4daedc50d4e3e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-render_template()" class="anchor"></a>[F] render_template <small><span class="summary">"hoge $<span class="badge " data-badge-title="">hoge</span>" 形式のレンダリング</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/render_template.php#L13-L95" target="_blank">render_template.php#13~95</a></p>
</div>
<details>
<summary class="">"hoge $<span class="badge " data-badge-title="">hoge</span>" 形式のレンダリング</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function render_template(
    ?string|string $template,
    array|object $vars,
    callable $tag = null
): string</div></pre>
<div class="description">
<p>ES6 のテンプレートリテラルのようなもの。</p>
<ul class=" simple">
<li>埋め込みは $<span class="badge " data-badge-title="">var</span> のみで、<span class="badge " data-badge-title="">$var</span> は無効</li>
<li>$<span class="badge " data-badge-title="">expression</span> は「評価結果の変数名」ではなく「評価結果」が埋め込まれる</li>
</ul>
<p>この関数は実験的機能のため、互換性を維持せず変更される可能性がある。<span class="implicit-br">
</span>また、 token_get_all に頼っているため php9 で <code>${var}</code> 構文が廃止されたらおそらく動かない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(render_template('${max($nums)}', ['nums' =&gt; [1, 9, 3]]))-&gt;isSame('9');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$template</code></td>
<td>​<span class="summary">レンダリングする文字列</span></td>
</tr>
<tr>
<td>​array|​object</td>
<td>​<code>$vars</code></td>
<td>​<span class="summary">レンダリング変数</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$tag = null</code></td>
<td>​<span class="summary">ブロックと変数値が渡ってくるクロージャ（タグ付きテンプレートリテラルのようなもの）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">レンダリングされた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1335a0afe5aed335baeb289a84b59af658a088fe-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-snake_case()" class="anchor"></a>[F] snake_case <small><span class="summary">snake_case に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/snake_case.php#L7-L28" target="_blank">snake_case.php#7~28</a></p>
</div>
<details>
<summary class="">snake_case に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function snake_case(
    ?string|string $string,
    ?string|string $delimiter = "_",
    bool $keep_abbr = false
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(snake_case('ThisIsAPen'))-&gt;isSame('this_is_a_pen');
that(snake_case('URLEncode', '-'))-&gt;isSame('u-r-l-encode');     // デフォルトでは略語も分割される
that(snake_case('URLEncode', '-', true))-&gt;isSame('url-encode'); // 第3引数 true で略語は維持される</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$delimiter = "_"</code></td>
<td>​<span class="summary">デリミタ</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$keep_abbr = false</code></td>
<td>​<span class="summary">すべて大文字の単語を1単語として扱うか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">変換した文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_251121301156ffcf0ae64ee84b24c343ed254870-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-split_noempty()" class="anchor"></a>[F] split_noempty <small><span class="summary">空文字を除外する文字列分割</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/split_noempty.php#L7-L44" target="_blank">split_noempty.php#7~44</a></p>
</div>
<details>
<summary class="">空文字を除外する文字列分割</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function split_noempty(
    ?string|string $delimiter,
    ?string|string $string,
    string|bool $trimchars = true
): array</div></pre>
<div class="description">
<ul class=" simple">
<li>空文字を任意の区切り文字で分割しても常に空配列</li>
<li>キーは連番で返す（歯抜けがないただの配列）</li>
</ul>
<p>$triming を指定した場合、結果配列にも影響する。<span class="implicit-br">
</span>つまり「除外は trim したいが結果配列にはしたくない」はできない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(split_noempty(',', 'a, b, c'))-&gt;isSame(['a', 'b', 'c']);
that(split_noempty(',', 'a, , , b, c'))-&gt;isSame(['a', 'b', 'c']);
that(split_noempty(',', 'a, , , b, c', false))-&gt;isSame(['a', ' ', ' ', ' b', ' c']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$delimiter</code></td>
<td>​<span class="summary">区切り文字</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字</span></td>
</tr>
<tr>
<td>​string|​bool</td>
<td>​<code>$trimchars = true</code></td>
<td>​<span class="summary">指定した文字を trim する。true を指定すると trim する</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">指定文字で分割して空文字を除いた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_97a98201614978762da492c3b6c78aec07078084-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-starts_with()" class="anchor"></a>[F] starts_with <small><span class="summary">指定文字列で始まるか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/starts_with.php#L8-L44" target="_blank">starts_with.php#8~44</a></p>
</div>
<details>
<summary class="">指定文字列で始まるか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function starts_with(
    ?string|string $string,
    string|string[] $with,
    bool $case_insensitivity = false
): bool</div></pre>
<div class="description">
<p>$with に配列を渡すといずれかで始まるときに true を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(starts_with('abcdef', 'abc'))-&gt;isTrue();
that(starts_with('abcdef', 'ABC', true))-&gt;isTrue();
that(starts_with('abcdef', 'xyz'))-&gt;isFalse();
that(starts_with('abcdef', ['a', 'b', 'c']))-&gt;isTrue();
that(starts_with('abcdef', ['x', 'y', 'z']))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">探される文字列</span></td>
</tr>
<tr>
<td>​string|​string[]</td>
<td>​<code>$with</code></td>
<td>​<span class="summary">探す文字列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">指定文字列で始まるなら true を返す</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8b49906a4f8e7ebca62859894a8713eabbaf63b3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_anyof()" class="anchor"></a>[F] str_anyof <small><span class="summary">文字列が候補の中にあるか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_anyof.php#L7-L46" target="_blank">str_anyof.php#7~46</a></p>
</div>
<details>
<summary class="">文字列が候補の中にあるか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_anyof(
    ?string $needle,
    iterable $haystack,
    bool $case_insensitivity = false
): bool</div></pre>
<div class="description">
<p>候補配列の中に対象文字列があるならそのキーを返す。ないなら null を返す。</p>
<p>あくまで文字列としての比較に徹する（in_array/array_search の第3引数は厳密すぎて使いにくいことがある）。<span class="implicit-br">
</span>ので array_search の文字列特化版とも言える。<span class="implicit-br">
</span>動作的には <code>array_flip($haystack)[$needle] ?? null</code> と同じ（大文字小文字オプションはあるけど）。<span class="implicit-br">
</span>ただ array_flip は巨大配列に弱いし、大文字小文字などの融通が効かないので foreach での素朴な実装になっている。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(str_anyof('b', ['a', 'b', 'c']))-&gt;isSame(1);       // 見つかったキーを返す
that(str_anyof('x', ['a', 'b', 'c']))-&gt;isSame(null);    // 見つからないなら null を返す
that(str_anyof('C', ['a', 'b', 'c'], true))-&gt;isSame(2); // 大文字文字を区別しない
that(str_anyof('1', [1, 2, 3]))-&gt;isSame(0);             // 文字列の比較に徹する
that(str_anyof(2, ['1', '2', '3']))-&gt;isSame(1);         // 同上</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">調べる文字列</span></td>
</tr>
<tr>
<td>​iterable</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">候補配列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">候補の中にあるならそのキー。無いなら null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0c0a9afd8a09e270d8ee7a9220ddc2b64a516bf5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_array()" class="anchor"></a>[F] str_array <small><span class="summary">文字列を区切り文字で区切って配列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_array.php#L9-L132" target="_blank">str_array.php#9~132</a></p>
</div>
<details>
<summary class="">文字列を区切り文字で区切って配列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_array(
    string|array $string,
    ?string|string $delimiter,
    bool $hashmode,
    bool $strict = true
): array</div></pre>
<div class="description">
<p>典型的には http ヘッダとか sar の結果とかを配列にする。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// http response header  を ":" 区切りで連想配列にする
that(str_array("
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Connection: Keep-Alive
", ':', true))-&gt;isSame([
    'HTTP/1.1 200 OK',
    'Content-Type' =&gt; 'text/html; charset=utf-8',
    'Connection'   =&gt; 'Keep-Alive',
]);

// sar の結果を " " 区切りで連想配列の配列にする
that(str_array("
13:00:01        CPU     %user     %nice   %system   %iowait    %steal     %idle
13:10:01        all      0.99      0.10      0.71      0.00      0.00     98.19
13:20:01        all      0.60      0.10      0.56      0.00      0.00     98.74
", ' ', false))-&gt;isSame([
    1 =&gt; [
        '13:00:01' =&gt; '13:10:01',
        'CPU'      =&gt; 'all',
        '%user'    =&gt; '0.99',
        '%nice'    =&gt; '0.10',
        '%system'  =&gt; '0.71',
        '%iowait'  =&gt; '0.00',
        '%steal'   =&gt; '0.00',
        '%idle'    =&gt; '98.19',
    ],
    2 =&gt; [
        '13:00:01' =&gt; '13:20:01',
        'CPU'      =&gt; 'all',
        '%user'    =&gt; '0.60',
        '%nice'    =&gt; '0.10',
        '%system'  =&gt; '0.56',
        '%iowait'  =&gt; '0.00',
        '%steal'   =&gt; '0.00',
        '%idle'    =&gt; '98.74',
    ],
]);

// strict:false だと列数が一致していなくてもよい（null で埋められる）
that(str_array("
13:00:01        CPU     %user     %nice   %system   %iowait
13:10:01        all      0.99      0.10      0.71      0.00      0.00     98.19
13:20:01        all      0.60      0.10
", ' ', false, false))-&gt;isSame([
    1 =&gt; [
        '13:00:01' =&gt; '13:10:01',
        'CPU'      =&gt; 'all',
        '%user'    =&gt; '0.99',
        '%nice'    =&gt; '0.10',
        '%system'  =&gt; '0.71',
        '%iowait'  =&gt; '0.00',
        '6'        =&gt; '0.00',
        '7'        =&gt; '98.19',
    ],
    2 =&gt; [
        '13:00:01' =&gt; '13:20:01',
        'CPU'      =&gt; 'all',
        '%user'    =&gt; '0.60',
        '%nice'    =&gt; '0.10',
        '%system'  =&gt; null,
        '%iowait'  =&gt; null,
        '6'        =&gt; null,
        '7'        =&gt; null,
    ],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列。配列を与えても動作する</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$delimiter</code></td>
<td>​<span class="summary">区切り文字</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$hashmode</code></td>
<td>​<span class="summary">連想配列モードか</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$strict = true</code></td>
<td>​<span class="summary">true にすると列数が一致しない場合に null になる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9d6e59ddd2123a442d3b99170377cc2bf45580a1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_between()" class="anchor"></a>[F] str_between <small><span class="summary">指定文字で囲まれた文字列を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_between.php#L8-L73" target="_blank">str_between.php#8~73</a></p>
</div>
<details>
<summary class="">指定文字で囲まれた文字列を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_between(
    ?string|string $string,
    ?string|string $from,
    ?string|string $to,
    int &amp;$position = 0,
    string $enclosure = "'\"",
    string $escape = "\\"
): ?string</div></pre>
<div class="description">
<p>$from, $to で指定した文字間を取得する（$from, $to 自体は結果に含まれない）。<span class="implicit-br">
</span>ネストしている場合、一番外側の文字間を返す。</p>
<p>$enclosure で「特定文字に囲まれている」場合を無視することができる。<span class="implicit-br">
</span>$escape で「特定文字が前にある」場合を無視することができる。</p>
<p>$position を与えた場合、その場所から走査を開始する。<span class="implicit-br">
</span>さらに結果があった場合、 $position には「次の走査開始位置」が代入される。<span class="implicit-br">
</span>これを使用すると連続で「次の文字, 次の文字, ...」と言った動作が可能になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// $position を利用して "first", "second", "third" を得る（"で囲まれた "blank" は返ってこない）。
that(str_between('{first} and {second} and "{blank}" and {third}', '{', '}', $n))-&gt;isSame('first');
that(str_between('{first} and {second} and "{blank}" and {third}', '{', '}', $n))-&gt;isSame('second');
that(str_between('{first} and {second} and "{blank}" and {third}', '{', '}', $n))-&gt;isSame('third');
// ネストしている場合は最も外側を返す
that(str_between('{nest1{nest2{nest3}}}', '{', '}'))-&gt;isSame('nest1{nest2{nest3}}');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$from</code></td>
<td>​<span class="summary">開始文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$to</code></td>
<td>​<span class="summary">終了文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>&amp;$position = 0</code></td>
<td>​<span class="summary">開始位置。渡した場合次の開始位置が設定される</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$enclosure = "'\""</code></td>
<td>​<span class="summary">囲い文字。この文字中にいる $from, $to 文字は走査外になる</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$escape = "\\"</code></td>
<td>​<span class="summary">エスケープ文字。この文字が前にある $from, $to 文字は走査外になる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">$from, $to で囲まれた文字。見つからなかった場合は null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4147d711eefd61092593143b37e3c4dc8ff34924-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_bytes()" class="anchor"></a>[F] str_bytes <small><span class="summary">文字列のバイト配列を得る</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_bytes.php#L7-L43" target="_blank">str_bytes.php#7~43</a></p>
</div>
<details>
<summary class="">文字列のバイト配列を得る</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_bytes(
    ?string|string $string,
    int $base = 10
): array</div></pre>
<div class="description">
<p>$base 引数で基数を変更できる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 10進配列で返す
that(str_bytes('abc'))-&gt;isSame([97, 98, 99]);
// 16進配列で返す
that(str_bytes('abc', 16))-&gt;isSame(["61", "62", "63"]);
// マルチバイトで余計なことはしない（php としての文字列のバイト配列をそのまま返す）
that(str_bytes('あいう', 16))-&gt;isSame(["e3", "81", "82", "e3", "81", "84", "e3", "81", "86"]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$base = 10</code></td>
<td>​<span class="summary">基数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">文字のバイト配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ce06bcbcf9163db628534e66900ad713dafdca1e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_chop()" class="anchor"></a>[F] str_chop <small><span class="summary">先頭・末尾の指定文字列を削ぎ落とす</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_chop.php#L7-L36" target="_blank">str_chop.php#7~36</a></p>
</div>
<details>
<summary class="">先頭・末尾の指定文字列を削ぎ落とす</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_chop(
    ?string|string $string,
    ?string|string $prefix = "",
    ?string|string $suffix = "",
    bool $case_insensitivity = false
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 文字列からパス文字列と拡張子を削ぎ落とす
$PATH = '/path/to/something';
that(str_chop("$PATH/hoge.php", "$PATH/", '.php'))-&gt;isSame('hoge');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$prefix = ""</code></td>
<td>​<span class="summary">削ぎ落とす先頭文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$suffix = ""</code></td>
<td>​<span class="summary">削ぎ落とす末尾文字列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">削ぎ落とした文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6d8c552856a983bf488859aa7bd8bd2ce97bb5bb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_chunk()" class="anchor"></a>[F] str_chunk <small><span class="summary">文字列を可変引数の数で分割する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_chunk.php#L7-L44" target="_blank">str_chunk.php#7~44</a></p>
</div>
<details>
<summary class="">文字列を可変引数の数で分割する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_chunk(
    ?string|string $string,
    int ...$chunks
): string[]</div></pre>
<div class="description">
<p>str_split の $length を個別に指定できるイメージ。<span class="implicit-br">
</span>長さ以上を指定したりしても最後の要素は必ずついてくる（指定数で分割した後のあまり文字が最後の要素になる）。<span class="implicit-br">
</span>これは最後が空文字でも同様で、 list での代入を想定しているため。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 1, 2, 3 文字に分割（ぴったりなので変わったことはない）
that(str_chunk('abcdef', 1, 2, 3))-&gt;isSame(['a', 'bc', 'def', '']);
// 2, 3 文字に分割（余った f も最後の要素として含まれてくる）
that(str_chunk('abcdef', 2, 3))-&gt;isSame(['ab', 'cde', 'f']);
// 1, 10 文字に分割
that(str_chunk('abcdef', 1, 10))-&gt;isSame(['a', 'bcdef', '']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>...$chunks</code></td>
<td>​<span class="summary">分割の各文字数（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string[]</td>
<td>​<span class="summary">分割された文字列配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2c8f5c4caa39a6045a56123a674981f05464e590-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_common_prefix()" class="anchor"></a>[F] str_common_prefix <small><span class="summary">文字列群の共通のプレフィックスを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_common_prefix.php#L7-L46" target="_blank">str_common_prefix.php#7~46</a></p>
</div>
<details>
<summary class="">文字列群の共通のプレフィックスを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_common_prefix(?string|string[] ...$strings): ?string</div></pre>
<div class="description">
<p>共通部分がない場合は空文字を返す。<span class="implicit-br">
</span>引数は2個以上必要で足りない場合は null を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 共通プレフィックスを返す
that(str_common_prefix('ab', 'abc', 'abcd'))-&gt;isSame('ab');
that(str_common_prefix('あ', 'あい', 'あいう'))-&gt;isSame('あ');
// 共通部分がない場合は空文字を返す
that(str_common_prefix('xab', 'yabc', 'zabcd'))-&gt;isSame('');
that(str_common_prefix('わあ', 'をあい', 'んあいう'))-&gt;isSame('');
// 引数不足の場合は null を返す
that(str_common_prefix('a'))-&gt;isSame(null);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string[]</td>
<td>​<code>...$strings</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">共通部分（共通がない場合は空文字）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5da10968c51dedcfe2b7085f2299a70ac5aa8227-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_control_apply()" class="anchor"></a>[F] str_control_apply <small><span class="summary">制御文字を実際に適用させる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_control_apply.php#L10-L84" target="_blank">str_control_apply.php#10~84</a></p>
</div>
<details>
<summary class="">制御文字を実際に適用させる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_control_apply(
    string $string,
    string $characters = &lt;&lt;&lt;TEXT
\\b\10\\d\177
TEXT
): string</div></pre>
<div class="description">
<p>とはいえ文字列として適用できる制御文字はそう多くはなく、実質的に \b くらいだろう。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>\b</dt>
<dd>前の1文字を消して自身も消える</dd>
</div>
<div class="dtdd-container">
<dt>\d</dt>
<dd>次の\d以外の1文字を消して自身も消える<ul class=" simple">
<li>前方探索なので利便性のため「\d以外の」という条件がついている</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>\r</dt>
<dd>直前の \n から直後の \n までを消す<ul class=" simple">
<li>\r に「消す」という意味はないが、実用上はその方が便利なことが多い</li>
</ul>
</dd>
</div>
</dl>
<p>なお、 \b と書いてあるが php のエスケープシーケンスに \b は存在しないため \x08 と記述する必要がある（\d も同様）。<span class="implicit-br">
</span>それはそれで不便なので \b, \d は特別扱いとしてある（$characters のデフォルト値に潜ませてあるが、それを外せば特別扱いは無くなる）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 最初の X は [BS] で消える・次の X は [DEL] で消える、XXX は [CR] で消える。結果 text\nzzz になる
that(str_control_apply("X\b\dXtext\nXXX\rzzz"))-&gt;isSame("text\nzzz");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$characters = &lt;&lt;&lt;TEXT&lt;br&gt;\\b\10\\d\177&lt;br&gt;TEXT</code></td>
<td>​<span class="summary">対象とする制御文字</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">制御文字が適用された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_443ac8e583d818739eb910af277555ce91c998e1-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_diff()" class="anchor"></a>[F] str_diff <small><span class="summary">テキストの diff を得る</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_diff.php#L11-L586" target="_blank">str_diff.php#11~586</a></p>
</div>
<details>
<summary class="">テキストの diff を得る</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_diff(
    string|array|resource $xstring,
    string|array|resource $ystring,
    array $options = []
): string|array|null</div></pre>
<div class="description">
<p><code>$options['allow-binary']</code> でバイナリ文字列の扱いを指定する（false: 例外, null: null を返す）。<span class="implicit-br">
</span><code>$options['ignore-case'] = true</code> で大文字小文字を無視する。<span class="implicit-br">
</span><code>$options['ignore-space-change'] = true</code> で空白文字の数を無視する。<span class="implicit-br">
</span><code>$options['ignore-all-space'] = true</code> ですべての空白文字を無視する<span class="implicit-br">
</span><code>$options['stringify']</code> で差分データを文字列化するクロージャを指定する。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>normal</dt>
<dd>標準形式（diff のオプションなしに相当する）</dd>
</div>
<div class="dtdd-container">
<dt>context</dt>
<dd>コンテキスト形式（context=3 のような形式で diff の -C 3 に相当する）</dd>
</div>
<div class="dtdd-container">
<dt>unified</dt>
<dd>ユニファイド形式（unified=3 のような形式で diff の -U 3 に相当する）<ul class=" simple">
<li>unified のみを指定するとヘッダを含まない +- のみの差分を出す</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>split</dt>
<dd>サイドバイサイド形式（split=3,120 のような形式で diff の -y -W 120 に相当する）<ul class=" simple">
<li>diff -y と互換性はなく、あくまでそれっぽくしているのみ</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>html</dt>
<dd>ins, del の html タグ形式<ul class=" simple">
<li>html=perline とすると行レベルでの差分も出す</li>
</ul>
</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 前文字列
$old = 'same
delete
same
same
change
';
// 後文字列
$new = 'same
same
append
same
this is changed line
';
// シンプルな差分テキストを返す
that(str_diff($old, $new))-&gt;isSame(' same
-delete
 same
+append
 same
-change
+this is changed line
');
// html で差分を返す
that(str_diff($old, $new, ['stringify' =&gt; 'html']))-&gt;isSame('same
&lt;del&gt;delete&lt;/del&gt;
same
&lt;ins&gt;append&lt;/ins&gt;
same
&lt;del&gt;change&lt;/del&gt;
&lt;ins&gt;this is changed line&lt;/ins&gt;
');
// 行レベルの html で差分を返す
that(str_diff($old, $new, ['stringify' =&gt; 'html=perline']))-&gt;isSame('same
&lt;del&gt;delete&lt;/del&gt;
same
&lt;ins&gt;append&lt;/ins&gt;
same
&lt;ins&gt;this is &lt;/ins&gt;chang&lt;ins&gt;ed lin&lt;/ins&gt;e
');
// raw な配列で差分を返す
that(str_diff($old, $new, ['stringify' =&gt; null]))-&gt;isSame([
    // 等価行（'=' という記号と前後それぞれの文字列を返す（キーは行番号））
    ['=', [0 =&gt; 'same'], [0 =&gt; 'same']],
    // 削除行（'-' という記号と前の文字列を返す（キーは行番号）、後は int で行番号のみ）
    ['-', [1 =&gt; 'delete'], 0],
    // 等価行
    ['=', [2 =&gt; 'same'], [1 =&gt; 'same']],
    // 追加行（'+' という記号と後の文字列を返す（キーは行番号）、前は int で行番号のみ）
    ['+', 2, [2 =&gt; 'append']],
    // 等価行
    ['=', [3 =&gt; 'same'], [3 =&gt; 'same']],
    // 変更行（'*' という記号と前後それぞれの文字列を返す（キーは行番号））
    ['*', [4 =&gt; 'change'], [4 =&gt; 'this is changed line']],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array|​resource</td>
<td>​<code>$xstring</code></td>
<td>​<span class="summary">元文字列</span></td>
</tr>
<tr>
<td>​string|​array|​resource</td>
<td>​<code>$ystring</code></td>
<td>​<span class="summary">比較文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array|​null</td>
<td>​<span class="summary">差分テキスト。 stringify が null の場合は raw な差分配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c3a6525deb1cfb4478b710c431e946da9e289972-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_ellipsis()" class="anchor"></a>[F] str_ellipsis <small><span class="summary">文字列を指定数に丸める</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_ellipsis.php#L8-L53" target="_blank">str_ellipsis.php#8~53</a></p>
</div>
<details>
<summary class="">文字列を指定数に丸める</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_ellipsis(
    ?string|string $string,
    int $width,
    string $trimmarker = "...",
    int|null $pos = null
): string</div></pre>
<div class="description">
<p>mb_strimwidth と似ているが、省略文字の差し込み位置を $pos で指定できる。<span class="implicit-br">
</span>$pos は負数が指定できる。負数の場合後ろから数えられる。<span class="implicit-br">
</span>省略した場合は真ん中となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 8文字に丸める（$pos 省略なので真ん中が省略される）
that(str_ellipsis('1234567890', 8, '...'))-&gt;isSame('12...890');
// 8文字に丸める（$pos=1 なので1文字目から省略される）
that(str_ellipsis('1234567890', 8, '...', 1))-&gt;isSame('1...7890');
// 8文字に丸める（$pos=-1 なので後ろから1文字目から省略される）
that(str_ellipsis('1234567890', 8, '...', -1))-&gt;isSame('1234...0');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$width</code></td>
<td>​<span class="summary">丸める幅</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$trimmarker = "..."</code></td>
<td>​<span class="summary">省略文字列</span></td>
</tr>
<tr>
<td>​int|​null</td>
<td>​<code>$pos = null</code></td>
<td>​<span class="summary">省略記号の差し込み位置</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">丸められた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_4085cf00595979da8ea421025a6ae0ce644cb7f6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_embed()" class="anchor"></a>[F] str_embed <small><span class="summary">エスケープ付きで文字列を置換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_embed.php#L9-L100" target="_blank">str_embed.php#9~100</a></p>
</div>
<details>
<summary class="">エスケープ付きで文字列を置換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_embed(
    ?string|string $string,
    array $replacemap,
    string|array $enclosure = "'\"",
    string $escape = "\\",
    ?array &amp;$replaced = null
): string</div></pre>
<div class="description">
<p>$replacemap で from -&gt; to 文字列を指定する。<span class="implicit-br">
</span>to は文字列と配列とクロージャを受け付ける。<span class="implicit-br">
</span>文字列の場合は普通に想起される動作で単純な置換となる。<span class="implicit-br">
</span>配列の場合は順次置換していく。要素が足りなくなったら例外を投げる。<span class="implicit-br">
</span>クロージャの場合は(from, from 内の連番, トータル置換回数)でコールバックされる。null を返すと置換されない。</p>
<p>strtr と同様、最も長いキーから置換を行い、置換後の文字列は対象にならない。</p>
<p>$enclosure で「特定文字に囲まれている」場合を無視することができる。<span class="implicit-br">
</span>$escape で「特定文字が前にある」場合を無視することができる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 最も単純な置換
that(str_embed('a, b, c', ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C']))-&gt;isSame('A, B, C');
// 最も長いキーから置換される
that(str_embed('abc', ['a' =&gt; 'X', 'ab' =&gt; 'AB']))-&gt;isSame('ABc');
// 配列を渡すと「N番目の置換」が実現できる（文字列の場合は再利用される）
that(str_embed('a, a, b, b', [
    'a' =&gt; 'A',          // 全ての a が A になる
    'b' =&gt; ['B1', 'B2'], // 1番目の b が B1, 2番目の b が B2 になる
]))-&gt;isSame('A, A, B1, B2');
// クロージャを渡すと(from, from 内の連番, トータル置換回数)でコールバックされる
that(str_embed('a, a, b, b', [
    'a' =&gt; fn($src, $n, $l) =&gt; "$src,$n,$l",
    'b' =&gt; fn($src, $n, $l) =&gt; null,
]))-&gt;isSame('a,0,0, a,1,1, b, b');
// 最も重要な性質として "' で囲まれていると対象にならない
that(str_embed('a, "a", b, "b", b', [
    'a' =&gt; 'A',
    'b' =&gt; ['B1', 'B2'],
]))-&gt;isSame('A, "a", B1, "b", B2');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$replacemap</code></td>
<td>​<span class="summary">置換文字列</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$enclosure = "'\""</code></td>
<td>​<span class="summary">囲い文字。この文字中にいる $from, $to 文字は走査外になる</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$escape = "\\"</code></td>
<td>​<span class="summary">エスケープ文字。この文字が前にある $from, $to 文字は走査外になる</span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>&amp;$replaced = null</code></td>
<td>​<span class="summary">置換されたペアがタプルで格納される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">置換された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c5db8b6dba5f914f5af30052db00c0d98244461c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_equals()" class="anchor"></a>[F] str_equals <small><span class="summary">文字列比較の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_equals.php#L7-L46" target="_blank">str_equals.php#7~46</a></p>
</div>
<details>
<summary class="">文字列比較の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_equals(
    string $str1,
    string $str2,
    bool $case_insensitivity = false
): bool</div></pre>
<div class="description">
<p>文字列以外が与えられた場合は常に false を返す。ただし __toString を実装したオブジェクトは別。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(str_equals('abc', 'abc'))-&gt;isTrue();
that(str_equals('abc', 'ABC', true))-&gt;isTrue();
that(str_equals('\0abc', '\0abc'))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$str1</code></td>
<td>​<span class="summary">文字列1</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$str2</code></td>
<td>​<span class="summary">文字列2</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">同じ文字列なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d8712eff6f6d9bfc90f15e02bcd241a7d9baa1f7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_exists()" class="anchor"></a>[F] str_exists <small><span class="summary">指定文字列を含むか返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_exists.php#L7-L44" target="_blank">str_exists.php#7~44</a></p>
</div>
<details>
<summary class="">指定文字列を含むか返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_exists(
    ?string|string $haystack,
    string|array $needle,
    bool $case_insensitivity = false,
    bool $and_flag = false
): bool</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(str_exists('abc', 'b'))-&gt;isTrue();
that(str_exists('abc', 'B', true))-&gt;isTrue();
that(str_exists('abc', ['b', 'x'], false, false))-&gt;isTrue();
that(str_exists('abc', ['b', 'x'], false, true))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">調べる文字列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$and_flag = false</code></td>
<td>​<span class="summary">すべて含む場合に true を返すか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">$needle を含むなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_09872e43d7378955c8a0e5cc2b017d44631569cd-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_guess()" class="anchor"></a>[F] str_guess <small><span class="summary">$string に最も近い文字列を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_guess.php#L10-L99" target="_blank">str_guess.php#10~99</a></p>
</div>
<details>
<summary class="">$string に最も近い文字列を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_guess(
    ?string|string $string,
    array $candidates,
    ?float &amp;$percent = null
): string|array</div></pre>
<div class="description">
<p>N-gram 化して類似度の高い結果を返す。<span class="implicit-br">
</span>$percent で一致度を受けられる。<span class="implicit-br">
</span>予め値が入った変数を渡すとその一致度以上の候補を高い順で配列で返す。</p>
<p>この関数の結果（内部実装）は互換性を考慮しない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 「あいうえお」と最も近い文字列は「あいゆえに」である
that(str_guess("あいうえお", [
    'かきくけこ', // マッチ度 0%（1文字もかすらない）
    'ぎぼあいこ', // マッチ度約 13.1%（"あい"はあるが位置が異なる）
    'あいしてる', // マッチ度約 13.8%（"あい"がマッチ）
    'かとうあい', // マッチ度約 16.7%（"あい"があり"う"の位置が等しい）
    'あいゆえに', // マッチ度約 17.4%（"あい", "え"がマッチ）
]))-&gt;isSame('あいゆえに');

// マッチ度30%以上を高い順に配列で返す
$percent = 30;
that(str_guess("destory", [
    'describe',
    'destroy',
    'destruct',
    'destiny',
    'destinate',
], $percent))-&gt;isSame([
    'destroy',
    'destiny',
    'destruct',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">調べる文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$candidates</code></td>
<td>​<span class="summary">候補文字列配列</span></td>
</tr>
<tr>
<td>​?float</td>
<td>​<code>&amp;$percent = null</code></td>
<td>​<span class="summary">マッチ度（％）を受ける変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<span class="summary">候補の中で最も近い文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7c8e167e36221d4309174659e9dc5a686c1149f9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_lchop()" class="anchor"></a>[F] str_lchop <small><span class="summary">先頭の指定文字列を削ぎ落とす</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_lchop.php#L8-L28" target="_blank">str_lchop.php#8~28</a></p>
</div>
<details>
<summary class="">先頭の指定文字列を削ぎ落とす</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_lchop(
    ?string|string $string,
    ?string|string $prefix,
    bool $case_insensitivity = false
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 文字列からパス文字列を削ぎ落とす
$PATH = '/path/to/something';
that(str_lchop("$PATH/hoge.php", "$PATH/"))-&gt;isSame('hoge.php');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$prefix</code></td>
<td>​<span class="summary">削ぎ落とす先頭文字列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">削ぎ落とした文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_fe18a0a3bc7003fe1301e09bcf20a879559239bf-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_patch()" class="anchor"></a>[F] str_patch <small><span class="summary">テキストに patch を当てる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_patch.php#L9-L215" target="_blank">str_patch.php#9~215</a></p>
</div>
<details>
<summary class="">テキストに patch を当てる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_patch(
    ?string|string $string,
    ?string|string $patch,
    array $options = []
): string</div></pre>
<div class="description">
<p>diff 形式は現在のところ unified のみ。<span class="implicit-br">
</span>reject の仕様はなく、ハンクが一つでも検出・適用不可なら例外を投げる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$xstring = &lt;&lt;&lt;HERE
equal line
delete line
equal line
HERE;
$ystring = &lt;&lt;&lt;HERE
equal line
equal line
append line
HERE;
// xstring から ystring へのパッチ
$patch = str_diff($xstring, $ystring, ['stringify' =&gt; 'unified=3']);
// xstring に適用すれば ystring になる
that(str_patch($xstring, $patch))-&gt;isSame($ystring);
// ystring に reverse で適用すれば xstring に戻る
that(str_patch($ystring, $patch, ['reverse' =&gt; true]))-&gt;isSame($xstring);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$patch</code></td>
<td>​<span class="summary">パッチ文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">パッチ適用結果</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_97a4da59cbd0ed1744b830f34bdce6d4e2ed9447-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_putcsv()" class="anchor"></a>[F] str_putcsv <small><span class="summary">fputcsv の文字列版（str_getcsv の put 版）</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_putcsv.php#L8-L51" target="_blank">str_putcsv.php#8~51</a></p>
</div>
<details>
<summary class="">fputcsv の文字列版（str_getcsv の put 版）</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_putcsv(
    iterable $array,
    string $delimiter = ",",
    string $enclosure = "\"",
    string $escape = "\\"
): string</div></pre>
<div class="description">
<p>普通の配列を与えるとシンプルに "a,b,c" のような1行を返す。<span class="implicit-br">
</span>多次元配列（2次元のみを想定）や Traversable を与えるとループして "a,b,c\nd,e,f" のような複数行を返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルな1行を返す
that(str_putcsv(['a', 'b', 'c']))-&gt;isSame("a,b,c");
that(str_putcsv(['a', 'b', 'c'], "\t"))-&gt;isSame("a\tb\tc");
that(str_putcsv(['a', ' b ', 'c'], " ", "'"))-&gt;isSame("a ' b ' c");

// 複数行を返す
that(str_putcsv([['a', 'b', 'c'], ['d', 'e', 'f']]))-&gt;isSame("a,b,c\nd,e,f");
that(str_putcsv((function() {
    yield ['a', 'b', 'c'];
    yield ['d', 'e', 'f'];
})()))-&gt;isSame("a,b,c\nd,e,f");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable</td>
<td>​<code>$array</code></td>
<td>​<span class="summary">値の配列 or 値の配列の配列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$delimiter = ","</code></td>
<td>​<span class="summary">フィールド区切り文字</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$enclosure = "\""</code></td>
<td>​<span class="summary">フィールドを囲む文字</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$escape = "\\"</code></td>
<td>​<span class="summary">エスケープ文字</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">CSV 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f61b9930f5280b3cbabbb0bfab0f6a468506ed3c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_quote()" class="anchor"></a>[F] str_quote <small><span class="summary">文字列をダブルクォート文字列に変換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_quote.php#L7-L150" target="_blank">str_quote.php#7~150</a></p>
</div>
<details>
<summary class="">文字列をダブルクォート文字列に変換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_quote(
    string $string,
    array $options = []
): string</div></pre>
<div class="description">
<p>文字ではうまく表現できないが、例えば「本当の改行」が \n になり、「本当のタブ文字」が \t になる。<span class="implicit-br">
</span>コントロール文字は "\code" 形式のようになる。<span class="implicit-br">
</span>「得られた文字列は eval すると元に戻る」とでも言えばいいか。</p>
<p>制御文字をそのまま出力するとまずい状況が稀によくある（特に行指向媒体への改行文字）。<span class="implicit-br">
</span>この関数を通せば php の文字列の体裁を保ったまま1行化できる。<span class="implicit-br">
</span>端的に言えば var_export の文字列特化版。</p>
<p>挙動は $options である程度制御可能。<span class="implicit-br">
</span>各 $options は原則的に文字のマップか true を渡す（true の場合はデフォルトが使用される）。<span class="implicit-br">
</span>一部、それ以外の値・型に対応しているものもある。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>escape-character</dt>
<dd>制御文字のうち、明確なエスケープシーケンスが存在する場合はそれを使用する<ul class=" simple">
<li>control-character にオーバーラップするがこちらが優先される</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>control-character</dt>
<dd>00 ～ 1F+7F の制御文字を \code 形式にする<ul class=" simple">
<li>文字列で "oct", "hex", "HEX" も指定できる。その場合それぞれ \oct, \xhex, \xHEX 形式になる</li>
</ul>
</dd>
</div>
<div class="dtdd-container">
<dt>special-character</dt>
<dd>ダブルクオート内の文字列が文字列であるための変換を行う<ul class=" simple">
<li>原則的にデフォルトに任せて指定すべきではない</li>
</ul>
</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// （非常に分かりにくいが）下記のように変換される
that(str_quote("\$a\nb\rc\x00"))-&gt;isSame("\"\\\$a\\nb\\rc\\0\"");
// 文字としての意味は一緒であり要するに表現形式の違いなので、php の世界で eval すれば元の文字列に戻る
that(eval('return ' . str_quote("\$a\nb\rc\x00") . ';'))-&gt;isSame("\$a\nb\rc\x00");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">クォート文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0b8be260981f1a0e47e39887f4c4f481088fc5a6-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_rchop()" class="anchor"></a>[F] str_rchop <small><span class="summary">末尾の指定文字列を削ぎ落とす</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_rchop.php#L8-L28" target="_blank">str_rchop.php#8~28</a></p>
</div>
<details>
<summary class="">末尾の指定文字列を削ぎ落とす</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_rchop(
    ?string|string $string,
    ?string|string $suffix,
    bool $case_insensitivity = false
): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 文字列から .php を削ぎ落とす
$PATH = '/path/to/something';
that(str_rchop("$PATH/hoge.php", ".php"))-&gt;isSame("$PATH/hoge");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$suffix</code></td>
<td>​<span class="summary">削ぎ落とす末尾文字列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">削ぎ落とした文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c0837d76fd630777830700b872822eed02be12d4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_submap()" class="anchor"></a>[F] str_submap <small><span class="summary">指定文字列を置換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_submap.php#L8-L110" target="_blank">str_submap.php#8~110</a></p>
</div>
<details>
<summary class="">指定文字列を置換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_submap(
    ?string|string $subject,
    array $replaces,
    bool $case_insensitivity = false
): string</div></pre>
<div class="description">
<p>$subject を $replaces に従って置換する。<span class="implicit-br">
</span>具体的には「$replaces を 複数指定できる str_subreplace」に近い。</p>
<p>strtr とは「N 番目のみ置換できる」点で異なる。<span class="implicit-br">
</span>つまり、$replaces=['hoge' =&gt; [2 =&gt; 'fuga']] とすると「2 番目の 'hoge' が 'fuga' に置換される」という動作になる（0 ベース）。</p>
<p>$replaces の要素に非配列を与えた場合は配列化される。<span class="implicit-br">
</span>つまり <code>$replaces = ['hoge' =&gt; 'fuga']</code> は <code>$replaces = ['hoge' =&gt; ['fuga']]</code> と同じ（最初のマッチを置換する）。</p>
<p>$replace に空配列を与えると何もしない。<span class="implicit-br">
</span>負数キーは後ろから数える動作となる。<span class="implicit-br">
</span>また、置換後の文字列は置換対象にはならない。</p>
<p>N 番目の検索文字列が見つからない場合は例外を投げる。<span class="implicit-br">
</span>ただし、文字自体が見つからない場合は投げない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// "hello, world" の l と o を置換
that(str_submap('hello, world', [
    // l は0番目と2番目のみを置換（1番目は何も行われない）
    'l' =&gt; [
        0 =&gt; 'L1',
        2 =&gt; 'L3',
    ],
    // o は後ろから数えて1番目を置換
    'o' =&gt; [
        -1 =&gt; 'O',
    ],
]))-&gt;isSame('heL1lo, wOrL3d');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$subject</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$replaces</code></td>
<td>​<span class="summary">読み換え配列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">置換された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_362a6602e6327a8a1bc758d604d6a71e7fb8c6e9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-str_subreplace()" class="anchor"></a>[F] str_subreplace <small><span class="summary">指定文字列を置換する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/str_subreplace.php#L8-L84" target="_blank">str_subreplace.php#8~84</a></p>
</div>
<details>
<summary class="">指定文字列を置換する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function str_subreplace(
    ?string|string $subject,
    ?string|string $search,
    array|string $replaces,
    bool $case_insensitivity = false
): string</div></pre>
<div class="description">
<p>$subject 内の $search を $replaces に置換する。<span class="implicit-br">
</span>str_replace とは「N 番目のみ置換できる」点で異なる。<span class="implicit-br">
</span>つまり、$search='hoge', $replace=[2 =&gt; 'fuga'] とすると「2 番目の 'hoge' が 'fuga' に置換される」という動作になる（0 ベース）。</p>
<p>$replace に 非配列を与えた場合は配列化される。<span class="implicit-br">
</span>つまり <code>$replaces = 'hoge'</code> は <code>$replaces = [0 =&gt; 'hoge']</code> と同じ（最初のマッチを置換する）。</p>
<p>$replace に空配列を与えると何もしない。<span class="implicit-br">
</span>負数キーは後ろから数える動作となる。<span class="implicit-br">
</span>また、置換後の文字列は置換対象にはならない。</p>
<p>N 番目の検索文字列が見つからない場合は例外を投げる。<span class="implicit-br">
</span>ただし、文字自体が見つからない場合は投げない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 1番目（0ベースなので2番目）の x を X に置換
that(str_subreplace('xxx', 'x', [1 =&gt; 'X']))-&gt;isSame('xXx');
// 0番目（最前列）の x を Xa に、-1番目（最後尾）の x を Xz に置換
that(str_subreplace('!xxx!', 'x', [0 =&gt; 'Xa', -1 =&gt; 'Xz']))-&gt;isSame('!XaxXz!');
// 置換結果は置換対象にならない
that(str_subreplace('xxx', 'x', [0 =&gt; 'xxx', 1 =&gt; 'X']))-&gt;isSame('xxxXx');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$subject</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$search</code></td>
<td>​<span class="summary">検索文字列</span></td>
</tr>
<tr>
<td>​array|​string</td>
<td>​<code>$replaces</code></td>
<td>​<span class="summary">置換文字列配列（単一指定は配列化される）</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$case_insensitivity = false</code></td>
<td>​<span class="summary">大文字小文字を無視するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">置換された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7aeeb2e98fe3114d5417c40252f1e846e2f17d74-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strcat()" class="anchor"></a>[F] strcat <small><span class="summary">文字列結合の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strcat.php#L7-L23" target="_blank">strcat.php#7~23</a></p>
</div>
<details>
<summary class="">文字列結合の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strcat(?string|mixed ...$variadic): string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(strcat('a', 'b', 'c'))-&gt;isSame('abc');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">結合する文字列（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">結合した文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ecab3f5475502f84f16c73422f41498619a04bfa-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strpos_array()" class="anchor"></a>[F] strpos_array <small><span class="summary">複数の文字列で strpos する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strpos_array.php#L8-L48" target="_blank">strpos_array.php#8~48</a></p>
</div>
<details>
<summary class="">複数の文字列で strpos する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strpos_array(
    ?string|string $haystack,
    iterable $needles,
    int $offset = 0
): array</div></pre>
<div class="description">
<p>$needles のそれぞれの位置を配列で返す。<span class="implicit-br">
</span>ただし、見つからなかった文字は結果に含まれない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 見つかった位置を返す
that(strpos_array('hello world', ['hello', 'world']))-&gt;isSame([
    0 =&gt; 0,
    1 =&gt; 6,
]);
// 見つからない文字は含まれない
that(strpos_array('hello world', ['notfound', 'world']))-&gt;isSame([
    1 =&gt; 6,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​iterable</td>
<td>​<code>$needles</code></td>
<td>​<span class="summary">位置を取得したい文字列配列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$offset = 0</code></td>
<td>​<span class="summary">開始位置</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">$needles それぞれの位置配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e45c39a23dca2d34dad0a024647366ca35a75de4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strpos_closest()" class="anchor"></a>[F] strpos_closest <small><span class="summary">指定位置から左右どちらかの探索を行う</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strpos_closest.php#L8-L92" target="_blank">strpos_closest.php#8~92</a></p>
</div>
<details>
<summary class="">指定位置から左右どちらかの探索を行う</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strpos_closest(
    string $haystack,
    string $needle,
    ?int $offset = null,
    int $nth = 1
): ?int</div></pre>
<div class="description">
<p>一つ前/後の指定文字の位置を返す<span class="implicit-br">
</span>端的に言えば strpo/strposr の自動使い分け＋範囲外でもエラーにならない版。</p>
<p>$nth は負数で左探索、正数で右探索だが、スキップ数も兼ねる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">//        +0123456789A1234567
//        -7654321A9876543210
$string = 'hello hello hello';

// 0文字目から右探索すれば0文字目が引っかかる
that(strpos_closest($string, 'hello', 0, +1))-&gt;isSame(0);
// ↑のスキップ（2つ目）版
that(strpos_closest($string, 'hello', 0, +2))-&gt;isSame(6);
// 5文字目から右探索すれば6文字目が引っかかる
that(strpos_closest($string, 'hello', 5, +1))-&gt;isSame(6);
// ↑のスキップ（2つ目）版
that(strpos_closest($string, 'hello', 5, +2))-&gt;isSame(12);
// 8文字目から右探索すれば12文字目が引っかかる（2個目の hello の途中なので3個目の hello から引っかかる）
that(strpos_closest($string, 'hello', 8, +1))-&gt;isSame(12);
// ↑のスキップ（2つ目）版
that(strpos_closest($string, 'hello', 8, +2))-&gt;isSame(null);

// 0文字目から左探索しても見つからない
that(strpos_closest($string, 'hello', 0, -1))-&gt;isSame(null);
// 5文字目から左探索すれば0文字目が引っかかる
that(strpos_closest($string, 'hello', 5, -1))-&gt;isSame(0);
// 8文字目から左探索すれば0文字目が引っかかる（2個目の hello の途中なので1個目の hello から引っかかる）
that(strpos_closest($string, 'hello', 8, -1))-&gt;isSame(0);
// 11文字目から左探索すれば6文字目が引っかかる
that(strpos_closest($string, 'hello', 11, -1))-&gt;isSame(6);
// ↑のスキップ（2つ目）版
that(strpos_closest($string, 'hello', 11, -2))-&gt;isSame(0);

// 範囲外でもエラーにならない
that(strpos_closest($string, 'hello', -999, +1))-&gt;isSame(0);  // 「数直線のはるか左方から探索を始めて 0 文字目で見つかった」のようなイメージ
that(strpos_closest($string, 'hello', +999, -1))-&gt;isSame(12); // 「数直線のはるか右方から探索を始めて 12 文字目で見つかった」のようなイメージ</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">位置を取得したい文字列</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$offset = null</code></td>
<td>​<span class="summary">開始位置。 null を渡すと $nth の方向に応じて自動で定まる</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$nth = 1</code></td>
<td>​<span class="summary">左右指定兼スキップ数（正数で右探索、負数で左探索）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?int</td>
<td>​<span class="summary">見つかった位置</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_dab55b650331540d6a4a17107413ac7e53a6b491-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strpos_escaped()" class="anchor"></a>[F] strpos_escaped <small><span class="summary">エスケープを考慮して strpos する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strpos_escaped.php#L9-L81" target="_blank">strpos_escaped.php#9~81</a></p>
</div>
<details>
<summary class="">エスケープを考慮して strpos する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strpos_escaped(
    ?string|string $haystack,
    string|array $needle,
    int $offset = 0,
    string $escape = "\\",
    ?string &amp;$found = null
): ?int</div></pre>
<div class="description">
<p>文字列中のエスケープ中でない生の文字を検索する。<span class="implicit-br">
</span>例えば <code>"abc\nxyz"</code> という文字列で <code>"n"</code> という文字は存在しないとみなす。<span class="implicit-br">
</span><code>"\n"</code> は改行のエスケープシーケンスであり、 <code>"n"</code> という文字ではない（エスケープシーケンスとして "n" を流用しているだけ）。<span class="implicit-br">
</span>逆に <code>"\\n"</code> はバックスラッシュと <code>"n"</code> という文字であり <code>"n"</code> が存在する。<span class="implicit-br">
</span>簡単に言えば「直前にバックスラッシュがある場合はヒットしない strpos」である。<span class="implicit-br">
</span>バックスラッシュは $escape 引数で指定可能。</p>
<p>$needle 自体にエスケープ文字を含む場合、反対の意味で検索する。<span class="implicit-br">
</span>つまり、「直前にバックスラッシュがある場合のみヒットする strpos」になる。</p>
<p>$offset 引数を指定するとその位置から探索を開始するが、戻り読みはしないのでエスケープ文字の真っ只中を指定する場合は注意。<span class="implicit-br">
</span>例えば <code>"\n"</code> は改行文字だけであるが、offset に 1 に指定して "n" を探すとマッチする。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"># 分かりにくいので \ ではなく % をエスケープ文字とする
$defargs = [0, '%'];

// これは null である（"%d" という文字の列であるため "d" という文字は存在しない）
that(strpos_escaped('%d', 'd', ...$defargs))-&gt;isSame(null);
// これは 2 である（"%" "d" という文字の列であるため（d の前の % は更にその前の % に呑まれておりメタ文字ではない））
that(strpos_escaped('%%d', 'd', ...$defargs))-&gt;isSame(2);

// これは 0 である（% をつけて検索するとそのエスケープシーケンス的なものそのものを探すため）
that(strpos_escaped('%d', '%d', ...$defargs))-&gt;isSame(0);
// これは null である（"%" "d" という文字の列であるため "%d" という文字は存在しない）
that(strpos_escaped('%%d', '%d', ...$defargs))-&gt;isSame(null);
// これは 2 である（"%" "%d" という文字の列であるため）
that(strpos_escaped('%%%d', '%d', ...$defargs))-&gt;isSame(2);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">探す文字</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$offset = 0</code></td>
<td>​<span class="summary">開始位置</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$escape = "\\"</code></td>
<td>​<span class="summary">エスケープ文字</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>&amp;$found = null</code></td>
<td>​<span class="summary">見つかった文字が格納される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?int</td>
<td>​<span class="summary">見つかった位置</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f2176b819d2b583654180b15e8a4d62359e947fa-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strpos_quoted()" class="anchor"></a>[F] strpos_quoted <small><span class="summary">クオートを考慮して strpos する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strpos_quoted.php#L8-L79" target="_blank">strpos_quoted.php#8~79</a></p>
</div>
<details>
<summary class="">クオートを考慮して strpos する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strpos_quoted(
    ?string|string $haystack,
    string|iterable $needle,
    int $offset = 0,
    string|array $enclosure = "'\"",
    string $escape = "\\",
    ?string &amp;$found = null
): ?int</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// クオート中は除外される
that(strpos_quoted('hello "this" is world', 'is'))-&gt;isSame(13);
// 開始位置やクオート文字は指定できる（5文字目以降の \* に囲まれていない hoge の位置を返す）
that(strpos_quoted('1:hoge, 2:*hoge*, 3:hoge', 'hoge', 5, '*'))-&gt;isSame(20);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​string|​iterable</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">位置を取得したい文字列</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$offset = 0</code></td>
<td>​<span class="summary">開始位置</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$enclosure = "'\""</code></td>
<td>​<span class="summary">囲い文字。この文字中にいる $from, $to 文字は走査外になる</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$escape = "\\"</code></td>
<td>​<span class="summary">エスケープ文字。この文字が前にある $from, $to 文字は走査外になる</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>&amp;$found = null</code></td>
<td>​<span class="summary">$needle の内、見つかった文字列が格納される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?int</td>
<td>​<span class="summary">$needle の位置</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b027c7d286de697c797df114112d413e17b54281-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strposr()" class="anchor"></a>[F] strposr <small><span class="summary">デフォで左探索な strrpos</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strposr.php#L7-L73" target="_blank">strposr.php#7~73</a></p>
</div>
<details>
<summary class="">デフォで左探索な strrpos</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strposr(
    string $haystack,
    string $needle,
    ?int $offset = null
): int|false</div></pre>
<div class="description">
<p>個人的に strrpos の offset の挙動が分かりにくい。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>offset&gt;=0</dt>
<dd>先頭から offset スキップ＋<strong>右探索</strong></dd>
</div>
<div class="dtdd-container">
<dt>offset&lt; 0</dt>
<dd>末尾から -offset スキップ＋<strong>左探索</strong></dd>
</div>
</dl>
<p>r と銘打っているんだから offset に依らずにデフォで左探索して欲しい。<span class="implicit-br">
</span>特に offset 未指定だと 0 なので「先頭から末尾まで読んで最後に見つかった場所を返す」という非常に非効率的なことになっている（実際の実装は違うようだけど）。<span class="implicit-br">
</span>さらに「単純に50文字目から左探索したい」だけなのに offset が気持ち悪いことになる（50 - strlen($string)）。<span class="implicit-br">
</span>要するに <a href="https://www.php.net/manual/ja/function.strrpos.php#76447" class="link-url">https://www.php.net/manual/ja/function.strrpos.php#76447</a> これ。</p>
<p>offset で検索文字列の途中に飛び込んだ場合は見つからないとみなす（strrpos は見つかったとみなす）。<span class="implicit-br">
</span>この挙動は説明しにくいので Example を参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">//        +0123456789A1234567
//        -7654321A9876543210
$string = 'hello hello hello';

// offset を省略すると末尾から左探索になる
that(strposr($string, 'hello'))-&gt;isSame(12);
// 標準の文字列関数のように負数で後ろからの探索になる
that(strposr($string, 'hello', -1))-&gt;isSame(6);
// 0文字目から左探索しても見つからない
that(strposr($string, 'hello', 0))-&gt;isSame(false);
// 5文字目から左探索すれば0文字目が引っかかる
that(strposr($string, 'hello', 5))-&gt;isSame(0);
// 13文字目から左探索すれば6文字目が引っかかる（13文字目は3個目の hello の途中なので2個目の hello から引っかかる）
that(strposr($string, 'hello', 13))-&gt;isSame(6);
// この動作は strrpos だと異なる（途中文字列も拾ってしまう）
that(strrpos($string, 'hello', -4))-&gt;isSame(12);
// そもそも strrpos は負数指定しないと右探索なので使いにくくてしょうがない
that(strrpos($string, 'hello', 5))-&gt;isSame(12);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">位置を取得したい文字列</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$offset = null</code></td>
<td>​<span class="summary">開始位置。 null を渡すと末尾からの探索になる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​false</td>
<td>​<span class="summary">見つかった位置</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1d4987a38a0e3ef46db1a4f679a4a711dd7fd29f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strrstr()" class="anchor"></a>[F] strrstr <small><span class="summary">文字列が最後に現れる位置以前を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strrstr.php#L7-L51" target="_blank">strrstr.php#7~51</a></p>
</div>
<details>
<summary class="">文字列が最後に現れる位置以前を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strrstr(
    ?string|string $haystack,
    ?string|string $needle,
    bool $after_needle = true
): ?string</div></pre>
<div class="description">
<p>strstr の逆のイメージで文字列を後ろから探索する動作となる。<span class="implicit-br">
</span>strstr の動作は「文字列を前から探索して指定文字列があったらそれ以後を返す」なので、<span class="implicit-br">
</span>その逆の動作の「文字列を後ろから探索して指定文字列があったらそれ以前を返す」という挙動を示す。</p>
<p>strstr の「needle が文字列でない場合は、 それを整数に変換し、その番号に対応する文字として扱います」は直感的じゃないので踏襲しない。<span class="implicit-br">
</span>（全体的にこの動作をやめよう、という RFC もあったはず）。</p>
<p>第3引数の意味合いもデフォルト値も逆になるので、単純に呼べばよくある「指定文字列より後ろを（指定文字列を含めないで）返す」という動作になる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// パス中の最後のディレクトリを取得
that(strrstr("path/to/1:path/to/2:path/to/3", ":"))-&gt;isSame('path/to/3');
// $after_needle を false にすると逆の動作になる
that(strrstr("path/to/1:path/to/2:path/to/3", ":", false))-&gt;isSame('path/to/1:path/to/2:');
// （参考）strrchr と違い、文字列が使えるしその文字そのものは含まれない
that(strrstr("A\r\nB\r\nC", "\r\n"))-&gt;isSame('C');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$haystack</code></td>
<td>​<span class="summary">調べる文字列</span></td>
</tr>
<tr>
<td>​?string|​string</td>
<td>​<code>$needle</code></td>
<td>​<span class="summary">検索文字列</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$after_needle = true</code></td>
<td>​<span class="summary">$needle より後ろを返すか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0f2cce8cbec7a6c9272dcb9971446ca1caa3834b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strtr_escaped()" class="anchor"></a>[F] strtr_escaped <small><span class="summary">エスケープを考慮して strtr する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/strings/strtr_escaped.php#L8-L51" target="_blank">strtr_escaped.php#8~51</a></p>
</div>
<details>
<summary class="">エスケープを考慮して strtr する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strtr_escaped(
    ?string|string $string,
    array $replace_pairs,
    string $escape = "\\"
): string</div></pre>
<div class="description">
<p>「エスケープ」についての詳細は strpos_escaped を参照。</p>
<p>$replace_pairs は [from =&gt; to] な配列を指定する。<span class="implicit-br">
</span>to がクロージャの場合はキーとオフセットでコールバックされる。</p>
<p>strtr と同様、最も長いキーから置換を行い、置換後の文字列は対象にならない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"># 分かりにくいので \ ではなく % をエスケープ文字とする
that(strtr_escaped('XYZ ab %% %s', [
    'ab'  =&gt; 'AB',  // 2. 1 で置換された文字は対象にならない
    'A'   =&gt; '%a',  // 使われない
    'Z'   =&gt; '%z',  // 使われない
    '%%'  =&gt; 'p',   // 普通に置換される
    's'   =&gt; 'S',   // エスケープが対象なので置換されない（%s は文字 "s" ではない（\n が文字 "n" ではないのと同じ））
    'XYZ' =&gt; 'abc', // 1. 後ろにあるがまず置換される
], '%'))-&gt;isSame('abc AB p %s');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string|​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">対象文字列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$replace_pairs</code></td>
<td>​<span class="summary">置換するペア</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$escape = "\\"</code></td>
<td>​<span class="summary">エスケープ文字</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">置換された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d1536ee991275a8d2e51d04bf605c9c6c51309da-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-syntax" class="anchor"></a>[N] ryunosuke\Functions\Package\syntax\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-22" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-syntax--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_e0318ecc79ab40d3a3e027a1c5272d450b5c9ac8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-blank_if()" class="anchor"></a>[F] blank_if <small><span class="summary">値が空なら null を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/blank_if.php#L8-L100" target="_blank">blank_if.php#8~100</a></p>
</div>
<details>
<summary class="">値が空なら null を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function blank_if(
    mixed $var,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p><code>is_empty($value) ? $value : null</code> とほぼ同じ。<span class="implicit-br">
</span>言ってしまえば「falsy な値を null に変換する」とも言える。</p>
<p>ここでいう falsy とは php 標準の <code>empty</code> ではなく本ライブラリの <code>is_empty</code> であることに留意（"0" は空ではない）。<span class="implicit-br">
</span>さらに利便性のため 0, 0.0 も空ではない判定をする（strpos や array_search などで「0 は意味のある値」という事が多いので）。<span class="implicit-br">
</span>乱暴に言えば「仮に文字列化したとき、情報量がゼロ」が falsy になる。</p>
<ul class=" simple">
<li>「 <code>$var ?: 'default'</code> で十分なんだけど "0" が…」</li>
<li>「 <code>$var ?? 'default'</code> で十分なんだけど false が…」</li>
</ul>
<p>という状況はまれによくあるはず。</p>
<p>?? との親和性のため null を返す動作がデフォルトだが、そのデフォルト値は引数で渡すこともできる。<span class="implicit-br">
</span>用途は Example を参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// falsy な値は null を返すので null 合体演算子でデフォルト値が得られる
that(blank_if(null) ?? 'default')-&gt;isSame('default');
that(blank_if('')   ?? 'default')-&gt;isSame('default');
// falsy じゃない値の場合は引数をそのまま返すので null 合体演算子には反応しない
that(blank_if(0)   ?? 'default')-&gt;isSame(0);   // 0 は空ではない
that(blank_if('0') ?? 'default')-&gt;isSame('0'); // "0" は空ではない
that(blank_if(1)   ?? 'default')-&gt;isSame(1);
that(blank_if('X') ?? 'default')-&gt;isSame('X');
// 第2引数で返る値を指定できるので下記も等価となる。ただし、php の仕様上第2引数が必ず評価されるため、関数呼び出しなどだと無駄な処理となる
that(blank_if(null, 'default'))-&gt;isSame('default');
that(blank_if('',   'default'))-&gt;isSame('default');
that(blank_if(0,    'default'))-&gt;isSame(0);
that(blank_if('0',  'default'))-&gt;isSame('0');
that(blank_if(1,    'default'))-&gt;isSame(1);
that(blank_if('X',  'default'))-&gt;isSame('X');
// 第2引数の用途は少し短く書けることと演算子の優先順位のつらみの回避程度（`??` は結構優先順位が低い。下記を参照）
that(0 &lt; blank_if(null) ?? 1)-&gt;isFalse();  // (0 &lt; null) ?? 1 となるので false
that(0 &lt; blank_if(null, 1))-&gt;isTrue();     // 0 &lt; 1 となるので true
that(0 &lt; (blank_if(null) ?? 1))-&gt;isTrue(); // ?? で同じことしたいならこのように括弧が必要

# ここから下は既存言語機構との比較（愚痴っぽいので読まなくてもよい）

// エルビス演算子は "0" にも反応するので正直言って使いづらい（php における falsy の定義は広すぎる）
that(null ?: 'default')-&gt;isSame('default');
that(''   ?: 'default')-&gt;isSame('default');
that(1    ?: 'default')-&gt;isSame(1);
that('0'  ?: 'default')-&gt;isSame('default'); // こいつが反応してしまう
that('X'  ?: 'default')-&gt;isSame('X');
// 逆に null 合体演算子は null にしか反応しないので微妙に使い勝手が悪い（php の標準関数が false を返したりするし）
that(null ?? 'default')-&gt;isSame('default'); // こいつしか反応しない
that(''   ?? 'default')-&gt;isSame('');
that(1    ?? 'default')-&gt;isSame(1);
that('0'  ?? 'default')-&gt;isSame('0');
that('X'  ?? 'default')-&gt;isSame('X');
// 恣意的な例だが、 array_search は false も 0 も返し得るので ?: は使えない。 null を返すこともないので ?? も使えない（エラーも吐かない）
that(array_search('a', ['a', 'b', 'c']) ?: 'default')-&gt;isSame('default'); // 見つかったのに 0 に反応するので 'default' になってしまう
that(array_search('x', ['a', 'b', 'c']) ?? 'default')-&gt;isSame(false);     // 見つからないので 'default' としたいが false になってしまう
// 要するに単に「見つからなかった場合に 'default' としたい」だけなんだが、下記のようにめんどくさいことをせざるを得ない
that(array_search('x', ['a', 'b', 'c']) === false ? 'default' : array_search('x', ['a', 'b', 'c']))-&gt;isSame('default'); // 3項演算子で2回呼ぶ
that(($tmp = array_search('x', ['a', 'b', 'c']) === false) ? 'default' : $tmp)-&gt;isSame('default');                      // 一時変数を使用する（あるいは if 文）
// このように書きたかった
that(blank_if(array_search('x', ['a', 'b', 'c'])) ?? 'default')-&gt;isSame('default'); // null 合体演算子版
that(blank_if(array_search('x', ['a', 'b', 'c']), 'default'))-&gt;isSame('default');   // 第2引数版</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">判定する値</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">空だった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">空なら $default, 空じゃないなら $var をそのまま返す</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7af85c29c0a8f4b9ec4a1e9ac621a741cf1b40cf-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cast()" class="anchor"></a>[F] cast <small><span class="summary">php の型変換に準じてキャストする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/cast.php#L8-L79" target="_blank">cast.php#8~79</a></p>
</div>
<details>
<summary class="">php の型変換に準じてキャストする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cast(
    mixed $value,
    string $type,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>「php の型変換」とは strict_type=0 の時の暗黙の変換を指す（(type)等のキャストではない）。<span class="implicit-br">
</span>eval で呼び出して判定するため、決して $type に外部入力を渡してはならない。</p>
<p>この関数を使うシチュエーションはほぼない。<span class="implicit-br">
</span>呼び先のためならそれを普通に呼べば同じエラーになるし、用途が分かっているなら通常のキャストで十分。<span class="implicit-br">
</span>「呼び先が型宣言されていない」とか「numeric であることを担保したい」とか、限られた状況でしか使えないし使うべきではない。<span class="implicit-br">
</span>通常の(type)キャストが強すぎる（特に int）のため、「エラーになってくれる弱いキャスト」のようなイメージ。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"># 下記のように変換される
that(cast("1", 'int'))-&gt;isSame(1);
that(cast(1, 'string'))-&gt;isSame('1');
that(cast(1, 'int|string'))-&gt;isSame(1);
that(cast([], 'array|ArrayAccess'))-&gt;isSame([]);
that(cast($ao = new \ArrayObject(), 'ArrayAccess&amp;Countable'))-&gt;isSame($ao);

# 下記はすべて TypeError になる
// cast("hoge", 'int');             // 非数値文字列 は int に変換できない
// cast([], 'string');              // array は string に変換できない
// cast(new \stdClass(), 'bool');   // object は bool に変換できない</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">取得される配列・オブジェクト</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$type</code></td>
<td>​<span class="summary">型文字列</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">失敗したときのデフォルト値（null も立派な値なので例外を飛ばすためには未指定時にしなければならない）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">キャストされた値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7e48d823c271d241582a19a6e7dbd4718b55d832-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-instance_of()" class="anchor"></a>[F] instance_of <small><span class="summary">instanceof 構文の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/instance_of.php#L7-L38" target="_blank">instance_of.php#7~38</a></p>
</div>
<details>
<summary class="">instanceof 構文の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function instance_of(
    T $object,
    string|object $class
): ?T</div></pre>
<div class="description">
<p>ただし、bool ではなく ?object を返す。<span class="implicit-br">
</span>つまり「instanceof が true ならそのまま、false なら null」を返す。<span class="implicit-br">
</span>これは ?-&gt; との親和性を考慮している。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php"> // 実質的に下記は同じ
$object = new \Exception('message');
that(($object instanceof \Exception ? $object : null)?-&gt;getMessage())-&gt;is('message');
that(instance_of($object, \Exception::class)?-&gt;getMessage())-&gt;is('message');

$object = new \stdClass();
that(($object instanceof \Exception ? $object : null)?-&gt;getMessage())-&gt;isNull();
that(instance_of($object, \Exception::class)?-&gt;getMessage())-&gt;isNull();
// Exception ではないが null でもないので下記のようにはできない
// $object?-&gt;getMessage();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--T">T</a></td>
<td>​<code>$object</code></td>
<td>​<span class="summary">調べるオブジェクト</span></td>
</tr>
<tr>
<td>​string|​object</td>
<td>​<code>$class</code></td>
<td>​<span class="summary">クラス名</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?<a href="#--T">T</a></td>
<td>​<span class="summary">$object が $class のインスタンスなら $object, そうでなければ null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6aae098dff4b344653230439cd69b5d5d79559fb-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-try_catch()" class="anchor"></a>[F] try_catch <small><span class="summary">try ～ catch 構文の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/try_catch.php#L8-L33" target="_blank">try_catch.php#8~33</a></p>
</div>
<details>
<summary class="">try ～ catch 構文の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function try_catch(
    callable $try,
    ?callable $catch = null,
    mixed ...$variadic
): \Exception|mixed</div></pre>
<div class="description">
<p>例外機構構文が冗長なことがまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 例外が飛ばない場合は平和極まりない
$try = function ($a, $b, $c) {return [$a, $b, $c];};
that(try_catch($try, null, 1, 2, 3))-&gt;isSame([1, 2, 3]);
// 例外が飛ぶ場合は特殊なことをしなければ例外オブジェクトが返ってくる
$try = function () {throw new \Exception('tried');};
that(try_catch($try)-&gt;getMessage())-&gt;isSame('tried');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$try</code></td>
<td>​<span class="summary">try ブロッククロージャ</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$catch = null</code></td>
<td>​<span class="summary">catch ブロッククロージャ</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">$try に渡る引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.exception.php" target="_blank">Exception</a>|​mixed</td>
<td>​<span class="summary">例外が飛ばなかったら $try ブロックの返り値、飛んだなら $catch の返り値（デフォルトで例外オブジェクト）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5c11ead8ce29ee1f4b1aca35fb49784fe2980767-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-try_catch_finally()" class="anchor"></a>[F] try_catch_finally <small><span class="summary">try ～ catch ～ finally 構文の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/try_catch_finally.php#L7-L56" target="_blank">try_catch_finally.php#7~56</a></p>
</div>
<details>
<summary class="">try ～ catch ～ finally 構文の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function try_catch_finally(
    callable $try,
    ?callable $catch = null,
    ?callable $finally = null,
    mixed ...$variadic
): \Exception|mixed</div></pre>
<div class="description">
<p>例外機構構文が冗長なことがまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$finally_count = 0;
$finally = function () use (&amp;$finally_count) {$finally_count++;};
// 例外が飛ぼうと飛ぶまいと $finally は実行される
$try = function ($a, $b, $c) {return [$a, $b, $c];};
that(try_catch_finally($try, null, $finally, 1, 2, 3))-&gt;isSame([1, 2, 3]);
that($finally_count)-&gt;isSame(1); // 呼ばれている
// 例外を投げるが、 $catch で握りつぶす
$try = function () {throw new \Exception('tried');};
that(try_catch_finally($try, null, $finally, 1, 2, 3)-&gt;getMessage())-&gt;isSame('tried');
that($finally_count)-&gt;isSame(2); // 呼ばれている</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$try</code></td>
<td>​<span class="summary">try ブロッククロージャ</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$catch = null</code></td>
<td>​<span class="summary">catch ブロッククロージャ</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$finally = null</code></td>
<td>​<span class="summary">finally ブロッククロージャ</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">$try に渡る引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.exception.php" target="_blank">Exception</a>|​mixed</td>
<td>​<span class="summary">例外が飛ばなかったら $try ブロックの返り値、飛んだなら $catch の返り値（デフォルトで例外オブジェクト）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c1599b36c81d5c36da12cd7e5ba05ef8de5c948b-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-try_close()" class="anchor"></a>[F] try_close <small><span class="summary">try ～ finally 構文の close 特化版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/try_close.php#L9-L122" target="_blank">try_close.php#9~122</a></p>
</div>
<details>
<summary class="">try ～ finally 構文の close 特化版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function try_close(
    $callback,
    object|resource|array ...$resources
): mixed</div></pre>
<div class="description">
<p>$try の呼び出し完了後に必ず close するようにする。<span class="implicit-br">
</span>C# の using, java の try-with-resource みたいなもの。</p>
<p>$resources 引数は [filename, mode], [filename =&gt; mode] のような配列を受け付け、中で fopen される。</p>
<p>resource 型を想定しているが、オブジェクトの場合は close, free, dispose あたりを試みる。<span class="implicit-br">
</span>このメソッド候補は互換性を問わず変更されることがある。<span class="implicit-br">
</span>そもそも、stream 以外のリソースや完全不透明クラスはオマケのようなもので完全サポートはしないし互換性も考慮しない。</p>
<p>close で例外が飛んだ場合は握りつぶされる。<span class="implicit-br">
</span>この握りつぶした例外を取得する方法は今のところ存在しない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(try_close(fn($fp, $string) =&gt; fwrite($fp, $string), $tmpfile = tmpfile(), 'test'))-&gt;is(4);
that(gettype($tmpfile))-&gt;is('resource (closed)'); // 閉じている</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​object|​resource|​array</td>
<td>​<code>...$resources</code></td>
<td>​<span class="summary">$try に渡る引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">$try ブロックの返り値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c40dd06fcc6cc5e994cb3e223b4b52bff43cc6ae-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-try_finally()" class="anchor"></a>[F] try_finally <small><span class="summary">try ～ finally 構文の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/try_finally.php#L8-L37" target="_blank">try_finally.php#8~37</a></p>
</div>
<details>
<summary class="">try ～ finally 構文の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function try_finally(
    callable $try,
    ?callable $finally = null,
    mixed ...$variadic
): \Exception|mixed</div></pre>
<div class="description">
<p>例外は投げっぱなす。例外機構構文が冗長なことがまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$finally_count = 0;
$finally = function () use (&amp;$finally_count) {$finally_count++;};
// 例外が飛ぼうと飛ぶまいと $finally は実行される
$try = function ($a, $b, $c) {return [$a, $b, $c];};
that(try_finally($try, $finally, 1, 2, 3))-&gt;isSame([1, 2, 3]);
that($finally_count)-&gt;isSame(1); // 呼ばれている
// 例外は投げっぱなすが、 $finally は実行される
$try = function () {throw new \Exception('tried');};
try {try_finally($try, $finally, 1, 2, 3);} catch(\Exception $e){}
that($finally_count)-&gt;isSame(2); // 呼ばれている</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$try</code></td>
<td>​<span class="summary">try ブロッククロージャ</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$finally = null</code></td>
<td>​<span class="summary">finally ブロッククロージャ</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">$try に渡る引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.exception.php" target="_blank">Exception</a>|​mixed</td>
<td>​<span class="summary">例外が飛ばなかったら $try ブロックの返り値、飛んだなら $catch の返り値（デフォルトで例外オブジェクト）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5c6ba1fa22e795816a2d1b3fe7e2b05d8c2f744e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-try_null()" class="anchor"></a>[F] try_null <small><span class="summary">例外を握りつぶす try 構文</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/try_null.php#L7-L36" target="_blank">try_null.php#7~36</a></p>
</div>
<details>
<summary class="">例外を握りつぶす try 構文</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function try_null(
    callable $try,
    mixed ...$variadic
): mixed</div></pre>
<div class="description">
<p>例外機構構文が冗長なことがまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 例外が飛ばない場合は平和極まりない
$try = function ($a, $b, $c) {return [$a, $b, $c];};
that(try_null($try, 1, 2, 3))-&gt;isSame([1, 2, 3]);
// 例外が飛ぶ場合は null が返ってくる
$try = function () {throw new \Exception('tried');};
that(try_null($try))-&gt;isSame(null);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$try</code></td>
<td>​<span class="summary">try ブロッククロージャ</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">$try に渡る引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">例外が飛ばなかったら $try ブロックの返り値、飛んだなら null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_385f93319db8d3fe0130a50303ec88497f110bb9-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-try_return()" class="anchor"></a>[F] try_return <small><span class="summary">例外が飛んだら例外オブジェクトを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/syntax/try_return.php#L7-L36" target="_blank">try_return.php#7~36</a></p>
</div>
<details>
<summary class="">例外が飛んだら例外オブジェクトを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function try_return(
    callable $try,
    mixed ...$variadic
): mixed</div></pre>
<div class="description">
<p>例外機構構文が冗長なことがまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 例外が飛ばない場合は平和極まりない
$try = function ($a, $b, $c) {return [$a, $b, $c];};
that(try_return($try, 1, 2, 3))-&gt;isSame([1, 2, 3]);
// 例外が飛ぶ場合は例外オブジェクトが返ってくる
$try = function () {throw new \Exception('tried');};
that(try_return($try))-&gt;IsInstanceOf(\Exception::class);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​callable</td>
<td>​<code>$try</code></td>
<td>​<span class="summary">try ブロッククロージャ</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$variadic</code></td>
<td>​<span class="summary">$try に渡る引数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">例外が飛ばなかったら $try ブロックの返り値、飛んだなら null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e5119b81215c845c3114a3bf5df663465e7ba529-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-url" class="anchor"></a>[N] ryunosuke\Functions\Package\url\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-23" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-url--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_b2fe576e44a882e9c5d63a7c2fbf19958077eb3a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-base62_decode()" class="anchor"></a>[F] base62_decode <small><span class="summary">数値とアルファベットで base62 デコードする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/base62_decode.php#L8-L42" target="_blank">base62_decode.php#8~42</a></p>
</div>
<details>
<summary class="">数値とアルファベットで base62 デコードする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function base62_decode(string $string): string</div></pre>
<div class="description">
<p>対で使うと思うので base62_encode を参照。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">base62 文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">変換元文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_c3af7297ea7d4177dc3262d8cfc54e6b3920cb2d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-base62_encode()" class="anchor"></a>[F] base62_encode <small><span class="summary">数値とアルファベットで base62 エンコードする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/base62_encode.php#L8-L56" target="_blank">base62_encode.php#8~56</a></p>
</div>
<details>
<summary class="">数値とアルファベットで base62 エンコードする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function base62_encode(string $string): string</div></pre>
<div class="description">
<p>あくまでエンコードであって引数は文字列として扱う。つまり数値の基数変換ではない。</p>
<p>base64 と違い、下記の特徴がある。</p>
<ul class=" simple">
<li>=パディングなし</li>
<li>記号が入らない（完全に URL セーフ）</li>
<li>ASCII 順（元の推移律が維持される）</li>
</ul>
<p>変換効率もあまり変わらないため、文字列が小さい間はほぼ base64_encode の上位互換に近い。<span class="implicit-br">
</span>ただし gmp が入っていないと猛烈に遅い。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(base62_encode('abcdefg'))-&gt;isSame('21XiSSifQN');
that(base62_decode('21XiSSifQN'))-&gt;isSame('abcdefg');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">変換元文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">base62 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1067877c97640bbf6cc4b6fcd12834d87929327f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-base64url_decode()" class="anchor"></a>[F] base64url_decode <small><span class="summary">url safe な base64_decode</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/base64url_decode.php#L7-L20" target="_blank">base64url_decode.php#7~20</a></p>
</div>
<details>
<summary class="">url safe な base64_decode</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function base64url_decode(string $string): string</div></pre>
<div class="description">
<p>対で使うと思うので base64_encode を参照。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">base64url 文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">変換元文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f6a8bf0a65cca40eb0f98c5ccefcdf4b825bc0ea-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-base64url_encode()" class="anchor"></a>[F] base64url_encode <small><span class="summary">url safe な base64_encode</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/base64url_encode.php#L7-L21" target="_blank">base64url_encode.php#7~21</a></p>
</div>
<details>
<summary class="">url safe な base64_encode</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function base64url_encode(string $string): string</div></pre>
<div class="description">
<p>れっきとした RFC があるのかは分からないが '+' =&gt; '-', '/' =&gt; '_' がデファクトだと思うのでそのようにしてある。<span class="implicit-br">
</span>パディングの = も外す。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$string</code></td>
<td>​<span class="summary">変換元文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">base64url 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a02586c10c591a046aac22932370cc81e225e262-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-dataurl_decode()" class="anchor"></a>[F] dataurl_decode <small><span class="summary">DataURL をデコードする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/dataurl_decode.php#L8-L65" target="_blank">dataurl_decode.php#8~65</a></p>
</div>
<details>
<summary class="">DataURL をデコードする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function dataurl_decode(
    string $url,
    array &amp;$metadata = []
): ?string</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(dataurl_decode("data:text/plain;charset=US-ASCII,hello%2C%20world"))-&gt;isSame('hello, world');
that(dataurl_decode("data:text/plain;charset=US-ASCII;base64,aGVsbG8sIHdvcmxk", $metadata))-&gt;isSame('hello, world');
that($metadata)-&gt;is([
    "mimetype" =&gt; "text/plain",
    "charset"  =&gt; "US-ASCII",
    "base64"   =&gt; true,
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$url</code></td>
<td>​<span class="summary">DataURL</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>&amp;$metadata = []</code></td>
<td>​<span class="summary">スキームのメタ情報が格納される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">元データ。失敗時は null</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8abc4896377cbcf9b2e542613f7adf679478cc6c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-dataurl_encode()" class="anchor"></a>[F] dataurl_encode <small><span class="summary">DataURL をエンコードする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/dataurl_encode.php#L7-L67" target="_blank">dataurl_encode.php#7~67</a></p>
</div>
<details>
<summary class="">DataURL をエンコードする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function dataurl_encode(
    string $data,
    array $metadata = []
): string</div></pre>
<div class="description">
<p>$metadata で mimetype や エンコード等を指定できる。<span class="implicit-br">
</span>指定されていない場合、自動検出して埋め込まれる。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>mimetype(?string)</dt>
<dd>特筆無し</dd>
</div>
<div class="dtdd-container">
<dt>charset(?string)</dt>
<dd>自動検出は mime 名になる。明示指定はそのまま埋め込まれる</dd>
</div>
<div class="dtdd-container">
<dt>base64(?bool)</dt>
<dd>true:base64encode, false:urlencode, null: raw<ul class=" simple">
<li>null の raw はスキームとしては base64 となる。つまり既に base64 の文字列が手元にある場合（変換したくない場合）に指定する</li>
</ul>
</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(dataurl_encode("hello, world", ['base64' =&gt; false]))-&gt;isSame("data:text/plain;charset=US-ASCII,hello%2C%20world");
that(dataurl_encode("hello, world", ['mimetype' =&gt; 'text/csv', 'charset' =&gt; 'hoge']))-&gt;isSame("data:text/csv;charset=hoge;base64,aGVsbG8sIHdvcmxk");</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$data</code></td>
<td>​<span class="summary">エンコードするデータ</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$metadata = []</code></td>
<td>​<span class="summary">エンコードオプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">DataURL</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a62d5c553d0cfde2a8c2abc6b74d76025375ab5e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-formdata_build()" class="anchor"></a>[F] formdata_build <small><span class="summary">multipart/formdata の構築</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/formdata_build.php#L9-L121" target="_blank">formdata_build.php#9~121</a></p>
</div>
<details>
<summary class="">multipart/formdata の構築</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function formdata_build(
    array $formdata,
    ?string &amp;$boundary = null,
    ?\Closure $encoder = null
): string</div></pre>
<div class="description">
<p>$boundary 未指定時はランダム文字列が生成され、衝突した場合は無限にリトライされる。<span class="implicit-br">
</span>SplFileInfo はファイルとみなされるが $encoder を指定すれば CURLFile なども活用可能。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$file = sys_get_temp_dir() . '/upload.txt';
file_put_contents($file, 'plain');

$boundary = 'hogefugapiyo';
that(formdata_build([
    'n' =&gt; ['e' =&gt; ['s' =&gt; ['t' =&gt; 'nest']]],
    'f' =&gt; new \SplFileInfo($file),
], $boundary))-&gt;is(strtr(&lt;&lt;&lt;FORMDATA
--hogefugapiyo
Content-Disposition: form-data; name="n[e][s][t]"

nest
--hogefugapiyo
Content-Disposition: form-data; name="f"; filename="upload.txt"
Content-Type: text/plain

plain
--hogefugapiyo--
FORMDATA, ["\n" =&gt; "\r\n"]));</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$formdata</code></td>
<td>​<span class="summary">フォームデータ配列</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>&amp;$boundary = null</code></td>
<td>​<span class="summary">バウンダリ文字列初期値兼レシーバ引数</span></td>
</tr>
<tr>
<td>​?<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$encoder = null</code></td>
<td>​<span class="summary">値のエンコーダだが実質的にファイルの検出に使う（デフォルトでは SplFileInfo がファイルと認識される）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">フォームデータ文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_5274b6b7cbe3f7d0bc478ce0781150b430a395f4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-formdata_parse()" class="anchor"></a>[F] formdata_parse <small><span class="summary">multipart/formdata のパース</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/formdata_parse.php#L9-L76" target="_blank">formdata_parse.php#9~76</a></p>
</div>
<details>
<summary class="">multipart/formdata のパース</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function formdata_parse(
    string $formdata,
    ?string $boundary = null,
    ?\Closure $decoder = null
): array</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$data = formdata_parse(&lt;&lt;&lt;FORMDATA
--hogefugapiyo
Content-Disposition: form-data; name="n[e][s][t]"

nest
--hogefugapiyo
Content-Disposition: form-data; name="f"; filename="upload.txt"
Content-Type: text/plain

plain
--hogefugapiyo--
FORMDATA);

that($data['n']['e']['s']['t'])-&gt;is('nest');
that($data['f'])-&gt;isInstanceOf(\SplFileInfo::class);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$formdata</code></td>
<td>​<span class="summary">フォームデータ文字列</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$boundary = null</code></td>
<td>​<span class="summary">バウンダリ文字列。省略時は1行目から推測する</span></td>
</tr>
<tr>
<td>​?<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$decoder = null</code></td>
<td>​<span class="summary">値のデコーダだが実質的にファイルの検出に使う（デフォルトでは一時ファイルの SplFileInfo で返す）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">フォームデータ配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_38bdaa7501a0dcfde862e94ce91921b9a6d5f30d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-query_build()" class="anchor"></a>[F] query_build <small><span class="summary">数値キーを削除する http_build_query</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/query_build.php#L8-L92" target="_blank">query_build.php#8~92</a></p>
</div>
<details>
<summary class="">数値キーを削除する http_build_query</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function query_build(
    array|object $data,
    string|int|null $numeric_prefix = null,
    string|null $arg_separator = null,
    int $encoding_type = PHP_QUERY_RFC1738,
    string[]|string|null $brackets = null
): string</div></pre>
<div class="description">
<p>php の世界において配列のクエリ表現は <code>var[]=1&amp;var[]=2</code> で事足りる。<span class="implicit-br">
</span>しかし http_build_query では数値キーでも必ず <code>var[0]=1&amp;var[1]=2</code> になる。<span class="implicit-br">
</span>それはそれで正しいし、他言語との連携が必要な場合はそうせざるを得ない状況もあるが、単純に php だけで配列を表したい場合は邪魔だし文字長が長くなる。<span class="implicit-br">
</span>この関数を使うと数値キーを削除し、<code>var[]=1&amp;var[]=2</code> のようなクエリ文字列を生成できる。</p>
<p>シグネチャは http_build_query と同じで、 $numeric_prefix に数値的文字列を与えたときのみ動作が変化する。<span class="implicit-br">
</span>（$numeric_prefix の意味を考えればこの引数に数値的文字列を与える意味は皆無だろうので流用している）。</p>
<ul class=" simple">
<li>1 を与えると最前列を残して [] (%5B%5D) が置換される</li>
<li>2 を与えると最前列とその右を残して [] (%5B%5D) が置換される</li>
<li>要するに正数を与えると「abs(n) 個を残して [] (%5B%5D) を置換する」という指定になる</li>
<li>-1 を与えると最後尾の [] (%5B%5D) が置換される</li>
<li>-2 を与えると最後尾とその左の [] (%5B%5D) が置換される</li>
<li>要するに負数を与えると「右から abs(n) 個の [] (%5B%5D) を置換する」という指定になる</li>
</ul>
<p>この仕様は <code>v[][]=1&amp;v[][]=2</code> のようなときにおいしくないためである。<span class="implicit-br">
</span>これは <code>$v=[[1], [2]]</code> のような値になるが、この場合 <code>$v=[[1, 2]]</code> という値が欲しい、という事が多い。<span class="implicit-br">
</span>そのためには <code>v[0][]=1&amp;v[0][]=2</code> のようにする必要があるための数値指定である。</p>
<p>$brackets で配列ブラケット文字を指定できるが、現実的には下記の3択だろう。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>['%5B','%5D']</dt>
<dd>デフォルトのパーセントエンコーディング文字</dd>
</div>
<div class="dtdd-container">
<dt>['[', ']']</dt>
<dd>[] のままにする（ブラケットは必ずしもパーセントエンコーディングが必須ではない）</dd>
</div>
<div class="dtdd-container">
<dt>['', '']</dt>
<dd>ブラケットを削除する（他言語のために配列パラメータを抑止したいことがある）</dd>
</div>
</dl>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​object</td>
<td>​<code>$data</code></td>
<td>​<span class="summary">クエリデータ</span></td>
</tr>
<tr>
<td>​string|​int|​null</td>
<td>​<code>$numeric_prefix = null</code></td>
<td>​<span class="summary">数値キープレフィックス</span></td>
</tr>
<tr>
<td>​string|​null</td>
<td>​<code>$arg_separator = null</code></td>
<td>​<span class="summary">クエリセパレータ</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$encoding_type = PHP_QUERY_RFC1738</code></td>
<td>​<span class="summary">エンコードタイプ</span></td>
</tr>
<tr>
<td>​string[]|​string|​null</td>
<td>​<code>$brackets = null</code></td>
<td>​<span class="summary">配列ブラケット文字</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">クエリ文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f0320c95bbe1ca1b3000a9f58f7b6597fe910125-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-query_parse()" class="anchor"></a>[F] query_parse <small><span class="summary">parse_str の返り値版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/query_parse.php#L8-L85" target="_blank">query_parse.php#8~85</a></p>
</div>
<details>
<summary class="">parse_str の返り値版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function query_parse(
    string $query,
    ?string $arg_separator = null,
    ?int $encoding_type = null
): array</div></pre>
<div class="description">
<p>標準の parse_str は参照で受ける謎シグネチャなのでそれを返り値に変更したもの。<span class="implicit-br">
</span>と同時に parse_str はドットやスペースをアンダースコアに置換するため、それを避ける独自実装がある。<span class="implicit-br">
</span>$arg_separator や $encoding_type を指定すると独自実装で動きかつその引数の挙動でパースされる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 普通に使えばネイティブの返り値版
that(query_parse('a.b=ab&amp;x[y][z]=xyz'))-&gt;is([
    'a_b' =&gt; 'ab',
    'x'   =&gt; ['y' =&gt; ['z' =&gt; 'xyz']],
]);
// パラメータを渡せば独自実装（&amp; 以外を指定できたり . を維持できたりする）
that(query_parse('a.b=ab|x[y][z]=xyz', '|'))-&gt;is([
    'a.b' =&gt; 'ab',
    'x'   =&gt; ['y' =&gt; ['z' =&gt; 'xyz']],
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$query</code></td>
<td>​<span class="summary">クエリ文字列</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$arg_separator = null</code></td>
<td>​<span class="summary">クエリ文字列</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$encoding_type = null</code></td>
<td>​<span class="summary">クエリ文字列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">クエリのパース結果配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_babc73e6955c2da10d76c34a96840744060fd4d0-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-uri_build()" class="anchor"></a>[F] uri_build <small><span class="summary">parse_uri の逆</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/uri_build.php#L9-L88" target="_blank">uri_build.php#9~88</a></p>
</div>
<details>
<summary class="">parse_uri の逆</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function uri_build(
    array $parts,
    array $options = []
): string</div></pre>
<div class="description">
<p>URI のパーツを与えると URI として構築する。<span class="implicit-br">
</span>パーツは不完全でも良い。例えば scheme を省略すると "://" すら付かない URI が生成される。</p>
<p>"query" パートだけは配列が許容される。その場合クエリ文字列に変換される。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 完全指定
that(uri_build([
    'scheme'   =&gt; 'http',
    'user'     =&gt; 'user',
    'pass'     =&gt; 'pass',
    'host'     =&gt; 'localhost',
    'port'     =&gt; '80',
    'path'     =&gt; '/path/to/file',
    'query'    =&gt; ['id' =&gt; 1],
    'fragment' =&gt; 'hash',
]))-&gt;isSame('http://user:pass@localhost:80/path/to/file?id=1#hash');
// 一部だけ指定
that(uri_build([
    'scheme'   =&gt; 'http',
    'host'     =&gt; 'localhost',
    'path'     =&gt; '/path/to/file',
    'fragment' =&gt; 'hash',
]))-&gt;isSame('http://localhost/path/to/file#hash');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<code>$parts</code></td>
<td>​<span class="summary">URI の各パーツ配列</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">URI 文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2a18277cf5942b71832e70820470f0e0810f97a3-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-uri_parse()" class="anchor"></a>[F] uri_parse <small><span class="summary">parse_url の仕様を少しいじったもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/url/uri_parse.php#L10-L105" target="_blank">uri_parse.php#10~105</a></p>
</div>
<details>
<summary class="">parse_url の仕様を少しいじったもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function uri_parse(
    string $uri,
    array|string $default = []
): array</div></pre>
<div class="description">
<p>parse_url とは下記が異なる。</p>
<ul class=" simple">
<li>"単一文字列" はホスト名とみなされる（parse_url はパスとみなされる）</li>
<li>パートがなくてもキー自体は生成される（そしてその値は $default で指定したもの）</li>
<li>query は配列で返す（parse_str される）</li>
<li>パート値をスカラー値で返すことはできない（必ず8要素の配列を返す）</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 完全指定
that(uri_parse('http://user:pass@localhost:80/path/to/file?id=1#hash'))-&gt;is([
    'scheme'   =&gt; 'http',
    'user'     =&gt; 'user',
    'pass'     =&gt; 'pass',
    'host'     =&gt; 'localhost',
    'port'     =&gt; '80',
    'path'     =&gt; '/path/to/file',
    'query'    =&gt; ['id' =&gt; 1],
    'fragment' =&gt; 'hash',
]);
// デフォルト値つき
that(uri_parse('localhost/path/to/file', [
    'scheme'   =&gt; 'http', // scheme のデフォルト値
    'user'     =&gt; 'user', // user のデフォルト値
    'port'     =&gt; '8080', // port のデフォルト値
    'host'     =&gt; 'hoge', // host のデフォルト値
]))-&gt;is([
    'scheme'   =&gt; 'http',      // scheme はないのでデフォルト値が使われている
    'user'     =&gt; 'user',      // user はないのでデフォルト値が使われている
    'pass'     =&gt; '',
    'host'     =&gt; 'localhost', // host はあるのでデフォルト値が使われていない
    'port'     =&gt; '8080',      // port はないのでデフォルト値が使われている
    'path'     =&gt; '/path/to/file',
    'query'    =&gt; [],
    'fragment' =&gt; '',
]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$uri</code></td>
<td>​<span class="summary">パースする URI</span></td>
</tr>
<tr>
<td>​array|​string</td>
<td>​<code>$default = []</code></td>
<td>​<span class="summary">$uri に足りないパーツがあった場合のデフォルト値。文字列を与えた場合はそのパース結果がデフォルト値になる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">URI の各パーツ配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_8e258ca9fb77e6f1f99619dc7abcb9dfb1781924-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-utility" class="anchor"></a>[N] ryunosuke\Functions\Package\utility\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-24" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-utility--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_0da5d69b53e2f6254eca0e8e1074940c58dc9318-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-benchmark()" class="anchor"></a>[F] benchmark <small><span class="summary">簡易ベンチマークを取る</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/benchmark.php#L16-L227" target="_blank">benchmark.php#16~227</a></p>
</div>
<details>
<summary class="">簡易ベンチマークを取る</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function benchmark(
    array|callable $suite,
    array $args = [],
    int $millisec = 1000,
    bool $output = true
): array</div></pre>
<div class="description">
<p>「指定ミリ秒内で何回コールできるか？」でベンチする。<span class="implicit-br">
</span>メモリ使用量も取れるが ticks を利用しているのであまり正確ではないし、モノによっては計測できない（バージョンアップで memory_reset_peak_usage に変更される）。</p>
<p>$suite は ['表示名' =&gt; $callable] 形式の配列。<span class="implicit-br">
</span>表示名が与えられていない場合、それらしい名前で表示する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// intval と int キャストはどちらが早いか調べる
benchmark([
    'intval',
    'intcast' =&gt; fn($v) =&gt; (int) $v,
], ['12345'], 10);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​callable</td>
<td>​<code>$suite</code></td>
<td>​<span class="summary">ベンチ対象処理</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$args = []</code></td>
<td>​<span class="summary">各ケースに与えられる引数</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$millisec = 1000</code></td>
<td>​<span class="summary">呼び出しミリ秒</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$output = true</code></td>
<td>​<span class="summary">true だと標準出力に出力される</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">ベンチ結果の配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_ac6ca8b554cc7a4619113204df8a35f994009055-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-built_in_server()" class="anchor"></a>[F] built_in_server <small><span class="summary">ビルトインサーバーを起動する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/built_in_server.php#L14-L103" target="_blank">built_in_server.php#14~103</a></p>
</div>
<details>
<summary class="">ビルトインサーバーを起動する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function built_in_server(
    string $document_root,
    string|callable $router = null,
    array $options = []
): ProcessAsync|object</div></pre>
<div class="description">
<p>単に別プロセスで php -S するだけなので本番では使用してはならない。<span class="implicit-br">
</span>少し小細工として下記を実装してある。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>$router</dt>
<dd>クロージャを渡せる</dd>
</div>
<div class="dtdd-container">
<dt>$options['last-modified']</dt>
<dd>true にすると存在するファイルの 304 キャッシュが有効になる</dd>
</div>
</dl>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$document_root</code></td>
<td>​<span class="summary">公開ディレクトリ兼カレントディレクトリ</span></td>
</tr>
<tr>
<td>​string|​callable</td>
<td>​<code>$router = null</code></td>
<td>​<span class="summary">ルータースクリプト or クロージャ</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--ProcessAsync">ProcessAsync</a>|​object</td>
<td>​<span class="summary">プロセスオブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_3d504873ab283588b47d1b86411bf040a9c732ba-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cache()" class="anchor"></a>[F] cache <small><span class="summary">シンプルにキャッシュする</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><span class="badge alert" data-badge-title="">deprecated </span><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/cache.php#L8-L148" target="_blank">cache.php#8~148</a></p>
</div>
<details>
<summary class="">シンプルにキャッシュする</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cache(
    string $key,
    ?callable $provider,
    ?string $namespace = null
): mixed</div></pre>
<div class="description">
<p>この関数は get/set/delete を兼ねる。<span class="implicit-br">
</span>キャッシュがある場合はそれを返し、ない場合は $provider を呼び出してその結果をキャッシュしつつそれを返す。</p>
<p>$provider に null を与えるとキャッシュの削除となる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$provider = fn() =&gt; rand();
// 乱数を返す処理だが、キャッシュされるので同じ値になる
$rand1 = cache('rand', $provider);
$rand2 = cache('rand', $provider);
that($rand1)-&gt;isSame($rand2);
// $provider に null を与えると削除される
cache('rand', null);
$rand3 = cache('rand', $provider);
that($rand1)-&gt;isNotSame($rand3);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">キャッシュのキー</span></td>
</tr>
<tr>
<td>​?callable</td>
<td>​<code>$provider</code></td>
<td>​<span class="summary">キャッシュがない場合にコールされる callable</span></td>
</tr>
<tr>
<td>​?string</td>
<td>​<code>$namespace = null</code></td>
<td>​<span class="summary">名前空間</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">キャッシュ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_f87d1ee71d330913a392b46a264300fe5233d8bd-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cache_fetch()" class="anchor"></a>[F] cache_fetch <small><span class="summary">psr-16 cache で「無かったらコールバックを実行して set」する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/cache_fetch.php#L7-L26" target="_blank">cache_fetch.php#7~26</a></p>
</div>
<details>
<summary class="">psr-16 cache で「無かったらコールバックを実行して set」する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cache_fetch(
    Psr\SimpleCache\CacheInterface $cacher,
    string $key,
    callable $provider,
    ?int $ttl = null
): mixed</div></pre>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--Psr-SimpleCache-CacheInterface">CacheInterface</a></td>
<td>​<code>$cacher</code></td>
<td>​<span class="summary">キャッシュオブジェクト</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">キャッシュキー</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$provider</code></td>
<td>​<span class="summary">データプロバイダ</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$ttl = null</code></td>
<td>​<span class="summary">キャッシュ時間</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">キャッシュデータ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_e740be253341ff00cfd058828c47a63071714438-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cacheobject()" class="anchor"></a>[F] cacheobject <small><span class="summary">psr-16 を実装したキャッシュオブジェクトを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/cacheobject.php#L15-L382" target="_blank">cacheobject.php#15~382</a></p>
</div>
<details>
<summary class="">psr-16 を実装したキャッシュオブジェクトを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cacheobject(
    ?string $directory = null,
    float $clean_probability = 0,
    ?float $clean_execution_time = null
): Cacheobject</div></pre>
<div class="description">
<p>このオブジェクトはあくまで「他のパッケージに依存したくない」場合のデフォルト実装としての使用を想定している。</p>
<ul class=" simple">
<li>キャッシュはファイルシステムに保存される</li>
<li>キャッシュキーの . はディレクトリ区切りとして使用される</li>
<li>TTL を指定しなかったときのデフォルト値は約100年（実質無期限だろう）</li>
<li>psr-16 にはない getOrSet(fetch) が生えている（利便性が非常に高く使用頻度が多いため）</li>
</ul>
<p>性質上、参照されない期限切れキャッシュが溜まり続けるが $clean_probability を渡すと一定確率で削除される。<span class="implicit-br">
</span>さらに $clean_execution_time を指定すると削除の実行時間が制限される。<span class="implicit-br">
</span>$clean_probability は 1 が 100%（必ず削除）、 0 が 0%（削除しない）である。<span class="implicit-br">
</span>削除処理は軽くはないため高頻度な実行は避けなければならない。<span class="implicit-br">
</span>clean メソッドが生えているので明示的に呼ぶことも可能。</p>
<p>psr/simple-cache （\Psr\SimpleCache\CacheInterface）が存在するなら implement される。<span class="implicit-br">
</span>存在しないなら素の無名クラスで返す。<span class="implicit-br">
</span>動作に違いはないが instanceoof や class_implements に違いが出てくるので注意。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<code>$directory = null</code></td>
<td>​<span class="summary">キャッシュ保存ディレクトリ</span></td>
</tr>
<tr>
<td>​float</td>
<td>​<code>$clean_probability = 0</code></td>
<td>​<span class="summary">不要キャッシュの削除確率</span></td>
</tr>
<tr>
<td>​?float</td>
<td>​<code>$clean_execution_time = null</code></td>
<td>​<span class="summary">不要キャッシュの最大実行時間</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="#--Cacheobject">Cacheobject</a></td>
<td>​<span class="summary">psr-16 実装オブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d1e48c838c915f3721958049eadc60d0a48e0a38-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-function_configure()" class="anchor"></a>[F] function_configure <small><span class="summary">本ライブラリの設定を行う</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/function_configure.php#L8-L87" target="_blank">function_configure.php#8~87</a></p>
</div>
<details>
<summary class="">本ライブラリの設定を行う</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function function_configure(array|?string $option): array|string</div></pre>
<div class="description">
<p>各関数の挙動を変えたり、デフォルトオプションを設定できる。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​?string</td>
<td>​<code>$option</code></td>
<td>​<span class="summary">設定。文字列指定時はその値を返す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array|​string</td>
<td>​<span class="summary">設定値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6d93355502c0320aad97cbb170ce20df59c81a08-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-function_resolve()" class="anchor"></a>[F] function_resolve <small><span class="summary">本ライブラリの関数名を解決する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/function_resolve.php#L7-L30" target="_blank">function_resolve.php#7~30</a></p>
</div>
<details>
<summary class="">本ライブラリの関数名を解決する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function function_resolve(string $funcname): ?string</div></pre>
<div class="description">
<p>※ 内部向け</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$funcname</code></td>
<td>​<span class="summary">関数名</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary">FQSEN 名</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_08637a75c171f89f54ef58217520cbf28bb8bf85-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-json_storage()" class="anchor"></a>[F] json_storage <small><span class="summary">キーが json 化されてファイルシステムに永続化される ArrayAccess を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/json_storage.php#L11-L149" target="_blank">json_storage.php#11~149</a></p>
</div>
<details>
<summary class="">キーが json 化されてファイルシステムに永続化される ArrayAccess を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function json_storage(
    string $prefix = "global",
    int $ttl = ryunosuke\Functions\Package\PHP_INT_MAX
): \ArrayObject</div></pre>
<div class="description">
<p>非常にシンプルで PSR-16 も実装せず、クリア手段も（基本的には）存在しない。<span class="implicit-br">
</span>ArrayAccess なので <code>$storage['hoge'] ??= something()</code> として使うのがほぼ唯一の利用法。<span class="implicit-br">
</span>その仕様・利用上、値として null を使用することはできない（使用した場合の動作は未定義とする）。</p>
<p>キーに指定できるのは json_encode 可能なもののみ。<span class="implicit-br">
</span>値に指定できるのは var_export 可能なもののみ。<span class="implicit-br">
</span>上記以外を与えたときの動作は未定義。<span class="implicit-br">
</span>TTL を指定すると次回読み込み時に期限切れをチェックし、切れていた場合 null を返す。<span class="implicit-br">
</span>一度読み込まれればそのリクエスト中は期限切れになることはない。</p>
<p>得てして簡単な関数・メソッドのメモ化や内部的なキャッシュに使用する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// ??= を使えば「無かったら値を、有ったらそれを」を単純に実現できる
$storage = json_storage();
that($storage['key'] ??= (fn() =&gt; 123)())-&gt;is(123);
that($storage['key'] ??= (fn() =&gt; 456)())-&gt;is(123);
// 引数に与えた prefix で別空間になる
$storage = json_storage('other');
that($storage['key'] ??= (fn() =&gt; 789)())-&gt;is(789);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$prefix = "global"</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$ttl = ryunosuke\Functions\Package\PHP_INT_MAX</code></td>
<td>​<span class="summary">TTL</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​<a href="https://php.net/manual/class.arrayobject.php" target="_blank">ArrayObject</a></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b1441befdd6f1cb6d9530017e7ae3ac78d52b6fc-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-number_serial()" class="anchor"></a>[F] number_serial <small><span class="summary">連続した数値の配列を縮めて返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/utility/number_serial.php#L9-L79" target="_blank">number_serial.php#9~79</a></p>
</div>
<details>
<summary class="">連続した数値の配列を縮めて返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function number_serial(
    iterable|array $numbers,
    int|float $step = 1,
    string|null|\Closure $separator = null,
    bool $doSort = true
): array</div></pre>
<div class="description">
<p>例えば <code>[1, 2, 4, 6, 7, 9]</code> が <code>['1~2', 4, '6~7', 9]</code> になる。<span class="implicit-br">
</span>結合法則は指定可能（上記は "~" を指定したもの）。<span class="implicit-br">
</span>null を与えると配列の配列で返すことも可能。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 単純に文字列指定
that(number_serial([1, 2, 4, 6, 7, 9], 1, '~'))-&gt;is(['1~2', 4, '6~7', 9]);
// null を与えると from, to の配列で返す
that(number_serial([1, 2, 4, 6, 7, 9], 1, null))-&gt;is([[1, 2], [4, 4], [6, 7], [9, 9]]);
// $step は負数・小数・逆順も対応している（正負でよしなにソートされる）
that(number_serial([-9, 0.2, 0.5, -0.3, 0.1, 0, -0.2, 9], -0.1, '~'))-&gt;is([9, 0.5, '0.2~0', '-0.2~-0.3', -9]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​iterable|​array</td>
<td>​<code>$numbers</code></td>
<td>​<span class="summary">数値配列</span></td>
</tr>
<tr>
<td>​int|​float</td>
<td>​<code>$step = 1</code></td>
<td>​<span class="summary">連続とみなすステップ。負数を指定すれば逆順指定にも使える</span></td>
</tr>
<tr>
<td>​string|​null|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$separator = null</code></td>
<td>​<span class="summary">連続列を結合する文字列（string: 文字結合、null: 配列、Closure: 2引数が渡ってくる）</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$doSort = true</code></td>
<td>​<span class="summary">ソートをするか否か。事前にソート済みであることが明らかであれば false の方が良い</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">連続値をまとめた配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_28914961b87a71417c562e0b6e256adaa4cb695e-1" class="section section-level-h2" data-section-level="2"><h2 class="section-header"><a id="ryunosuke-Functions-Package-var" class="anchor"></a>[N] ryunosuke\Functions\Package\var\ <small><span class="summary"></span></small></h2>
</section><section id="_819cf95d4d38b57293d94a4f4938e69043abd716-25" class="section section-level-h3" data-section-level="3"><h3 class="section-header"><a id="ryunosuke-Functions-Package-var--functions" class="anchor"></a>[F] functions</h3>
</section><section id="_eaccad915f12ef975c8bead39f87d54ce73835ea-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-arrayable_key_exists()" class="anchor"></a>[F] arrayable_key_exists <small><span class="summary">配列・ArrayAccess にキーがあるか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/arrayable_key_exists.php#L9-L48" target="_blank">arrayable_key_exists.php#9~48</a></p>
</div>
<details>
<summary class="">配列・ArrayAccess にキーがあるか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function arrayable_key_exists(
    string|int $key,
    array|\ArrayAccess $arrayable
): bool</div></pre>
<div class="description">
<p>配列が与えられた場合は array_key_exists と同じ。<span class="implicit-br">
</span>ArrayAccess は一旦 isset で確認した後 null の場合は実際にアクセスして試みる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    'k' =&gt; 'v',
    'n' =&gt; null,
];
// 配列は array_key_exists と同じ
that(arrayable_key_exists('k', $array))-&gt;isTrue();  // もちろん存在する
that(arrayable_key_exists('n', $array))-&gt;isTrue();  // isset ではないので null も true
that(arrayable_key_exists('x', $array))-&gt;isFalse(); // 存在しないので false
that(isset($array['n']))-&gt;isFalse();                // isset だと null が false になる（参考）

$object = new \ArrayObject($array);
// ArrayAccess は isset + 実際に取得を試みる
that(arrayable_key_exists('k', $object))-&gt;isTrue();  // もちろん存在する
that(arrayable_key_exists('n', $object))-&gt;isTrue();  // isset ではないので null も true
that(arrayable_key_exists('x', $object))-&gt;isFalse(); // 存在しないので false
that(isset($object['n']))-&gt;isFalse();                // isset だと null が false になる（参考）</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​int</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">キー</span></td>
</tr>
<tr>
<td>​array|​<a href="https://php.net/manual/class.arrayaccess.php" target="_blank">ArrayAccess</a></td>
<td>​<code>$arrayable</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">キーが存在するなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_329fb2a6132a33ed759741a9069bd365cb9aa59a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-arrayval()" class="anchor"></a>[F] arrayval <small><span class="summary">array キャストの関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/arrayval.php#L8-L57" target="_blank">arrayval.php#8~57</a></p>
</div>
<details>
<summary class="">array キャストの関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function arrayval(
    mixed $var,
    bool $recursive = true
): array</div></pre>
<div class="description">
<p>intval とか strval とかの array 版。<span class="implicit-br">
</span>ただキャストするだけだが、関数なのでコールバックとして使える。</p>
<p>$recursive を true にすると再帰的に適用する（デフォルト）。<span class="implicit-br">
</span>入れ子オブジェクトを配列化するときなどに使える。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// キャストなので基本的には配列化される
that(arrayval(123))-&gt;isSame([123]);
that(arrayval('str'))-&gt;isSame(['str']);
that(arrayval([123]))-&gt;isSame([123]); // 配列は配列のまま

// $recursive = false にしない限り再帰的に適用される
$stdclass = (object) ['key' =&gt; 'val'];
that(arrayval([$stdclass], true))-&gt;isSame([['key' =&gt; 'val']]); // true なので中身も配列化される
that(arrayval([$stdclass], false))-&gt;isSame([$stdclass]);       // false なので中身は変わらない</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">array 化する値</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$recursive = true</code></td>
<td>​<span class="summary">再帰的に行うなら true</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">array 化した配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7e80b52360469a27207877ea44f9dfc9cc757521-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-attr_exists()" class="anchor"></a>[F] attr_exists <small><span class="summary">配列・オブジェクトを問わずキーやプロパティの存在を確認する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/attr_exists.php#L8-L41" target="_blank">attr_exists.php#8~41</a></p>
</div>
<details>
<summary class="">配列・オブジェクトを問わずキーやプロパティの存在を確認する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function attr_exists(
    int|string $key,
    array|object $value
): bool</div></pre>
<div class="description">
<p>配列が与えられた場合は array_key_exists と同じ。<span class="implicit-br">
</span>オブジェクトは一旦 isset で確認した後 null の場合は実際にアクセスして試みる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    'k' =&gt; 'v',
    'n' =&gt; null,
];
// 配列は array_key_exists と同じ
that(attr_exists('k', $array))-&gt;isTrue();  // もちろん存在する
that(attr_exists('n', $array))-&gt;isTrue();  // isset ではないので null も true
that(attr_exists('x', $array))-&gt;isFalse(); // 存在しないので false

$object = (object) $array;
// オブジェクトでも使える
that(attr_exists('k', $object))-&gt;isTrue();  // もちろん存在する
that(attr_exists('n', $object))-&gt;isTrue();  // isset ではないので null も true
that(attr_exists('x', $object))-&gt;isFalse(); // 存在しないので false</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​string</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">調べるキー</span></td>
</tr>
<tr>
<td>​array|​object</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">調べられる配列・オブジェクト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">$key が存在するなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_41af3b9bf48ae6cff76a3b27c11d65b89cb178cd-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-attr_get()" class="anchor"></a>[F] attr_get <small><span class="summary">配列・オブジェクトを問わずキーやプロパティの値を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/attr_get.php#L8-L77" target="_blank">attr_get.php#8~77</a></p>
</div>
<details>
<summary class="">配列・オブジェクトを問わずキーやプロパティの値を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function attr_get(
    int|string $key,
    array|object $value,
    mixed $default = null
): mixed</div></pre>
<div class="description">
<p>配列が与えられた場合は array_key_exists でチェック。<span class="implicit-br">
</span>オブジェクトは一旦 isset で確認した後 null の場合は実際にアクセスして取得する。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$array = [
    'k' =&gt; 'v',
    'n' =&gt; null,
];
that(attr_get('k', $array))-&gt;isSame('v');                  // もちろん存在する
that(attr_get('n', $array))-&gt;isSame(null);                 // isset ではないので null も true
that(attr_get('x', $array, 'default'))-&gt;isSame('default'); // 存在しないのでデフォルト値

$object = (object) $array;
// オブジェクトでも使える
that(attr_get('k', $object))-&gt;isSame('v');                  // もちろん存在する
that(attr_get('n', $object))-&gt;isSame(null);                 // isset ではないので null も true
that(attr_get('x', $object, 'default'))-&gt;isSame('default'); // 存在しないのでデフォルト値</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​string</td>
<td>​<code>$key</code></td>
<td>​<span class="summary">取得するキー</span></td>
</tr>
<tr>
<td>​array|​object</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">取得される配列・オブジェクト</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$default = null</code></td>
<td>​<span class="summary">なかった場合のデフォルト値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">$key の値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6615fa6e776d0135fb2c055f0e7fd5307fa886a8-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-cipher_metadata()" class="anchor"></a>[F] cipher_metadata <small><span class="summary">暗号化アルゴリズムのメタデータを返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/cipher_metadata.php#L7-L161" target="_blank">cipher_metadata.php#7~161</a></p>
</div>
<details>
<summary class="">暗号化アルゴリズムのメタデータを返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function cipher_metadata(string $cipher): array</div></pre>
<div class="description">
<p>※ 内部向け</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$cipher</code></td>
<td>​<span class="summary">暗号化方式（openssl_get_cipher_methods で得られるもの）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">暗号化アルゴリズムのメタデータ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9c473e0d69cb6633743fb341500667959472f01f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-decrypt()" class="anchor"></a>[F] decrypt <small><span class="summary">指定されたパスワードで復号化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/decrypt.php#L9-L109" target="_blank">decrypt.php#9~109</a></p>
</div>
<details>
<summary class="">指定されたパスワードで復号化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function decrypt(
    string $cipherdata,
    string|array $password,
    string|array $ciphers = "aes-256-cbc",
    string $tag = ""
): mixed</div></pre>
<div class="description">
<p>$password は配列で複数与えることができる。<span class="implicit-br">
</span>複数与えた場合、順に試みて複合できた段階でその値を返す。</p>
<p>$ciphers は配列で複数与えることができる。<span class="implicit-br">
</span>複数与えた場合、順に試みて複合できた段階でその値を返す。<span class="implicit-br">
</span>v2 以降は生成文字列に $cipher が含まれているため指定不要（今後指定してはならない）。</p>
<p>復号に失敗すると null を返す。<span class="implicit-br">
</span>単体で使うことはないと思うので詳細は encrypt を参照。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<code>$cipherdata</code></td>
<td>​<span class="summary">復号化するデータ</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$password</code></td>
<td>​<span class="summary">パスワード</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$ciphers = "aes-256-cbc"</code></td>
<td>​<span class="summary">暗号化方式（openssl_get_cipher_methods で得られるもの）</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$tag = ""</code></td>
<td>​<span class="summary">認証タグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">復号化されたデータ</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_952fb6e9714c51d1fb3a8078257a414c3bd04154-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-encrypt()" class="anchor"></a>[F] encrypt <small><span class="summary">指定されたパスワードで暗号化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/encrypt.php#L10-L85" target="_blank">encrypt.php#10~85</a></p>
</div>
<details>
<summary class="">指定されたパスワードで暗号化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function encrypt(
    mixed $plaindata,
    string|array $password,
    string $cipher = null,
    string &amp;$tag = ""
): string</div></pre>
<div class="description">
<p>データは json を経由して base64（URL セーフ） して返す。</p>
<p>$tag を与えると認証タグが設定される（非推奨）。<span class="implicit-br">
</span>$cipher で暗号化メソッドを指定できる（非推奨）。<span class="implicit-br">
</span>v4 から $cipher は aes-256-gcm 決め打ち、結果に $tag が含まれるようになったので引数は2つだけを推奨。<span class="implicit-br">
</span>要するに sodium_crypto_aead_aes256gcm_encrypt+iv と等しくなった。</p>
<p>$password は配列で複数与えることができる。<span class="implicit-br">
</span>複数与えた場合、先頭の要素が使用される。<span class="implicit-br">
</span>これは decrypt との親和性のため（password の変更・移行期間は複数を扱いたいことがある）であり、決して「複数のパスワード対応」ではない。</p>
<p>データ末尾には v が付与される。<span class="implicit-br">
</span>これによって処理が変わり、バージョン違いの暗号化文字列を与えたとしても複合することができる。</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>v0</dt>
<dd>バージョンのない無印。json -&gt; encrypt -&gt; base64</dd>
</div>
<div class="dtdd-container">
<dt>v1</dt>
<dd>上記に圧縮処理を加えたもの。json -&gt; deflate -&gt; encrypt -&gt; base64</dd>
</div>
<div class="dtdd-container">
<dt>v2</dt>
<dd>生成文字列に $cipher, $iv, $tag を加えたもの。json -&gt; deflate -&gt; cipher+iv+tag+encrypt -&gt; base64</dd>
</div>
<div class="dtdd-container">
<dt>v3</dt>
<dd>生成文字列に $iv, $tag, $cipher を加えたもの。json -&gt; deflate -&gt; encrypt+cipher+iv+tag -&gt; base64</dd>
</div>
<div class="dtdd-container">
<dt>v4</dt>
<dd>生成文字列に $tag, $iv を加えたもの。json -&gt; deflate -&gt; encrypt+tag+iv -&gt; base64</dd>
</div>
</dl>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$plaindata = ['a', 'b', 'c'];
$encrypted = encrypt($plaindata, 'password');
$decrypted = decrypt($encrypted, 'password');
// 暗号化されて base64 の文字列になる
that($encrypted)-&gt;isString();
// 復号化されて元の配列になる
that($decrypted)-&gt;isSame(['a', 'b', 'c']);
// password が異なれば失敗して null を返す
that(decrypt($encrypted, 'invalid'))-&gt;isSame(null);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$plaindata</code></td>
<td>​<span class="summary">暗号化するデータ</span></td>
</tr>
<tr>
<td>​string|​array</td>
<td>​<code>$password</code></td>
<td>​<span class="summary">パスワード。十分な長さでなければならない</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$cipher = null</code></td>
<td>​<span class="summary">暗号化方式（openssl_get_cipher_methods で得られるもの）</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>&amp;$tag = ""</code></td>
<td>​<span class="summary">認証タグ</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">暗号化された文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_cda5505a26a3c53a5e084d2db887bb966a6bc496-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-flagval()" class="anchor"></a>[F] flagval <small><span class="summary">falsy の範囲を少し拡張した bool キャスト</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/flagval.php#L7-L39" target="_blank">flagval.php#7~39</a></p>
</div>
<details>
<summary class="">falsy の範囲を少し拡張した bool キャスト</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function flagval(
    mixed $var,
    bool $trim = false
): bool</div></pre>
<div class="description">
<p>例えば ajax 等で  とすると "false" が飛んできてしまうが、その場合も false 判定されるようになる。<span class="implicit-br" style="hoge: false">
</span>この処理は FILTER_VALIDATE_BOOLEAN で行うので "off", "no", 等も false を返す。</p>
<p>あとドキュメントには空白文字について言及がないが、どうも trim される模様。<span class="implicit-br">
</span>trim するかどうかは呼び元で判断すべきだと思う（" true " が true, "    " が false になるのは果たして正しいのか）ので、第2引数で分岐できるようにしてある。<span class="implicit-br">
</span>boolval やキャストでは trim されないようなのでデフォルト false にしてある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// こういう文字列も false になる
that(flagval('false'))-&gt;isFalse();
that(flagval('off'))-&gt;isFalse();
that(flagval('no'))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">bool 化する値</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$trim = false</code></td>
<td>​<span class="summary">$var が文字列の場合に trim するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">bool 化した値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_0bdfe7d20edc352b6cadb4cdf36e4ff5166bd0ca-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-hashvar()" class="anchor"></a>[F] hashvar <small><span class="summary">変数指定をできるようにした compact</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/hashvar.php#L9-L97" target="_blank">hashvar.php#9~97</a></p>
</div>
<details>
<summary class="">変数指定をできるようにした compact</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function hashvar(mixed ...$vars): array</div></pre>
<div class="description">
<p>名前空間指定の呼び出しは未対応。use して関数名だけで呼び出す必要がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">$hoge = 'HOGE';
$fuga = 'FUGA';
that(hashvar($hoge, $fuga))-&gt;isSame(['hoge' =&gt; 'HOGE', 'fuga' =&gt; 'FUGA']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>...$vars</code></td>
<td>​<span class="summary">変数（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​array</td>
<td>​<span class="summary">引数の変数を変数名で compact した配列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_89ef3daf5f81f9018c67195257568185ee21bae4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_arrayable()" class="anchor"></a>[F] is_arrayable <small><span class="summary">変数が配列アクセス可能か調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_arrayable.php#L7-L25" target="_blank">is_arrayable.php#7~25</a></p>
</div>
<details>
<summary class="">変数が配列アクセス可能か調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_arrayable(mixed $var): bool</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(is_arrayable([]))-&gt;isTrue();
that(is_arrayable(new \ArrayObject()))-&gt;isTrue();
that(is_arrayable(new \stdClass()))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">配列アクセス可能なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d288e3687393830b9dfcc2137bf9efe9c7a4c1db-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_decimal()" class="anchor"></a>[F] is_decimal <small><span class="summary">値が10進的か調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_decimal.php#L7-L43" target="_blank">is_decimal.php#7~43</a></p>
</div>
<details>
<summary class="">値が10進的か調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_decimal(
    mixed $var,
    bool $allow_float = true
): bool</div></pre>
<div class="description">
<p>is_numeric を少しキツめにしたような関数で、なるべく「一般人の感覚」で数値とみなせるものを true で返す。</p>
<p>なお、 0 始まりは false だが 0 終わり小数は許容される。<span class="implicit-br">
</span><code>1.20000</code> を false にするような動作だと <code>1.0</code> も false にしなければ一貫性がない。<span class="implicit-br">
</span>しかし <code>1.0</code> が false になるのはあまり一般的とはいえない。</p>
<p>空白込みが false なのは空白許可は呼び元に委ねたいため（trim すればいいだけなので）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 以下は is_numeric と違い false を返す
that(is_decimal('.12'))-&gt;isFalse();  // 整数部省略
that(is_decimal('12.'))-&gt;isFalse();  // 小数部省略
that(is_decimal('1e2'))-&gt;isFalse();  // 指数記法
that(is_decimal(' 12 '))-&gt;isFalse(); // 空白あり
that(is_decimal('012'))-&gt;isFalse();  // 0 始まり</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">判定する値</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$allow_float = true</code></td>
<td>​<span class="summary">false にすると整数のみを許可する</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">数値なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b17a50aee6efe53710742e13303243d737ec8cf2-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_empty()" class="anchor"></a>[F] is_empty <small><span class="summary">値が空か検査する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_empty.php#L7-L71" target="_blank">is_empty.php#7~71</a></p>
</div>
<details>
<summary class="">値が空か検査する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_empty(
    mixed $var,
    bool $empty_stdClass = false
): bool</div></pre>
<div class="description">
<p><code>empty</code> とほぼ同じ。ただし</p>
<dl class="docutils field-list">
<div class="dtdd-container">
<dt>string</dt>
<dd>"0"</dd>
</div>
</dl><li>countable でない object</li>
<li>countable である object で count() &gt; 0</li>

<p>は false 判定する。<span class="implicit-br">
</span>ただし、 $empty_stcClass に true を指定すると「フィールドのない stdClass」も true を返すようになる。<span class="implicit-br">
</span>これは stdClass の立ち位置はかなり特殊で「フィールドアクセスできる組み込み配列」のような扱いをされることが多いため。<span class="implicit-br">
</span>（例えば <code>json_decode('{}')</code> は stdClass を返すが、このような状況は空判定したいことが多いだろう）。</p>
<p>なお、関数の仕様上、未定義変数を true 判定することはできない。<span class="implicit-br">
</span>未定義変数をチェックしたい状況は大抵の場合コードが悪いが <code>$array['key1']['key2']</code> を調べたいことはある。<span class="implicit-br">
</span>そういう時には使えない（?? する必要がある）。</p>
<p>「 <code>if ($var) {}</code> で十分なんだけど "0" が…」という状況はまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// この辺は empty と全く同じ
that(is_empty(null))-&gt;isTrue();
that(is_empty(false))-&gt;isTrue();
that(is_empty(0))-&gt;isTrue();
that(is_empty(''))-&gt;isTrue();
// この辺だけが異なる
that(is_empty('0'))-&gt;isFalse();
// 第2引数に true を渡すと空の stdClass も empty 判定される
$stdclass = new \stdClass();
that(is_empty($stdclass, true))-&gt;isTrue();
// フィールドがあれば empty ではない
$stdclass-&gt;hoge = 123;
that(is_empty($stdclass, true))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">判定する値</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$empty_stdClass = false</code></td>
<td>​<span class="summary">空の stdClass を空とみなすか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">空なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_eaaa631e8a067bb183609c8448f9c13c9f01e2ef-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_empty_recursive()" class="anchor"></a>[F] is_empty_recursive <small><span class="summary">値が空か再帰的に検査する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_empty_recursive.php#L8-L61" target="_blank">is_empty_recursive.php#8~61</a></p>
</div>
<details>
<summary class="">値が空か再帰的に検査する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_empty_recursive(
    mixed $var,
    bool $empty_stdClass = false
): bool</div></pre>
<div class="description">
<p><code>is_empty</code> の再帰版。</p>
<p>クエリパラメータやオプション配列等で「実質値を持っていない」を判定したいことが稀によくある。<span class="implicit-br">
</span>Example を参照。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// このような値を空判定したい
that(is_empty_recursive([
    'query' =&gt; [
        'param1' =&gt; '',
        'param2' =&gt; '',
    ],
    'opt' =&gt; [
        'key1' =&gt; '',
        'key2' =&gt; null,
    ],
]))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">判定する値</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$empty_stdClass = false</code></td>
<td>​<span class="summary">空の stdClass を空とみなすか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">空なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_34d86cc6d6313c5feb084fb8f9a0a20bb9f36a5d-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_exportable()" class="anchor"></a>[F] is_exportable <small><span class="summary">値が var_export で出力可能か検査する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_exportable.php#L9-L82" target="_blank">is_exportable.php#9~82</a></p>
</div>
<details>
<summary class="">値が var_export で出力可能か検査する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_exportable(mixed $var): bool</div></pre>
<div class="description">
<p>「出力可能」とは「意味のある出力」を意味する。<span class="implicit-br">
</span>例えば set_state のないオブジェクトはエラーなく set_state コール形式で出力されるが意味のある出力ではない。<span class="implicit-br">
</span>リソース型はエラーなく NULL で出力されるが意味のある出力ではない。<span class="implicit-br">
</span>循環参照は出力できるものの warning が出てかつ循環は切れるため意味のある出力ではない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(is_primitive(null))-&gt;isTrue();
that(is_primitive(false))-&gt;isTrue();
that(is_primitive(123))-&gt;isTrue();
that(is_primitive(STDIN))-&gt;isTrue();
that(is_primitive(new \stdClass))-&gt;isFalse();
that(is_primitive(['array']))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">出力可能なら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7cf609c7ef0216881ec2005170374ee0f9c30056-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_primitive()" class="anchor"></a>[F] is_primitive <small><span class="summary">値が複合型でないか検査する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_primitive.php#L8-L36" target="_blank">is_primitive.php#8~36</a></p>
</div>
<details>
<summary class="">値が複合型でないか検査する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_primitive(mixed $var): bool</div></pre>
<div class="description">
<p>「複合型」とはオブジェクトと配列のこと。<span class="implicit-br">
</span>つまり</p>
<ul class=" simple">
<li>is_scalar($var) || is_null($var) || is_resource($var)</li>
</ul>
<p>と同義（!is_array($var) &amp;&amp; !is_object($var) とも言える）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(is_primitive(null))-&gt;isTrue();
that(is_primitive(false))-&gt;isTrue();
that(is_primitive(123))-&gt;isTrue();
that(is_primitive(STDIN))-&gt;isTrue();
that(is_primitive(new \stdClass))-&gt;isFalse();
that(is_primitive(['array']))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">複合型なら false</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d5353957b9b68aadcfee33e676ede9a34c6d334e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_recursive()" class="anchor"></a>[F] is_recursive <small><span class="summary">変数が再帰参照を含むか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_recursive.php#L8-L56" target="_blank">is_recursive.php#8~56</a></p>
</div>
<details>
<summary class="">変数が再帰参照を含むか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_recursive(mixed $var): bool</div></pre>
<div class="description">
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 配列の再帰
$array = [];
$array['recursive'] = &amp;$array;
that(is_recursive($array))-&gt;isTrue();
// オブジェクトの再帰
$object = new \stdClass();
$object-&gt;recursive = $object;
that(is_recursive($object))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">再帰参照を含むなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_eddfbd7fd9e5d2d531c14226267b6faf185718aa-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_resourcable()" class="anchor"></a>[F] is_resourcable <small><span class="summary">閉じたリソースでも true を返す is_resource</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_resourcable.php#L7-L39" target="_blank">is_resourcable.php#7~39</a></p>
</div>
<details>
<summary class="">閉じたリソースでも true を返す is_resource</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_resourcable(mixed $var): bool</div></pre>
<div class="description">
<p>マニュアル（ <a href="https://www.php.net/manual/ja/function.is-resource.php" class="link-url">https://www.php.net/manual/ja/function.is-resource.php</a> ）に記載の通り、 isresource は閉じたリソースで false を返す。<span class="implicit-br">
</span>リソースはリソースであり、それでは不便なこともあるので、閉じていようとリソースなら true を返す関数。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 閉じたリソースを用意
$resource = tmpfile();
fclose($resource);
// is_resource は false を返すが・・・
that(is_resource($resource))-&gt;isFalse();
// is_resourcable は true を返す
that(is_resourcable($resource))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">リソースなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_bc3c48100108fad6cad3e1c019468ac381b5aa5c-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_stringable()" class="anchor"></a>[F] is_stringable <small><span class="summary">変数が文字列化できるか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_stringable.php#L7-L40" target="_blank">is_stringable.php#7~40</a></p>
</div>
<details>
<summary class="">変数が文字列化できるか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_stringable(mixed $var): bool</div></pre>
<div class="description">
<p>「配列」「__toString を持たないオブジェクト」が false になる。<span class="implicit-br">
</span>（厳密に言えば配列は "Array" になるので文字列化できるといえるがここでは考えない）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// こいつらは true
that(is_stringable(null))-&gt;isTrue();
that(is_stringable(true))-&gt;isTrue();
that(is_stringable(3.14))-&gt;isTrue();
that(is_stringable(STDOUT))-&gt;isTrue();
that(is_stringable(new \Exception()))-&gt;isTrue();
// こいつらは false
that(is_stringable(new \ArrayObject()))-&gt;isFalse();
that(is_stringable([1, 2, 3]))-&gt;isFalse();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">文字列化できるなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_b491c27fa96950b2ac772a7629cb0cd92875b376-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-is_typeof()" class="anchor"></a>[F] is_typeof <small><span class="summary">変数が型に合致するか調べる</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/is_typeof.php#L8-L85" target="_blank">is_typeof.php#8~85</a></p>
</div>
<details>
<summary class="">変数が型に合致するか調べる</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function is_typeof(
    mixed $var,
    string $typestring,
    null|object|string $context = null
): bool</div></pre>
<div class="description">
<p>is_a のビルトイン＋DNF 対応版。</p>
<p>DNF の場合、括弧は必須だしネストも不可。<span class="implicit-br">
</span>実質的には ReflectionType の文字列表現を与えるのみ。</p>
<p>いわゆる strict_types=1 で、型の変換は伴わない。<span class="implicit-br">
</span>それはそれで不便なことがある（stringable とか）ので対応するかもしれない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(is_typeof(null, 'null'))-&gt;isTrue();
that(is_typeof(null, '?int'))-&gt;isTrue();
that(is_typeof(1234, '?int'))-&gt;isTrue();
that(is_typeof(1234, 'int|string'))-&gt;isTrue();
that(is_typeof('ss', 'int|string'))-&gt;isTrue();
that(is_typeof(null, 'int|string'))-&gt;isFalse();
that(is_typeof([], 'array|(ArrayAccess&amp;Countable&amp;iterable)'))-&gt;isTrue();
that(is_typeof(new \ArrayObject(), 'array|(ArrayAccess&amp;Countable&amp;iterable)'))-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">調べる値</span></td>
</tr>
<tr>
<td>​string</td>
<td>​<code>$typestring</code></td>
<td>​<span class="summary">型文字列</span></td>
</tr>
<tr>
<td>​null|​object|​string</td>
<td>​<code>$context = null</code></td>
<td>​<span class="summary">self,static のコンテキスト</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​bool</td>
<td>​<span class="summary">$typestring に合致するなら true</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_887f615732a769f4536e3903a7c7ff455660973e-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-numberify()" class="anchor"></a>[F] numberify <small><span class="summary">値を何とかして数値化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/numberify.php#L8-L83" target="_blank">numberify.php#8~83</a></p>
</div>
<details>
<summary class="">値を何とかして数値化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function numberify(
    mixed $var,
    bool $decimal = false
): int|float</div></pre>
<div class="description">
<ul class=" simple">
<li>配列は要素数</li>
<li>int/float はそのまま（ただし $decimal に応じた型にキャストされる）</li>
<li>resource はリソースID（php 標準の int キャスト）</li>
<li>null/bool はその int 値（php 標準の int キャストだが $decimal を見る）</li>
<li>それ以外（文字列・オブジェクト）は文字列表現から数値以外を取り除いたもの</li>
</ul>
<p>文字列・オブジェクト以外の変換は互換性を考慮しない。頻繁に変更される可能性がある（特に配列）。</p>
<p>-記号は受け入れるが+記号は受け入れない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 配列は要素数となる
that(numberify([1, 2, 3]))-&gt;isSame(3);
// int/float は基本的にそのまま
that(numberify(123))-&gt;isSame(123);
that(numberify(123.45))-&gt;isSame(123);
that(numberify(123.45, true))-&gt;isSame(123.45);
// 文字列は数値抽出
that(numberify('a1b2c3'))-&gt;isSame(123);
that(numberify('a1b2.c3', true))-&gt;isSame(12.3);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">対象の値</span></td>
</tr>
<tr>
<td>​bool</td>
<td>​<code>$decimal = false</code></td>
<td>​<span class="summary">小数として扱うか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float</td>
<td>​<span class="summary">数値化した値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_87fe4ff6c8fd5a8520a3cd8d14f5c65bc677e216-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-numval()" class="anchor"></a>[F] numval <small><span class="summary">値を数値化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/numval.php#L7-L39" target="_blank">numval.php#7~39</a></p>
</div>
<details>
<summary class="">値を数値化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function numval(
    mixed $var,
    int $base = 10
): int|float</div></pre>
<div class="description">
<p>int か float ならそのまま返す。<span class="implicit-br">
</span>文字列の場合、一言で言えば「.を含むなら float、含まないなら int」を返す。<span class="implicit-br">
</span>int でも float でも stringable でもない場合は実装依存（ただの int キャスト）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(numval(3.14))-&gt;isSame(3.14);   // int や float はそのまま返す
that(numval('3.14'))-&gt;isSame(3.14); // . を含む文字列は float を返す
that(numval('11', 8))-&gt;isSame(9);   // 基数が指定できる</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">数値化する値</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$base = 10</code></td>
<td>​<span class="summary">基数。int 的な値のときしか意味をなさない</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float</td>
<td>​<span class="summary">数値化した値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a72397da0807ec444fd0e3f45a3c7d2b3c469b1f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-phpval()" class="anchor"></a>[F] phpval <small><span class="summary">文字列を php の式として評価して値を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/phpval.php#L8-L52" target="_blank">phpval.php#8~52</a></p>
</div>
<details>
<summary class="">文字列を php の式として評価して値を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function phpval(
    mixed $var,
    array $contextvars = []
): mixed</div></pre>
<div class="description">
<p>実質的には <code>eval("return $var;")</code> とほぼ同義。<span class="implicit-br">
</span>ただ、 eval するまでもない式はそのまま返し、bare な文字列はそのまま文字列として返す（7.2 以前の未定義定数のような動作）。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">that(phpval('strtoupper($var)', ['var' =&gt; 'string']))-&gt;isSame('STRING');
that(phpval('bare string'))-&gt;isSame('bare string');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">評価する式</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$contextvars = []</code></td>
<td>​<span class="summary">eval される場合のローカル変数</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<span class="summary">評価した値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a6d3b4ab739f277bdb54f593821858c31ba87073-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-si_prefix()" class="anchor"></a>[F] si_prefix <small><span class="summary">数値に SI 接頭辞を付与する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/si_prefix.php#L8-L75" target="_blank">si_prefix.php#8~75</a></p>
</div>
<details>
<summary class="">数値に SI 接頭辞を付与する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function si_prefix(
    mixed $var,
    int $unit = 1000,
    string|\Closure $format = "%.3f %s"
): string|array</div></pre>
<div class="description">
<p>値は 1 &lt;= $var &lt; 1000(1024) の範囲内に収められる。<span class="implicit-br">
</span>ヨクト（10^24）～ヨタ（1024）まで。整数だとしても 64bit の範囲を超えるような値の精度は保証しない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// シンプルに k をつける
that(si_prefix(12345))-&gt;isSame('12.345 k');
// シンプルに m をつける
that(si_prefix(0.012345))-&gt;isSame('12.345 m');
// 書式フォーマットを指定できる
that(si_prefix(12345, 1000, '%d%s'))-&gt;isSame('12k');
that(si_prefix(0.012345, 1000, '%d%s'))-&gt;isSame('12m');
// ファイルサイズを byte で表示する
that(si_prefix(12345, 1000, '%d %sbyte'))-&gt;isSame('12 kbyte');
// ファイルサイズを byte で表示する（1024）
that(si_prefix(10240, 1024, '%.3f %sbyte'))-&gt;isSame('10.000 kbyte');
// フォーマットに null を与えると sprintf せずに配列で返す
that(si_prefix(12345, 1000, null))-&gt;isSame([12.345, 'k']);
// フォーマットにクロージャを与えると実行して返す
that(si_prefix(12345, 1000, fn($v, $u) =&gt; number_format($v, 2) . $u))-&gt;isSame('12.35k');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">丸める値</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$unit = 1000</code></td>
<td>​<span class="summary">桁単位。実用上は 1000, 1024 の2値しか指定することはないはず</span></td>
</tr>
<tr>
<td>​string|​<a href="https://php.net/manual/class.closure.php" target="_blank">Closure</a></td>
<td>​<code>$format = "%.3f %s"</code></td>
<td>​<span class="summary">書式フォーマット。 null を与えると sprintf せずに配列で返す</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​array</td>
<td>​<span class="summary">丸めた数値と SI 接頭辞で sprintf した文字列（$format が null の場合は配列）</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_70338eb3a244a209fe49f006254a5ab4d43ad9aa-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-si_unprefix()" class="anchor"></a>[F] si_unprefix <small><span class="summary">SI 接頭辞が付与された文字列を数値化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/si_unprefix.php#L9-L51" target="_blank">si_unprefix.php#9~51</a></p>
</div>
<details>
<summary class="">SI 接頭辞が付与された文字列を数値化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function si_unprefix(
    mixed $var,
    int $unit = 1000,
    $format = "%d%s"
): int|float</div></pre>
<div class="description">
<p>典型的な用途は ini_get で得られた値を数値化したいとき。<span class="implicit-br">
</span>ただし、 ini は 1m のように小文字で指定することもあるので大文字化する必要はある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 1k = 1000
that(si_unprefix('1k'))-&gt;isSame(1000);
// 1k = 1024
that(si_unprefix('1k', 1024))-&gt;isSame(1024);
// m はメガではなくミリ
that(si_unprefix('1m'))-&gt;isSame(0.001);
// M がメガ
that(si_unprefix('1M'))-&gt;isSame(1000000);
// K だけは特別扱いで大文字小文字のどちらでもキロになる
that(si_unprefix('1K'))-&gt;isSame(1000);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">数値化する値</span></td>
</tr>
<tr>
<td>​int</td>
<td>​<code>$unit = 1000</code></td>
<td>​<span class="summary">桁単位。実用上は 1000, 1024 の2値しか指定することはないはず</span></td>
</tr>
<tr>
<td>​</td>
<td>​<code>$format = "%d%s"</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float</td>
<td>​<span class="summary">SI 接頭辞を取り払った実際の数値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d05b2e9c9808a378e1cdc55b2091f1cf7086856a-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-strdec()" class="anchor"></a>[F] strdec <small><span class="summary">0xff,0777 などを10進数値化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/strdec.php#L8-L61" target="_blank">strdec.php#8~61</a></p>
</div>
<details>
<summary class="">0xff,0777 などを10進数値化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function strdec($var): int|float</div></pre>
<div class="description">
<p>php のリテラル形式の数値文字列を int に変換すると考えればよい。<span class="implicit-br">
</span>intval でも似たようなことはできるが、エラーも例外も発生せず静かに 0 を返すので使い勝手が悪い。<span class="implicit-br">
</span>この関数は変換できない場合は例外を投げる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 数値を与えれば数値のまま
that(strdec(12345))-&gt;isSame(12345);
// 通常の10進数字
that(strdec('12345'))-&gt;isSame(12345);
// 16進数字
that(strdec('0xff'))-&gt;isSame(255);
// 8進数字
that(strdec('077'))-&gt;isSame(63);
that(strdec('0o77'))-&gt;isSame(63);
// 2進数字
that(strdec('0b11'))-&gt;isSame(3);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​</td>
<td>​<code>$var</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int|​float</td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_2fd2acf2ec2541547bca8ec8b8ce3f519319fac4-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-stringify()" class="anchor"></a>[F] stringify <small><span class="summary">値を何とかして文字列化する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/stringify.php#L8-L43" target="_blank">stringify.php#8~43</a></p>
</div>
<details>
<summary class="">値を何とかして文字列化する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function stringify(mixed $var): string</div></pre>
<div class="description">
<p>この関数の出力は互換性を考慮しない。頻繁に変更される可能性がある。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">文字列化する値</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">$var を文字列化したもの</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_d7b4c2ddabac6fce83ed97c2ed1a8431f7dd3a17-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_apply()" class="anchor"></a>[F] var_apply <small><span class="summary">値にコールバックを適用する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_apply.php#L7-L46" target="_blank">var_apply.php#7~46</a></p>
</div>
<details>
<summary class="">値にコールバックを適用する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_apply(
    mixed $var,
    callable $callback,
    mixed ...$args
): mixed|array</div></pre>
<div class="description">
<p>普通のスカラー値であれば <code>$callback($var)</code> と全く同じ。<span class="implicit-br">
</span>この関数は「$var が配列だったら中身に適用して返す（再帰）」という点で上記とは異なる。</p>
<p>「配列が与えられたら要素に適用して配列で返す、配列じゃないなら直に適用してそれを返す」という状況はまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 素の値は素の呼び出しと同じ
that(var_apply(' x ', 'trim'))-&gt;isSame('x');
// 配列は中身に適用して配列で返す（再帰）
that(var_apply([' x ', ' y ', [' z ']], 'trim'))-&gt;isSame(['x', 'y', ['z']]);
// 第3引数以降は残り引数を意味する
that(var_apply(['!x!', '!y!'], 'trim', '!'))-&gt;isSame(['x', 'y']);
// 「まれによくある」の具体例
that(var_apply(['&lt;x&gt;', ['&lt;y&gt;']], 'htmlspecialchars', ENT_QUOTES, 'utf-8'))-&gt;isSame(['&amp;lt;x&amp;gt;', ['&amp;lt;y&amp;gt;']]);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">$callback を適用する値</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">値変換コールバック</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$args</code></td>
<td>​<span class="summary">$callback の残り引数（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed|​array</td>
<td>​<span class="summary">$callback が適用された値。元が配列なら配列で返す</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_6db8de26afc5799a3f161c652892e09a468b47e0-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_applys()" class="anchor"></a>[F] var_applys <small><span class="summary">配列にコールバックを適用する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_applys.php#L7-L45" target="_blank">var_applys.php#7~45</a></p>
</div>
<details>
<summary class="">配列にコールバックを適用する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_applys(
    mixed $var,
    callable $callback,
    mixed ...$args
): mixed|array</div></pre>
<div class="description">
<p>配列であれば <code>$callback($var)</code> と全く同じ。<span class="implicit-br">
</span>この関数は「$var がスカラー値だったら配列化して適用してスカラーで返す」という点で上記とは異なる。</p>
<p>「配列を受け取って配列を返す関数があるが、手元にスカラー値しか無い」という状況はまれによくあるはず。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 配列を受け取って中身を大文字化して返すクロージャ
$upper = fn($array) =&gt; array_map('strtoupper', $array);
// 普通はこうやって使うが・・・
that($upper(['a', 'b', 'c']))-&gt;isSame(['A', 'B', 'C']);
// 手元に配列ではなくスカラー値しか無いときはこうせざるをえない
that($upper(['a'])[0])-&gt;isSame('A');
// var_applys を使うと配列でもスカラーでも統一的に記述することができる
that(var_applys(['a', 'b', 'c'], $upper))-&gt;isSame(['A', 'B', 'C']);
that(var_applys('a', $upper))-&gt;isSame('A');
# 要するに「大文字化したい」だけなわけだが、$upper が配列を前提としているので、「大文字化」部分を得るには配列化しなければならなくなっている
# 「strtoupper だけ切り出せばよいのでは？」と思うかもしれないが、「（外部ライブラリなどで）手元に配列しか受け取ってくれない処理しかない」状況がまれによくある</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">$callback を適用する値</span></td>
</tr>
<tr>
<td>​callable</td>
<td>​<code>$callback</code></td>
<td>​<span class="summary">値変換コールバック</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>...$args</code></td>
<td>​<span class="summary">$callback の残り引数（可変引数）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed|​array</td>
<td>​<span class="summary">$callback が適用された値。元が配列なら配列で返す</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1f25821c565d16658afb892577fd36ede6875b4f-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_export2()" class="anchor"></a>[F] var_export2 <small><span class="summary">組み込みの var_export をいい感じにしたもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_export2.php#L14-L163" target="_blank">var_export2.php#14~163</a></p>
</div>
<details>
<summary class="">組み込みの var_export をいい感じにしたもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_export2(
    mixed $value,
    bool|array $options = []
): string|null</div></pre>
<div class="description">
<p>下記の点が異なる。</p>
<ul class=" simple">
<li>配列は 5.4 以降のショートシンタックス（[]）で出力</li>
<li>ただの配列は1行（[1, 2, 3]）でケツカンマなし、連想配列は桁合わせインデントでケツカンマあり</li>
<li>文字列はダブルクオート</li>
<li>null は null（小文字）</li>
<li>再帰構造を渡しても警告がでない（さらに NULL ではなく <code>'*RECURSION*'</code> という文字列になる）</li>
<li>配列の再帰構造の出力が異なる（Example参照）</li>
</ul>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 単純なエクスポート
that(var_export2(['array' =&gt; [1, 2, 3], 'hash' =&gt; ['a' =&gt; 'A', 'b' =&gt; 'B', 'c' =&gt; 'C']], true))-&gt;isSame('[
    "array" =&gt; [1, 2, 3],
    "hash"  =&gt; [
        "a" =&gt; "A",
        "b" =&gt; "B",
        "c" =&gt; "C",
    ],
]');
// 再帰構造を含むエクスポート（標準の var_export は形式が異なる。 var_export すれば分かる）
$rarray = [];
$rarray['a']['b']['c'] = &amp;$rarray;
$robject = new \stdClass();
$robject-&gt;a = new \stdClass();
$robject-&gt;a-&gt;b = new \stdClass();
$robject-&gt;a-&gt;b-&gt;c = $robject;
that(var_export2(compact('rarray', 'robject'), true))-&gt;isSame('[
    "rarray"  =&gt; [
        "a" =&gt; [
            "b" =&gt; [
                "c" =&gt; "*RECURSION*",
            ],
        ],
    ],
    "robject" =&gt; (object) [
        "a" =&gt; (object) [
            "b" =&gt; (object) [
                "c" =&gt; "*RECURSION*",
            ],
        ],
    ],
]');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">出力する値</span></td>
</tr>
<tr>
<td>​bool|​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列（var_export に寄せるため bool も受け付ける）</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string|​null</td>
<td>​<span class="summary">$return=true の場合は出力せず結果を返す</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_1a2f842298b2340a4faaed7b68cef93564c52dbe-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_export3()" class="anchor"></a>[F] var_export3 <small><span class="summary">var_export を色々と出力できるようにしたもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_export3.php#L17-L585" target="_blank">var_export3.php#17~585</a></p>
</div>
<details>
<summary class="">var_export を色々と出力できるようにしたもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_export3(
    mixed $value,
    bool|array $return = false
): string</div></pre>
<div class="description">
<p>php のコードに落とし込むことで serialize と比較してかなり高速に動作する。</p>
<p>各種オブジェクトやクロージャ、循環参照を含む配列など様々なものが出力できる。<span class="implicit-br">
</span>ただし、下記は不可能あるいは復元不可（今度も対応するかは未定）。</p>
<ul class=" simple">
<li>特定の内部クラス（PDO など）</li>
<li>大部分のリソース</li>
</ul>
<p>オブジェクトは「リフレクションを用いてコンストラクタなしで生成してプロパティを代入する」という手法で復元する。<span class="implicit-br">
</span>ただしコンストラクタが必須引数無しの場合はコールされる。<span class="implicit-br">
</span>のでクラスによってはおかしな状態で復元されることがある（大体はリソース型のせいだが…）。<span class="implicit-br">
</span>sleep, wakeup, Serializable などが実装されているとそれはそのまま機能する。<span class="implicit-br">
</span>set_state だけは呼ばれないので注意。</p>
<p>Generator は元となった関数/メソッドを再コールすることで復元される。<span class="implicit-br">
</span>その仕様上、引数があると呼べないし、実行位置はリセットされる。</p>
<p>クロージャはコード自体を引っ張ってきて普通に function (){} として埋め込む。<span class="implicit-br">
</span>クラス名のエイリアスや use, $this バインドなど可能な限り復元するが、おそらくあまりに複雑なことをしてると失敗する。</p>
<p>リソースはファイル的なリソースであればメタ情報を出力して復元時に再オープンする。</p>
<p>軽くベンチを取ったところ、オブジェクトを含まない純粋な配列の場合、serialize の 200 倍くらいは速い（それでも var_export の方が速いが…）。<span class="implicit-br">
</span>オブジェクトを含めば含むほど遅くなり、全要素がオブジェクトになると serialize と同程度になる。<span class="implicit-br">
</span>大体 var_export:var_export3:serialize が 1:5:1000 くらい。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">エクスポートする値</span></td>
</tr>
<tr>
<td>​bool|​array</td>
<td>​<code>$return = false</code></td>
<td>​<span class="summary">返り値として返すなら true. 配列を与えるとオプションになる</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">エクスポートされた文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_feb5508799cc7f1c85173e71a95640542e0bedd7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_hash()" class="anchor"></a>[F] var_hash <small><span class="summary">値に複数のハッシュアルゴリズムを適用させて結合して返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_hash.php#L9-L50" target="_blank">var_hash.php#9~50</a></p>
</div>
<details>
<summary class="">値に複数のハッシュアルゴリズムを適用させて結合して返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_hash(
    mixed $var,
    string[] $algos = ["md5", "sha1"],
    ?bool $base64 = true
): string</div></pre>
<div class="description">
<p>$data は何らかの方法で文字列化される（この「何らかの方法」は互換性を担保しない）。<span class="implicit-br">
</span>文字長がかなり増えるため、 $base64 に true を与えるとバイナリ変換してその結果を base64（url セーフ）して返す。<span class="implicit-br">
</span>さらに false を与えると 16進数文字列で返し、 null を与えるとバイナリ文字列で返す。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 配列をハッシュ化する
that(var_hash(['a', 'b', 'c']))-&gt;isSame('7BDgx6NE2hkXAKtKzhpeJm6-mheMOQWNgrCe7768OiFeoWgA');
// オブジェクトをハッシュ化する
that(var_hash(new \ArrayObject(['a', 'b', 'c'])))-&gt;isSame('-zR2rZ58CzuYhhdHn1Oq90zkYSaxMS-dHUbmb0MTRM4gBpj2');</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">ハッシュ化する値</span></td>
</tr>
<tr>
<td>​string[]</td>
<td>​<code>$algos = ["md5", "sha1"]</code></td>
<td>​<span class="summary">ハッシュアルゴリズム</span></td>
</tr>
<tr>
<td>​?bool</td>
<td>​<code>$base64 = true</code></td>
<td>​<span class="summary">結果を base64 化するか</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">ハッシュ文字列</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_9fe4c94058f879422c4cd8f424868eb935e0d3e7-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_html()" class="anchor"></a>[F] var_html <small><span class="summary">var_export2 を html コンテキストに特化させたようなもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_html.php#L9-L81" target="_blank">var_html.php#9~81</a></p>
</div>
<details>
<summary class="">var_export2 を html コンテキストに特化させたようなもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_html(mixed $value)</div></pre>
<div class="description">
<p>下記のような出力になる。</p>
<ul class=" simple">
<li><code>&lt;pre class='var_html'&gt; ～ &lt;/pre&gt;</code> で囲まれる</li>
<li>php 構文なのでハイライトされて表示される</li>
<li>Content-Type が強制的に text/html になる</li>
</ul>
<p>この関数の出力は互換性を考慮しない。頻繁に変更される可能性がある。</p>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">出力する値</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_a1904fe1f8b8d7a4ac4ca2f78a304cbcd3048dbe-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_mimetype()" class="anchor"></a>[F] var_mimetype <small><span class="summary">値の mimetype を返す</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_mimetype.php#L8-L54" target="_blank">var_mimetype.php#8~54</a></p>
</div>
<details>
<summary class="">値の mimetype を返す</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_mimetype(
    $var,
    ?array &amp;$parameters = null
): ?string</div></pre>
<div class="description">
<p>追加の引数で ; 区切りのパラメータを受け取れる。<span class="implicit-br">
</span>mimetype は <code>タイプ/サブタイプ;引数=値</code> と規約されているので 引数=&gt;値 の連想配列で受け取る。<span class="implicit-br">
</span>したがって返り値は「タイプ/サブタイプ」の文字列で固定となる（ただし失敗時は null を返す）。<span class="implicit-br">
</span>とは言っても finfo の仕様上、現状では charset しか返さない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 普通の文字列は text/plain
that(var_mimetype('plain text', $parameters))-&gt;isSame('text/plain');
// $parameters で引数を受け取れる
that($parameters)-&gt;is(['charset' =&gt; 'us-ascii']);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​</td>
<td>​<code>$var</code></td>
<td>​<span class="summary"></span></td>
</tr>
<tr>
<td>​?array</td>
<td>​<code>&amp;$parameters = null</code></td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​?string</td>
<td>​<span class="summary"></span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_aa210363e2d03938d274f3f5df6b767432ff0447-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_pretty()" class="anchor"></a>[F] var_pretty <small><span class="summary">var_dump の出力を見やすくしたもの</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_pretty.php#L22-L575" target="_blank">var_pretty.php#22~575</a></p>
</div>
<details>
<summary class="">var_dump の出力を見やすくしたもの</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_pretty(
    mixed $value,
    array $options = []
): string</div></pre>
<div class="description">
<p>var_dump はとても縦に長い上見づらいので色や改行・空白を調整して見やすくした。<span class="implicit-br">
</span>sapi に応じて自動で色分けがなされる（$context で指定もできる）。<span class="implicit-br">
</span>また、 xdebug のように呼び出しファイル:行数が先頭に付与される。</p>
<p>この関数の出力は互換性を考慮しない。頻繁に変更される可能性がある。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 下記のように出力される（実際は色付きで出力される）
$using = 123;
var_pretty([
    "array"   =&gt; [1, 2, 3],
    "hash"    =&gt; [
        "a" =&gt; "A",
        "b" =&gt; "B",
        "c" =&gt; "C",
    ],
    "object"  =&gt; new \Exception(),
    "closure" =&gt; function () use ($using) { },
]);
?&gt;
{
  array: [1, 2, 3],
  hash: {
    a: 'A',
    b: 'B',
    c: 'C',
  },
  object: Exception#1 {
    message: '',
    string: '',
    code: 0,
    file: '...',
    line: 19,
    trace: [],
    previous: null,
  },
  closure: Closure#0(static) use {
    using: 123,
  },
}
&lt;?php</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$value</code></td>
<td>​<span class="summary">出力する値</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">出力オプション</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">return: true なら値の出力結果</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_504c1fd0f5d232caa2041866372e0b830c7842c5-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-var_type()" class="anchor"></a>[F] var_type <small><span class="summary">値の型を取得する</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/var_type.php#L11-L303" target="_blank">var_type.php#11~303</a></p>
</div>
<details>
<summary class="">値の型を取得する</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function var_type(
    mixed $var,
    array $options = []
): string</div></pre>
<div class="description">
<p>get_debug_type を少しだけ特殊化したもの。<span class="implicit-br">
</span>「デバッグ用の型」ではなく「コード化したときに埋め込みやすい型」が主目的。</p>
<ul class=" simple">
<li>object の場合は必ず \ が付く</li>
<li>resource の場合はカッコ書き無しで 'resource'</li>
</ul>
<p>無名クラスの場合は extends, implements の優先順位でその名前を使う。<span class="implicit-br">
</span>継承も実装もされていない場合は標準の get_class の結果を返す。</p>
<p>phpdoc に true を渡すと array-shape 記法も有効になり下記のようになる。</p>
<ul class=" simple">
<li>連想配列は想起した通り</li>
<li>連番配列は中身の和集合を取る<ul class=" simple">
<li>中身がさらに配列なら再帰的に処理する<ul class=" simple">
<li>有り無し混在は null 扱いになる</li>
</ul>
</li>
</ul>
</li>
<li>無名クラスは親クラス＋インターフェースを取る<ul class=" simple">
<li>完全無名クラスは object になる</li>
</ul>
</li>
</ul>
<p>phpdoc:true の場合の結果は互換性を考慮しない。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// プリミティブ型は get_debug_type と同義
that(var_type(false))-&gt;isSame('bool');
that(var_type(123))-&gt;isSame('int');
that(var_type(3.14))-&gt;isSame('float');
that(var_type([1, 2, 3]))-&gt;isSame('array');
// リソースはなんでも resource
that(var_type(STDOUT))-&gt;isSame('resource');
// オブジェクトは型名を返す
that(var_type(new \stdClass))-&gt;isSame('\\stdClass');
that(var_type(new \Exception()))-&gt;isSame('\\Exception');
// 無名クラスは継承元の型名を返す（インターフェース実装だけのときはインターフェース名）
that(var_type(new class extends \Exception{}))-&gt;isSame('\\Exception');
that(var_type(new class implements \JsonSerializable{
    public function jsonSerialize(): string { return ''; }
}))-&gt;isSame('\\JsonSerializable');

// phpdoc 形式
that(var_type([
    'scalar'    =&gt; 123,
    'lish-hash' =&gt; [
        ['id' =&gt; 1, 'name' =&gt; 'a'],
        ['id' =&gt; 2, 'name' =&gt; 'b'],
    ],
    'nest'      =&gt; [
        'a' =&gt; [
            'b' =&gt; [
                'c' =&gt; ['a', 'b', 'c'],
            ],
        ],
    ],
], ['phpdoc' =&gt; true, 'format' =&gt; 9]))-&gt;is(&lt;&lt;&lt;ARRAYSHAPE
array{
  "lish-hash": array&lt;array{
    id: int,
    name: string
  }&gt;,
  nest: array{
    a: array{
      b: array{
        c: array&lt;string&gt;
      }
    }
  },
  scalar: int
}
ARRAYSHAPE);</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$var</code></td>
<td>​<span class="summary">型を取得する値</span></td>
</tr>
<tr>
<td>​array</td>
<td>​<code>$options = []</code></td>
<td>​<span class="summary">オプション配列</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​string</td>
<td>​<span class="summary">型名</span></td>
</tr>
</tbody>
</table>
</div>
</details>
</section><section id="_7f89b955bcb9d6f9d13d6011e2b1723a21229097-1" class="section section-level-h4" data-section-level="4"><h4 class="section-header"><a id="ryunosuke-Functions-Package-varcmp()" class="anchor"></a>[F] varcmp <small><span class="summary">php7 の <code>&amp;lt;=&amp;gt;</code> の関数版</span></small></h4>
<div class="right sidebar">
<p class="sidebar-title"></p>
<p><a href="https://github.com/arima-ryunosuke/php-functions/blob/master/src/Package/var/varcmp.php#L8-L90" target="_blank">varcmp.php#8~90</a></p>
</div>
<details>
<summary class="">php7 の <code>&lt;=&gt;</code> の関数版</summary>
<pre data-label="Definitation"><div class="code language-php:Definitation php:Definitation">function varcmp(
    mixed $a,
    mixed $b,
    ?int $mode = null,
    ?int $precision = null
): int</div></pre>
<div class="description">
<p>引数で大文字小文字とか自然順とか型モードとかが指定できる。<span class="implicit-br">
</span>さらに追加で SORT_STRICT という厳密比較フラグを渡すことができる。</p>
<p>Example:</p>
<pre data-label=""><div class="code language-php php">// 'a' と 'z' なら 'z' の方が大きい
that(varcmp('z', 'a') &gt; 0)-&gt;isTrue();
that(varcmp('a', 'z') &lt; 0)-&gt;isTrue();
that(varcmp('a', 'a') === 0)-&gt;isTrue();

// 'a' と 'Z' なら 'a' の方が大きい…が SORT_FLAG_CASE なので 'Z' のほうが大きい
that(varcmp('Z', 'a', SORT_FLAG_CASE) &gt; 0)-&gt;isTrue();
that(varcmp('a', 'Z', SORT_FLAG_CASE) &lt; 0)-&gt;isTrue();
that(varcmp('a', 'A', SORT_FLAG_CASE) === 0)-&gt;isTrue();

// '2' と '12' なら '2' の方が大きい…が SORT_NATURAL なので '12' のほうが大きい
that(varcmp('12', '2', SORT_NATURAL) &gt; 0)-&gt;isTrue();
that(varcmp('2', '12', SORT_NATURAL) &lt; 0)-&gt;isTrue();

// SORT_STRICT 定数が使える（下記はすべて宇宙船演算子を使うと 0 になる）
that(varcmp(['a' =&gt; 'A', 'b' =&gt; 'B'], ['b' =&gt; 'B', 'a' =&gt; 'A'], SORT_STRICT) &lt; 0)-&gt;isTrue();
that(varcmp((object) ['a'], (object) ['a'], SORT_STRICT) &lt; 0)-&gt;isTrue();</div></pre>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Parameter</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​mixed</td>
<td>​<code>$a</code></td>
<td>​<span class="summary">比較する値1</span></td>
</tr>
<tr>
<td>​mixed</td>
<td>​<code>$b</code></td>
<td>​<span class="summary">比較する値2</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$mode = null</code></td>
<td>​<span class="summary">比較モード（SORT_XXX）。省略すると型でよしなに選択</span></td>
</tr>
<tr>
<td>​?int</td>
<td>​<code>$precision = null</code></td>
<td>​<span class="summary">小数比較の際の誤差桁</span></td>
</tr>
</tbody>
</table>
</div>
<div class="wy-table-responsive">
<table class=" no-border docutils align-default has-colgroup has-caption has-top-caption">
<caption style="text-align: left;caption-side: top">Return</caption>
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<thead>
<tr>
<th>type</th>
<th>summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>​int</td>
<td>​<span class="summary">等しいなら 0、 $a のほうが大きいなら &gt; 0、 $bのほうが大きいなら &lt; 0</span></td>
</tr>
</tbody>
</table>
</div>
</details></section></article>                </main>
                <footer>
                    <div class="rst-footer-buttons hidden-single">
                        <div>
                                                    </div>
                        <div>
                                                            <a href="index.html" class="btn btn-neutral" accesskey="u" rel="up"><span class="fa fa-arrow-circle-up" aria-hidden="true"></span> .md/</a>
                                                    </div>
                        <div>
                                                    </div>
                    </div>
                    <hr>
                    <div role="contentinfo">
                        <p>© Copyright Dave Snider, Read the Docs, Inc. &amp; contributors.</p>
                    </div>
                    Built with htmarkdown Using a
                    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
                    provided by <a href="https://readthedocs.org">Read the Docs</a>.
                </footer>
            </div>
        </div>
        <div class="sentinel"></div>
    </div>
</div>
<div data-toggle="wy-nav-shift" class="rst-versions">
    <span class="rst-current-version" data-toggle-target=".rst-versions" data-toggle-class="shift-up">
        <span class="fa fa-cog"> コントロールパネル</span>
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <form class="control-panel">
            <dl>
                <dt>View</dt>
                <dd>
                    <label class="option-title" for="font_family">フォント</label>
                    <input id="fontFamily" class="option-input savedata" data-default-value="sans-serif" type="search" list="fonts">
                    <datalist id="fonts">
                                                    <option value="serif">serif</option>
                                                    <option value="sans-serif">sans-serif</option>
                                                    <option value="monospace">monospace</option>
                                            </datalist>
                </dd>
                <dd>
                    <label class="option-title" for="font_size">フォントサイズ</label>
                    <span>
                        <input id="fontSize" class="option-input savedata" data-default-value="16" type="range" min="10" max="24">
                        <output for="fontSize"></output>
                    </span>
                </dd>
                <dd>
                    <label class="option-title" for="toc_visible">見出し表示</label>
                    <input id="tocVisible" class="option-input savedata" data-default-value="1" type="checkbox" value="1">
                </dd>
                <dt>Head</dt>
                <dd>
                    <label class="option-title" for="toc_width">見出しサイズ</label>
                    <input id="tocWidth" class="option-input savedata" data-default-value="380" type="number" min="0" max="700">
                </dd>
                <dd>
                    <label class="option-title" for="toc_level">見出し表示レベル</label>
                    <input id="tocLevel" class="option-input savedata" data-default-value="3" type="number" min="1" max="6">
                </dd>
                <dd>
                    <label class="option-title" for="toc_sticky">見出し固定レベル</label>
                    <input id="tocSticky" class="option-input savedata" data-default-value="3" type="number" min="0" max="6">
                </dd>
                <dd>
                    <label class="option-title" for="toc_active">アクティブな同レベル見出し</label>
                    <select id="tocActive" class="option-input savedata" data-default-value="some">
                                                    <option value="none">非表示</option>
                                                    <option value="some">一部表示</option>
                                                    <option value="all">すべて表示</option>
                                            </select>
                </dd>
                <dd>
                    <label class="option-title" for="toc_number">見出し番号を表示する</label>
                    <input id="tocNumber" class="option-input savedata" data-default-value="false" type="checkbox" value="1">
                </dd>
                <dd>
                    <label class="option-title" for="toc_child">子見出し数を表示する</label>
                    <input id="tocChild" class="option-input savedata" data-default-value="1" type="checkbox" value="1">
                </dd>
                <dd>
                    <label class="option-title" for="toc_follow">見出しメニューを追従する</label>
                    <input id="tocFollow" class="option-input savedata" data-default-value="1" type="checkbox" value="1">
                </dd>
                <dt>Body</dt>
                <dd>
                    <label class="option-title" for="section_indent">セクションごとのインデント</label>
                    <input id="sectionIndent" class="option-input savedata" data-default-value="0" type="number" min="0" max="6">
                </dd>
                <dd>
                    <label class="option-title" for="highlight_css">シンタックスハイライト</label>
                    <select id="highlightCss" class="option-input savedata" data-default-value="default">
                                                    <option value="default">default</option>
                                                    <option value="zenburn">zenburn</option>
                                                    <option value="github">github</option>
                                                    <option value="vs">vs</option>
                                            </select>
                </dd>
                <dd>
                    <label class="option-title" for="section_number">セクション番号を表示する</label>
                    <input id="sectionNumber" class="option-input savedata" data-default-value="false" type="checkbox" value="1">
                </dd>
                <dd>
                    <label class="option-title" for="link_url">URL を自動リンクする</label>
                    <input id="linkUrl" class="option-input savedata" data-default-value="1" type="checkbox" value="1">
                </dd>
                <dd>
                    <label class="option-title" for="break_line">改行の扱い</label>
                    <select id="breakLine" class="option-input savedata" data-default-value="break">
                                                    <option value="ignore">無視する</option>
                                                    <option value="break">改行する</option>
                                                    <option value="space">スペース</option>
                                            </select>
                </dd>
            </dl>
        </form>
    </div>
</div>
</body>

</html>
